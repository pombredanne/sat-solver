<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>satsolver: src/transaction.c Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<!-- Generated by Doxygen 1.7.1 -->
<div class="navigation" id="top">
  <div class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="pages.html"><span>Related&nbsp;Pages</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
      <li><a href="dirs.html"><span>Directories</span></a></li>
    </ul>
  </div>
  <div class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&nbsp;List</span></a></li>
      <li><a href="globals.html"><span>File&nbsp;Members</span></a></li>
    </ul>
  </div>
  <div class="navpath">
    <ul>
      <li><a class="el" href="dir_4422304925a660d7ad9b44d0ebab103c.html">src</a>      </li>
    </ul>
  </div>
</div>
<div class="header">
  <div class="headertitle">
<h1>transaction.c</h1>  </div>
</div>
<div class="contents">
<a href="transaction_8c.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 <span class="comment">/*</span>
<a name="l00002"></a>00002 <span class="comment"> * Copyright (c) 2007-2009, Novell Inc.</span>
<a name="l00003"></a>00003 <span class="comment"> *</span>
<a name="l00004"></a>00004 <span class="comment"> * This program is licensed under the BSD license, read LICENSE.BSD</span>
<a name="l00005"></a>00005 <span class="comment"> * for further information</span>
<a name="l00006"></a>00006 <span class="comment"> */</span>
<a name="l00007"></a>00007 
<a name="l00008"></a>00008 <span class="comment">/*</span>
<a name="l00009"></a>00009 <span class="comment"> * transaction.c</span>
<a name="l00010"></a>00010 <span class="comment"> *</span>
<a name="l00011"></a>00011 <span class="comment"> * Transaction handling</span>
<a name="l00012"></a>00012 <span class="comment"> */</span>
<a name="l00013"></a>00013 
<a name="l00014"></a>00014 <span class="preprocessor">#include &lt;stdio.h&gt;</span>
<a name="l00015"></a>00015 <span class="preprocessor">#include &lt;stdlib.h&gt;</span>
<a name="l00016"></a>00016 <span class="preprocessor">#include &lt;unistd.h&gt;</span>
<a name="l00017"></a>00017 <span class="preprocessor">#include &lt;string.h&gt;</span>
<a name="l00018"></a>00018 <span class="preprocessor">#include &lt;assert.h&gt;</span>
<a name="l00019"></a>00019 
<a name="l00020"></a>00020 <span class="preprocessor">#include &quot;<a class="code" href="transaction_8h.html">transaction.h</a>&quot;</span>
<a name="l00021"></a>00021 <span class="preprocessor">#include &quot;<a class="code" href="solver_8h.html">solver.h</a>&quot;</span>
<a name="l00022"></a>00022 <span class="preprocessor">#include &quot;<a class="code" href="bitmap_8h.html">bitmap.h</a>&quot;</span>
<a name="l00023"></a>00023 <span class="preprocessor">#include &quot;<a class="code" href="pool_8h.html">pool.h</a>&quot;</span>
<a name="l00024"></a>00024 <span class="preprocessor">#include &quot;<a class="code" href="poolarch_8h.html">poolarch.h</a>&quot;</span>
<a name="l00025"></a>00025 <span class="preprocessor">#include &quot;<a class="code" href="evr_8h.html">evr.h</a>&quot;</span>
<a name="l00026"></a>00026 <span class="preprocessor">#include &quot;<a class="code" href="util_8h.html">util.h</a>&quot;</span>
<a name="l00027"></a>00027 
<a name="l00028"></a>00028 <span class="keyword">static</span> <span class="keywordtype">int</span>
<a name="l00029"></a><a class="code" href="transaction_8c.html#a69014e9e8739378b99b5f0578b8e2e09">00029</a> <a class="code" href="transaction_8c.html#a69014e9e8739378b99b5f0578b8e2e09">obsq_sortcmp</a>(<span class="keyword">const</span> <span class="keywordtype">void</span> *ap, <span class="keyword">const</span> <span class="keywordtype">void</span> *bp, <span class="keywordtype">void</span> *dp)
<a name="l00030"></a>00030 {
<a name="l00031"></a>00031   <a class="code" href="pooltypes_8h.html#a2e0e6278ac51842ca3aeb53e3fc3ead6">Id</a> a, b, oa, ob;
<a name="l00032"></a>00032   <a class="code" href="struct__Pool.html">Pool</a> *pool = dp;
<a name="l00033"></a>00033   <a class="code" href="struct__Solvable.html">Solvable</a> *s, *oas, *obs;
<a name="l00034"></a>00034   <span class="keywordtype">int</span> r;
<a name="l00035"></a>00035 
<a name="l00036"></a>00036   a = ((<a class="code" href="pooltypes_8h.html#a2e0e6278ac51842ca3aeb53e3fc3ead6">Id</a> *)ap)[0];
<a name="l00037"></a>00037   oa = ((<a class="code" href="pooltypes_8h.html#a2e0e6278ac51842ca3aeb53e3fc3ead6">Id</a> *)ap)[1];
<a name="l00038"></a>00038   b = ((<a class="code" href="pooltypes_8h.html#a2e0e6278ac51842ca3aeb53e3fc3ead6">Id</a> *)bp)[0];
<a name="l00039"></a>00039   ob = ((<a class="code" href="pooltypes_8h.html#a2e0e6278ac51842ca3aeb53e3fc3ead6">Id</a> *)bp)[1];
<a name="l00040"></a>00040   <span class="keywordflow">if</span> (a != b)
<a name="l00041"></a>00041     <span class="keywordflow">return</span> a - b;
<a name="l00042"></a>00042   <span class="keywordflow">if</span> (oa == ob)
<a name="l00043"></a>00043     <span class="keywordflow">return</span> 0;
<a name="l00044"></a>00044   s = pool-&gt;<a class="code" href="struct__Pool.html#a9842c936aa241bad13ba13f21a337319">solvables</a> + a;
<a name="l00045"></a>00045   oas = pool-&gt;<a class="code" href="struct__Pool.html#a9842c936aa241bad13ba13f21a337319">solvables</a> + oa;
<a name="l00046"></a>00046   obs = pool-&gt;<a class="code" href="struct__Pool.html#a9842c936aa241bad13ba13f21a337319">solvables</a> + ob;
<a name="l00047"></a>00047   <span class="keywordflow">if</span> (oas-&gt;<a class="code" href="struct__Solvable.html#a5912021e2c3fe505c24a92aa7639dff2">name</a> != obs-&gt;<a class="code" href="struct__Solvable.html#a5912021e2c3fe505c24a92aa7639dff2">name</a>)
<a name="l00048"></a>00048     {
<a name="l00049"></a>00049       <span class="keywordflow">if</span> (oas-&gt;<a class="code" href="struct__Solvable.html#a5912021e2c3fe505c24a92aa7639dff2">name</a> == s-&gt;<a class="code" href="struct__Solvable.html#a5912021e2c3fe505c24a92aa7639dff2">name</a>)
<a name="l00050"></a>00050         <span class="keywordflow">return</span> -1;
<a name="l00051"></a>00051       <span class="keywordflow">if</span> (obs-&gt;<a class="code" href="struct__Solvable.html#a5912021e2c3fe505c24a92aa7639dff2">name</a> == s-&gt;<a class="code" href="struct__Solvable.html#a5912021e2c3fe505c24a92aa7639dff2">name</a>)
<a name="l00052"></a>00052         <span class="keywordflow">return</span> 1;
<a name="l00053"></a>00053       <span class="keywordflow">return</span> strcmp(<a class="code" href="poolid_8c.html#a8a844727bd2258ef240555fc629b2fa7">id2str</a>(pool, oas-&gt;<a class="code" href="struct__Solvable.html#a5912021e2c3fe505c24a92aa7639dff2">name</a>), <a class="code" href="poolid_8c.html#a8a844727bd2258ef240555fc629b2fa7">id2str</a>(pool, obs-&gt;<a class="code" href="struct__Solvable.html#a5912021e2c3fe505c24a92aa7639dff2">name</a>));
<a name="l00054"></a>00054     }
<a name="l00055"></a>00055   r = <a class="code" href="evr_8c.html#af1c0c1a0a8bb84cb85d4e9c9707330ba">evrcmp</a>(pool, oas-&gt;<a class="code" href="struct__Solvable.html#ae776af434c21800db6c01a75c2e6a4f6">evr</a>, obs-&gt;<a class="code" href="struct__Solvable.html#ae776af434c21800db6c01a75c2e6a4f6">evr</a>, <a class="code" href="evr_8h.html#a28017816e556b44b57fd1607ccdfd2b4">EVRCMP_COMPARE</a>);
<a name="l00056"></a>00056   <span class="keywordflow">if</span> (r)
<a name="l00057"></a>00057     <span class="keywordflow">return</span> -r;  <span class="comment">/* highest version first */</span>
<a name="l00058"></a>00058   <span class="keywordflow">return</span> oa - ob;
<a name="l00059"></a>00059 }
<a name="l00060"></a>00060 
<a name="l00061"></a>00061 <span class="keywordtype">void</span>
<a name="l00062"></a><a class="code" href="transaction_8h.html#aaa33152cda972dad9f684b64e376ea05">00062</a> <a class="code" href="transaction_8c.html#aaa33152cda972dad9f684b64e376ea05">transaction_all_obs_pkgs</a>(<a class="code" href="struct__Transaction.html">Transaction</a> *trans, <a class="code" href="pooltypes_8h.html#a2e0e6278ac51842ca3aeb53e3fc3ead6">Id</a> p, <a class="code" href="struct__Queue.html">Queue</a> *pkgs)
<a name="l00063"></a>00063 {
<a name="l00064"></a>00064   <a class="code" href="struct__Pool.html">Pool</a> *pool = trans-&gt;<a class="code" href="struct__Transaction.html#aeec1bcea114aa72e7c8005b8e08a369b">pool</a>;
<a name="l00065"></a>00065   <a class="code" href="struct__Solvable.html">Solvable</a> *s = pool-&gt;<a class="code" href="struct__Pool.html#a9842c936aa241bad13ba13f21a337319">solvables</a> + p;
<a name="l00066"></a>00066   <a class="code" href="struct__Queue.html">Queue</a> *ti = &amp;trans-&gt;<a class="code" href="struct__Transaction.html#aee106dc80baa493cbd7b6f3dd9011845">transaction_info</a>;
<a name="l00067"></a>00067   <a class="code" href="pooltypes_8h.html#a2e0e6278ac51842ca3aeb53e3fc3ead6">Id</a> q;
<a name="l00068"></a>00068   <span class="keywordtype">int</span> i;
<a name="l00069"></a>00069 
<a name="l00070"></a>00070   <a class="code" href="queue_8h.html#aad3334b89bd00dfaa2d483971bd55a7b">queue_empty</a>(pkgs);
<a name="l00071"></a>00071   <span class="keywordflow">if</span> (p &lt;= 0 || !s-&gt;repo)
<a name="l00072"></a>00072     <span class="keywordflow">return</span>;
<a name="l00073"></a>00073   <span class="keywordflow">if</span> (s-&gt;<a class="code" href="struct__Solvable.html#a15e0b77fe061c6429a24215191b10f05">repo</a> == pool-&gt;<a class="code" href="struct__Pool.html#a887053f905054298cd61ce1c99e26690">installed</a>)
<a name="l00074"></a>00074     {
<a name="l00075"></a>00075       q = trans-&gt;<a class="code" href="struct__Transaction.html#a592881da1d794d3ea60272a3938d4bf0">transaction_installed</a>[p - pool-&gt;<a class="code" href="struct__Pool.html#a887053f905054298cd61ce1c99e26690">installed</a>-&gt;<a class="code" href="struct__Repo.html#a4eb2dd93e4a4f88f13d462f2f111e038">start</a>];
<a name="l00076"></a>00076       <span class="keywordflow">if</span> (!q)
<a name="l00077"></a>00077         <span class="keywordflow">return</span>;
<a name="l00078"></a>00078       <span class="keywordflow">if</span> (q &gt; 0)
<a name="l00079"></a>00079         {
<a name="l00080"></a>00080           <a class="code" href="queue_8h.html#a3ba172138b6a04f289def63b198057f1">queue_push</a>(pkgs, q);
<a name="l00081"></a>00081           <span class="keywordflow">return</span>;
<a name="l00082"></a>00082         }
<a name="l00083"></a>00083       <span class="comment">/* find which packages obsolete us */</span>
<a name="l00084"></a>00084       <span class="keywordflow">for</span> (i = 0; i &lt; ti-&gt;<a class="code" href="struct__Queue.html#abb0696a77174cd23b5f488ad4c7b45d2">count</a>; i += 2)
<a name="l00085"></a>00085         <span class="keywordflow">if</span> (ti-&gt;<a class="code" href="struct__Queue.html#a116eb58bed8ff76bf18f9c16cf1ce5c6">elements</a>[i + 1] == p)
<a name="l00086"></a>00086           {
<a name="l00087"></a>00087             <a class="code" href="queue_8h.html#a3ba172138b6a04f289def63b198057f1">queue_push</a>(pkgs, p);
<a name="l00088"></a>00088             <a class="code" href="queue_8h.html#a3ba172138b6a04f289def63b198057f1">queue_push</a>(pkgs, ti-&gt;<a class="code" href="struct__Queue.html#a116eb58bed8ff76bf18f9c16cf1ce5c6">elements</a>[i]);
<a name="l00089"></a>00089           }
<a name="l00090"></a>00090       <span class="comment">/* sort obsoleters */</span>
<a name="l00091"></a>00091       <span class="keywordflow">if</span> (pkgs-&gt;<a class="code" href="struct__Queue.html#abb0696a77174cd23b5f488ad4c7b45d2">count</a> &gt; 2)
<a name="l00092"></a>00092         <a class="code" href="util_8c.html#a23a8607fedc58dfceea738fc835160ab">sat_sort</a>(pkgs-&gt;<a class="code" href="struct__Queue.html#a116eb58bed8ff76bf18f9c16cf1ce5c6">elements</a>, pkgs-&gt;<a class="code" href="struct__Queue.html#abb0696a77174cd23b5f488ad4c7b45d2">count</a> / 2, 2 * <span class="keyword">sizeof</span>(<a class="code" href="pooltypes_8h.html#a2e0e6278ac51842ca3aeb53e3fc3ead6">Id</a>), <a class="code" href="transaction_8c.html#a69014e9e8739378b99b5f0578b8e2e09">obsq_sortcmp</a>, pool);
<a name="l00093"></a>00093       <span class="keywordflow">for</span> (i = 0; i &lt; pkgs-&gt;<a class="code" href="struct__Queue.html#abb0696a77174cd23b5f488ad4c7b45d2">count</a>; i += 2)
<a name="l00094"></a>00094         pkgs-&gt;<a class="code" href="struct__Queue.html#a116eb58bed8ff76bf18f9c16cf1ce5c6">elements</a>[i / 2] = pkgs-&gt;<a class="code" href="struct__Queue.html#a116eb58bed8ff76bf18f9c16cf1ce5c6">elements</a>[i + 1];
<a name="l00095"></a>00095       pkgs-&gt;<a class="code" href="struct__Queue.html#abb0696a77174cd23b5f488ad4c7b45d2">count</a> /= 2;
<a name="l00096"></a>00096     }
<a name="l00097"></a>00097   <span class="keywordflow">else</span>
<a name="l00098"></a>00098     {
<a name="l00099"></a>00099       <span class="comment">/* find the packages we obsolete */</span>
<a name="l00100"></a>00100       <span class="keywordflow">for</span> (i = 0; i &lt; ti-&gt;<a class="code" href="struct__Queue.html#abb0696a77174cd23b5f488ad4c7b45d2">count</a>; i += 2)
<a name="l00101"></a>00101         {
<a name="l00102"></a>00102           <span class="keywordflow">if</span> (ti-&gt;<a class="code" href="struct__Queue.html#a116eb58bed8ff76bf18f9c16cf1ce5c6">elements</a>[i] == p)
<a name="l00103"></a>00103             <a class="code" href="queue_8h.html#a3ba172138b6a04f289def63b198057f1">queue_push</a>(pkgs, ti-&gt;<a class="code" href="struct__Queue.html#a116eb58bed8ff76bf18f9c16cf1ce5c6">elements</a>[i + 1]);
<a name="l00104"></a>00104           <span class="keywordflow">else</span> <span class="keywordflow">if</span> (pkgs-&gt;<a class="code" href="struct__Queue.html#abb0696a77174cd23b5f488ad4c7b45d2">count</a>)
<a name="l00105"></a>00105             <span class="keywordflow">break</span>;
<a name="l00106"></a>00106         }
<a name="l00107"></a>00107     }
<a name="l00108"></a>00108 }
<a name="l00109"></a>00109 
<a name="l00110"></a>00110 <a class="code" href="pooltypes_8h.html#a2e0e6278ac51842ca3aeb53e3fc3ead6">Id</a>
<a name="l00111"></a><a class="code" href="transaction_8h.html#afc85427a4fc858b5e2e60fbfe75f8184">00111</a> <a class="code" href="transaction_8c.html#afc85427a4fc858b5e2e60fbfe75f8184">transaction_obs_pkg</a>(<a class="code" href="struct__Transaction.html">Transaction</a> *trans, <a class="code" href="pooltypes_8h.html#a2e0e6278ac51842ca3aeb53e3fc3ead6">Id</a> p)
<a name="l00112"></a>00112 {
<a name="l00113"></a>00113   <a class="code" href="struct__Pool.html">Pool</a> *pool = trans-&gt;<a class="code" href="struct__Transaction.html#aeec1bcea114aa72e7c8005b8e08a369b">pool</a>;
<a name="l00114"></a>00114   <a class="code" href="struct__Solvable.html">Solvable</a> *s = pool-&gt;<a class="code" href="struct__Pool.html#a9842c936aa241bad13ba13f21a337319">solvables</a> + p;
<a name="l00115"></a>00115   <a class="code" href="struct__Queue.html">Queue</a> ti;
<a name="l00116"></a>00116   <a class="code" href="pooltypes_8h.html#a2e0e6278ac51842ca3aeb53e3fc3ead6">Id</a> tibuf[5];
<a name="l00117"></a>00117 
<a name="l00118"></a>00118   <span class="keywordflow">if</span> (p &lt;= 0 || !s-&gt;repo)
<a name="l00119"></a>00119     <span class="keywordflow">return</span> 0;
<a name="l00120"></a>00120   <span class="keywordflow">if</span> (s-&gt;<a class="code" href="struct__Solvable.html#a15e0b77fe061c6429a24215191b10f05">repo</a> == pool-&gt;<a class="code" href="struct__Pool.html#a887053f905054298cd61ce1c99e26690">installed</a>)
<a name="l00121"></a>00121     {
<a name="l00122"></a>00122       p = trans-&gt;<a class="code" href="struct__Transaction.html#a592881da1d794d3ea60272a3938d4bf0">transaction_installed</a>[p - pool-&gt;<a class="code" href="struct__Pool.html#a887053f905054298cd61ce1c99e26690">installed</a>-&gt;<a class="code" href="struct__Repo.html#a4eb2dd93e4a4f88f13d462f2f111e038">start</a>];
<a name="l00123"></a>00123       <span class="keywordflow">return</span> p &lt; 0 ? -p : p;
<a name="l00124"></a>00124     }
<a name="l00125"></a>00125   <a class="code" href="queue_8c.html#a5988db301609a3b7ab6666e50c61430e">queue_init_buffer</a>(&amp;ti, tibuf, <span class="keyword">sizeof</span>(tibuf)/<span class="keyword">sizeof</span>(*tibuf));
<a name="l00126"></a>00126   <a class="code" href="transaction_8c.html#aaa33152cda972dad9f684b64e376ea05">transaction_all_obs_pkgs</a>(trans, p, &amp;ti);
<a name="l00127"></a>00127   p = ti.<a class="code" href="struct__Queue.html#abb0696a77174cd23b5f488ad4c7b45d2">count</a> ? ti.<a class="code" href="struct__Queue.html#a116eb58bed8ff76bf18f9c16cf1ce5c6">elements</a>[0] : 0;
<a name="l00128"></a>00128   <a class="code" href="queue_8c.html#a701c81a9f7d503837e74d43981e79137">queue_free</a>(&amp;ti);
<a name="l00129"></a>00129   <span class="keywordflow">return</span> p;
<a name="l00130"></a>00130 }
<a name="l00131"></a>00131 
<a name="l00132"></a>00132 
<a name="l00133"></a>00133 <span class="comment">/*</span>
<a name="l00134"></a>00134 <span class="comment"> * calculate base type of transaction element</span>
<a name="l00135"></a>00135 <span class="comment"> */</span>
<a name="l00136"></a>00136 
<a name="l00137"></a>00137 <span class="keyword">static</span> <a class="code" href="pooltypes_8h.html#a2e0e6278ac51842ca3aeb53e3fc3ead6">Id</a>
<a name="l00138"></a><a class="code" href="transaction_8c.html#a566e252a0971f1760d40bbddd0ec2481">00138</a> <a class="code" href="transaction_8c.html#a566e252a0971f1760d40bbddd0ec2481">transaction_base_type</a>(<a class="code" href="struct__Transaction.html">Transaction</a> *trans, <a class="code" href="pooltypes_8h.html#a2e0e6278ac51842ca3aeb53e3fc3ead6">Id</a> p)
<a name="l00139"></a>00139 {
<a name="l00140"></a>00140   <a class="code" href="struct__Pool.html">Pool</a> *pool = trans-&gt;<a class="code" href="struct__Transaction.html#aeec1bcea114aa72e7c8005b8e08a369b">pool</a>;
<a name="l00141"></a>00141   <a class="code" href="struct__Solvable.html">Solvable</a> *s, *s2;
<a name="l00142"></a>00142   <span class="keywordtype">int</span> r;
<a name="l00143"></a>00143   <a class="code" href="pooltypes_8h.html#a2e0e6278ac51842ca3aeb53e3fc3ead6">Id</a> p2;
<a name="l00144"></a>00144 
<a name="l00145"></a>00145   <span class="keywordflow">if</span> (!<a class="code" href="bitmap_8h.html#ad8ccb9ad3a8ad65f5fe08a988acc503d">MAPTST</a>(&amp;trans-&gt;<a class="code" href="struct__Transaction.html#ac0d758cc5496d3cfe62b8c890d21a47b">transactsmap</a>, p))
<a name="l00146"></a>00146     <span class="keywordflow">return</span> SOLVER_TRANSACTION_IGNORE;
<a name="l00147"></a>00147   p2 = <a class="code" href="transaction_8c.html#afc85427a4fc858b5e2e60fbfe75f8184">transaction_obs_pkg</a>(trans, p);
<a name="l00148"></a>00148   <span class="keywordflow">if</span> (pool-&gt;<a class="code" href="struct__Pool.html#a887053f905054298cd61ce1c99e26690">installed</a> &amp;&amp; pool-&gt;<a class="code" href="struct__Pool.html#a9842c936aa241bad13ba13f21a337319">solvables</a>[p].<a class="code" href="struct__Solvable.html#a15e0b77fe061c6429a24215191b10f05">repo</a> == pool-&gt;<a class="code" href="struct__Pool.html#a887053f905054298cd61ce1c99e26690">installed</a>)
<a name="l00149"></a>00149     {
<a name="l00150"></a>00150       <span class="comment">/* erase */</span>
<a name="l00151"></a>00151       <span class="keywordflow">if</span> (!p2)
<a name="l00152"></a>00152         <span class="keywordflow">return</span> SOLVER_TRANSACTION_ERASE;
<a name="l00153"></a>00153       s = pool-&gt;<a class="code" href="struct__Pool.html#a9842c936aa241bad13ba13f21a337319">solvables</a> + p;
<a name="l00154"></a>00154       s2 = pool-&gt;<a class="code" href="struct__Pool.html#a9842c936aa241bad13ba13f21a337319">solvables</a> + p2;
<a name="l00155"></a>00155       <span class="keywordflow">if</span> (s-&gt;<a class="code" href="struct__Solvable.html#a5912021e2c3fe505c24a92aa7639dff2">name</a> == s2-&gt;<a class="code" href="struct__Solvable.html#a5912021e2c3fe505c24a92aa7639dff2">name</a>)
<a name="l00156"></a>00156         {
<a name="l00157"></a>00157           <span class="keywordflow">if</span> (s-&gt;<a class="code" href="struct__Solvable.html#ae776af434c21800db6c01a75c2e6a4f6">evr</a> == s2-&gt;<a class="code" href="struct__Solvable.html#ae776af434c21800db6c01a75c2e6a4f6">evr</a> &amp;&amp; <a class="code" href="pool_8h.html#af238179e2e8d5b218faa7f603f5122e7">solvable_identical</a>(s, s2))
<a name="l00158"></a>00158             <span class="keywordflow">return</span> SOLVER_TRANSACTION_REINSTALLED;
<a name="l00159"></a>00159           r = <a class="code" href="evr_8c.html#af1c0c1a0a8bb84cb85d4e9c9707330ba">evrcmp</a>(pool, s-&gt;<a class="code" href="struct__Solvable.html#ae776af434c21800db6c01a75c2e6a4f6">evr</a>, s2-&gt;<a class="code" href="struct__Solvable.html#ae776af434c21800db6c01a75c2e6a4f6">evr</a>, <a class="code" href="evr_8h.html#a28017816e556b44b57fd1607ccdfd2b4">EVRCMP_COMPARE</a>);
<a name="l00160"></a>00160           <span class="keywordflow">if</span> (r &lt; 0)
<a name="l00161"></a>00161             <span class="keywordflow">return</span> SOLVER_TRANSACTION_UPGRADED;
<a name="l00162"></a>00162           <span class="keywordflow">else</span> <span class="keywordflow">if</span> (r &gt; 0)
<a name="l00163"></a>00163             <span class="keywordflow">return</span> SOLVER_TRANSACTION_DOWNGRADED;
<a name="l00164"></a>00164           <span class="keywordflow">return</span> SOLVER_TRANSACTION_CHANGED;
<a name="l00165"></a>00165         }
<a name="l00166"></a>00166       <span class="keywordflow">return</span> SOLVER_TRANSACTION_OBSOLETED;
<a name="l00167"></a>00167     }
<a name="l00168"></a>00168   <span class="keywordflow">else</span>
<a name="l00169"></a>00169     {
<a name="l00170"></a>00170       <span class="keywordtype">int</span> noobs = trans-&gt;<a class="code" href="struct__Transaction.html#aac87ae47634e99c5266a762ee85d59e5">noobsmap</a>.<a class="code" href="struct__Map.html#a6f33ba32c40c61ac1ab1c96919b77ee0">size</a> &amp;&amp; <a class="code" href="bitmap_8h.html#ad8ccb9ad3a8ad65f5fe08a988acc503d">MAPTST</a>(&amp;trans-&gt;<a class="code" href="struct__Transaction.html#aac87ae47634e99c5266a762ee85d59e5">noobsmap</a>, p);
<a name="l00171"></a>00171       <span class="keywordflow">if</span> (noobs)
<a name="l00172"></a>00172         <span class="keywordflow">return</span> p2 ? <a class="code" href="transaction_8h.html#a19678a508979033e52ed586ae047e492">SOLVER_TRANSACTION_MULTIREINSTALL</a> : SOLVER_TRANSACTION_MULTIINSTALL;
<a name="l00173"></a>00173       <span class="keywordflow">if</span> (!p2)
<a name="l00174"></a>00174         <span class="keywordflow">return</span> SOLVER_TRANSACTION_INSTALL;
<a name="l00175"></a>00175       s = pool-&gt;<a class="code" href="struct__Pool.html#a9842c936aa241bad13ba13f21a337319">solvables</a> + p;
<a name="l00176"></a>00176       s2 = pool-&gt;<a class="code" href="struct__Pool.html#a9842c936aa241bad13ba13f21a337319">solvables</a> + p2;
<a name="l00177"></a>00177       <span class="keywordflow">if</span> (s-&gt;<a class="code" href="struct__Solvable.html#a5912021e2c3fe505c24a92aa7639dff2">name</a> == s2-&gt;<a class="code" href="struct__Solvable.html#a5912021e2c3fe505c24a92aa7639dff2">name</a>)
<a name="l00178"></a>00178         {
<a name="l00179"></a>00179           <span class="keywordflow">if</span> (s-&gt;<a class="code" href="struct__Solvable.html#ae776af434c21800db6c01a75c2e6a4f6">evr</a> == s2-&gt;<a class="code" href="struct__Solvable.html#ae776af434c21800db6c01a75c2e6a4f6">evr</a> &amp;&amp; <a class="code" href="pool_8h.html#af238179e2e8d5b218faa7f603f5122e7">solvable_identical</a>(s, s2))
<a name="l00180"></a>00180             <span class="keywordflow">return</span> SOLVER_TRANSACTION_REINSTALL;
<a name="l00181"></a>00181           r = <a class="code" href="evr_8c.html#af1c0c1a0a8bb84cb85d4e9c9707330ba">evrcmp</a>(pool, s-&gt;<a class="code" href="struct__Solvable.html#ae776af434c21800db6c01a75c2e6a4f6">evr</a>, s2-&gt;<a class="code" href="struct__Solvable.html#ae776af434c21800db6c01a75c2e6a4f6">evr</a>, <a class="code" href="evr_8h.html#a28017816e556b44b57fd1607ccdfd2b4">EVRCMP_COMPARE</a>);
<a name="l00182"></a>00182           <span class="keywordflow">if</span> (r &gt; 0)
<a name="l00183"></a>00183             <span class="keywordflow">return</span> SOLVER_TRANSACTION_UPGRADE;
<a name="l00184"></a>00184           <span class="keywordflow">else</span> <span class="keywordflow">if</span> (r &lt; 0)
<a name="l00185"></a>00185             <span class="keywordflow">return</span> SOLVER_TRANSACTION_DOWNGRADE;
<a name="l00186"></a>00186           <span class="keywordflow">else</span>
<a name="l00187"></a>00187             <span class="keywordflow">return</span> SOLVER_TRANSACTION_CHANGE;
<a name="l00188"></a>00188         }
<a name="l00189"></a>00189       <span class="keywordflow">return</span> SOLVER_TRANSACTION_OBSOLETES;
<a name="l00190"></a>00190     }
<a name="l00191"></a>00191 }
<a name="l00192"></a>00192 
<a name="l00193"></a>00193 <span class="comment">/*</span>
<a name="l00194"></a>00194 <span class="comment"> * return type of transaction element</span>
<a name="l00195"></a>00195 <span class="comment"> *</span>
<a name="l00196"></a>00196 <span class="comment"> * filtering is needed if either not all packages are shown</span>
<a name="l00197"></a>00197 <span class="comment"> * or replaces are not shown, as otherwise parts of the</span>
<a name="l00198"></a>00198 <span class="comment"> * transaction might not be shown to the user */</span>
<a name="l00199"></a>00199 
<a name="l00200"></a>00200 <a class="code" href="pooltypes_8h.html#a2e0e6278ac51842ca3aeb53e3fc3ead6">Id</a>
<a name="l00201"></a><a class="code" href="transaction_8h.html#a2b3fe1e25edd92e0853f45b7ebdbb5af">00201</a> <a class="code" href="transaction_8c.html#a2b3fe1e25edd92e0853f45b7ebdbb5af">transaction_type</a>(<a class="code" href="struct__Transaction.html">Transaction</a> *trans, <a class="code" href="pooltypes_8h.html#a2e0e6278ac51842ca3aeb53e3fc3ead6">Id</a> p, <span class="keywordtype">int</span> mode)
<a name="l00202"></a>00202 {
<a name="l00203"></a>00203   <a class="code" href="struct__Pool.html">Pool</a> *pool = trans-&gt;<a class="code" href="struct__Transaction.html#aeec1bcea114aa72e7c8005b8e08a369b">pool</a>;
<a name="l00204"></a>00204   <a class="code" href="struct__Solvable.html">Solvable</a> *s = pool-&gt;<a class="code" href="struct__Pool.html#a9842c936aa241bad13ba13f21a337319">solvables</a> + p;
<a name="l00205"></a>00205   <a class="code" href="struct__Queue.html">Queue</a> oq, rq;
<a name="l00206"></a>00206   <a class="code" href="pooltypes_8h.html#a2e0e6278ac51842ca3aeb53e3fc3ead6">Id</a> type, q;
<a name="l00207"></a>00207   <span class="keywordtype">int</span> i, j, ref = 0;
<a name="l00208"></a>00208   <span class="keyword">const</span> <span class="keywordtype">char</span> *n;
<a name="l00209"></a>00209 
<a name="l00210"></a>00210   <span class="keywordflow">if</span> (!s-&gt;<a class="code" href="struct__Solvable.html#a15e0b77fe061c6429a24215191b10f05">repo</a>)
<a name="l00211"></a>00211     <span class="keywordflow">return</span> SOLVER_TRANSACTION_IGNORE;
<a name="l00212"></a>00212 
<a name="l00213"></a>00213   n = <a class="code" href="poolid_8c.html#a8a844727bd2258ef240555fc629b2fa7">id2str</a>(pool, s-&gt;<a class="code" href="struct__Solvable.html#a5912021e2c3fe505c24a92aa7639dff2">name</a>);
<a name="l00214"></a>00214   <span class="keywordflow">if</span> (!strncmp(n, <span class="stringliteral">&quot;patch:&quot;</span>, 6))
<a name="l00215"></a>00215     <span class="keywordflow">return</span> SOLVER_TRANSACTION_IGNORE;
<a name="l00216"></a>00216   <span class="keywordflow">if</span> (!strncmp(n, <span class="stringliteral">&quot;pattern:&quot;</span>, 8))
<a name="l00217"></a>00217     <span class="keywordflow">return</span> SOLVER_TRANSACTION_IGNORE;
<a name="l00218"></a>00218 
<a name="l00219"></a>00219   type = <a class="code" href="transaction_8c.html#a566e252a0971f1760d40bbddd0ec2481">transaction_base_type</a>(trans, p);
<a name="l00220"></a>00220 
<a name="l00221"></a>00221   <span class="keywordflow">if</span> (type == <a class="code" href="transaction_8h.html#a93382c70e0d7d65efea1c2fb4e7babca">SOLVER_TRANSACTION_IGNORE</a>)
<a name="l00222"></a>00222     <span class="keywordflow">return</span> SOLVER_TRANSACTION_IGNORE;   <span class="comment">/* not part of the transaction */</span>
<a name="l00223"></a>00223 
<a name="l00224"></a>00224   <span class="keywordflow">if</span> ((mode &amp; <a class="code" href="transaction_8h.html#ab780e639c730b0ebb0ad0a8a67672099">SOLVER_TRANSACTION_RPM_ONLY</a>) != 0)
<a name="l00225"></a>00225     {
<a name="l00226"></a>00226       <span class="comment">/* application wants to know what to feed to rpm */</span>
<a name="l00227"></a>00227       <span class="keywordflow">if</span> (type == <a class="code" href="transaction_8h.html#a6628972c54e3ec89ee96acb65b435642">SOLVER_TRANSACTION_ERASE</a> || type == <a class="code" href="transaction_8h.html#abb82d7761ad043a7a1082477101fd750">SOLVER_TRANSACTION_INSTALL</a> || type == <a class="code" href="transaction_8h.html#a57fdcc82ed23ac10402ef9c06a72e8f6">SOLVER_TRANSACTION_MULTIINSTALL</a>)
<a name="l00228"></a>00228         <span class="keywordflow">return</span> type;
<a name="l00229"></a>00229       <span class="keywordflow">if</span> (s-&gt;<a class="code" href="struct__Solvable.html#a15e0b77fe061c6429a24215191b10f05">repo</a> == pool-&gt;<a class="code" href="struct__Pool.html#a887053f905054298cd61ce1c99e26690">installed</a>)
<a name="l00230"></a>00230         <span class="keywordflow">return</span> SOLVER_TRANSACTION_IGNORE;       <span class="comment">/* ignore as we&#39;re being obsoleted */</span>
<a name="l00231"></a>00231       <span class="keywordflow">if</span> (type == <a class="code" href="transaction_8h.html#a19678a508979033e52ed586ae047e492">SOLVER_TRANSACTION_MULTIREINSTALL</a>)
<a name="l00232"></a>00232         <span class="keywordflow">return</span> SOLVER_TRANSACTION_MULTIINSTALL;
<a name="l00233"></a>00233       <span class="keywordflow">return</span> SOLVER_TRANSACTION_INSTALL;
<a name="l00234"></a>00234     }
<a name="l00235"></a>00235 
<a name="l00236"></a>00236   <span class="keywordflow">if</span> ((mode &amp; <a class="code" href="transaction_8h.html#a55586b4056617eff343aa21c5b203ace">SOLVER_TRANSACTION_SHOW_MULTIINSTALL</a>) == 0)
<a name="l00237"></a>00237     {
<a name="l00238"></a>00238       <span class="comment">/* application wants to make no difference between install</span>
<a name="l00239"></a>00239 <span class="comment">       * and multiinstall */</span>
<a name="l00240"></a>00240       <span class="keywordflow">if</span> (type == <a class="code" href="transaction_8h.html#a57fdcc82ed23ac10402ef9c06a72e8f6">SOLVER_TRANSACTION_MULTIINSTALL</a>)
<a name="l00241"></a>00241         type = SOLVER_TRANSACTION_INSTALL;
<a name="l00242"></a>00242       <span class="keywordflow">if</span> (type == <a class="code" href="transaction_8h.html#a19678a508979033e52ed586ae047e492">SOLVER_TRANSACTION_MULTIREINSTALL</a>)
<a name="l00243"></a>00243         type = SOLVER_TRANSACTION_REINSTALL;
<a name="l00244"></a>00244     }
<a name="l00245"></a>00245 
<a name="l00246"></a>00246   <span class="keywordflow">if</span> ((mode &amp; <a class="code" href="transaction_8h.html#a4f34a888c31b8f3a298b3ade4c4c360e">SOLVER_TRANSACTION_CHANGE_IS_REINSTALL</a>))
<a name="l00247"></a>00247     {
<a name="l00248"></a>00248       <span class="comment">/* application wants to make no difference between change</span>
<a name="l00249"></a>00249 <span class="comment">       * and reinstall */</span>
<a name="l00250"></a>00250       <span class="keywordflow">if</span> (type == <a class="code" href="transaction_8h.html#a8ca5f008e0ccc18a47dd9747a0985ea4">SOLVER_TRANSACTION_CHANGED</a>)
<a name="l00251"></a>00251         type = SOLVER_TRANSACTION_REINSTALLED;
<a name="l00252"></a>00252       <span class="keywordflow">else</span> <span class="keywordflow">if</span> (type == <a class="code" href="transaction_8h.html#a7a095cf21eaf69f25c85917c9bf1ea13">SOLVER_TRANSACTION_CHANGE</a>)
<a name="l00253"></a>00253         type = SOLVER_TRANSACTION_REINSTALL;
<a name="l00254"></a>00254     }
<a name="l00255"></a>00255 
<a name="l00256"></a>00256   <span class="keywordflow">if</span> (type == <a class="code" href="transaction_8h.html#a6628972c54e3ec89ee96acb65b435642">SOLVER_TRANSACTION_ERASE</a> || type == <a class="code" href="transaction_8h.html#abb82d7761ad043a7a1082477101fd750">SOLVER_TRANSACTION_INSTALL</a> || type == <a class="code" href="transaction_8h.html#a57fdcc82ed23ac10402ef9c06a72e8f6">SOLVER_TRANSACTION_MULTIINSTALL</a>)
<a name="l00257"></a>00257     <span class="keywordflow">return</span> type;
<a name="l00258"></a>00258 
<a name="l00259"></a>00259   <span class="keywordflow">if</span> (s-&gt;<a class="code" href="struct__Solvable.html#a15e0b77fe061c6429a24215191b10f05">repo</a> == pool-&gt;<a class="code" href="struct__Pool.html#a887053f905054298cd61ce1c99e26690">installed</a> &amp;&amp; (mode &amp; <a class="code" href="transaction_8h.html#a908897c491200d2f1cbe84e89e9754d2">SOLVER_TRANSACTION_SHOW_ACTIVE</a>) == 0)
<a name="l00260"></a>00260     {
<a name="l00261"></a>00261       <span class="comment">/* erase element and we&#39;re showing the passive side */</span>
<a name="l00262"></a>00262       <span class="keywordflow">if</span> ((mode &amp; <a class="code" href="transaction_8h.html#a7502a80e35d239877c08ff4dd98621ef">SOLVER_TRANSACTION_SHOW_OBSOLETES</a>) == 0 &amp;&amp; type == <a class="code" href="transaction_8h.html#aa6bce21a41d097de81e28cda5f032370">SOLVER_TRANSACTION_OBSOLETED</a>)
<a name="l00263"></a>00263         type = SOLVER_TRANSACTION_ERASE;
<a name="l00264"></a>00264       <span class="keywordflow">return</span> type;
<a name="l00265"></a>00265     }
<a name="l00266"></a>00266   <span class="keywordflow">if</span> (s-&gt;<a class="code" href="struct__Solvable.html#a15e0b77fe061c6429a24215191b10f05">repo</a> != pool-&gt;<a class="code" href="struct__Pool.html#a887053f905054298cd61ce1c99e26690">installed</a> &amp;&amp; (mode &amp; SOLVER_TRANSACTION_SHOW_ACTIVE) != 0)
<a name="l00267"></a>00267     {
<a name="l00268"></a>00268       <span class="comment">/* install element and we&#39;re showing the active side */</span>
<a name="l00269"></a>00269       <span class="keywordflow">if</span> ((mode &amp; <a class="code" href="transaction_8h.html#a7502a80e35d239877c08ff4dd98621ef">SOLVER_TRANSACTION_SHOW_OBSOLETES</a>) == 0 &amp;&amp; type == <a class="code" href="transaction_8h.html#aaabe26749b590e688dd72404e30e013f">SOLVER_TRANSACTION_OBSOLETES</a>)
<a name="l00270"></a>00270         type = SOLVER_TRANSACTION_INSTALL;
<a name="l00271"></a>00271       <span class="keywordflow">return</span> type;
<a name="l00272"></a>00272     }
<a name="l00273"></a>00273 
<a name="l00274"></a>00274   <span class="comment">/* the element doesn&#39;t match the show mode */</span>
<a name="l00275"></a>00275 
<a name="l00276"></a>00276   <span class="comment">/* if we&#39;re showing all references, we can ignore this package */</span>
<a name="l00277"></a>00277   <span class="keywordflow">if</span> ((mode &amp; (<a class="code" href="transaction_8h.html#aab5654bf90e6612aed581955534812a9">SOLVER_TRANSACTION_SHOW_ALL</a>|<a class="code" href="transaction_8h.html#a7502a80e35d239877c08ff4dd98621ef">SOLVER_TRANSACTION_SHOW_OBSOLETES</a>)) == (<a class="code" href="transaction_8h.html#aab5654bf90e6612aed581955534812a9">SOLVER_TRANSACTION_SHOW_ALL</a>|<a class="code" href="transaction_8h.html#a7502a80e35d239877c08ff4dd98621ef">SOLVER_TRANSACTION_SHOW_OBSOLETES</a>))
<a name="l00278"></a>00278     <span class="keywordflow">return</span> SOLVER_TRANSACTION_IGNORE;
<a name="l00279"></a>00279 
<a name="l00280"></a>00280   <span class="comment">/* we&#39;re not showing all refs. check if some other package</span>
<a name="l00281"></a>00281 <span class="comment">   * references us. If yes, it&#39;s safe to ignore this package,</span>
<a name="l00282"></a>00282 <span class="comment">   * otherwise we need to map the type */</span>
<a name="l00283"></a>00283 
<a name="l00284"></a>00284   <span class="comment">/* most of the time there&#39;s only one reference, so check it first */</span>
<a name="l00285"></a>00285   q = <a class="code" href="transaction_8c.html#afc85427a4fc858b5e2e60fbfe75f8184">transaction_obs_pkg</a>(trans, p);
<a name="l00286"></a>00286 
<a name="l00287"></a>00287   <span class="keywordflow">if</span> ((mode &amp; <a class="code" href="transaction_8h.html#a7502a80e35d239877c08ff4dd98621ef">SOLVER_TRANSACTION_SHOW_OBSOLETES</a>) == 0)
<a name="l00288"></a>00288     {
<a name="l00289"></a>00289       <a class="code" href="struct__Solvable.html">Solvable</a> *sq = pool-&gt;<a class="code" href="struct__Pool.html#a9842c936aa241bad13ba13f21a337319">solvables</a> + q;
<a name="l00290"></a>00290       <span class="keywordflow">if</span> (sq-&gt;<a class="code" href="struct__Solvable.html#a5912021e2c3fe505c24a92aa7639dff2">name</a> != s-&gt;<a class="code" href="struct__Solvable.html#a5912021e2c3fe505c24a92aa7639dff2">name</a>)
<a name="l00291"></a>00291         {
<a name="l00292"></a>00292           <span class="comment">/* it&#39;s a replace but we&#39;re not showing replaces. map type. */</span>
<a name="l00293"></a>00293           <span class="keywordflow">if</span> (s-&gt;<a class="code" href="struct__Solvable.html#a15e0b77fe061c6429a24215191b10f05">repo</a> == pool-&gt;<a class="code" href="struct__Pool.html#a887053f905054298cd61ce1c99e26690">installed</a>)
<a name="l00294"></a>00294             <span class="keywordflow">return</span> SOLVER_TRANSACTION_ERASE;
<a name="l00295"></a>00295           <span class="keywordflow">else</span> <span class="keywordflow">if</span> (type == <a class="code" href="transaction_8h.html#a19678a508979033e52ed586ae047e492">SOLVER_TRANSACTION_MULTIREINSTALL</a>)
<a name="l00296"></a>00296             <span class="keywordflow">return</span> SOLVER_TRANSACTION_MULTIINSTALL;
<a name="l00297"></a>00297           <span class="keywordflow">else</span>
<a name="l00298"></a>00298             <span class="keywordflow">return</span> SOLVER_TRANSACTION_INSTALL;
<a name="l00299"></a>00299         }
<a name="l00300"></a>00300     }
<a name="l00301"></a>00301   
<a name="l00302"></a>00302   <span class="comment">/* if there&#39;s a match, p will be shown when q</span>
<a name="l00303"></a>00303 <span class="comment">   * is processed */</span>
<a name="l00304"></a>00304   <span class="keywordflow">if</span> (<a class="code" href="transaction_8c.html#afc85427a4fc858b5e2e60fbfe75f8184">transaction_obs_pkg</a>(trans, q) == p)
<a name="l00305"></a>00305     <span class="keywordflow">return</span> SOLVER_TRANSACTION_IGNORE;
<a name="l00306"></a>00306 
<a name="l00307"></a>00307   <span class="comment">/* too bad, a miss. check em all */</span>
<a name="l00308"></a>00308   <a class="code" href="queue_8c.html#ae1a64f63dd8cc46bdb2bcd415aa89e5a">queue_init</a>(&amp;oq);
<a name="l00309"></a>00309   <a class="code" href="queue_8c.html#ae1a64f63dd8cc46bdb2bcd415aa89e5a">queue_init</a>(&amp;rq);
<a name="l00310"></a>00310   <a class="code" href="transaction_8c.html#aaa33152cda972dad9f684b64e376ea05">transaction_all_obs_pkgs</a>(trans, p, &amp;oq);
<a name="l00311"></a>00311   <span class="keywordflow">for</span> (i = 0; i &lt; oq.<a class="code" href="struct__Queue.html#abb0696a77174cd23b5f488ad4c7b45d2">count</a>; i++)
<a name="l00312"></a>00312     {
<a name="l00313"></a>00313       q = oq.<a class="code" href="struct__Queue.html#a116eb58bed8ff76bf18f9c16cf1ce5c6">elements</a>[i];
<a name="l00314"></a>00314       <span class="keywordflow">if</span> ((mode &amp; SOLVER_TRANSACTION_SHOW_OBSOLETES) == 0)
<a name="l00315"></a>00315         {
<a name="l00316"></a>00316           <a class="code" href="struct__Solvable.html">Solvable</a> *sq = pool-&gt;<a class="code" href="struct__Pool.html#a9842c936aa241bad13ba13f21a337319">solvables</a> + q;
<a name="l00317"></a>00317           <span class="keywordflow">if</span> (sq-&gt;<a class="code" href="struct__Solvable.html#a5912021e2c3fe505c24a92aa7639dff2">name</a> != s-&gt;<a class="code" href="struct__Solvable.html#a5912021e2c3fe505c24a92aa7639dff2">name</a>)
<a name="l00318"></a>00318             <span class="keywordflow">continue</span>;
<a name="l00319"></a>00319         }
<a name="l00320"></a>00320       <span class="comment">/* check if we are referenced? */</span>
<a name="l00321"></a>00321       <span class="keywordflow">if</span> ((mode &amp; <a class="code" href="transaction_8h.html#aab5654bf90e6612aed581955534812a9">SOLVER_TRANSACTION_SHOW_ALL</a>) != 0)
<a name="l00322"></a>00322         {
<a name="l00323"></a>00323           <a class="code" href="transaction_8c.html#aaa33152cda972dad9f684b64e376ea05">transaction_all_obs_pkgs</a>(trans, q, &amp;rq);
<a name="l00324"></a>00324           <span class="keywordflow">for</span> (j = 0; j &lt; rq.<a class="code" href="struct__Queue.html#abb0696a77174cd23b5f488ad4c7b45d2">count</a>; j++)
<a name="l00325"></a>00325             <span class="keywordflow">if</span> (rq.<a class="code" href="struct__Queue.html#a116eb58bed8ff76bf18f9c16cf1ce5c6">elements</a>[j] == p)
<a name="l00326"></a>00326               {
<a name="l00327"></a>00327                 ref = 1;
<a name="l00328"></a>00328                 <span class="keywordflow">break</span>;
<a name="l00329"></a>00329               }
<a name="l00330"></a>00330           <span class="keywordflow">if</span> (ref)
<a name="l00331"></a>00331             <span class="keywordflow">break</span>;
<a name="l00332"></a>00332         }
<a name="l00333"></a>00333       <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="transaction_8c.html#afc85427a4fc858b5e2e60fbfe75f8184">transaction_obs_pkg</a>(trans, q) == p)
<a name="l00334"></a>00334         {
<a name="l00335"></a>00335           ref = 1;
<a name="l00336"></a>00336           <span class="keywordflow">break</span>;
<a name="l00337"></a>00337         }
<a name="l00338"></a>00338     }
<a name="l00339"></a>00339   <a class="code" href="queue_8c.html#a701c81a9f7d503837e74d43981e79137">queue_free</a>(&amp;oq);
<a name="l00340"></a>00340   <a class="code" href="queue_8c.html#a701c81a9f7d503837e74d43981e79137">queue_free</a>(&amp;rq);
<a name="l00341"></a>00341 
<a name="l00342"></a>00342   <span class="keywordflow">if</span> (!ref)
<a name="l00343"></a>00343     {
<a name="l00344"></a>00344       <span class="comment">/* we&#39;re not referenced. map type */</span>
<a name="l00345"></a>00345       <span class="keywordflow">if</span> (s-&gt;<a class="code" href="struct__Solvable.html#a15e0b77fe061c6429a24215191b10f05">repo</a> == pool-&gt;<a class="code" href="struct__Pool.html#a887053f905054298cd61ce1c99e26690">installed</a>)
<a name="l00346"></a>00346         <span class="keywordflow">return</span> SOLVER_TRANSACTION_ERASE;
<a name="l00347"></a>00347       <span class="keywordflow">else</span> <span class="keywordflow">if</span> (type == <a class="code" href="transaction_8h.html#a19678a508979033e52ed586ae047e492">SOLVER_TRANSACTION_MULTIREINSTALL</a>)
<a name="l00348"></a>00348         <span class="keywordflow">return</span> SOLVER_TRANSACTION_MULTIINSTALL;
<a name="l00349"></a>00349       <span class="keywordflow">else</span>
<a name="l00350"></a>00350         <span class="keywordflow">return</span> SOLVER_TRANSACTION_INSTALL;
<a name="l00351"></a>00351     }
<a name="l00352"></a>00352   <span class="comment">/* there was a ref, so p is shown with some other package */</span>
<a name="l00353"></a>00353   <span class="keywordflow">return</span> SOLVER_TRANSACTION_IGNORE;
<a name="l00354"></a>00354 }
<a name="l00355"></a>00355 
<a name="l00356"></a>00356 
<a name="l00357"></a>00357 
<a name="l00358"></a>00358 <span class="keyword">static</span> <span class="keywordtype">int</span>
<a name="l00359"></a><a class="code" href="transaction_8c.html#a784b96fe4248f9102eeca3bc404217ef">00359</a> <a class="code" href="transaction_8c.html#a784b96fe4248f9102eeca3bc404217ef">classify_cmp</a>(<span class="keyword">const</span> <span class="keywordtype">void</span> *ap, <span class="keyword">const</span> <span class="keywordtype">void</span> *bp, <span class="keywordtype">void</span> *dp)
<a name="l00360"></a>00360 {
<a name="l00361"></a>00361   <a class="code" href="struct__Transaction.html">Transaction</a> *trans = dp;
<a name="l00362"></a>00362   <a class="code" href="struct__Pool.html">Pool</a> *pool = trans-&gt;<a class="code" href="struct__Transaction.html#aeec1bcea114aa72e7c8005b8e08a369b">pool</a>;
<a name="l00363"></a>00363   <span class="keyword">const</span> <a class="code" href="pooltypes_8h.html#a2e0e6278ac51842ca3aeb53e3fc3ead6">Id</a> *a = ap;
<a name="l00364"></a>00364   <span class="keyword">const</span> <a class="code" href="pooltypes_8h.html#a2e0e6278ac51842ca3aeb53e3fc3ead6">Id</a> *b = bp;
<a name="l00365"></a>00365   <span class="keywordtype">int</span> r;
<a name="l00366"></a>00366 
<a name="l00367"></a>00367   r = a[0] - b[0];
<a name="l00368"></a>00368   <span class="keywordflow">if</span> (r)
<a name="l00369"></a>00369     <span class="keywordflow">return</span> r;
<a name="l00370"></a>00370   r = a[2] - b[2];
<a name="l00371"></a>00371   <span class="keywordflow">if</span> (r)
<a name="l00372"></a>00372     <span class="keywordflow">return</span> a[2] &amp;&amp; b[2] ? strcmp(<a class="code" href="poolid_8c.html#a8a844727bd2258ef240555fc629b2fa7">id2str</a>(pool, a[2]), <a class="code" href="poolid_8c.html#a8a844727bd2258ef240555fc629b2fa7">id2str</a>(pool, b[2])) : r;
<a name="l00373"></a>00373   r = a[3] - b[3];
<a name="l00374"></a>00374   <span class="keywordflow">if</span> (r)
<a name="l00375"></a>00375     <span class="keywordflow">return</span> a[3] &amp;&amp; b[3] ? strcmp(<a class="code" href="poolid_8c.html#a8a844727bd2258ef240555fc629b2fa7">id2str</a>(pool, a[3]), <a class="code" href="poolid_8c.html#a8a844727bd2258ef240555fc629b2fa7">id2str</a>(pool, b[3])) : r;
<a name="l00376"></a>00376   <span class="keywordflow">return</span> 0;
<a name="l00377"></a>00377 }
<a name="l00378"></a>00378 
<a name="l00379"></a>00379 <span class="keyword">static</span> <span class="keywordtype">int</span>
<a name="l00380"></a><a class="code" href="transaction_8c.html#a2a0f5c05d570beeb9c00b5b813d7a4f1">00380</a> <a class="code" href="transaction_8c.html#a2a0f5c05d570beeb9c00b5b813d7a4f1">classify_cmp_pkgs</a>(<span class="keyword">const</span> <span class="keywordtype">void</span> *ap, <span class="keyword">const</span> <span class="keywordtype">void</span> *bp, <span class="keywordtype">void</span> *dp)
<a name="l00381"></a>00381 {
<a name="l00382"></a>00382   <a class="code" href="struct__Transaction.html">Transaction</a> *trans = dp;
<a name="l00383"></a>00383   <a class="code" href="struct__Pool.html">Pool</a> *pool = trans-&gt;<a class="code" href="struct__Transaction.html#aeec1bcea114aa72e7c8005b8e08a369b">pool</a>;
<a name="l00384"></a>00384   <a class="code" href="pooltypes_8h.html#a2e0e6278ac51842ca3aeb53e3fc3ead6">Id</a> a = *(<a class="code" href="pooltypes_8h.html#a2e0e6278ac51842ca3aeb53e3fc3ead6">Id</a> *)ap;
<a name="l00385"></a>00385   <a class="code" href="pooltypes_8h.html#a2e0e6278ac51842ca3aeb53e3fc3ead6">Id</a> b = *(<a class="code" href="pooltypes_8h.html#a2e0e6278ac51842ca3aeb53e3fc3ead6">Id</a> *)bp;
<a name="l00386"></a>00386   <a class="code" href="struct__Solvable.html">Solvable</a> *sa, *sb;
<a name="l00387"></a>00387 
<a name="l00388"></a>00388   sa = pool-&gt;<a class="code" href="struct__Pool.html#a9842c936aa241bad13ba13f21a337319">solvables</a> + a;
<a name="l00389"></a>00389   sb = pool-&gt;<a class="code" href="struct__Pool.html#a9842c936aa241bad13ba13f21a337319">solvables</a> + b;
<a name="l00390"></a>00390   <span class="keywordflow">if</span> (sa-&gt;<a class="code" href="struct__Solvable.html#a5912021e2c3fe505c24a92aa7639dff2">name</a> != sb-&gt;<a class="code" href="struct__Solvable.html#a5912021e2c3fe505c24a92aa7639dff2">name</a>)
<a name="l00391"></a>00391     <span class="keywordflow">return</span> strcmp(<a class="code" href="poolid_8c.html#a8a844727bd2258ef240555fc629b2fa7">id2str</a>(pool, sa-&gt;<a class="code" href="struct__Solvable.html#a5912021e2c3fe505c24a92aa7639dff2">name</a>), <a class="code" href="poolid_8c.html#a8a844727bd2258ef240555fc629b2fa7">id2str</a>(pool, sb-&gt;<a class="code" href="struct__Solvable.html#a5912021e2c3fe505c24a92aa7639dff2">name</a>));
<a name="l00392"></a>00392   <span class="keywordflow">if</span> (sa-&gt;<a class="code" href="struct__Solvable.html#ae776af434c21800db6c01a75c2e6a4f6">evr</a> != sb-&gt;<a class="code" href="struct__Solvable.html#ae776af434c21800db6c01a75c2e6a4f6">evr</a>)
<a name="l00393"></a>00393     {
<a name="l00394"></a>00394       <span class="keywordtype">int</span> r = <a class="code" href="evr_8c.html#af1c0c1a0a8bb84cb85d4e9c9707330ba">evrcmp</a>(pool, sa-&gt;<a class="code" href="struct__Solvable.html#ae776af434c21800db6c01a75c2e6a4f6">evr</a>, sb-&gt;<a class="code" href="struct__Solvable.html#ae776af434c21800db6c01a75c2e6a4f6">evr</a>, <a class="code" href="evr_8h.html#a28017816e556b44b57fd1607ccdfd2b4">EVRCMP_COMPARE</a>);
<a name="l00395"></a>00395       <span class="keywordflow">if</span> (r)
<a name="l00396"></a>00396         <span class="keywordflow">return</span> r;
<a name="l00397"></a>00397     }
<a name="l00398"></a>00398   <span class="keywordflow">return</span> a - b;
<a name="l00399"></a>00399 }
<a name="l00400"></a>00400 
<a name="l00401"></a>00401 <span class="keywordtype">void</span>
<a name="l00402"></a><a class="code" href="transaction_8h.html#a0aaba93d9c1458f90d9b1bd9c2fb5ecc">00402</a> <a class="code" href="transaction_8c.html#a0aaba93d9c1458f90d9b1bd9c2fb5ecc">transaction_classify</a>(<a class="code" href="struct__Transaction.html">Transaction</a> *trans, <span class="keywordtype">int</span> mode, <a class="code" href="struct__Queue.html">Queue</a> *classes)
<a name="l00403"></a>00403 {
<a name="l00404"></a>00404   <a class="code" href="struct__Pool.html">Pool</a> *pool = trans-&gt;<a class="code" href="struct__Transaction.html#aeec1bcea114aa72e7c8005b8e08a369b">pool</a>;
<a name="l00405"></a>00405   <span class="keywordtype">int</span> ntypes[<a class="code" href="transaction_8h.html#a69366819a9e5bef976fba868033791e9">SOLVER_TRANSACTION_MAXTYPE</a> + 1];
<a name="l00406"></a>00406   <a class="code" href="struct__Solvable.html">Solvable</a> *s, *sq;
<a name="l00407"></a>00407   <a class="code" href="pooltypes_8h.html#a2e0e6278ac51842ca3aeb53e3fc3ead6">Id</a> v, vq, type, p, q;
<a name="l00408"></a>00408   <span class="keywordtype">int</span> i, j;
<a name="l00409"></a>00409 
<a name="l00410"></a>00410   <a class="code" href="queue_8h.html#aad3334b89bd00dfaa2d483971bd55a7b">queue_empty</a>(classes);
<a name="l00411"></a>00411   memset(ntypes, 0, <span class="keyword">sizeof</span>(ntypes));
<a name="l00412"></a>00412   <span class="comment">/* go through transaction and classify each step */</span>
<a name="l00413"></a>00413   <span class="keywordflow">for</span> (i = 0; i &lt; trans-&gt;<a class="code" href="struct__Transaction.html#a7e05d837578f51e0a26658a2ae37fc4d">steps</a>.<a class="code" href="struct__Queue.html#abb0696a77174cd23b5f488ad4c7b45d2">count</a>; i++)
<a name="l00414"></a>00414     {
<a name="l00415"></a>00415       p = trans-&gt;<a class="code" href="struct__Transaction.html#a7e05d837578f51e0a26658a2ae37fc4d">steps</a>.<a class="code" href="struct__Queue.html#a116eb58bed8ff76bf18f9c16cf1ce5c6">elements</a>[i];
<a name="l00416"></a>00416       s = pool-&gt;<a class="code" href="struct__Pool.html#a9842c936aa241bad13ba13f21a337319">solvables</a> + p;
<a name="l00417"></a>00417       type = <a class="code" href="transaction_8c.html#a2b3fe1e25edd92e0853f45b7ebdbb5af">transaction_type</a>(trans, p, mode);
<a name="l00418"></a>00418       ntypes[type]++;
<a name="l00419"></a>00419       <span class="keywordflow">if</span> (!pool-&gt;<a class="code" href="struct__Pool.html#a887053f905054298cd61ce1c99e26690">installed</a> || s-&gt;<a class="code" href="struct__Solvable.html#a15e0b77fe061c6429a24215191b10f05">repo</a> != pool-&gt;<a class="code" href="struct__Pool.html#a887053f905054298cd61ce1c99e26690">installed</a>)
<a name="l00420"></a>00420         <span class="keywordflow">continue</span>;
<a name="l00421"></a>00421       <span class="comment">/* look at arch/vendor changes */</span>
<a name="l00422"></a>00422       q = <a class="code" href="transaction_8c.html#afc85427a4fc858b5e2e60fbfe75f8184">transaction_obs_pkg</a>(trans, p);
<a name="l00423"></a>00423       <span class="keywordflow">if</span> (!q)
<a name="l00424"></a>00424         <span class="keywordflow">continue</span>;
<a name="l00425"></a>00425       sq = pool-&gt;<a class="code" href="struct__Pool.html#a9842c936aa241bad13ba13f21a337319">solvables</a> + q;
<a name="l00426"></a>00426 
<a name="l00427"></a>00427       v = s-&gt;<a class="code" href="struct__Solvable.html#a51ba374144373934101befc2bd20150b">arch</a>;
<a name="l00428"></a>00428       vq = sq-&gt;<a class="code" href="struct__Solvable.html#a51ba374144373934101befc2bd20150b">arch</a>;
<a name="l00429"></a>00429       <span class="keywordflow">if</span> (v != vq)
<a name="l00430"></a>00430         {
<a name="l00431"></a>00431           <span class="keywordflow">if</span> ((mode &amp; <a class="code" href="transaction_8h.html#aac905c805f2f4c4b02b271ba1141f40f">SOLVER_TRANSACTION_MERGE_ARCHCHANGES</a>) != 0)
<a name="l00432"></a>00432             v = vq = 0;
<a name="l00433"></a>00433           <span class="keywordflow">for</span> (j = 0; j &lt; classes-&gt;<a class="code" href="struct__Queue.html#abb0696a77174cd23b5f488ad4c7b45d2">count</a>; j += 4)
<a name="l00434"></a>00434             <span class="keywordflow">if</span> (classes-&gt;<a class="code" href="struct__Queue.html#a116eb58bed8ff76bf18f9c16cf1ce5c6">elements</a>[j] == <a class="code" href="transaction_8h.html#a54bc6736d4cc1b026b7d31182a29e1d2">SOLVER_TRANSACTION_ARCHCHANGE</a> &amp;&amp; classes-&gt;<a class="code" href="struct__Queue.html#a116eb58bed8ff76bf18f9c16cf1ce5c6">elements</a>[j + 2] == v &amp;&amp; classes-&gt;<a class="code" href="struct__Queue.html#a116eb58bed8ff76bf18f9c16cf1ce5c6">elements</a>[j + 3] == vq)
<a name="l00435"></a>00435               <span class="keywordflow">break</span>;
<a name="l00436"></a>00436           <span class="keywordflow">if</span> (j == classes-&gt;<a class="code" href="struct__Queue.html#abb0696a77174cd23b5f488ad4c7b45d2">count</a>)
<a name="l00437"></a>00437             {
<a name="l00438"></a>00438               <a class="code" href="queue_8h.html#a3ba172138b6a04f289def63b198057f1">queue_push</a>(classes, <a class="code" href="transaction_8h.html#a54bc6736d4cc1b026b7d31182a29e1d2">SOLVER_TRANSACTION_ARCHCHANGE</a>);
<a name="l00439"></a>00439               <a class="code" href="queue_8h.html#a3ba172138b6a04f289def63b198057f1">queue_push</a>(classes, 1);
<a name="l00440"></a>00440               <a class="code" href="queue_8h.html#a3ba172138b6a04f289def63b198057f1">queue_push</a>(classes, v);
<a name="l00441"></a>00441               <a class="code" href="queue_8h.html#a3ba172138b6a04f289def63b198057f1">queue_push</a>(classes, vq);
<a name="l00442"></a>00442             }
<a name="l00443"></a>00443           <span class="keywordflow">else</span>
<a name="l00444"></a>00444             classes-&gt;<a class="code" href="struct__Queue.html#a116eb58bed8ff76bf18f9c16cf1ce5c6">elements</a>[j + 1]++;
<a name="l00445"></a>00445         }
<a name="l00446"></a>00446 
<a name="l00447"></a>00447       v = s-&gt;<a class="code" href="struct__Solvable.html#a042e0dd4d730f3b15a0263af25198441">vendor</a> ? s-&gt;<a class="code" href="struct__Solvable.html#a042e0dd4d730f3b15a0263af25198441">vendor</a> : 1;
<a name="l00448"></a>00448       vq = sq-&gt;<a class="code" href="struct__Solvable.html#a042e0dd4d730f3b15a0263af25198441">vendor</a> ? sq-&gt;<a class="code" href="struct__Solvable.html#a042e0dd4d730f3b15a0263af25198441">vendor</a> : 1;
<a name="l00449"></a>00449       <span class="keywordflow">if</span> (v != vq)
<a name="l00450"></a>00450         {
<a name="l00451"></a>00451           <span class="keywordflow">if</span> ((mode &amp; <a class="code" href="transaction_8h.html#aac74bc1f6e95c277e32965f97a5bf20a">SOLVER_TRANSACTION_MERGE_VENDORCHANGES</a>) != 0)
<a name="l00452"></a>00452             v = vq = 0;
<a name="l00453"></a>00453           <span class="keywordflow">for</span> (j = 0; j &lt; classes-&gt;<a class="code" href="struct__Queue.html#abb0696a77174cd23b5f488ad4c7b45d2">count</a>; j += 4)
<a name="l00454"></a>00454             <span class="keywordflow">if</span> (classes-&gt;<a class="code" href="struct__Queue.html#a116eb58bed8ff76bf18f9c16cf1ce5c6">elements</a>[j] == <a class="code" href="transaction_8h.html#a308c790355fdf1537b6f63567609ad42">SOLVER_TRANSACTION_VENDORCHANGE</a> &amp;&amp; classes-&gt;<a class="code" href="struct__Queue.html#a116eb58bed8ff76bf18f9c16cf1ce5c6">elements</a>[j + 2] == v &amp;&amp; classes-&gt;<a class="code" href="struct__Queue.html#a116eb58bed8ff76bf18f9c16cf1ce5c6">elements</a>[j + 3] == vq)
<a name="l00455"></a>00455               <span class="keywordflow">break</span>;
<a name="l00456"></a>00456           <span class="keywordflow">if</span> (j == classes-&gt;<a class="code" href="struct__Queue.html#abb0696a77174cd23b5f488ad4c7b45d2">count</a>)
<a name="l00457"></a>00457             {
<a name="l00458"></a>00458               <a class="code" href="queue_8h.html#a3ba172138b6a04f289def63b198057f1">queue_push</a>(classes, <a class="code" href="transaction_8h.html#a308c790355fdf1537b6f63567609ad42">SOLVER_TRANSACTION_VENDORCHANGE</a>);
<a name="l00459"></a>00459               <a class="code" href="queue_8h.html#a3ba172138b6a04f289def63b198057f1">queue_push</a>(classes, 1);
<a name="l00460"></a>00460               <a class="code" href="queue_8h.html#a3ba172138b6a04f289def63b198057f1">queue_push</a>(classes, v);
<a name="l00461"></a>00461               <a class="code" href="queue_8h.html#a3ba172138b6a04f289def63b198057f1">queue_push</a>(classes, vq);
<a name="l00462"></a>00462             }
<a name="l00463"></a>00463           <span class="keywordflow">else</span>
<a name="l00464"></a>00464             classes-&gt;<a class="code" href="struct__Queue.html#a116eb58bed8ff76bf18f9c16cf1ce5c6">elements</a>[j + 1]++;
<a name="l00465"></a>00465         }
<a name="l00466"></a>00466     }
<a name="l00467"></a>00467   <span class="comment">/* now sort all vendor/arch changes */</span>
<a name="l00468"></a>00468   <span class="keywordflow">if</span> (classes-&gt;<a class="code" href="struct__Queue.html#abb0696a77174cd23b5f488ad4c7b45d2">count</a> &gt; 4)
<a name="l00469"></a>00469     <a class="code" href="util_8c.html#a23a8607fedc58dfceea738fc835160ab">sat_sort</a>(classes-&gt;<a class="code" href="struct__Queue.html#a116eb58bed8ff76bf18f9c16cf1ce5c6">elements</a>, classes-&gt;<a class="code" href="struct__Queue.html#abb0696a77174cd23b5f488ad4c7b45d2">count</a> / 4, 4 * <span class="keyword">sizeof</span>(<a class="code" href="pooltypes_8h.html#a2e0e6278ac51842ca3aeb53e3fc3ead6">Id</a>), <a class="code" href="transaction_8c.html#a784b96fe4248f9102eeca3bc404217ef">classify_cmp</a>, trans);
<a name="l00470"></a>00470   <span class="comment">/* finally add all classes. put erases last */</span>
<a name="l00471"></a>00471   i = SOLVER_TRANSACTION_ERASE;
<a name="l00472"></a>00472   <span class="keywordflow">if</span> (ntypes[i])
<a name="l00473"></a>00473     {
<a name="l00474"></a>00474       <a class="code" href="queue_8h.html#a78b0753442bc98bbaca3a78d95eb9b82">queue_unshift</a>(classes, 0);
<a name="l00475"></a>00475       <a class="code" href="queue_8h.html#a78b0753442bc98bbaca3a78d95eb9b82">queue_unshift</a>(classes, 0);
<a name="l00476"></a>00476       <a class="code" href="queue_8h.html#a78b0753442bc98bbaca3a78d95eb9b82">queue_unshift</a>(classes, ntypes[i]);
<a name="l00477"></a>00477       <a class="code" href="queue_8h.html#a78b0753442bc98bbaca3a78d95eb9b82">queue_unshift</a>(classes, i);
<a name="l00478"></a>00478     }
<a name="l00479"></a>00479   <span class="keywordflow">for</span> (i = <a class="code" href="transaction_8h.html#a69366819a9e5bef976fba868033791e9">SOLVER_TRANSACTION_MAXTYPE</a>; i &gt; 0; i--)
<a name="l00480"></a>00480     {
<a name="l00481"></a>00481       <span class="keywordflow">if</span> (!ntypes[i])
<a name="l00482"></a>00482         <span class="keywordflow">continue</span>;
<a name="l00483"></a>00483       <span class="keywordflow">if</span> (i == <a class="code" href="transaction_8h.html#a6628972c54e3ec89ee96acb65b435642">SOLVER_TRANSACTION_ERASE</a>)
<a name="l00484"></a>00484         <span class="keywordflow">continue</span>;
<a name="l00485"></a>00485       <a class="code" href="queue_8h.html#a78b0753442bc98bbaca3a78d95eb9b82">queue_unshift</a>(classes, 0);
<a name="l00486"></a>00486       <a class="code" href="queue_8h.html#a78b0753442bc98bbaca3a78d95eb9b82">queue_unshift</a>(classes, 0);
<a name="l00487"></a>00487       <a class="code" href="queue_8h.html#a78b0753442bc98bbaca3a78d95eb9b82">queue_unshift</a>(classes, ntypes[i]);
<a name="l00488"></a>00488       <a class="code" href="queue_8h.html#a78b0753442bc98bbaca3a78d95eb9b82">queue_unshift</a>(classes, i);
<a name="l00489"></a>00489     }
<a name="l00490"></a>00490 }
<a name="l00491"></a>00491 
<a name="l00492"></a>00492 <span class="keywordtype">void</span>
<a name="l00493"></a><a class="code" href="transaction_8h.html#a85fcead9cf147776f063d4982955b3ea">00493</a> <a class="code" href="transaction_8c.html#aec81264647a48cf0cb218d9ee050c068">transaction_classify_pkgs</a>(<a class="code" href="struct__Transaction.html">Transaction</a> *trans, <span class="keywordtype">int</span> mode, <a class="code" href="pooltypes_8h.html#a2e0e6278ac51842ca3aeb53e3fc3ead6">Id</a> <span class="keyword">class</span>, <a class="code" href="pooltypes_8h.html#a2e0e6278ac51842ca3aeb53e3fc3ead6">Id</a> from, <a class="code" href="pooltypes_8h.html#a2e0e6278ac51842ca3aeb53e3fc3ead6">Id</a> to, <a class="code" href="struct__Queue.html">Queue</a> *pkgs)
<a name="l00494"></a>00494 {
<a name="l00495"></a>00495   <a class="code" href="struct__Pool.html">Pool</a> *pool = trans-&gt;<a class="code" href="struct__Transaction.html#aeec1bcea114aa72e7c8005b8e08a369b">pool</a>;
<a name="l00496"></a>00496   <span class="keywordtype">int</span> i;
<a name="l00497"></a>00497   <a class="code" href="pooltypes_8h.html#a2e0e6278ac51842ca3aeb53e3fc3ead6">Id</a> type, p, q;
<a name="l00498"></a>00498   <a class="code" href="struct__Solvable.html">Solvable</a> *s, *sq;
<a name="l00499"></a>00499 
<a name="l00500"></a>00500   <a class="code" href="queue_8h.html#aad3334b89bd00dfaa2d483971bd55a7b">queue_empty</a>(pkgs);
<a name="l00501"></a>00501   <span class="keywordflow">for</span> (i = 0; i &lt; trans-&gt;<a class="code" href="struct__Transaction.html#a7e05d837578f51e0a26658a2ae37fc4d">steps</a>.<a class="code" href="struct__Queue.html#abb0696a77174cd23b5f488ad4c7b45d2">count</a>; i++)
<a name="l00502"></a>00502     {
<a name="l00503"></a>00503       p = trans-&gt;<a class="code" href="struct__Transaction.html#a7e05d837578f51e0a26658a2ae37fc4d">steps</a>.<a class="code" href="struct__Queue.html#a116eb58bed8ff76bf18f9c16cf1ce5c6">elements</a>[i];
<a name="l00504"></a>00504       s = pool-&gt;<a class="code" href="struct__Pool.html#a9842c936aa241bad13ba13f21a337319">solvables</a> + p;
<a name="l00505"></a>00505       <span class="keywordflow">if</span> (<span class="keyword">class</span> &lt;= <a class="code" href="transaction_8h.html#a69366819a9e5bef976fba868033791e9">SOLVER_TRANSACTION_MAXTYPE</a>)
<a name="l00506"></a>00506         {
<a name="l00507"></a>00507           type = <a class="code" href="transaction_8c.html#a2b3fe1e25edd92e0853f45b7ebdbb5af">transaction_type</a>(trans, p, mode);
<a name="l00508"></a>00508           <span class="keywordflow">if</span> (type == <span class="keyword">class</span>)
<a name="l00509"></a>00509             <a class="code" href="queue_8h.html#a3ba172138b6a04f289def63b198057f1">queue_push</a>(pkgs, p);
<a name="l00510"></a>00510           <span class="keywordflow">continue</span>;
<a name="l00511"></a>00511         }
<a name="l00512"></a>00512       <span class="keywordflow">if</span> (!pool-&gt;<a class="code" href="struct__Pool.html#a887053f905054298cd61ce1c99e26690">installed</a> || s-&gt;<a class="code" href="struct__Solvable.html#a15e0b77fe061c6429a24215191b10f05">repo</a> != pool-&gt;<a class="code" href="struct__Pool.html#a887053f905054298cd61ce1c99e26690">installed</a>)
<a name="l00513"></a>00513         <span class="keywordflow">continue</span>;
<a name="l00514"></a>00514       q = <a class="code" href="transaction_8c.html#afc85427a4fc858b5e2e60fbfe75f8184">transaction_obs_pkg</a>(trans, p);
<a name="l00515"></a>00515       <span class="keywordflow">if</span> (!q)
<a name="l00516"></a>00516         <span class="keywordflow">continue</span>;
<a name="l00517"></a>00517       sq = pool-&gt;<a class="code" href="struct__Pool.html#a9842c936aa241bad13ba13f21a337319">solvables</a> + q;
<a name="l00518"></a>00518       <span class="keywordflow">if</span> (<span class="keyword">class</span> == <a class="code" href="transaction_8h.html#a54bc6736d4cc1b026b7d31182a29e1d2">SOLVER_TRANSACTION_ARCHCHANGE</a>)
<a name="l00519"></a>00519         {
<a name="l00520"></a>00520           <span class="keywordflow">if</span> ((!from &amp;&amp; !to) || (s-&gt;<a class="code" href="struct__Solvable.html#a51ba374144373934101befc2bd20150b">arch</a> == from &amp;&amp; sq-&gt;<a class="code" href="struct__Solvable.html#a51ba374144373934101befc2bd20150b">arch</a> == to))
<a name="l00521"></a>00521             <a class="code" href="queue_8h.html#a3ba172138b6a04f289def63b198057f1">queue_push</a>(pkgs, p);
<a name="l00522"></a>00522           <span class="keywordflow">continue</span>;
<a name="l00523"></a>00523         }
<a name="l00524"></a>00524       <span class="keywordflow">if</span> (<span class="keyword">class</span> == <a class="code" href="transaction_8h.html#a308c790355fdf1537b6f63567609ad42">SOLVER_TRANSACTION_VENDORCHANGE</a>)
<a name="l00525"></a>00525         {
<a name="l00526"></a>00526           <a class="code" href="pooltypes_8h.html#a2e0e6278ac51842ca3aeb53e3fc3ead6">Id</a> v = s-&gt;<a class="code" href="struct__Solvable.html#a042e0dd4d730f3b15a0263af25198441">vendor</a> ? s-&gt;<a class="code" href="struct__Solvable.html#a042e0dd4d730f3b15a0263af25198441">vendor</a> : 1;
<a name="l00527"></a>00527           <a class="code" href="pooltypes_8h.html#a2e0e6278ac51842ca3aeb53e3fc3ead6">Id</a> vq = sq-&gt;<a class="code" href="struct__Solvable.html#a042e0dd4d730f3b15a0263af25198441">vendor</a> ? sq-&gt;<a class="code" href="struct__Solvable.html#a042e0dd4d730f3b15a0263af25198441">vendor</a> : 1;
<a name="l00528"></a>00528           <span class="keywordflow">if</span> ((!from &amp;&amp; !to) || (v == from &amp;&amp; vq == to))
<a name="l00529"></a>00529             <a class="code" href="queue_8h.html#a3ba172138b6a04f289def63b198057f1">queue_push</a>(pkgs, p);
<a name="l00530"></a>00530           <span class="keywordflow">continue</span>;
<a name="l00531"></a>00531         }
<a name="l00532"></a>00532     }
<a name="l00533"></a>00533   <span class="keywordflow">if</span> (pkgs-&gt;<a class="code" href="struct__Queue.html#abb0696a77174cd23b5f488ad4c7b45d2">count</a> &gt; 1)
<a name="l00534"></a>00534     <a class="code" href="util_8c.html#a23a8607fedc58dfceea738fc835160ab">sat_sort</a>(pkgs-&gt;<a class="code" href="struct__Queue.html#a116eb58bed8ff76bf18f9c16cf1ce5c6">elements</a>, pkgs-&gt;<a class="code" href="struct__Queue.html#abb0696a77174cd23b5f488ad4c7b45d2">count</a>, <span class="keyword">sizeof</span>(<a class="code" href="pooltypes_8h.html#a2e0e6278ac51842ca3aeb53e3fc3ead6">Id</a>), <a class="code" href="transaction_8c.html#a2a0f5c05d570beeb9c00b5b813d7a4f1">classify_cmp_pkgs</a>, trans);
<a name="l00535"></a>00535 }
<a name="l00536"></a>00536 
<a name="l00537"></a>00537 <span class="keyword">static</span> <span class="keywordtype">void</span>
<a name="l00538"></a><a class="code" href="transaction_8c.html#a3d373aa25308ce3b2d57b4e2f938c2a0">00538</a> <a class="code" href="transaction_8c.html#a3d373aa25308ce3b2d57b4e2f938c2a0">create_transaction_info</a>(<a class="code" href="struct__Transaction.html">Transaction</a> *trans, <a class="code" href="struct__Queue.html">Queue</a> *decisionq)
<a name="l00539"></a>00539 {
<a name="l00540"></a>00540   <a class="code" href="struct__Pool.html">Pool</a> *pool = trans-&gt;<a class="code" href="struct__Transaction.html#aeec1bcea114aa72e7c8005b8e08a369b">pool</a>;
<a name="l00541"></a>00541   <a class="code" href="struct__Queue.html">Queue</a> *ti = &amp;trans-&gt;<a class="code" href="struct__Transaction.html#aee106dc80baa493cbd7b6f3dd9011845">transaction_info</a>;
<a name="l00542"></a>00542   <a class="code" href="struct__Repo.html">Repo</a> *installed = pool-&gt;<a class="code" href="struct__Pool.html#a887053f905054298cd61ce1c99e26690">installed</a>;
<a name="l00543"></a>00543   <span class="keywordtype">int</span> i, j, noobs;
<a name="l00544"></a>00544   <a class="code" href="pooltypes_8h.html#a2e0e6278ac51842ca3aeb53e3fc3ead6">Id</a> p, p2, pp2;
<a name="l00545"></a>00545   <a class="code" href="struct__Solvable.html">Solvable</a> *s, *s2;
<a name="l00546"></a>00546 
<a name="l00547"></a>00547   <a class="code" href="queue_8h.html#aad3334b89bd00dfaa2d483971bd55a7b">queue_empty</a>(ti);
<a name="l00548"></a>00548   trans-&gt;<a class="code" href="struct__Transaction.html#a592881da1d794d3ea60272a3938d4bf0">transaction_installed</a> = <a class="code" href="util_8c.html#a1f246fae10a89534cfe0583cefb44c11">sat_free</a>(trans-&gt;<a class="code" href="struct__Transaction.html#a592881da1d794d3ea60272a3938d4bf0">transaction_installed</a>);
<a name="l00549"></a>00549   <span class="keywordflow">if</span> (!installed)
<a name="l00550"></a>00550     <span class="keywordflow">return</span>;     <span class="comment">/* no info needed */</span>
<a name="l00551"></a>00551   <span class="keywordflow">for</span> (i = 0; i &lt; decisionq-&gt;<a class="code" href="struct__Queue.html#abb0696a77174cd23b5f488ad4c7b45d2">count</a>; i++)
<a name="l00552"></a>00552     {
<a name="l00553"></a>00553       p = decisionq-&gt;<a class="code" href="struct__Queue.html#a116eb58bed8ff76bf18f9c16cf1ce5c6">elements</a>[i];
<a name="l00554"></a>00554       <span class="keywordflow">if</span> (p &lt;= 0 || p == <a class="code" href="pool_8h.html#abd207d4eeed4b96e8dd1a25e2dce7f52">SYSTEMSOLVABLE</a>)
<a name="l00555"></a>00555         <span class="keywordflow">continue</span>;
<a name="l00556"></a>00556       s = pool-&gt;<a class="code" href="struct__Pool.html#a9842c936aa241bad13ba13f21a337319">solvables</a> + p;
<a name="l00557"></a>00557       <span class="keywordflow">if</span> (!s-&gt;<a class="code" href="struct__Solvable.html#a15e0b77fe061c6429a24215191b10f05">repo</a> || s-&gt;<a class="code" href="struct__Solvable.html#a15e0b77fe061c6429a24215191b10f05">repo</a> == installed)
<a name="l00558"></a>00558         <span class="keywordflow">continue</span>;
<a name="l00559"></a>00559       noobs = trans-&gt;<a class="code" href="struct__Transaction.html#aac87ae47634e99c5266a762ee85d59e5">noobsmap</a>.<a class="code" href="struct__Map.html#a6f33ba32c40c61ac1ab1c96919b77ee0">size</a> &amp;&amp; <a class="code" href="bitmap_8h.html#ad8ccb9ad3a8ad65f5fe08a988acc503d">MAPTST</a>(&amp;trans-&gt;<a class="code" href="struct__Transaction.html#aac87ae47634e99c5266a762ee85d59e5">noobsmap</a>, p);
<a name="l00560"></a>00560       <a class="code" href="pool_8h.html#a6529dc5dd039f8d1019aa2e6f9a9011f">FOR_PROVIDES</a>(p2, pp2, s-&gt;<a class="code" href="struct__Solvable.html#a5912021e2c3fe505c24a92aa7639dff2">name</a>)
<a name="l00561"></a>00561         {
<a name="l00562"></a>00562           <span class="keywordflow">if</span> (!<a class="code" href="bitmap_8h.html#ad8ccb9ad3a8ad65f5fe08a988acc503d">MAPTST</a>(&amp;trans-&gt;<a class="code" href="struct__Transaction.html#ac0d758cc5496d3cfe62b8c890d21a47b">transactsmap</a>, p2))
<a name="l00563"></a>00563             <span class="keywordflow">continue</span>;
<a name="l00564"></a>00564           s2 = pool-&gt;<a class="code" href="struct__Pool.html#a9842c936aa241bad13ba13f21a337319">solvables</a> + p2;
<a name="l00565"></a>00565           <span class="keywordflow">if</span> (s2-&gt;<a class="code" href="struct__Solvable.html#a15e0b77fe061c6429a24215191b10f05">repo</a> != installed)
<a name="l00566"></a>00566             <span class="keywordflow">continue</span>;
<a name="l00567"></a>00567           <span class="keywordflow">if</span> (noobs &amp;&amp; (s-&gt;<a class="code" href="struct__Solvable.html#a5912021e2c3fe505c24a92aa7639dff2">name</a> != s2-&gt;<a class="code" href="struct__Solvable.html#a5912021e2c3fe505c24a92aa7639dff2">name</a> || s-&gt;<a class="code" href="struct__Solvable.html#ae776af434c21800db6c01a75c2e6a4f6">evr</a> != s2-&gt;<a class="code" href="struct__Solvable.html#ae776af434c21800db6c01a75c2e6a4f6">evr</a> || s-&gt;<a class="code" href="struct__Solvable.html#a51ba374144373934101befc2bd20150b">arch</a> != s2-&gt;<a class="code" href="struct__Solvable.html#a51ba374144373934101befc2bd20150b">arch</a>))
<a name="l00568"></a>00568             <span class="keywordflow">continue</span>;
<a name="l00569"></a>00569           <span class="keywordflow">if</span> (!pool-&gt;<a class="code" href="struct__Pool.html#abc2e01f9f1f4833c256d836b0a9e4387">implicitobsoleteusesprovides</a> &amp;&amp; s-&gt;<a class="code" href="struct__Solvable.html#a5912021e2c3fe505c24a92aa7639dff2">name</a> != s2-&gt;<a class="code" href="struct__Solvable.html#a5912021e2c3fe505c24a92aa7639dff2">name</a>)
<a name="l00570"></a>00570             <span class="keywordflow">continue</span>;
<a name="l00571"></a>00571           <span class="keywordflow">if</span> (pool-&gt;<a class="code" href="struct__Pool.html#acdf3981cb1a41707c6ddf7efe9a105f0">obsoleteusescolors</a> &amp;&amp; !<a class="code" href="poolarch_8h.html#a03fb65256662cbc0b0027bbc82992a2e">pool_colormatch</a>(pool, s, s2))
<a name="l00572"></a>00572             <span class="keywordflow">continue</span>;
<a name="l00573"></a>00573           <a class="code" href="queue_8h.html#a3ba172138b6a04f289def63b198057f1">queue_push</a>(ti, p);
<a name="l00574"></a>00574           <a class="code" href="queue_8h.html#a3ba172138b6a04f289def63b198057f1">queue_push</a>(ti, p2);
<a name="l00575"></a>00575         }
<a name="l00576"></a>00576       <span class="keywordflow">if</span> (s-&gt;<a class="code" href="struct__Solvable.html#a2eb11a5e84d9a4141fd44e9e9f2d0124">obsoletes</a> &amp;&amp; !noobs)
<a name="l00577"></a>00577         {
<a name="l00578"></a>00578           <a class="code" href="pooltypes_8h.html#a2e0e6278ac51842ca3aeb53e3fc3ead6">Id</a> obs, *obsp = s-&gt;<a class="code" href="struct__Solvable.html#a15e0b77fe061c6429a24215191b10f05">repo</a>-&gt;<a class="code" href="struct__Repo.html#afddcfa36231cc08266800bee5b978528">idarraydata</a> + s-&gt;<a class="code" href="struct__Solvable.html#a2eb11a5e84d9a4141fd44e9e9f2d0124">obsoletes</a>;
<a name="l00579"></a>00579           <span class="keywordflow">while</span> ((obs = *obsp++) != 0)
<a name="l00580"></a>00580             {
<a name="l00581"></a>00581               <a class="code" href="pool_8h.html#a6529dc5dd039f8d1019aa2e6f9a9011f">FOR_PROVIDES</a>(p2, pp2, obs)
<a name="l00582"></a>00582                 {
<a name="l00583"></a>00583                   s2 = pool-&gt;<a class="code" href="struct__Pool.html#a9842c936aa241bad13ba13f21a337319">solvables</a> + p2;
<a name="l00584"></a>00584                   <span class="keywordflow">if</span> (s2-&gt;<a class="code" href="struct__Solvable.html#a15e0b77fe061c6429a24215191b10f05">repo</a> != installed)
<a name="l00585"></a>00585                     <span class="keywordflow">continue</span>;
<a name="l00586"></a>00586                   <span class="keywordflow">if</span> (!pool-&gt;<a class="code" href="struct__Pool.html#a6983b12a5c8fd406fe85ac343914ac30">obsoleteusesprovides</a> &amp;&amp; !<a class="code" href="pool_8h.html#a1f2bd95045b7a58d9237da8aeaeee6de">pool_match_nevr</a>(pool, pool-&gt;<a class="code" href="struct__Pool.html#a9842c936aa241bad13ba13f21a337319">solvables</a> + p2, obs))
<a name="l00587"></a>00587                     <span class="keywordflow">continue</span>;
<a name="l00588"></a>00588                   <span class="keywordflow">if</span> (pool-&gt;<a class="code" href="struct__Pool.html#acdf3981cb1a41707c6ddf7efe9a105f0">obsoleteusescolors</a> &amp;&amp; !<a class="code" href="poolarch_8h.html#a03fb65256662cbc0b0027bbc82992a2e">pool_colormatch</a>(pool, s, s2))
<a name="l00589"></a>00589                     <span class="keywordflow">continue</span>;
<a name="l00590"></a>00590                   <a class="code" href="queue_8h.html#a3ba172138b6a04f289def63b198057f1">queue_push</a>(ti, p);
<a name="l00591"></a>00591                   <a class="code" href="queue_8h.html#a3ba172138b6a04f289def63b198057f1">queue_push</a>(ti, p2);
<a name="l00592"></a>00592                 }
<a name="l00593"></a>00593             }
<a name="l00594"></a>00594         }
<a name="l00595"></a>00595     }
<a name="l00596"></a>00596   <a class="code" href="util_8c.html#a23a8607fedc58dfceea738fc835160ab">sat_sort</a>(ti-&gt;<a class="code" href="struct__Queue.html#a116eb58bed8ff76bf18f9c16cf1ce5c6">elements</a>, ti-&gt;<a class="code" href="struct__Queue.html#abb0696a77174cd23b5f488ad4c7b45d2">count</a> / 2, 2 * <span class="keyword">sizeof</span>(<a class="code" href="pooltypes_8h.html#a2e0e6278ac51842ca3aeb53e3fc3ead6">Id</a>), <a class="code" href="transaction_8c.html#a69014e9e8739378b99b5f0578b8e2e09">obsq_sortcmp</a>, pool);
<a name="l00597"></a>00597   <span class="comment">/* now unify */</span>
<a name="l00598"></a>00598   <span class="keywordflow">for</span> (i = j = 0; i &lt; ti-&gt;<a class="code" href="struct__Queue.html#abb0696a77174cd23b5f488ad4c7b45d2">count</a>; i += 2)
<a name="l00599"></a>00599     {
<a name="l00600"></a>00600       <span class="keywordflow">if</span> (j &amp;&amp; ti-&gt;<a class="code" href="struct__Queue.html#a116eb58bed8ff76bf18f9c16cf1ce5c6">elements</a>[i] == ti-&gt;<a class="code" href="struct__Queue.html#a116eb58bed8ff76bf18f9c16cf1ce5c6">elements</a>[j - 2] &amp;&amp; ti-&gt;<a class="code" href="struct__Queue.html#a116eb58bed8ff76bf18f9c16cf1ce5c6">elements</a>[i + 1] == ti-&gt;<a class="code" href="struct__Queue.html#a116eb58bed8ff76bf18f9c16cf1ce5c6">elements</a>[j - 1])
<a name="l00601"></a>00601         <span class="keywordflow">continue</span>;
<a name="l00602"></a>00602       ti-&gt;<a class="code" href="struct__Queue.html#a116eb58bed8ff76bf18f9c16cf1ce5c6">elements</a>[j++] = ti-&gt;<a class="code" href="struct__Queue.html#a116eb58bed8ff76bf18f9c16cf1ce5c6">elements</a>[i];
<a name="l00603"></a>00603       ti-&gt;<a class="code" href="struct__Queue.html#a116eb58bed8ff76bf18f9c16cf1ce5c6">elements</a>[j++] = ti-&gt;<a class="code" href="struct__Queue.html#a116eb58bed8ff76bf18f9c16cf1ce5c6">elements</a>[i + 1];
<a name="l00604"></a>00604     }
<a name="l00605"></a>00605   ti-&gt;<a class="code" href="struct__Queue.html#abb0696a77174cd23b5f488ad4c7b45d2">count</a> = j;
<a name="l00606"></a>00606 
<a name="l00607"></a>00607   <span class="comment">/* create transaction_installed helper */</span>
<a name="l00608"></a>00608   trans-&gt;<a class="code" href="struct__Transaction.html#a592881da1d794d3ea60272a3938d4bf0">transaction_installed</a> = <a class="code" href="util_8c.html#a7964924c069160718b17ac2770d6885d">sat_calloc</a>(installed-&gt;<a class="code" href="struct__Repo.html#aca3e16cc200b9c236963f56bf038a7bc">end</a> - installed-&gt;<a class="code" href="struct__Repo.html#a4eb2dd93e4a4f88f13d462f2f111e038">start</a>, <span class="keyword">sizeof</span>(<a class="code" href="pooltypes_8h.html#a2e0e6278ac51842ca3aeb53e3fc3ead6">Id</a>));
<a name="l00609"></a>00609   <span class="keywordflow">for</span> (i = 0; i &lt; ti-&gt;<a class="code" href="struct__Queue.html#abb0696a77174cd23b5f488ad4c7b45d2">count</a>; i += 2)
<a name="l00610"></a>00610     {
<a name="l00611"></a>00611       j = ti-&gt;<a class="code" href="struct__Queue.html#a116eb58bed8ff76bf18f9c16cf1ce5c6">elements</a>[i + 1] - installed-&gt;<a class="code" href="struct__Repo.html#a4eb2dd93e4a4f88f13d462f2f111e038">start</a>;
<a name="l00612"></a>00612       <span class="keywordflow">if</span> (!trans-&gt;<a class="code" href="struct__Transaction.html#a592881da1d794d3ea60272a3938d4bf0">transaction_installed</a>[j])
<a name="l00613"></a>00613         trans-&gt;<a class="code" href="struct__Transaction.html#a592881da1d794d3ea60272a3938d4bf0">transaction_installed</a>[j] = ti-&gt;<a class="code" href="struct__Queue.html#a116eb58bed8ff76bf18f9c16cf1ce5c6">elements</a>[i];
<a name="l00614"></a>00614       <span class="keywordflow">else</span>
<a name="l00615"></a>00615         {
<a name="l00616"></a>00616           <span class="comment">/* more than one package obsoletes us. compare */</span>
<a name="l00617"></a>00617           <a class="code" href="pooltypes_8h.html#a2e0e6278ac51842ca3aeb53e3fc3ead6">Id</a> q[4];
<a name="l00618"></a>00618           <span class="keywordflow">if</span> (trans-&gt;<a class="code" href="struct__Transaction.html#a592881da1d794d3ea60272a3938d4bf0">transaction_installed</a>[j] &gt; 0)
<a name="l00619"></a>00619             trans-&gt;<a class="code" href="struct__Transaction.html#a592881da1d794d3ea60272a3938d4bf0">transaction_installed</a>[j] = -trans-&gt;<a class="code" href="struct__Transaction.html#a592881da1d794d3ea60272a3938d4bf0">transaction_installed</a>[j];
<a name="l00620"></a>00620           q[0] = q[2] = ti-&gt;<a class="code" href="struct__Queue.html#a116eb58bed8ff76bf18f9c16cf1ce5c6">elements</a>[i + 1];
<a name="l00621"></a>00621           q[1] = ti-&gt;<a class="code" href="struct__Queue.html#a116eb58bed8ff76bf18f9c16cf1ce5c6">elements</a>[i];
<a name="l00622"></a>00622           q[3] = -trans-&gt;<a class="code" href="struct__Transaction.html#a592881da1d794d3ea60272a3938d4bf0">transaction_installed</a>[j];
<a name="l00623"></a>00623           <span class="keywordflow">if</span> (<a class="code" href="transaction_8c.html#a69014e9e8739378b99b5f0578b8e2e09">obsq_sortcmp</a>(q, q + 2, pool) &lt; 0)
<a name="l00624"></a>00624             trans-&gt;<a class="code" href="struct__Transaction.html#a592881da1d794d3ea60272a3938d4bf0">transaction_installed</a>[j] = -ti-&gt;<a class="code" href="struct__Queue.html#a116eb58bed8ff76bf18f9c16cf1ce5c6">elements</a>[i];
<a name="l00625"></a>00625         }
<a name="l00626"></a>00626     }
<a name="l00627"></a>00627 }
<a name="l00628"></a>00628 
<a name="l00629"></a>00629 
<a name="l00630"></a>00630 <span class="keywordtype">void</span>
<a name="l00631"></a><a class="code" href="transaction_8h.html#a6da8304f579ec3b094e2b69475629bcd">00631</a> <a class="code" href="transaction_8c.html#a6da8304f579ec3b094e2b69475629bcd">transaction_calculate</a>(<a class="code" href="struct__Transaction.html">Transaction</a> *trans, <a class="code" href="struct__Queue.html">Queue</a> *decisionq, <a class="code" href="struct__Map.html">Map</a> *noobsmap)
<a name="l00632"></a>00632 {
<a name="l00633"></a>00633   <a class="code" href="struct__Pool.html">Pool</a> *pool = trans-&gt;<a class="code" href="struct__Transaction.html#aeec1bcea114aa72e7c8005b8e08a369b">pool</a>;
<a name="l00634"></a>00634   <a class="code" href="struct__Repo.html">Repo</a> *installed = pool-&gt;<a class="code" href="struct__Pool.html#a887053f905054298cd61ce1c99e26690">installed</a>;
<a name="l00635"></a>00635   <span class="keywordtype">int</span> i, neednoobs;
<a name="l00636"></a>00636   <a class="code" href="pooltypes_8h.html#a2e0e6278ac51842ca3aeb53e3fc3ead6">Id</a> p;
<a name="l00637"></a>00637   <a class="code" href="struct__Solvable.html">Solvable</a> *s;
<a name="l00638"></a>00638 
<a name="l00639"></a>00639   <span class="keywordflow">if</span> (noobsmap &amp;&amp; !noobsmap-&gt;<a class="code" href="struct__Map.html#a6f33ba32c40c61ac1ab1c96919b77ee0">size</a>)
<a name="l00640"></a>00640     noobsmap = 0;       <span class="comment">/* ignore empty map */</span>
<a name="l00641"></a>00641   <a class="code" href="queue_8h.html#aad3334b89bd00dfaa2d483971bd55a7b">queue_empty</a>(&amp;trans-&gt;<a class="code" href="struct__Transaction.html#a7e05d837578f51e0a26658a2ae37fc4d">steps</a>);
<a name="l00642"></a>00642   <a class="code" href="bitmap_8c.html#a8d8010a0f9f491483c12e83ae3a9082e">map_init</a>(&amp;trans-&gt;<a class="code" href="struct__Transaction.html#ac0d758cc5496d3cfe62b8c890d21a47b">transactsmap</a>, pool-&gt;<a class="code" href="struct__Pool.html#a00e935f7b65616513799ac9e26fefa31">nsolvables</a>);
<a name="l00643"></a>00643   neednoobs = 0;
<a name="l00644"></a>00644   <span class="keywordflow">for</span> (i = 0; i &lt; decisionq-&gt;<a class="code" href="struct__Queue.html#abb0696a77174cd23b5f488ad4c7b45d2">count</a>; i++)
<a name="l00645"></a>00645     {
<a name="l00646"></a>00646       p = decisionq-&gt;<a class="code" href="struct__Queue.html#a116eb58bed8ff76bf18f9c16cf1ce5c6">elements</a>[i];
<a name="l00647"></a>00647       s = pool-&gt;<a class="code" href="struct__Pool.html#a9842c936aa241bad13ba13f21a337319">solvables</a> + (p &gt; 0 ? p : -p);
<a name="l00648"></a>00648       <span class="keywordflow">if</span> (!s-&gt;<a class="code" href="struct__Solvable.html#a15e0b77fe061c6429a24215191b10f05">repo</a>)
<a name="l00649"></a>00649         <span class="keywordflow">continue</span>;
<a name="l00650"></a>00650       <span class="keywordflow">if</span> (installed &amp;&amp; s-&gt;<a class="code" href="struct__Solvable.html#a15e0b77fe061c6429a24215191b10f05">repo</a> == installed &amp;&amp; p &lt; 0)
<a name="l00651"></a>00651         <a class="code" href="bitmap_8h.html#a33557e357513f5b3faef527bb320183c">MAPSET</a>(&amp;trans-&gt;<a class="code" href="struct__Transaction.html#ac0d758cc5496d3cfe62b8c890d21a47b">transactsmap</a>, -p);
<a name="l00652"></a>00652       <span class="keywordflow">if</span> ((!installed || s-&gt;<a class="code" href="struct__Solvable.html#a15e0b77fe061c6429a24215191b10f05">repo</a> != installed) &amp;&amp; p &gt; 0)
<a name="l00653"></a>00653         {
<a name="l00654"></a>00654 <span class="preprocessor">#if 0</span>
<a name="l00655"></a>00655 <span class="preprocessor"></span>          <span class="keyword">const</span> <span class="keywordtype">char</span> *n = <a class="code" href="poolid_8c.html#a8a844727bd2258ef240555fc629b2fa7">id2str</a>(pool, s-&gt;<a class="code" href="struct__Solvable.html#a5912021e2c3fe505c24a92aa7639dff2">name</a>);
<a name="l00656"></a>00656           <span class="keywordflow">if</span> (!strncmp(n, <span class="stringliteral">&quot;patch:&quot;</span>, 6))
<a name="l00657"></a>00657             <span class="keywordflow">continue</span>;
<a name="l00658"></a>00658           <span class="keywordflow">if</span> (!strncmp(n, <span class="stringliteral">&quot;pattern:&quot;</span>, 8))
<a name="l00659"></a>00659             <span class="keywordflow">continue</span>;
<a name="l00660"></a>00660 <span class="preprocessor">#endif</span>
<a name="l00661"></a>00661 <span class="preprocessor"></span>          <a class="code" href="bitmap_8h.html#a33557e357513f5b3faef527bb320183c">MAPSET</a>(&amp;trans-&gt;<a class="code" href="struct__Transaction.html#ac0d758cc5496d3cfe62b8c890d21a47b">transactsmap</a>, p);
<a name="l00662"></a>00662           <span class="keywordflow">if</span> (noobsmap &amp;&amp; <a class="code" href="bitmap_8h.html#ad8ccb9ad3a8ad65f5fe08a988acc503d">MAPTST</a>(noobsmap, p))
<a name="l00663"></a>00663             neednoobs = 1;
<a name="l00664"></a>00664         }
<a name="l00665"></a>00665     }
<a name="l00666"></a>00666   <a class="code" href="bitmap_8h.html#a4520be65a5431b300ed0ab7a9a910201">MAPCLR</a>(&amp;trans-&gt;<a class="code" href="struct__Transaction.html#ac0d758cc5496d3cfe62b8c890d21a47b">transactsmap</a>, <a class="code" href="pool_8h.html#abd207d4eeed4b96e8dd1a25e2dce7f52">SYSTEMSOLVABLE</a>);
<a name="l00667"></a>00667   <span class="keywordflow">if</span> (neednoobs)
<a name="l00668"></a>00668     <a class="code" href="bitmap_8c.html#a9115caa6f4faf6bd5757cf803a65b30f">map_init_clone</a>(&amp;trans-&gt;<a class="code" href="struct__Transaction.html#aac87ae47634e99c5266a762ee85d59e5">noobsmap</a>, noobsmap);
<a name="l00669"></a>00669 
<a name="l00670"></a>00670   <a class="code" href="transaction_8c.html#a3d373aa25308ce3b2d57b4e2f938c2a0">create_transaction_info</a>(trans, decisionq);
<a name="l00671"></a>00671 
<a name="l00672"></a>00672   <span class="keywordflow">if</span> (installed)
<a name="l00673"></a>00673     {
<a name="l00674"></a>00674       <a class="code" href="repo_8h.html#ad2d411118e6dc06fdd38f7ec68c3bb32">FOR_REPO_SOLVABLES</a>(installed, p, s)
<a name="l00675"></a>00675         {
<a name="l00676"></a>00676           <span class="keywordflow">if</span> (<a class="code" href="bitmap_8h.html#ad8ccb9ad3a8ad65f5fe08a988acc503d">MAPTST</a>(&amp;trans-&gt;<a class="code" href="struct__Transaction.html#ac0d758cc5496d3cfe62b8c890d21a47b">transactsmap</a>, p))
<a name="l00677"></a>00677             <a class="code" href="queue_8h.html#a3ba172138b6a04f289def63b198057f1">queue_push</a>(&amp;trans-&gt;<a class="code" href="struct__Transaction.html#a7e05d837578f51e0a26658a2ae37fc4d">steps</a>, p);
<a name="l00678"></a>00678         }
<a name="l00679"></a>00679     }
<a name="l00680"></a>00680   <span class="keywordflow">for</span> (i = 0; i &lt; decisionq-&gt;<a class="code" href="struct__Queue.html#abb0696a77174cd23b5f488ad4c7b45d2">count</a>; i++)
<a name="l00681"></a>00681     {
<a name="l00682"></a>00682       p = decisionq-&gt;<a class="code" href="struct__Queue.html#a116eb58bed8ff76bf18f9c16cf1ce5c6">elements</a>[i];
<a name="l00683"></a>00683       <span class="keywordflow">if</span> (p &gt; 0 &amp;&amp; <a class="code" href="bitmap_8h.html#ad8ccb9ad3a8ad65f5fe08a988acc503d">MAPTST</a>(&amp;trans-&gt;<a class="code" href="struct__Transaction.html#ac0d758cc5496d3cfe62b8c890d21a47b">transactsmap</a>, p))
<a name="l00684"></a>00684         <a class="code" href="queue_8h.html#a3ba172138b6a04f289def63b198057f1">queue_push</a>(&amp;trans-&gt;<a class="code" href="struct__Transaction.html#a7e05d837578f51e0a26658a2ae37fc4d">steps</a>, p);
<a name="l00685"></a>00685     }
<a name="l00686"></a>00686 }
<a name="l00687"></a>00687 
<a name="l00688"></a>00688 <span class="keywordtype">int</span>
<a name="l00689"></a><a class="code" href="transaction_8h.html#a681e8e0d6a7a3d20cd7b2b343037371a">00689</a> <a class="code" href="transaction_8c.html#a681e8e0d6a7a3d20cd7b2b343037371a">transaction_installedresult</a>(<a class="code" href="struct__Transaction.html">Transaction</a> *trans, <a class="code" href="struct__Queue.html">Queue</a> *installedq)
<a name="l00690"></a>00690 {
<a name="l00691"></a>00691   <a class="code" href="struct__Pool.html">Pool</a> *pool = trans-&gt;<a class="code" href="struct__Transaction.html#aeec1bcea114aa72e7c8005b8e08a369b">pool</a>;
<a name="l00692"></a>00692   <a class="code" href="struct__Repo.html">Repo</a> *installed = pool-&gt;<a class="code" href="struct__Pool.html#a887053f905054298cd61ce1c99e26690">installed</a>;
<a name="l00693"></a>00693   <a class="code" href="struct__Solvable.html">Solvable</a> *s;
<a name="l00694"></a>00694   <span class="keywordtype">int</span> i, cutoff;
<a name="l00695"></a>00695   <a class="code" href="pooltypes_8h.html#a2e0e6278ac51842ca3aeb53e3fc3ead6">Id</a> p;
<a name="l00696"></a>00696 
<a name="l00697"></a>00697   <a class="code" href="queue_8h.html#aad3334b89bd00dfaa2d483971bd55a7b">queue_empty</a>(installedq);
<a name="l00698"></a>00698   <span class="comment">/* first the new installs, than the kept packages */</span>
<a name="l00699"></a>00699   <span class="keywordflow">for</span> (i = 0; i &lt; trans-&gt;<a class="code" href="struct__Transaction.html#a7e05d837578f51e0a26658a2ae37fc4d">steps</a>.<a class="code" href="struct__Queue.html#abb0696a77174cd23b5f488ad4c7b45d2">count</a>; i++)
<a name="l00700"></a>00700     {
<a name="l00701"></a>00701       p = trans-&gt;<a class="code" href="struct__Transaction.html#a7e05d837578f51e0a26658a2ae37fc4d">steps</a>.<a class="code" href="struct__Queue.html#a116eb58bed8ff76bf18f9c16cf1ce5c6">elements</a>[i];
<a name="l00702"></a>00702       s = pool-&gt;<a class="code" href="struct__Pool.html#a9842c936aa241bad13ba13f21a337319">solvables</a> + p;
<a name="l00703"></a>00703       <span class="keywordflow">if</span> (installed &amp;&amp; s-&gt;<a class="code" href="struct__Solvable.html#a15e0b77fe061c6429a24215191b10f05">repo</a> == installed)
<a name="l00704"></a>00704         <span class="keywordflow">continue</span>;
<a name="l00705"></a>00705       <a class="code" href="queue_8h.html#a3ba172138b6a04f289def63b198057f1">queue_push</a>(installedq, p);
<a name="l00706"></a>00706     }
<a name="l00707"></a>00707   cutoff = installedq-&gt;<a class="code" href="struct__Queue.html#abb0696a77174cd23b5f488ad4c7b45d2">count</a>;
<a name="l00708"></a>00708   <span class="keywordflow">if</span> (installed)
<a name="l00709"></a>00709     {
<a name="l00710"></a>00710       <a class="code" href="repo_8h.html#ad2d411118e6dc06fdd38f7ec68c3bb32">FOR_REPO_SOLVABLES</a>(installed, p, s)
<a name="l00711"></a>00711         <span class="keywordflow">if</span> (!<a class="code" href="bitmap_8h.html#ad8ccb9ad3a8ad65f5fe08a988acc503d">MAPTST</a>(&amp;trans-&gt;<a class="code" href="struct__Transaction.html#ac0d758cc5496d3cfe62b8c890d21a47b">transactsmap</a>, p))
<a name="l00712"></a>00712           <a class="code" href="queue_8h.html#a3ba172138b6a04f289def63b198057f1">queue_push</a>(installedq, p);
<a name="l00713"></a>00713     }
<a name="l00714"></a>00714   <span class="keywordflow">return</span> cutoff;
<a name="l00715"></a>00715 }
<a name="l00716"></a>00716 
<a name="l00717"></a>00717 <span class="keyword">static</span> <span class="keywordtype">void</span>
<a name="l00718"></a><a class="code" href="transaction_8c.html#a4eee4040720ec524cf5efad0d85f9cc5">00718</a> <a class="code" href="transaction_8c.html#a4eee4040720ec524cf5efad0d85f9cc5">transaction_create_installedmap</a>(<a class="code" href="struct__Transaction.html">Transaction</a> *trans, <a class="code" href="struct__Map.html">Map</a> *installedmap)
<a name="l00719"></a>00719 {
<a name="l00720"></a>00720   <a class="code" href="struct__Pool.html">Pool</a> *pool = trans-&gt;<a class="code" href="struct__Transaction.html#aeec1bcea114aa72e7c8005b8e08a369b">pool</a>;
<a name="l00721"></a>00721   <a class="code" href="struct__Repo.html">Repo</a> *installed = pool-&gt;<a class="code" href="struct__Pool.html#a887053f905054298cd61ce1c99e26690">installed</a>;
<a name="l00722"></a>00722   <a class="code" href="struct__Solvable.html">Solvable</a> *s;
<a name="l00723"></a>00723   <a class="code" href="pooltypes_8h.html#a2e0e6278ac51842ca3aeb53e3fc3ead6">Id</a> p;
<a name="l00724"></a>00724   <span class="keywordtype">int</span> i;
<a name="l00725"></a>00725 
<a name="l00726"></a>00726   <a class="code" href="bitmap_8c.html#a8d8010a0f9f491483c12e83ae3a9082e">map_init</a>(installedmap, pool-&gt;<a class="code" href="struct__Pool.html#a00e935f7b65616513799ac9e26fefa31">nsolvables</a>);
<a name="l00727"></a>00727   <span class="keywordflow">for</span> (i = 0; i &lt; trans-&gt;<a class="code" href="struct__Transaction.html#a7e05d837578f51e0a26658a2ae37fc4d">steps</a>.<a class="code" href="struct__Queue.html#abb0696a77174cd23b5f488ad4c7b45d2">count</a>; i++)
<a name="l00728"></a>00728     {
<a name="l00729"></a>00729       p = trans-&gt;<a class="code" href="struct__Transaction.html#a7e05d837578f51e0a26658a2ae37fc4d">steps</a>.<a class="code" href="struct__Queue.html#a116eb58bed8ff76bf18f9c16cf1ce5c6">elements</a>[i];
<a name="l00730"></a>00730       s = pool-&gt;<a class="code" href="struct__Pool.html#a9842c936aa241bad13ba13f21a337319">solvables</a> + p;
<a name="l00731"></a>00731       <span class="keywordflow">if</span> (!installed || s-&gt;<a class="code" href="struct__Solvable.html#a15e0b77fe061c6429a24215191b10f05">repo</a> != installed)
<a name="l00732"></a>00732         <a class="code" href="bitmap_8h.html#a33557e357513f5b3faef527bb320183c">MAPSET</a>(installedmap, p);
<a name="l00733"></a>00733     }
<a name="l00734"></a>00734   <span class="keywordflow">if</span> (installed)
<a name="l00735"></a>00735     {
<a name="l00736"></a>00736       <a class="code" href="repo_8h.html#ad2d411118e6dc06fdd38f7ec68c3bb32">FOR_REPO_SOLVABLES</a>(installed, p, s)
<a name="l00737"></a>00737         <span class="keywordflow">if</span> (!<a class="code" href="bitmap_8h.html#ad8ccb9ad3a8ad65f5fe08a988acc503d">MAPTST</a>(&amp;trans-&gt;<a class="code" href="struct__Transaction.html#ac0d758cc5496d3cfe62b8c890d21a47b">transactsmap</a>, p))
<a name="l00738"></a>00738           <a class="code" href="bitmap_8h.html#a33557e357513f5b3faef527bb320183c">MAPSET</a>(installedmap, p);
<a name="l00739"></a>00739     }
<a name="l00740"></a>00740 }
<a name="l00741"></a>00741 
<a name="l00742"></a>00742 <span class="keywordtype">int</span>
<a name="l00743"></a><a class="code" href="transaction_8h.html#a7b1a056e98c931ad1e2b78114dd82e83">00743</a> <a class="code" href="transaction_8c.html#a7b1a056e98c931ad1e2b78114dd82e83">transaction_calc_installsizechange</a>(<a class="code" href="struct__Transaction.html">Transaction</a> *trans)
<a name="l00744"></a>00744 {
<a name="l00745"></a>00745   <a class="code" href="struct__Map.html">Map</a> installedmap;
<a name="l00746"></a>00746   <span class="keywordtype">int</span> change;
<a name="l00747"></a>00747 
<a name="l00748"></a>00748   <a class="code" href="transaction_8c.html#a4eee4040720ec524cf5efad0d85f9cc5">transaction_create_installedmap</a>(trans, &amp;installedmap);
<a name="l00749"></a>00749   change = <a class="code" href="pool_8c.html#aae337fb0d02ff2fbd798b01bfc45a88a">pool_calc_installsizechange</a>(trans-&gt;<a class="code" href="struct__Transaction.html#aeec1bcea114aa72e7c8005b8e08a369b">pool</a>, &amp;installedmap);
<a name="l00750"></a>00750   <a class="code" href="bitmap_8c.html#a85426cea64351e7b4477370824ddd75f">map_free</a>(&amp;installedmap);
<a name="l00751"></a>00751   <span class="keywordflow">return</span> change;
<a name="l00752"></a>00752 }
<a name="l00753"></a>00753 
<a name="l00754"></a>00754 <span class="keywordtype">void</span>
<a name="l00755"></a><a class="code" href="transaction_8h.html#af5142c73a7402d6fc4486ee7ef4e6d89">00755</a> <a class="code" href="transaction_8c.html#a1f4bb82a8b6cdb2a9d56f1777d612832">transaction_calc_duchanges</a>(<a class="code" href="struct__Transaction.html">Transaction</a> *trans, <a class="code" href="struct__DUChanges.html">DUChanges</a> *mps, <span class="keywordtype">int</span> nmps)
<a name="l00756"></a>00756 {
<a name="l00757"></a>00757   <a class="code" href="struct__Map.html">Map</a> installedmap;
<a name="l00758"></a>00758 
<a name="l00759"></a>00759   <a class="code" href="transaction_8c.html#a4eee4040720ec524cf5efad0d85f9cc5">transaction_create_installedmap</a>(trans, &amp;installedmap);
<a name="l00760"></a>00760   <a class="code" href="pool_8c.html#a7c20afd6c8e40d2af7f4d5d04355fdb7">pool_calc_duchanges</a>(trans-&gt;<a class="code" href="struct__Transaction.html#aeec1bcea114aa72e7c8005b8e08a369b">pool</a>, &amp;installedmap, mps, nmps);
<a name="l00761"></a>00761   <a class="code" href="bitmap_8c.html#a85426cea64351e7b4477370824ddd75f">map_free</a>(&amp;installedmap);
<a name="l00762"></a>00762 }
<a name="l00763"></a>00763 
<a name="l00764"></a><a class="code" href="struct__TransactionElement.html">00764</a> <span class="keyword">struct </span><a class="code" href="struct__TransactionElement.html">_TransactionElement</a> {
<a name="l00765"></a><a class="code" href="struct__TransactionElement.html#a15d7a733a882815e8017cab196175090">00765</a>   <a class="code" href="pooltypes_8h.html#a2e0e6278ac51842ca3aeb53e3fc3ead6">Id</a> <a class="code" href="struct__TransactionElement.html#a15d7a733a882815e8017cab196175090">p</a>;         <span class="comment">/* solvable id */</span>
<a name="l00766"></a><a class="code" href="struct__TransactionElement.html#a83c9f82e48799df8c379ecf0d435572e">00766</a>   <a class="code" href="pooltypes_8h.html#a2e0e6278ac51842ca3aeb53e3fc3ead6">Id</a> <a class="code" href="struct__TransactionElement.html#a83c9f82e48799df8c379ecf0d435572e">edges</a>;     <span class="comment">/* pointer into edges data */</span>
<a name="l00767"></a><a class="code" href="struct__TransactionElement.html#a9a92730d3d2313a63a0520a9214a9615">00767</a>   <a class="code" href="pooltypes_8h.html#a2e0e6278ac51842ca3aeb53e3fc3ead6">Id</a> <a class="code" href="struct__TransactionElement.html#a9a92730d3d2313a63a0520a9214a9615">mark</a>;
<a name="l00768"></a>00768 };
<a name="l00769"></a>00769 
<a name="l00770"></a><a class="code" href="struct__TransactionOrderdata.html">00770</a> <span class="keyword">struct </span><a class="code" href="struct__TransactionOrderdata.html">_TransactionOrderdata</a> {
<a name="l00771"></a><a class="code" href="struct__TransactionOrderdata.html#a434565f1766b3f2d4de59ad7d38338eb">00771</a>   <span class="keyword">struct </span><a class="code" href="struct__TransactionElement.html">_TransactionElement</a> *<a class="code" href="struct__TransactionOrderdata.html#a434565f1766b3f2d4de59ad7d38338eb">tes</a>;
<a name="l00772"></a><a class="code" href="struct__TransactionOrderdata.html#a1341a51bc715ad00740aa4fc4e0965d9">00772</a>   <span class="keywordtype">int</span> <a class="code" href="struct__TransactionOrderdata.html#a1341a51bc715ad00740aa4fc4e0965d9">ntes</a>;
<a name="l00773"></a><a class="code" href="struct__TransactionOrderdata.html#aa04948eac0d951e1c56004b06e8cc101">00773</a>   <a class="code" href="pooltypes_8h.html#a2e0e6278ac51842ca3aeb53e3fc3ead6">Id</a> *<a class="code" href="struct__TransactionOrderdata.html#aa04948eac0d951e1c56004b06e8cc101">invedgedata</a>;
<a name="l00774"></a><a class="code" href="struct__TransactionOrderdata.html#a8816e5b8bd23a05d6a73dcee3aa3c26b">00774</a>   <span class="keywordtype">int</span> <a class="code" href="struct__TransactionOrderdata.html#a8816e5b8bd23a05d6a73dcee3aa3c26b">ninvedgedata</a>;
<a name="l00775"></a>00775 };
<a name="l00776"></a>00776 
<a name="l00777"></a><a class="code" href="transaction_8c.html#addd825a898ef4e1c1c8ec80b0dcc175c">00777</a> <span class="preprocessor">#define TYPE_BROKEN     (1&lt;&lt;0)</span>
<a name="l00778"></a><a class="code" href="transaction_8c.html#ace3ac16641bce9bf9a08de1b7fe33272">00778</a> <span class="preprocessor"></span><span class="preprocessor">#define TYPE_CON        (1&lt;&lt;1)</span>
<a name="l00779"></a>00779 <span class="preprocessor"></span>
<a name="l00780"></a><a class="code" href="transaction_8c.html#a08f3c3a82684e5f060354d2baadddf23">00780</a> <span class="preprocessor">#define TYPE_REQ_P      (1&lt;&lt;2)</span>
<a name="l00781"></a><a class="code" href="transaction_8c.html#acf3138e6e901c774a26d9d0a910665a9">00781</a> <span class="preprocessor"></span><span class="preprocessor">#define TYPE_PREREQ_P   (1&lt;&lt;3)</span>
<a name="l00782"></a>00782 <span class="preprocessor"></span>
<a name="l00783"></a><a class="code" href="transaction_8c.html#a46a79b58e0b40ee48e149ccd71ebf8d3">00783</a> <span class="preprocessor">#define TYPE_REQ        (1&lt;&lt;4)</span>
<a name="l00784"></a><a class="code" href="transaction_8c.html#a61e1d12c65169313f8109e6a945e10fa">00784</a> <span class="preprocessor"></span><span class="preprocessor">#define TYPE_PREREQ     (1&lt;&lt;5)</span>
<a name="l00785"></a>00785 <span class="preprocessor"></span>
<a name="l00786"></a><a class="code" href="transaction_8c.html#ac7999251a8ba673393f546cd60d4f9df">00786</a> <span class="preprocessor">#define TYPE_CYCLETAIL  (1&lt;&lt;16)</span>
<a name="l00787"></a><a class="code" href="transaction_8c.html#a99f1854edffdacc03f05955592f05837">00787</a> <span class="preprocessor"></span><span class="preprocessor">#define TYPE_CYCLEHEAD  (1&lt;&lt;17)</span>
<a name="l00788"></a>00788 <span class="preprocessor"></span>
<a name="l00789"></a><a class="code" href="transaction_8c.html#affde009c2a01eff48789464ba08e73b3">00789</a> <span class="preprocessor">#define EDGEDATA_BLOCK  127</span>
<a name="l00790"></a>00790 <span class="preprocessor"></span>
<a name="l00791"></a>00791 <span class="keywordtype">void</span>
<a name="l00792"></a><a class="code" href="transaction_8h.html#a5fa8a6f0829aaf3d9afc0a95d0a1c20b">00792</a> <a class="code" href="transaction_8c.html#ac0cc07940adf6c27098c09466242d0c0">transaction_init</a>(<a class="code" href="struct__Transaction.html">Transaction</a> *trans, <a class="code" href="struct__Pool.html">Pool</a> *pool)
<a name="l00793"></a>00793 {
<a name="l00794"></a>00794   memset(trans, 0, <span class="keyword">sizeof</span>(*trans));
<a name="l00795"></a>00795   trans-&gt;<a class="code" href="struct__Transaction.html#aeec1bcea114aa72e7c8005b8e08a369b">pool</a> = pool;
<a name="l00796"></a>00796 }
<a name="l00797"></a>00797 
<a name="l00798"></a>00798 <span class="keywordtype">void</span>
<a name="l00799"></a><a class="code" href="transaction_8h.html#acd51520fe24b1bfb64d55e125a8d05d4">00799</a> <a class="code" href="transaction_8c.html#acd51520fe24b1bfb64d55e125a8d05d4">transaction_init_clone</a>(<a class="code" href="struct__Transaction.html">Transaction</a> *trans, <a class="code" href="struct__Transaction.html">Transaction</a> *srctrans)
<a name="l00800"></a>00800 {
<a name="l00801"></a>00801   memset(trans, 0, <span class="keyword">sizeof</span>(*trans));
<a name="l00802"></a>00802   trans-&gt;<a class="code" href="struct__Transaction.html#aeec1bcea114aa72e7c8005b8e08a369b">pool</a> = srctrans-&gt;<a class="code" href="struct__Transaction.html#aeec1bcea114aa72e7c8005b8e08a369b">pool</a>;
<a name="l00803"></a>00803   <a class="code" href="queue_8c.html#ac1d41e0b06e520040213b392002aebed">queue_init_clone</a>(&amp;trans-&gt;<a class="code" href="struct__Transaction.html#a7e05d837578f51e0a26658a2ae37fc4d">steps</a>, &amp;srctrans-&gt;<a class="code" href="struct__Transaction.html#a7e05d837578f51e0a26658a2ae37fc4d">steps</a>);
<a name="l00804"></a>00804   <a class="code" href="queue_8c.html#ac1d41e0b06e520040213b392002aebed">queue_init_clone</a>(&amp;trans-&gt;<a class="code" href="struct__Transaction.html#aee106dc80baa493cbd7b6f3dd9011845">transaction_info</a>, &amp;srctrans-&gt;<a class="code" href="struct__Transaction.html#aee106dc80baa493cbd7b6f3dd9011845">transaction_info</a>);
<a name="l00805"></a>00805   <span class="keywordflow">if</span> (srctrans-&gt;<a class="code" href="struct__Transaction.html#a592881da1d794d3ea60272a3938d4bf0">transaction_installed</a>)
<a name="l00806"></a>00806     {
<a name="l00807"></a>00807       <a class="code" href="struct__Repo.html">Repo</a> *installed = srctrans-&gt;<a class="code" href="struct__Transaction.html#aeec1bcea114aa72e7c8005b8e08a369b">pool</a>-&gt;<a class="code" href="struct__Pool.html#a887053f905054298cd61ce1c99e26690">installed</a>;
<a name="l00808"></a>00808       trans-&gt;<a class="code" href="struct__Transaction.html#a592881da1d794d3ea60272a3938d4bf0">transaction_installed</a> = <a class="code" href="util_8c.html#a7964924c069160718b17ac2770d6885d">sat_calloc</a>(installed-&gt;<a class="code" href="struct__Repo.html#aca3e16cc200b9c236963f56bf038a7bc">end</a> - installed-&gt;<a class="code" href="struct__Repo.html#a4eb2dd93e4a4f88f13d462f2f111e038">start</a>, <span class="keyword">sizeof</span>(<a class="code" href="pooltypes_8h.html#a2e0e6278ac51842ca3aeb53e3fc3ead6">Id</a>));
<a name="l00809"></a>00809       memcpy(trans-&gt;<a class="code" href="struct__Transaction.html#a592881da1d794d3ea60272a3938d4bf0">transaction_installed</a>, srctrans-&gt;<a class="code" href="struct__Transaction.html#a592881da1d794d3ea60272a3938d4bf0">transaction_installed</a>, (installed-&gt;<a class="code" href="struct__Repo.html#aca3e16cc200b9c236963f56bf038a7bc">end</a> - installed-&gt;<a class="code" href="struct__Repo.html#a4eb2dd93e4a4f88f13d462f2f111e038">start</a>) * <span class="keyword">sizeof</span>(<a class="code" href="pooltypes_8h.html#a2e0e6278ac51842ca3aeb53e3fc3ead6">Id</a>));
<a name="l00810"></a>00810     }
<a name="l00811"></a>00811   <a class="code" href="bitmap_8c.html#a9115caa6f4faf6bd5757cf803a65b30f">map_init_clone</a>(&amp;trans-&gt;<a class="code" href="struct__Transaction.html#ac0d758cc5496d3cfe62b8c890d21a47b">transactsmap</a>, &amp;srctrans-&gt;<a class="code" href="struct__Transaction.html#ac0d758cc5496d3cfe62b8c890d21a47b">transactsmap</a>);
<a name="l00812"></a>00812   <a class="code" href="bitmap_8c.html#a9115caa6f4faf6bd5757cf803a65b30f">map_init_clone</a>(&amp;trans-&gt;<a class="code" href="struct__Transaction.html#aac87ae47634e99c5266a762ee85d59e5">noobsmap</a>, &amp;srctrans-&gt;<a class="code" href="struct__Transaction.html#aac87ae47634e99c5266a762ee85d59e5">noobsmap</a>);
<a name="l00813"></a>00813   <span class="keywordflow">if</span> (srctrans-&gt;<a class="code" href="struct__Transaction.html#a7d6f72d061b26666810132daa1937fa3">orderdata</a>)
<a name="l00814"></a>00814     {
<a name="l00815"></a>00815       <span class="keyword">struct </span><a class="code" href="struct__TransactionOrderdata.html">_TransactionOrderdata</a> *od = srctrans-&gt;<a class="code" href="struct__Transaction.html#a7d6f72d061b26666810132daa1937fa3">orderdata</a>;
<a name="l00816"></a>00816       trans-&gt;<a class="code" href="struct__Transaction.html#a7d6f72d061b26666810132daa1937fa3">orderdata</a> = <a class="code" href="util_8c.html#a7964924c069160718b17ac2770d6885d">sat_calloc</a>(1, <span class="keyword">sizeof</span>(*trans-&gt;<a class="code" href="struct__Transaction.html#a7d6f72d061b26666810132daa1937fa3">orderdata</a>));
<a name="l00817"></a>00817       trans-&gt;<a class="code" href="struct__Transaction.html#a7d6f72d061b26666810132daa1937fa3">orderdata</a>-&gt;<a class="code" href="struct__TransactionOrderdata.html#a434565f1766b3f2d4de59ad7d38338eb">tes</a> = <a class="code" href="util_8c.html#ab9d2d14a104453bab5b20a3e449db52b">sat_malloc2</a>(od-&gt;<a class="code" href="struct__TransactionOrderdata.html#a1341a51bc715ad00740aa4fc4e0965d9">ntes</a>, <span class="keyword">sizeof</span>(*od-&gt;<a class="code" href="struct__TransactionOrderdata.html#a434565f1766b3f2d4de59ad7d38338eb">tes</a>));
<a name="l00818"></a>00818       memcpy(trans-&gt;<a class="code" href="struct__Transaction.html#a7d6f72d061b26666810132daa1937fa3">orderdata</a>-&gt;<a class="code" href="struct__TransactionOrderdata.html#a434565f1766b3f2d4de59ad7d38338eb">tes</a>, od-&gt;<a class="code" href="struct__TransactionOrderdata.html#a434565f1766b3f2d4de59ad7d38338eb">tes</a>, od-&gt;<a class="code" href="struct__TransactionOrderdata.html#a1341a51bc715ad00740aa4fc4e0965d9">ntes</a> * <span class="keyword">sizeof</span>(*od-&gt;<a class="code" href="struct__TransactionOrderdata.html#a434565f1766b3f2d4de59ad7d38338eb">tes</a>));
<a name="l00819"></a>00819       trans-&gt;<a class="code" href="struct__Transaction.html#a7d6f72d061b26666810132daa1937fa3">orderdata</a>-&gt;<a class="code" href="struct__TransactionOrderdata.html#a1341a51bc715ad00740aa4fc4e0965d9">ntes</a> = od-&gt;<a class="code" href="struct__TransactionOrderdata.html#a1341a51bc715ad00740aa4fc4e0965d9">ntes</a>;
<a name="l00820"></a>00820       trans-&gt;<a class="code" href="struct__Transaction.html#a7d6f72d061b26666810132daa1937fa3">orderdata</a>-&gt;<a class="code" href="struct__TransactionOrderdata.html#aa04948eac0d951e1c56004b06e8cc101">invedgedata</a> = <a class="code" href="util_8c.html#ab9d2d14a104453bab5b20a3e449db52b">sat_malloc2</a>(od-&gt;<a class="code" href="struct__TransactionOrderdata.html#a8816e5b8bd23a05d6a73dcee3aa3c26b">ninvedgedata</a>, <span class="keyword">sizeof</span>(<a class="code" href="pooltypes_8h.html#a2e0e6278ac51842ca3aeb53e3fc3ead6">Id</a>));
<a name="l00821"></a>00821       memcpy(trans-&gt;<a class="code" href="struct__Transaction.html#a7d6f72d061b26666810132daa1937fa3">orderdata</a>-&gt;<a class="code" href="struct__TransactionOrderdata.html#aa04948eac0d951e1c56004b06e8cc101">invedgedata</a>, od-&gt;<a class="code" href="struct__TransactionOrderdata.html#aa04948eac0d951e1c56004b06e8cc101">invedgedata</a>, od-&gt;<a class="code" href="struct__TransactionOrderdata.html#a8816e5b8bd23a05d6a73dcee3aa3c26b">ninvedgedata</a> * <span class="keyword">sizeof</span>(<a class="code" href="pooltypes_8h.html#a2e0e6278ac51842ca3aeb53e3fc3ead6">Id</a>));
<a name="l00822"></a>00822       trans-&gt;<a class="code" href="struct__Transaction.html#a7d6f72d061b26666810132daa1937fa3">orderdata</a>-&gt;<a class="code" href="struct__TransactionOrderdata.html#a8816e5b8bd23a05d6a73dcee3aa3c26b">ninvedgedata</a> = od-&gt;<a class="code" href="struct__TransactionOrderdata.html#a8816e5b8bd23a05d6a73dcee3aa3c26b">ninvedgedata</a>;
<a name="l00823"></a>00823     }
<a name="l00824"></a>00824 }
<a name="l00825"></a>00825 
<a name="l00826"></a>00826 <span class="keywordtype">void</span>
<a name="l00827"></a><a class="code" href="transaction_8h.html#a13e11b7d28c2991708ce6cc48f8ee223">00827</a> <a class="code" href="transaction_8c.html#a13e11b7d28c2991708ce6cc48f8ee223">transaction_free</a>(<a class="code" href="struct__Transaction.html">Transaction</a> *trans)
<a name="l00828"></a>00828 {
<a name="l00829"></a>00829   <a class="code" href="queue_8c.html#a701c81a9f7d503837e74d43981e79137">queue_free</a>(&amp;trans-&gt;<a class="code" href="struct__Transaction.html#a7e05d837578f51e0a26658a2ae37fc4d">steps</a>);
<a name="l00830"></a>00830   <a class="code" href="queue_8c.html#a701c81a9f7d503837e74d43981e79137">queue_free</a>(&amp;trans-&gt;<a class="code" href="struct__Transaction.html#aee106dc80baa493cbd7b6f3dd9011845">transaction_info</a>);
<a name="l00831"></a>00831   trans-&gt;<a class="code" href="struct__Transaction.html#a592881da1d794d3ea60272a3938d4bf0">transaction_installed</a> = <a class="code" href="util_8c.html#a1f246fae10a89534cfe0583cefb44c11">sat_free</a>(trans-&gt;<a class="code" href="struct__Transaction.html#a592881da1d794d3ea60272a3938d4bf0">transaction_installed</a>);
<a name="l00832"></a>00832   <a class="code" href="bitmap_8c.html#a85426cea64351e7b4477370824ddd75f">map_free</a>(&amp;trans-&gt;<a class="code" href="struct__Transaction.html#ac0d758cc5496d3cfe62b8c890d21a47b">transactsmap</a>);
<a name="l00833"></a>00833   <a class="code" href="bitmap_8c.html#a85426cea64351e7b4477370824ddd75f">map_free</a>(&amp;trans-&gt;<a class="code" href="struct__Transaction.html#aac87ae47634e99c5266a762ee85d59e5">noobsmap</a>);
<a name="l00834"></a>00834   <a class="code" href="transaction_8c.html#a3f182caa88e4bfdd9c8a46f816d615fb">transaction_free_orderdata</a>(trans);
<a name="l00835"></a>00835 }
<a name="l00836"></a>00836 
<a name="l00837"></a>00837 <span class="keywordtype">void</span>
<a name="l00838"></a><a class="code" href="transaction_8h.html#a3f182caa88e4bfdd9c8a46f816d615fb">00838</a> <a class="code" href="transaction_8c.html#a3f182caa88e4bfdd9c8a46f816d615fb">transaction_free_orderdata</a>(<a class="code" href="struct__Transaction.html">Transaction</a> *trans)
<a name="l00839"></a>00839 {
<a name="l00840"></a>00840   <span class="keywordflow">if</span> (trans-&gt;<a class="code" href="struct__Transaction.html#a7d6f72d061b26666810132daa1937fa3">orderdata</a>)
<a name="l00841"></a>00841     {
<a name="l00842"></a>00842       <span class="keyword">struct </span><a class="code" href="struct__TransactionOrderdata.html">_TransactionOrderdata</a> *od = trans-&gt;<a class="code" href="struct__Transaction.html#a7d6f72d061b26666810132daa1937fa3">orderdata</a>;
<a name="l00843"></a>00843       od-&gt;<a class="code" href="struct__TransactionOrderdata.html#a434565f1766b3f2d4de59ad7d38338eb">tes</a> = <a class="code" href="util_8c.html#a1f246fae10a89534cfe0583cefb44c11">sat_free</a>(od-&gt;<a class="code" href="struct__TransactionOrderdata.html#a434565f1766b3f2d4de59ad7d38338eb">tes</a>);
<a name="l00844"></a>00844       od-&gt;<a class="code" href="struct__TransactionOrderdata.html#aa04948eac0d951e1c56004b06e8cc101">invedgedata</a> = <a class="code" href="util_8c.html#a1f246fae10a89534cfe0583cefb44c11">sat_free</a>(od-&gt;<a class="code" href="struct__TransactionOrderdata.html#aa04948eac0d951e1c56004b06e8cc101">invedgedata</a>);
<a name="l00845"></a>00845       trans-&gt;<a class="code" href="struct__Transaction.html#a7d6f72d061b26666810132daa1937fa3">orderdata</a> = <a class="code" href="util_8c.html#a1f246fae10a89534cfe0583cefb44c11">sat_free</a>(trans-&gt;<a class="code" href="struct__Transaction.html#a7d6f72d061b26666810132daa1937fa3">orderdata</a>);
<a name="l00846"></a>00846     }
<a name="l00847"></a>00847 }
<a name="l00848"></a>00848 
<a name="l00849"></a><a class="code" href="structorderdata.html">00849</a> <span class="keyword">struct </span><a class="code" href="structorderdata.html">orderdata</a> {
<a name="l00850"></a><a class="code" href="structorderdata.html#a504265b4ce88aae0b2e6139a153094cb">00850</a>   <a class="code" href="struct__Transaction.html">Transaction</a> *<a class="code" href="structorderdata.html#a504265b4ce88aae0b2e6139a153094cb">trans</a>;
<a name="l00851"></a><a class="code" href="structorderdata.html#af2c9ed95d58301c7b395bb8812b5cddf">00851</a>   <span class="keyword">struct </span><a class="code" href="struct__TransactionElement.html">_TransactionElement</a> *<a class="code" href="structorderdata.html#af2c9ed95d58301c7b395bb8812b5cddf">tes</a>;
<a name="l00852"></a><a class="code" href="structorderdata.html#ac4393a568ed39c73f0042a208a3b60d9">00852</a>   <span class="keywordtype">int</span> <a class="code" href="structorderdata.html#ac4393a568ed39c73f0042a208a3b60d9">ntes</a>;
<a name="l00853"></a><a class="code" href="structorderdata.html#aa7d6b79cd94b60508b1390d1c299c83c">00853</a>   <a class="code" href="pooltypes_8h.html#a2e0e6278ac51842ca3aeb53e3fc3ead6">Id</a> *<a class="code" href="structorderdata.html#aa7d6b79cd94b60508b1390d1c299c83c">edgedata</a>;
<a name="l00854"></a><a class="code" href="structorderdata.html#a50802367a905a1a9cb41ea8725fb0e8c">00854</a>   <span class="keywordtype">int</span> <a class="code" href="structorderdata.html#a50802367a905a1a9cb41ea8725fb0e8c">nedgedata</a>;
<a name="l00855"></a><a class="code" href="structorderdata.html#a961f78ed70429961291bb497f7251e94">00855</a>   <a class="code" href="pooltypes_8h.html#a2e0e6278ac51842ca3aeb53e3fc3ead6">Id</a> *<a class="code" href="structorderdata.html#a961f78ed70429961291bb497f7251e94">invedgedata</a>;
<a name="l00856"></a>00856 
<a name="l00857"></a><a class="code" href="structorderdata.html#a0d5db89a42a09650097dfe8f9e0842f6">00857</a>   <a class="code" href="struct__Queue.html">Queue</a> <a class="code" href="structorderdata.html#a0d5db89a42a09650097dfe8f9e0842f6">cycles</a>;
<a name="l00858"></a><a class="code" href="structorderdata.html#a386d2b53b22a56e672da397cfa970c08">00858</a>   <a class="code" href="struct__Queue.html">Queue</a> <a class="code" href="structorderdata.html#a386d2b53b22a56e672da397cfa970c08">cyclesdata</a>;
<a name="l00859"></a><a class="code" href="structorderdata.html#aded143184ad79a57bbd973d7b5f7a90e">00859</a>   <span class="keywordtype">int</span> <a class="code" href="structorderdata.html#aded143184ad79a57bbd973d7b5f7a90e">ncycles</a>;
<a name="l00860"></a>00860 };
<a name="l00861"></a>00861 
<a name="l00862"></a>00862 <span class="keyword">static</span> <span class="keywordtype">int</span>
<a name="l00863"></a><a class="code" href="transaction_8c.html#a6a7194ba9f917f502f36e8e9a4769dc3">00863</a> <a class="code" href="transaction_8c.html#a6a7194ba9f917f502f36e8e9a4769dc3">addteedge</a>(<span class="keyword">struct</span> <a class="code" href="structorderdata.html">orderdata</a> *od, <span class="keywordtype">int</span> from, <span class="keywordtype">int</span> to, <span class="keywordtype">int</span> type)
<a name="l00864"></a>00864 {
<a name="l00865"></a>00865   <span class="keywordtype">int</span> i;
<a name="l00866"></a>00866   <span class="keyword">struct </span><a class="code" href="struct__TransactionElement.html">_TransactionElement</a> *te;
<a name="l00867"></a>00867 
<a name="l00868"></a>00868   <span class="keywordflow">if</span> (from == to)
<a name="l00869"></a>00869     <span class="keywordflow">return</span> 0;
<a name="l00870"></a>00870 
<a name="l00871"></a>00871   <span class="comment">/* printf(&quot;edge %d(%s) -&gt; %d(%s) type %x\n&quot;, from, solvid2str(pool, od-&gt;tes[from].p), to, solvid2str(pool, od-&gt;tes[to].p), type); */</span>
<a name="l00872"></a>00872 
<a name="l00873"></a>00873   te = od-&gt;<a class="code" href="structorderdata.html#af2c9ed95d58301c7b395bb8812b5cddf">tes</a> + from;
<a name="l00874"></a>00874   <span class="keywordflow">for</span> (i = te-&gt;<a class="code" href="struct__TransactionElement.html#a83c9f82e48799df8c379ecf0d435572e">edges</a>; od-&gt;<a class="code" href="structorderdata.html#aa7d6b79cd94b60508b1390d1c299c83c">edgedata</a>[i]; i += 2)
<a name="l00875"></a>00875     <span class="keywordflow">if</span> (od-&gt;<a class="code" href="structorderdata.html#aa7d6b79cd94b60508b1390d1c299c83c">edgedata</a>[i] == to)
<a name="l00876"></a>00876       <span class="keywordflow">break</span>;
<a name="l00877"></a>00877   <span class="comment">/* test of brokenness */</span>
<a name="l00878"></a>00878   <span class="keywordflow">if</span> (type == <a class="code" href="transaction_8c.html#addd825a898ef4e1c1c8ec80b0dcc175c">TYPE_BROKEN</a>)
<a name="l00879"></a>00879     <span class="keywordflow">return</span> od-&gt;<a class="code" href="structorderdata.html#aa7d6b79cd94b60508b1390d1c299c83c">edgedata</a>[i] &amp;&amp; (od-&gt;<a class="code" href="structorderdata.html#aa7d6b79cd94b60508b1390d1c299c83c">edgedata</a>[i + 1] &amp; TYPE_BROKEN) != 0 ? 1 : 0;
<a name="l00880"></a>00880   <span class="keywordflow">if</span> (od-&gt;<a class="code" href="structorderdata.html#aa7d6b79cd94b60508b1390d1c299c83c">edgedata</a>[i])
<a name="l00881"></a>00881     {
<a name="l00882"></a>00882       od-&gt;<a class="code" href="structorderdata.html#aa7d6b79cd94b60508b1390d1c299c83c">edgedata</a>[i + 1] |= type;
<a name="l00883"></a>00883       <span class="keywordflow">return</span> 0;
<a name="l00884"></a>00884     }
<a name="l00885"></a>00885   <span class="keywordflow">if</span> (i + 1 == od-&gt;<a class="code" href="structorderdata.html#a50802367a905a1a9cb41ea8725fb0e8c">nedgedata</a>)
<a name="l00886"></a>00886     {
<a name="l00887"></a>00887       <span class="comment">/* printf(&quot;tail add %d\n&quot;, i - te-&gt;edges); */</span>
<a name="l00888"></a>00888       <span class="keywordflow">if</span> (!i)
<a name="l00889"></a>00889         te-&gt;<a class="code" href="struct__TransactionElement.html#a83c9f82e48799df8c379ecf0d435572e">edges</a> = ++i;
<a name="l00890"></a>00890       od-&gt;<a class="code" href="structorderdata.html#aa7d6b79cd94b60508b1390d1c299c83c">edgedata</a> = <a class="code" href="util_8h.html#a8f0135824fd0936735b002a452c84cbd">sat_extend</a>(od-&gt;<a class="code" href="structorderdata.html#aa7d6b79cd94b60508b1390d1c299c83c">edgedata</a>, od-&gt;<a class="code" href="structorderdata.html#a50802367a905a1a9cb41ea8725fb0e8c">nedgedata</a>, 3, <span class="keyword">sizeof</span>(<a class="code" href="pooltypes_8h.html#a2e0e6278ac51842ca3aeb53e3fc3ead6">Id</a>), <a class="code" href="transaction_8c.html#affde009c2a01eff48789464ba08e73b3">EDGEDATA_BLOCK</a>);
<a name="l00891"></a>00891     }
<a name="l00892"></a>00892   <span class="keywordflow">else</span>
<a name="l00893"></a>00893     {
<a name="l00894"></a>00894       <span class="comment">/* printf(&quot;extend %d\n&quot;, i - te-&gt;edges); */</span>
<a name="l00895"></a>00895       od-&gt;<a class="code" href="structorderdata.html#aa7d6b79cd94b60508b1390d1c299c83c">edgedata</a> = <a class="code" href="util_8h.html#a8f0135824fd0936735b002a452c84cbd">sat_extend</a>(od-&gt;<a class="code" href="structorderdata.html#aa7d6b79cd94b60508b1390d1c299c83c">edgedata</a>, od-&gt;<a class="code" href="structorderdata.html#a50802367a905a1a9cb41ea8725fb0e8c">nedgedata</a>, 3 + (i - te-&gt;<a class="code" href="struct__TransactionElement.html#a83c9f82e48799df8c379ecf0d435572e">edges</a>), <span class="keyword">sizeof</span>(<a class="code" href="pooltypes_8h.html#a2e0e6278ac51842ca3aeb53e3fc3ead6">Id</a>), <a class="code" href="transaction_8c.html#affde009c2a01eff48789464ba08e73b3">EDGEDATA_BLOCK</a>);
<a name="l00896"></a>00896       <span class="keywordflow">if</span> (i &gt; te-&gt;<a class="code" href="struct__TransactionElement.html#a83c9f82e48799df8c379ecf0d435572e">edges</a>)
<a name="l00897"></a>00897         memcpy(od-&gt;<a class="code" href="structorderdata.html#aa7d6b79cd94b60508b1390d1c299c83c">edgedata</a> + od-&gt;<a class="code" href="structorderdata.html#a50802367a905a1a9cb41ea8725fb0e8c">nedgedata</a>, od-&gt;<a class="code" href="structorderdata.html#aa7d6b79cd94b60508b1390d1c299c83c">edgedata</a> + te-&gt;<a class="code" href="struct__TransactionElement.html#a83c9f82e48799df8c379ecf0d435572e">edges</a>, <span class="keyword">sizeof</span>(<a class="code" href="pooltypes_8h.html#a2e0e6278ac51842ca3aeb53e3fc3ead6">Id</a>) * (i - te-&gt;<a class="code" href="struct__TransactionElement.html#a83c9f82e48799df8c379ecf0d435572e">edges</a>));
<a name="l00898"></a>00898       i = od-&gt;<a class="code" href="structorderdata.html#a50802367a905a1a9cb41ea8725fb0e8c">nedgedata</a> + (i - te-&gt;<a class="code" href="struct__TransactionElement.html#a83c9f82e48799df8c379ecf0d435572e">edges</a>);
<a name="l00899"></a>00899       te-&gt;<a class="code" href="struct__TransactionElement.html#a83c9f82e48799df8c379ecf0d435572e">edges</a> = od-&gt;<a class="code" href="structorderdata.html#a50802367a905a1a9cb41ea8725fb0e8c">nedgedata</a>;
<a name="l00900"></a>00900     }
<a name="l00901"></a>00901   od-&gt;<a class="code" href="structorderdata.html#aa7d6b79cd94b60508b1390d1c299c83c">edgedata</a>[i] = to;
<a name="l00902"></a>00902   od-&gt;<a class="code" href="structorderdata.html#aa7d6b79cd94b60508b1390d1c299c83c">edgedata</a>[i + 1] = type;
<a name="l00903"></a>00903   od-&gt;<a class="code" href="structorderdata.html#aa7d6b79cd94b60508b1390d1c299c83c">edgedata</a>[i + 2] = 0;      <span class="comment">/* end marker */</span>
<a name="l00904"></a>00904   od-&gt;<a class="code" href="structorderdata.html#a50802367a905a1a9cb41ea8725fb0e8c">nedgedata</a> = i + 3;
<a name="l00905"></a>00905   <span class="keywordflow">return</span> 0;
<a name="l00906"></a>00906 }
<a name="l00907"></a>00907 
<a name="l00908"></a>00908 <span class="keyword">static</span> <span class="keywordtype">int</span>
<a name="l00909"></a><a class="code" href="transaction_8c.html#a858f4eec3e5c4b2c8ca6bfacf870d9a8">00909</a> <a class="code" href="transaction_8c.html#a858f4eec3e5c4b2c8ca6bfacf870d9a8">addedge</a>(<span class="keyword">struct</span> <a class="code" href="structorderdata.html">orderdata</a> *od, <a class="code" href="pooltypes_8h.html#a2e0e6278ac51842ca3aeb53e3fc3ead6">Id</a> from, <a class="code" href="pooltypes_8h.html#a2e0e6278ac51842ca3aeb53e3fc3ead6">Id</a> to, <span class="keywordtype">int</span> type)
<a name="l00910"></a>00910 {
<a name="l00911"></a>00911   <a class="code" href="struct__Transaction.html">Transaction</a> *trans = od-&gt;<a class="code" href="structorderdata.html#a504265b4ce88aae0b2e6139a153094cb">trans</a>;
<a name="l00912"></a>00912   <a class="code" href="struct__Pool.html">Pool</a> *pool = trans-&gt;<a class="code" href="struct__Transaction.html#aeec1bcea114aa72e7c8005b8e08a369b">pool</a>;
<a name="l00913"></a>00913   <a class="code" href="struct__Solvable.html">Solvable</a> *s;
<a name="l00914"></a>00914   <span class="keyword">struct </span><a class="code" href="struct__TransactionElement.html">_TransactionElement</a> *te;
<a name="l00915"></a>00915   <span class="keywordtype">int</span> i;
<a name="l00916"></a>00916 
<a name="l00917"></a>00917   <span class="comment">// printf(&quot;addedge %d %d type %d\n&quot;, from, to, type);</span>
<a name="l00918"></a>00918   s = pool-&gt;<a class="code" href="struct__Pool.html#a9842c936aa241bad13ba13f21a337319">solvables</a> + from;
<a name="l00919"></a>00919   <span class="keywordflow">if</span> (s-&gt;<a class="code" href="struct__Solvable.html#a15e0b77fe061c6429a24215191b10f05">repo</a> == pool-&gt;<a class="code" href="struct__Pool.html#a887053f905054298cd61ce1c99e26690">installed</a> &amp;&amp; trans-&gt;<a class="code" href="struct__Transaction.html#a592881da1d794d3ea60272a3938d4bf0">transaction_installed</a>[from - pool-&gt;<a class="code" href="struct__Pool.html#a887053f905054298cd61ce1c99e26690">installed</a>-&gt;<a class="code" href="struct__Repo.html#a4eb2dd93e4a4f88f13d462f2f111e038">start</a>])
<a name="l00920"></a>00920     {
<a name="l00921"></a>00921       <span class="comment">/* obsolete, map to install */</span>
<a name="l00922"></a>00922       <span class="keywordflow">if</span> (trans-&gt;<a class="code" href="struct__Transaction.html#a592881da1d794d3ea60272a3938d4bf0">transaction_installed</a>[from - pool-&gt;<a class="code" href="struct__Pool.html#a887053f905054298cd61ce1c99e26690">installed</a>-&gt;<a class="code" href="struct__Repo.html#a4eb2dd93e4a4f88f13d462f2f111e038">start</a>] &gt; 0)
<a name="l00923"></a>00923         from = trans-&gt;<a class="code" href="struct__Transaction.html#a592881da1d794d3ea60272a3938d4bf0">transaction_installed</a>[from - pool-&gt;<a class="code" href="struct__Pool.html#a887053f905054298cd61ce1c99e26690">installed</a>-&gt;<a class="code" href="struct__Repo.html#a4eb2dd93e4a4f88f13d462f2f111e038">start</a>];
<a name="l00924"></a>00924       <span class="keywordflow">else</span>
<a name="l00925"></a>00925         {
<a name="l00926"></a>00926           <span class="keywordtype">int</span> ret = 0;
<a name="l00927"></a>00927           <a class="code" href="struct__Queue.html">Queue</a> ti;
<a name="l00928"></a>00928           <a class="code" href="pooltypes_8h.html#a2e0e6278ac51842ca3aeb53e3fc3ead6">Id</a> tibuf[5];
<a name="l00929"></a>00929 
<a name="l00930"></a>00930           <a class="code" href="queue_8c.html#a5988db301609a3b7ab6666e50c61430e">queue_init_buffer</a>(&amp;ti, tibuf, <span class="keyword">sizeof</span>(tibuf)/<span class="keyword">sizeof</span>(*tibuf));
<a name="l00931"></a>00931           <a class="code" href="transaction_8c.html#aaa33152cda972dad9f684b64e376ea05">transaction_all_obs_pkgs</a>(trans, from, &amp;ti);
<a name="l00932"></a>00932           <span class="keywordflow">for</span> (i = 0; i &lt; ti.<a class="code" href="struct__Queue.html#abb0696a77174cd23b5f488ad4c7b45d2">count</a>; i++)
<a name="l00933"></a>00933             ret |= <a class="code" href="transaction_8c.html#a858f4eec3e5c4b2c8ca6bfacf870d9a8">addedge</a>(od, ti.<a class="code" href="struct__Queue.html#a116eb58bed8ff76bf18f9c16cf1ce5c6">elements</a>[i], to, type);
<a name="l00934"></a>00934           <a class="code" href="queue_8c.html#a701c81a9f7d503837e74d43981e79137">queue_free</a>(&amp;ti);
<a name="l00935"></a>00935           <span class="keywordflow">return</span> ret;
<a name="l00936"></a>00936         }
<a name="l00937"></a>00937     }
<a name="l00938"></a>00938   s = pool-&gt;<a class="code" href="struct__Pool.html#a9842c936aa241bad13ba13f21a337319">solvables</a> + to;
<a name="l00939"></a>00939   <span class="keywordflow">if</span> (s-&gt;<a class="code" href="struct__Solvable.html#a15e0b77fe061c6429a24215191b10f05">repo</a> == pool-&gt;<a class="code" href="struct__Pool.html#a887053f905054298cd61ce1c99e26690">installed</a> &amp;&amp; trans-&gt;<a class="code" href="struct__Transaction.html#a592881da1d794d3ea60272a3938d4bf0">transaction_installed</a>[to - pool-&gt;<a class="code" href="struct__Pool.html#a887053f905054298cd61ce1c99e26690">installed</a>-&gt;<a class="code" href="struct__Repo.html#a4eb2dd93e4a4f88f13d462f2f111e038">start</a>])
<a name="l00940"></a>00940     {
<a name="l00941"></a>00941       <span class="comment">/* obsolete, map to install */</span>
<a name="l00942"></a>00942       <span class="keywordflow">if</span> (trans-&gt;<a class="code" href="struct__Transaction.html#a592881da1d794d3ea60272a3938d4bf0">transaction_installed</a>[to - pool-&gt;<a class="code" href="struct__Pool.html#a887053f905054298cd61ce1c99e26690">installed</a>-&gt;<a class="code" href="struct__Repo.html#a4eb2dd93e4a4f88f13d462f2f111e038">start</a>] &gt; 0)
<a name="l00943"></a>00943         to = trans-&gt;<a class="code" href="struct__Transaction.html#a592881da1d794d3ea60272a3938d4bf0">transaction_installed</a>[to - pool-&gt;<a class="code" href="struct__Pool.html#a887053f905054298cd61ce1c99e26690">installed</a>-&gt;<a class="code" href="struct__Repo.html#a4eb2dd93e4a4f88f13d462f2f111e038">start</a>];
<a name="l00944"></a>00944       <span class="keywordflow">else</span>
<a name="l00945"></a>00945         {
<a name="l00946"></a>00946           <span class="keywordtype">int</span> ret = 0;
<a name="l00947"></a>00947           <a class="code" href="struct__Queue.html">Queue</a> ti;
<a name="l00948"></a>00948           <a class="code" href="pooltypes_8h.html#a2e0e6278ac51842ca3aeb53e3fc3ead6">Id</a> tibuf[5];
<a name="l00949"></a>00949 
<a name="l00950"></a>00950           <a class="code" href="queue_8c.html#a5988db301609a3b7ab6666e50c61430e">queue_init_buffer</a>(&amp;ti, tibuf, <span class="keyword">sizeof</span>(tibuf)/<span class="keyword">sizeof</span>(*tibuf));
<a name="l00951"></a>00951           <a class="code" href="transaction_8c.html#aaa33152cda972dad9f684b64e376ea05">transaction_all_obs_pkgs</a>(trans, to, &amp;ti);
<a name="l00952"></a>00952           <span class="keywordflow">for</span> (i = 0; i &lt; ti.<a class="code" href="struct__Queue.html#abb0696a77174cd23b5f488ad4c7b45d2">count</a>; i++)
<a name="l00953"></a>00953             ret |= <a class="code" href="transaction_8c.html#a858f4eec3e5c4b2c8ca6bfacf870d9a8">addedge</a>(od, from, ti.<a class="code" href="struct__Queue.html#a116eb58bed8ff76bf18f9c16cf1ce5c6">elements</a>[i], type);
<a name="l00954"></a>00954           <a class="code" href="queue_8c.html#a701c81a9f7d503837e74d43981e79137">queue_free</a>(&amp;ti);
<a name="l00955"></a>00955           <span class="keywordflow">return</span> ret;
<a name="l00956"></a>00956         }
<a name="l00957"></a>00957     }
<a name="l00958"></a>00958 
<a name="l00959"></a>00959   <span class="comment">/* map from/to to te numbers */</span>
<a name="l00960"></a>00960   <span class="keywordflow">for</span> (i = 1, te = od-&gt;<a class="code" href="structorderdata.html#af2c9ed95d58301c7b395bb8812b5cddf">tes</a> + i; i &lt; od-&gt;ntes; i++, te++)
<a name="l00961"></a>00961     <span class="keywordflow">if</span> (te-&gt;<a class="code" href="struct__TransactionElement.html#a15d7a733a882815e8017cab196175090">p</a> == to)
<a name="l00962"></a>00962       <span class="keywordflow">break</span>;
<a name="l00963"></a>00963   <span class="keywordflow">if</span> (i == od-&gt;<a class="code" href="structorderdata.html#ac4393a568ed39c73f0042a208a3b60d9">ntes</a>)
<a name="l00964"></a>00964     <span class="keywordflow">return</span> 0;
<a name="l00965"></a>00965   to = i;
<a name="l00966"></a>00966 
<a name="l00967"></a>00967   <span class="keywordflow">for</span> (i = 1, te = od-&gt;<a class="code" href="structorderdata.html#af2c9ed95d58301c7b395bb8812b5cddf">tes</a> + i; i &lt; od-&gt;ntes; i++, te++)
<a name="l00968"></a>00968     <span class="keywordflow">if</span> (te-&gt;<a class="code" href="struct__TransactionElement.html#a15d7a733a882815e8017cab196175090">p</a> == from)
<a name="l00969"></a>00969       <span class="keywordflow">break</span>;
<a name="l00970"></a>00970   <span class="keywordflow">if</span> (i == od-&gt;<a class="code" href="structorderdata.html#ac4393a568ed39c73f0042a208a3b60d9">ntes</a>)
<a name="l00971"></a>00971     <span class="keywordflow">return</span> 0;
<a name="l00972"></a>00972 
<a name="l00973"></a>00973   <span class="keywordflow">return</span> <a class="code" href="transaction_8c.html#a6a7194ba9f917f502f36e8e9a4769dc3">addteedge</a>(od, i, to, type);
<a name="l00974"></a>00974 }
<a name="l00975"></a>00975 
<a name="l00976"></a>00976 <span class="preprocessor">#if 1</span>
<a name="l00977"></a>00977 <span class="preprocessor"></span><span class="keyword">static</span> <span class="keywordtype">int</span>
<a name="l00978"></a><a class="code" href="transaction_8c.html#a61402722951bcdea81a44be3d0c20bf6">00978</a> <a class="code" href="transaction_8c.html#a61402722951bcdea81a44be3d0c20bf6">havechoice</a>(<span class="keyword">struct</span> <a class="code" href="structorderdata.html">orderdata</a> *od, <a class="code" href="pooltypes_8h.html#a2e0e6278ac51842ca3aeb53e3fc3ead6">Id</a> <a class="code" href="struct__TransactionElement.html#a15d7a733a882815e8017cab196175090">p</a>, <a class="code" href="pooltypes_8h.html#a2e0e6278ac51842ca3aeb53e3fc3ead6">Id</a> q1, <a class="code" href="pooltypes_8h.html#a2e0e6278ac51842ca3aeb53e3fc3ead6">Id</a> q2)
<a name="l00979"></a>00979 {
<a name="l00980"></a>00980   <a class="code" href="struct__Transaction.html">Transaction</a> *trans = od-&gt;<a class="code" href="structorderdata.html#a504265b4ce88aae0b2e6139a153094cb">trans</a>;
<a name="l00981"></a>00981   <a class="code" href="struct__Pool.html">Pool</a> *pool = trans-&gt;<a class="code" href="struct__Transaction.html#aeec1bcea114aa72e7c8005b8e08a369b">pool</a>;
<a name="l00982"></a>00982   <a class="code" href="pooltypes_8h.html#a2e0e6278ac51842ca3aeb53e3fc3ead6">Id</a> ti1buf[5], ti2buf[5];
<a name="l00983"></a>00983   <a class="code" href="struct__Queue.html">Queue</a> ti1, ti2;
<a name="l00984"></a>00984   <span class="keywordtype">int</span> i, j;
<a name="l00985"></a>00985 
<a name="l00986"></a>00986   <span class="comment">/* both q1 and q2 are uninstalls. check if their TEs intersect */</span>
<a name="l00987"></a>00987   <span class="comment">/* common case: just one TE for both packages */</span>
<a name="l00988"></a>00988 <span class="preprocessor">#if 0</span>
<a name="l00989"></a>00989 <span class="preprocessor"></span>  printf(<span class="stringliteral">&quot;havechoice %d %d %d\n&quot;</span>, p, q1, q2);
<a name="l00990"></a>00990 <span class="preprocessor">#endif</span>
<a name="l00991"></a>00991 <span class="preprocessor"></span>  <span class="keywordflow">if</span> (trans-&gt;<a class="code" href="struct__Transaction.html#a592881da1d794d3ea60272a3938d4bf0">transaction_installed</a>[q1 - pool-&gt;<a class="code" href="struct__Pool.html#a887053f905054298cd61ce1c99e26690">installed</a>-&gt;<a class="code" href="struct__Repo.html#a4eb2dd93e4a4f88f13d462f2f111e038">start</a>] == 0)
<a name="l00992"></a>00992     <span class="keywordflow">return</span> 1;
<a name="l00993"></a>00993   <span class="keywordflow">if</span> (trans-&gt;<a class="code" href="struct__Transaction.html#a592881da1d794d3ea60272a3938d4bf0">transaction_installed</a>[q2 - pool-&gt;<a class="code" href="struct__Pool.html#a887053f905054298cd61ce1c99e26690">installed</a>-&gt;<a class="code" href="struct__Repo.html#a4eb2dd93e4a4f88f13d462f2f111e038">start</a>] == 0)
<a name="l00994"></a>00994     <span class="keywordflow">return</span> 1;
<a name="l00995"></a>00995   <span class="keywordflow">if</span> (trans-&gt;<a class="code" href="struct__Transaction.html#a592881da1d794d3ea60272a3938d4bf0">transaction_installed</a>[q1 - pool-&gt;<a class="code" href="struct__Pool.html#a887053f905054298cd61ce1c99e26690">installed</a>-&gt;<a class="code" href="struct__Repo.html#a4eb2dd93e4a4f88f13d462f2f111e038">start</a>] == trans-&gt;<a class="code" href="struct__Transaction.html#a592881da1d794d3ea60272a3938d4bf0">transaction_installed</a>[q2 - pool-&gt;<a class="code" href="struct__Pool.html#a887053f905054298cd61ce1c99e26690">installed</a>-&gt;<a class="code" href="struct__Repo.html#a4eb2dd93e4a4f88f13d462f2f111e038">start</a>])
<a name="l00996"></a>00996     <span class="keywordflow">return</span> 0;
<a name="l00997"></a>00997   <span class="keywordflow">if</span> (trans-&gt;<a class="code" href="struct__Transaction.html#a592881da1d794d3ea60272a3938d4bf0">transaction_installed</a>[q1 - pool-&gt;<a class="code" href="struct__Pool.html#a887053f905054298cd61ce1c99e26690">installed</a>-&gt;<a class="code" href="struct__Repo.html#a4eb2dd93e4a4f88f13d462f2f111e038">start</a>] &gt; 0 &amp;&amp; trans-&gt;<a class="code" href="struct__Transaction.html#a592881da1d794d3ea60272a3938d4bf0">transaction_installed</a>[q2 - pool-&gt;<a class="code" href="struct__Pool.html#a887053f905054298cd61ce1c99e26690">installed</a>-&gt;<a class="code" href="struct__Repo.html#a4eb2dd93e4a4f88f13d462f2f111e038">start</a>] &gt; 0)
<a name="l00998"></a>00998     <span class="keywordflow">return</span> 1;
<a name="l00999"></a>00999   <a class="code" href="queue_8c.html#a5988db301609a3b7ab6666e50c61430e">queue_init_buffer</a>(&amp;ti1, ti1buf, <span class="keyword">sizeof</span>(ti1buf)/<span class="keyword">sizeof</span>(*ti1buf));
<a name="l01000"></a>01000   <a class="code" href="transaction_8c.html#aaa33152cda972dad9f684b64e376ea05">transaction_all_obs_pkgs</a>(trans, q1, &amp;ti1);
<a name="l01001"></a>01001   <a class="code" href="queue_8c.html#a5988db301609a3b7ab6666e50c61430e">queue_init_buffer</a>(&amp;ti2, ti2buf, <span class="keyword">sizeof</span>(ti2buf)/<span class="keyword">sizeof</span>(*ti2buf));
<a name="l01002"></a>01002   <a class="code" href="transaction_8c.html#aaa33152cda972dad9f684b64e376ea05">transaction_all_obs_pkgs</a>(trans, q2, &amp;ti2);
<a name="l01003"></a>01003   <span class="keywordflow">for</span> (i = 0; i &lt; ti1.<a class="code" href="struct__Queue.html#abb0696a77174cd23b5f488ad4c7b45d2">count</a>; i++)
<a name="l01004"></a>01004     <span class="keywordflow">for</span> (j = 0; j &lt; ti2.<a class="code" href="struct__Queue.html#abb0696a77174cd23b5f488ad4c7b45d2">count</a>; j++)
<a name="l01005"></a>01005       <span class="keywordflow">if</span> (ti1.<a class="code" href="struct__Queue.html#a116eb58bed8ff76bf18f9c16cf1ce5c6">elements</a>[i] == ti2.<a class="code" href="struct__Queue.html#a116eb58bed8ff76bf18f9c16cf1ce5c6">elements</a>[j])
<a name="l01006"></a>01006         {
<a name="l01007"></a>01007           <span class="comment">/* found a common edge */</span>
<a name="l01008"></a>01008           <a class="code" href="queue_8c.html#a701c81a9f7d503837e74d43981e79137">queue_free</a>(&amp;ti1);
<a name="l01009"></a>01009           <a class="code" href="queue_8c.html#a701c81a9f7d503837e74d43981e79137">queue_free</a>(&amp;ti2);
<a name="l01010"></a>01010           <span class="keywordflow">return</span> 0;
<a name="l01011"></a>01011         }
<a name="l01012"></a>01012   <a class="code" href="queue_8c.html#a701c81a9f7d503837e74d43981e79137">queue_free</a>(&amp;ti1);
<a name="l01013"></a>01013   <a class="code" href="queue_8c.html#a701c81a9f7d503837e74d43981e79137">queue_free</a>(&amp;ti2);
<a name="l01014"></a>01014   <span class="keywordflow">return</span> 1;
<a name="l01015"></a>01015 }
<a name="l01016"></a>01016 <span class="preprocessor">#endif</span>
<a name="l01017"></a>01017 <span class="preprocessor"></span>
<a name="l01018"></a>01018 <span class="keyword">static</span> <span class="keyword">inline</span> <span class="keywordtype">int</span>
<a name="l01019"></a><a class="code" href="transaction_8c.html#ad42ceb70c40e5c4fb30caf904a176bfa">01019</a> <a class="code" href="transaction_8c.html#ad42ceb70c40e5c4fb30caf904a176bfa">havescripts</a>(<a class="code" href="struct__Pool.html">Pool</a> *pool, <a class="code" href="pooltypes_8h.html#a2e0e6278ac51842ca3aeb53e3fc3ead6">Id</a> solvid)
<a name="l01020"></a>01020 {
<a name="l01021"></a>01021   <a class="code" href="struct__Solvable.html">Solvable</a> *s = pool-&gt;<a class="code" href="struct__Pool.html#a9842c936aa241bad13ba13f21a337319">solvables</a> + solvid;
<a name="l01022"></a>01022   <span class="keyword">const</span> <span class="keywordtype">char</span> *dep;
<a name="l01023"></a>01023   <span class="keywordflow">if</span> (s-&gt;<a class="code" href="struct__Solvable.html#a0920d25d5be01033af30796d19280c65">requires</a>)
<a name="l01024"></a>01024     {
<a name="l01025"></a>01025       <a class="code" href="pooltypes_8h.html#a2e0e6278ac51842ca3aeb53e3fc3ead6">Id</a> req, *reqp;
<a name="l01026"></a>01026       <span class="keywordtype">int</span> inpre = 0;
<a name="l01027"></a>01027       reqp = s-&gt;<a class="code" href="struct__Solvable.html#a15e0b77fe061c6429a24215191b10f05">repo</a>-&gt;<a class="code" href="struct__Repo.html#afddcfa36231cc08266800bee5b978528">idarraydata</a> + s-&gt;<a class="code" href="struct__Solvable.html#a0920d25d5be01033af30796d19280c65">requires</a>;
<a name="l01028"></a>01028       <span class="keywordflow">while</span> ((req = *reqp++) != 0)
<a name="l01029"></a>01029         {
<a name="l01030"></a>01030           <span class="keywordflow">if</span> (req == SOLVABLE_PREREQMARKER)
<a name="l01031"></a>01031             {
<a name="l01032"></a>01032               inpre = 1;
<a name="l01033"></a>01033               <span class="keywordflow">continue</span>;
<a name="l01034"></a>01034             }
<a name="l01035"></a>01035           <span class="keywordflow">if</span> (!inpre)
<a name="l01036"></a>01036             <span class="keywordflow">continue</span>;
<a name="l01037"></a>01037           dep = <a class="code" href="poolid_8c.html#a8a844727bd2258ef240555fc629b2fa7">id2str</a>(pool, req);
<a name="l01038"></a>01038           <span class="keywordflow">if</span> (*dep == <span class="charliteral">&#39;/&#39;</span> &amp;&amp; strcmp(dep, <span class="stringliteral">&quot;/sbin/ldconfig&quot;</span>) != 0)
<a name="l01039"></a>01039             <span class="keywordflow">return</span> 1;
<a name="l01040"></a>01040         }
<a name="l01041"></a>01041     }
<a name="l01042"></a>01042   <span class="keywordflow">return</span> 0;
<a name="l01043"></a>01043 }
<a name="l01044"></a>01044 
<a name="l01045"></a>01045 <span class="keyword">static</span> <span class="keywordtype">void</span>
<a name="l01046"></a><a class="code" href="transaction_8c.html#af4db4a730f550b35c5bee20785ff3b8f">01046</a> <a class="code" href="transaction_8c.html#af4db4a730f550b35c5bee20785ff3b8f">addsolvableedges</a>(<span class="keyword">struct</span> <a class="code" href="structorderdata.html">orderdata</a> *od, <a class="code" href="struct__Solvable.html">Solvable</a> *s)
<a name="l01047"></a>01047 {
<a name="l01048"></a>01048   <a class="code" href="struct__Transaction.html">Transaction</a> *trans = od-&gt;<a class="code" href="structorderdata.html#a504265b4ce88aae0b2e6139a153094cb">trans</a>;
<a name="l01049"></a>01049   <a class="code" href="struct__Pool.html">Pool</a> *pool = trans-&gt;<a class="code" href="struct__Transaction.html#aeec1bcea114aa72e7c8005b8e08a369b">pool</a>;
<a name="l01050"></a>01050   <a class="code" href="pooltypes_8h.html#a2e0e6278ac51842ca3aeb53e3fc3ead6">Id</a> req, *reqp, con, *conp;
<a name="l01051"></a>01051   <a class="code" href="pooltypes_8h.html#a2e0e6278ac51842ca3aeb53e3fc3ead6">Id</a> <a class="code" href="struct__TransactionElement.html#a15d7a733a882815e8017cab196175090">p</a>, p2, pp2;
<a name="l01052"></a>01052   <span class="keywordtype">int</span> i, j, pre, numins;
<a name="l01053"></a>01053   <a class="code" href="struct__Repo.html">Repo</a> *installed = pool-&gt;<a class="code" href="struct__Pool.html#a887053f905054298cd61ce1c99e26690">installed</a>;
<a name="l01054"></a>01054   <a class="code" href="struct__Solvable.html">Solvable</a> *s2;
<a name="l01055"></a>01055   <a class="code" href="struct__Queue.html">Queue</a> reqq;
<a name="l01056"></a>01056   <span class="keywordtype">int</span> provbyinst;
<a name="l01057"></a>01057 
<a name="l01058"></a>01058 <span class="preprocessor">#if 0</span>
<a name="l01059"></a>01059 <span class="preprocessor"></span>  printf(<span class="stringliteral">&quot;addsolvableedges %s\n&quot;</span>, <a class="code" href="pool_8h.html#ac54bf34d95ae90e0368aaf0662cd0783">solvable2str</a>(pool, s));
<a name="l01060"></a>01060 <span class="preprocessor">#endif</span>
<a name="l01061"></a>01061 <span class="preprocessor"></span>  p = s - pool-&gt;<a class="code" href="struct__Pool.html#a9842c936aa241bad13ba13f21a337319">solvables</a>;
<a name="l01062"></a>01062   <a class="code" href="queue_8c.html#ae1a64f63dd8cc46bdb2bcd415aa89e5a">queue_init</a>(&amp;reqq);
<a name="l01063"></a>01063   <span class="keywordflow">if</span> (s-&gt;<a class="code" href="struct__Solvable.html#a0920d25d5be01033af30796d19280c65">requires</a>)
<a name="l01064"></a>01064     {
<a name="l01065"></a>01065       reqp = s-&gt;<a class="code" href="struct__Solvable.html#a15e0b77fe061c6429a24215191b10f05">repo</a>-&gt;<a class="code" href="struct__Repo.html#afddcfa36231cc08266800bee5b978528">idarraydata</a> + s-&gt;<a class="code" href="struct__Solvable.html#a0920d25d5be01033af30796d19280c65">requires</a>;
<a name="l01066"></a>01066       pre = TYPE_REQ;
<a name="l01067"></a>01067       <span class="keywordflow">while</span> ((req = *reqp++) != 0)
<a name="l01068"></a>01068         {
<a name="l01069"></a>01069           <span class="keywordflow">if</span> (req == SOLVABLE_PREREQMARKER)
<a name="l01070"></a>01070             {
<a name="l01071"></a>01071               pre = TYPE_PREREQ;
<a name="l01072"></a>01072               <span class="keywordflow">continue</span>;
<a name="l01073"></a>01073             }
<a name="l01074"></a>01074 <span class="preprocessor">#if 0</span>
<a name="l01075"></a>01075 <span class="preprocessor"></span>          <span class="keywordflow">if</span> (pre != <a class="code" href="transaction_8c.html#a61e1d12c65169313f8109e6a945e10fa">TYPE_PREREQ</a> &amp;&amp; installed &amp;&amp; s-&gt;<a class="code" href="struct__Solvable.html#a15e0b77fe061c6429a24215191b10f05">repo</a> == installed)
<a name="l01076"></a>01076             {
<a name="l01077"></a>01077               <span class="comment">/* ignore normal requires if we&#39;re getting obsoleted */</span>
<a name="l01078"></a>01078               <span class="keywordflow">if</span> (trans-&gt;<a class="code" href="struct__Transaction.html#a592881da1d794d3ea60272a3938d4bf0">transaction_installed</a>[p - pool-&gt;<a class="code" href="struct__Pool.html#a887053f905054298cd61ce1c99e26690">installed</a>-&gt;<a class="code" href="struct__Repo.html#a4eb2dd93e4a4f88f13d462f2f111e038">start</a>])
<a name="l01079"></a>01079                 <span class="keywordflow">continue</span>;
<a name="l01080"></a>01080             }
<a name="l01081"></a>01081 <span class="preprocessor">#endif</span>
<a name="l01082"></a>01082 <span class="preprocessor"></span>          <a class="code" href="queue_8h.html#aad3334b89bd00dfaa2d483971bd55a7b">queue_empty</a>(&amp;reqq);
<a name="l01083"></a>01083           numins = 0;   <span class="comment">/* number of packages to be installed providing it */</span>
<a name="l01084"></a>01084           provbyinst = 0;       <span class="comment">/* provided by kept package */</span>
<a name="l01085"></a>01085           <a class="code" href="pool_8h.html#a6529dc5dd039f8d1019aa2e6f9a9011f">FOR_PROVIDES</a>(p2, pp2, req)
<a name="l01086"></a>01086             {
<a name="l01087"></a>01087               s2 = pool-&gt;<a class="code" href="struct__Pool.html#a9842c936aa241bad13ba13f21a337319">solvables</a> + p2;
<a name="l01088"></a>01088               <span class="keywordflow">if</span> (p2 == p)
<a name="l01089"></a>01089                 {
<a name="l01090"></a>01090                   reqq.<a class="code" href="struct__Queue.html#abb0696a77174cd23b5f488ad4c7b45d2">count</a> = 0;       <span class="comment">/* self provides */</span>
<a name="l01091"></a>01091                   <span class="keywordflow">break</span>;
<a name="l01092"></a>01092                 }
<a name="l01093"></a>01093               <span class="keywordflow">if</span> (s2-&gt;<a class="code" href="struct__Solvable.html#a15e0b77fe061c6429a24215191b10f05">repo</a> == installed &amp;&amp; !<a class="code" href="bitmap_8h.html#ad8ccb9ad3a8ad65f5fe08a988acc503d">MAPTST</a>(&amp;trans-&gt;<a class="code" href="struct__Transaction.html#ac0d758cc5496d3cfe62b8c890d21a47b">transactsmap</a>, p2))
<a name="l01094"></a>01094                 {
<a name="l01095"></a>01095                   provbyinst = 1;
<a name="l01096"></a>01096 <span class="preprocessor">#if 0</span>
<a name="l01097"></a>01097 <span class="preprocessor"></span>                  printf(<span class="stringliteral">&quot;IGNORE inst provides %s by %s\n&quot;</span>, <a class="code" href="poolid_8c.html#afbc7881d0aa3961818b1cc5e00c5a080">dep2str</a>(pool, req), <a class="code" href="pool_8h.html#ac54bf34d95ae90e0368aaf0662cd0783">solvable2str</a>(pool, s2));
<a name="l01098"></a>01098                   reqq.<a class="code" href="struct__Queue.html#abb0696a77174cd23b5f488ad4c7b45d2">count</a> = 0;       <span class="comment">/* provided by package that stays installed */</span>
<a name="l01099"></a>01099                   <span class="keywordflow">break</span>;
<a name="l01100"></a>01100 <span class="preprocessor">#else</span>
<a name="l01101"></a>01101 <span class="preprocessor"></span>                  <span class="keywordflow">continue</span>;
<a name="l01102"></a>01102 <span class="preprocessor">#endif</span>
<a name="l01103"></a>01103 <span class="preprocessor"></span>                }
<a name="l01104"></a>01104               <span class="keywordflow">if</span> (s2-&gt;<a class="code" href="struct__Solvable.html#a15e0b77fe061c6429a24215191b10f05">repo</a> != installed &amp;&amp; !<a class="code" href="bitmap_8h.html#ad8ccb9ad3a8ad65f5fe08a988acc503d">MAPTST</a>(&amp;trans-&gt;<a class="code" href="struct__Transaction.html#ac0d758cc5496d3cfe62b8c890d21a47b">transactsmap</a>, p2))
<a name="l01105"></a>01105                 <span class="keywordflow">continue</span>;               <span class="comment">/* package stays uninstalled */</span>
<a name="l01106"></a>01106               
<a name="l01107"></a>01107               <span class="keywordflow">if</span> (s-&gt;<a class="code" href="struct__Solvable.html#a15e0b77fe061c6429a24215191b10f05">repo</a> == installed)
<a name="l01108"></a>01108                 {
<a name="l01109"></a>01109                   <span class="comment">/* s gets uninstalled */</span>
<a name="l01110"></a>01110                   <a class="code" href="queue_8h.html#af11d92559906d939f448d415105a66b3">queue_pushunique</a>(&amp;reqq, p2);
<a name="l01111"></a>01111                   <span class="keywordflow">if</span> (s2-&gt;<a class="code" href="struct__Solvable.html#a15e0b77fe061c6429a24215191b10f05">repo</a> != installed)
<a name="l01112"></a>01112                     numins++;
<a name="l01113"></a>01113                 }
<a name="l01114"></a>01114               <span class="keywordflow">else</span>
<a name="l01115"></a>01115                 {
<a name="l01116"></a>01116                   <span class="keywordflow">if</span> (s2-&gt;<a class="code" href="struct__Solvable.html#a15e0b77fe061c6429a24215191b10f05">repo</a> == installed)
<a name="l01117"></a>01117                     <span class="keywordflow">continue</span>;   <span class="comment">/* s2 gets uninstalled */</span>
<a name="l01118"></a>01118                   <a class="code" href="queue_8h.html#af11d92559906d939f448d415105a66b3">queue_pushunique</a>(&amp;reqq, p2);
<a name="l01119"></a>01119                 }
<a name="l01120"></a>01120             }
<a name="l01121"></a>01121           <span class="keywordflow">if</span> (provbyinst)
<a name="l01122"></a>01122             {
<a name="l01123"></a>01123               <span class="comment">/* prune to harmless -&gt;inst edges */</span>
<a name="l01124"></a>01124               <span class="keywordflow">for</span> (i = j = 0; i &lt; reqq.<a class="code" href="struct__Queue.html#abb0696a77174cd23b5f488ad4c7b45d2">count</a>; i++)
<a name="l01125"></a>01125                 <span class="keywordflow">if</span> (pool-&gt;<a class="code" href="struct__Pool.html#a9842c936aa241bad13ba13f21a337319">solvables</a>[reqq.<a class="code" href="struct__Queue.html#a116eb58bed8ff76bf18f9c16cf1ce5c6">elements</a>[i]].<a class="code" href="struct__Solvable.html#a15e0b77fe061c6429a24215191b10f05">repo</a> != installed)
<a name="l01126"></a>01126                   reqq.<a class="code" href="struct__Queue.html#a116eb58bed8ff76bf18f9c16cf1ce5c6">elements</a>[j++] = reqq.<a class="code" href="struct__Queue.html#a116eb58bed8ff76bf18f9c16cf1ce5c6">elements</a>[i];
<a name="l01127"></a>01127               reqq.<a class="code" href="struct__Queue.html#abb0696a77174cd23b5f488ad4c7b45d2">count</a> = j;
<a name="l01128"></a>01128             }
<a name="l01129"></a>01129 
<a name="l01130"></a>01130           <span class="keywordflow">if</span> (numins &amp;&amp; reqq.<a class="code" href="struct__Queue.html#abb0696a77174cd23b5f488ad4c7b45d2">count</a>)
<a name="l01131"></a>01131             {
<a name="l01132"></a>01132               <span class="keywordflow">if</span> (s-&gt;<a class="code" href="struct__Solvable.html#a15e0b77fe061c6429a24215191b10f05">repo</a> == installed)
<a name="l01133"></a>01133                 {
<a name="l01134"></a>01134                   <span class="keywordflow">for</span> (i = 0; i &lt; reqq.<a class="code" href="struct__Queue.html#abb0696a77174cd23b5f488ad4c7b45d2">count</a>; i++)
<a name="l01135"></a>01135                     {
<a name="l01136"></a>01136                       <span class="keywordflow">if</span> (pool-&gt;<a class="code" href="struct__Pool.html#a9842c936aa241bad13ba13f21a337319">solvables</a>[reqq.<a class="code" href="struct__Queue.html#a116eb58bed8ff76bf18f9c16cf1ce5c6">elements</a>[i]].<a class="code" href="struct__Solvable.html#a15e0b77fe061c6429a24215191b10f05">repo</a> == installed)
<a name="l01137"></a>01137                         {
<a name="l01138"></a>01138                           <span class="keywordflow">for</span> (j = 0; j &lt; reqq.<a class="code" href="struct__Queue.html#abb0696a77174cd23b5f488ad4c7b45d2">count</a>; j++)
<a name="l01139"></a>01139                             {
<a name="l01140"></a>01140                               <span class="keywordflow">if</span> (pool-&gt;<a class="code" href="struct__Pool.html#a9842c936aa241bad13ba13f21a337319">solvables</a>[reqq.<a class="code" href="struct__Queue.html#a116eb58bed8ff76bf18f9c16cf1ce5c6">elements</a>[j]].<a class="code" href="struct__Solvable.html#a15e0b77fe061c6429a24215191b10f05">repo</a> != installed)
<a name="l01141"></a>01141                                 {
<a name="l01142"></a>01142                                   <span class="keywordflow">if</span> (trans-&gt;<a class="code" href="struct__Transaction.html#a592881da1d794d3ea60272a3938d4bf0">transaction_installed</a>[reqq.<a class="code" href="struct__Queue.html#a116eb58bed8ff76bf18f9c16cf1ce5c6">elements</a>[i] - pool-&gt;<a class="code" href="struct__Pool.html#a887053f905054298cd61ce1c99e26690">installed</a>-&gt;<a class="code" href="struct__Repo.html#a4eb2dd93e4a4f88f13d462f2f111e038">start</a>] == reqq.<a class="code" href="struct__Queue.html#a116eb58bed8ff76bf18f9c16cf1ce5c6">elements</a>[j])
<a name="l01143"></a>01143                                     <span class="keywordflow">continue</span>;   <span class="comment">/* no self edge */</span>
<a name="l01144"></a>01144 <span class="preprocessor">#if 0</span>
<a name="l01145"></a>01145 <span class="preprocessor"></span>                                  printf(<span class="stringliteral">&quot;add interrreq uninst-&gt;inst edge (%s -&gt; %s -&gt; %s)\n&quot;</span>, <a class="code" href="pool_8h.html#adf35a6568989887a7ca04422cf6fec98">solvid2str</a>(pool, reqq.<a class="code" href="struct__Queue.html#a116eb58bed8ff76bf18f9c16cf1ce5c6">elements</a>[i]), <a class="code" href="poolid_8c.html#afbc7881d0aa3961818b1cc5e00c5a080">dep2str</a>(pool, req), <a class="code" href="pool_8h.html#adf35a6568989887a7ca04422cf6fec98">solvid2str</a>(pool, reqq.<a class="code" href="struct__Queue.html#a116eb58bed8ff76bf18f9c16cf1ce5c6">elements</a>[j]));
<a name="l01146"></a>01146 <span class="preprocessor">#endif</span>
<a name="l01147"></a>01147 <span class="preprocessor"></span>                                  <a class="code" href="transaction_8c.html#a858f4eec3e5c4b2c8ca6bfacf870d9a8">addedge</a>(od, reqq.<a class="code" href="struct__Queue.html#a116eb58bed8ff76bf18f9c16cf1ce5c6">elements</a>[i], reqq.<a class="code" href="struct__Queue.html#a116eb58bed8ff76bf18f9c16cf1ce5c6">elements</a>[j], pre == <a class="code" href="transaction_8c.html#a61e1d12c65169313f8109e6a945e10fa">TYPE_PREREQ</a> ? <a class="code" href="transaction_8c.html#acf3138e6e901c774a26d9d0a910665a9">TYPE_PREREQ_P</a> : <a class="code" href="transaction_8c.html#a08f3c3a82684e5f060354d2baadddf23">TYPE_REQ_P</a>);
<a name="l01148"></a>01148                                 }
<a name="l01149"></a>01149                             }
<a name="l01150"></a>01150                         }
<a name="l01151"></a>01151                     }
<a name="l01152"></a>01152                 }
<a name="l01153"></a>01153               <span class="comment">/* no mixed types, remove all deps on uninstalls */</span>
<a name="l01154"></a>01154               <span class="keywordflow">for</span> (i = j = 0; i &lt; reqq.<a class="code" href="struct__Queue.html#abb0696a77174cd23b5f488ad4c7b45d2">count</a>; i++)
<a name="l01155"></a>01155                 <span class="keywordflow">if</span> (pool-&gt;<a class="code" href="struct__Pool.html#a9842c936aa241bad13ba13f21a337319">solvables</a>[reqq.<a class="code" href="struct__Queue.html#a116eb58bed8ff76bf18f9c16cf1ce5c6">elements</a>[i]].<a class="code" href="struct__Solvable.html#a15e0b77fe061c6429a24215191b10f05">repo</a> != installed)
<a name="l01156"></a>01156                   reqq.<a class="code" href="struct__Queue.html#a116eb58bed8ff76bf18f9c16cf1ce5c6">elements</a>[j++] = reqq.<a class="code" href="struct__Queue.html#a116eb58bed8ff76bf18f9c16cf1ce5c6">elements</a>[i];
<a name="l01157"></a>01157               reqq.<a class="code" href="struct__Queue.html#abb0696a77174cd23b5f488ad4c7b45d2">count</a> = j;
<a name="l01158"></a>01158             }
<a name="l01159"></a>01159           <span class="keywordflow">if</span> (!reqq.<a class="code" href="struct__Queue.html#abb0696a77174cd23b5f488ad4c7b45d2">count</a>)
<a name="l01160"></a>01160             <span class="keywordflow">continue</span>;
<a name="l01161"></a>01161           <span class="keywordflow">for</span> (i = 0; i &lt; reqq.<a class="code" href="struct__Queue.html#abb0696a77174cd23b5f488ad4c7b45d2">count</a>; i++)
<a name="l01162"></a>01162             {
<a name="l01163"></a>01163               <span class="keywordtype">int</span> choice = 0;
<a name="l01164"></a>01164               p2 = reqq.<a class="code" href="struct__Queue.html#a116eb58bed8ff76bf18f9c16cf1ce5c6">elements</a>[i];
<a name="l01165"></a>01165               <span class="keywordflow">if</span> (pool-&gt;<a class="code" href="struct__Pool.html#a9842c936aa241bad13ba13f21a337319">solvables</a>[p2].<a class="code" href="struct__Solvable.html#a15e0b77fe061c6429a24215191b10f05">repo</a> != installed)
<a name="l01166"></a>01166                 {
<a name="l01167"></a>01167                   <span class="comment">/* all elements of reqq are installs, thus have different TEs */</span>
<a name="l01168"></a>01168                   choice = reqq.<a class="code" href="struct__Queue.html#abb0696a77174cd23b5f488ad4c7b45d2">count</a> - 1;
<a name="l01169"></a>01169                   <span class="keywordflow">if</span> (pool-&gt;<a class="code" href="struct__Pool.html#a9842c936aa241bad13ba13f21a337319">solvables</a>[p].<a class="code" href="struct__Solvable.html#a15e0b77fe061c6429a24215191b10f05">repo</a> != installed)
<a name="l01170"></a>01170                     {
<a name="l01171"></a>01171 <span class="preprocessor">#if 0</span>
<a name="l01172"></a>01172 <span class="preprocessor"></span>                      printf(<span class="stringliteral">&quot;add inst-&gt;inst edge choice %d (%s -&gt; %s -&gt; %s)\n&quot;</span>, choice, <a class="code" href="pool_8h.html#adf35a6568989887a7ca04422cf6fec98">solvid2str</a>(pool, p), <a class="code" href="poolid_8c.html#afbc7881d0aa3961818b1cc5e00c5a080">dep2str</a>(pool, req), <a class="code" href="pool_8h.html#adf35a6568989887a7ca04422cf6fec98">solvid2str</a>(pool, p2));
<a name="l01173"></a>01173 <span class="preprocessor">#endif</span>
<a name="l01174"></a>01174 <span class="preprocessor"></span>                      <a class="code" href="transaction_8c.html#a858f4eec3e5c4b2c8ca6bfacf870d9a8">addedge</a>(od, p, p2, pre);
<a name="l01175"></a>01175                     }
<a name="l01176"></a>01176                   <span class="keywordflow">else</span>
<a name="l01177"></a>01177                     {
<a name="l01178"></a>01178 <span class="preprocessor">#if 0</span>
<a name="l01179"></a>01179 <span class="preprocessor"></span>                      printf(<span class="stringliteral">&quot;add uninst-&gt;inst edge choice %d (%s -&gt; %s -&gt; %s)\n&quot;</span>, choice, <a class="code" href="pool_8h.html#adf35a6568989887a7ca04422cf6fec98">solvid2str</a>(pool, p), <a class="code" href="poolid_8c.html#afbc7881d0aa3961818b1cc5e00c5a080">dep2str</a>(pool, req), <a class="code" href="pool_8h.html#adf35a6568989887a7ca04422cf6fec98">solvid2str</a>(pool, p2));
<a name="l01180"></a>01180 <span class="preprocessor">#endif</span>
<a name="l01181"></a>01181 <span class="preprocessor"></span>                      <a class="code" href="transaction_8c.html#a858f4eec3e5c4b2c8ca6bfacf870d9a8">addedge</a>(od, p, p2, pre == <a class="code" href="transaction_8c.html#a61e1d12c65169313f8109e6a945e10fa">TYPE_PREREQ</a> ? <a class="code" href="transaction_8c.html#acf3138e6e901c774a26d9d0a910665a9">TYPE_PREREQ_P</a> : <a class="code" href="transaction_8c.html#a08f3c3a82684e5f060354d2baadddf23">TYPE_REQ_P</a>);
<a name="l01182"></a>01182                     }
<a name="l01183"></a>01183                 }
<a name="l01184"></a>01184               <span class="keywordflow">else</span>
<a name="l01185"></a>01185                 {
<a name="l01186"></a>01186                   <span class="keywordflow">if</span> (s-&gt;<a class="code" href="struct__Solvable.html#a15e0b77fe061c6429a24215191b10f05">repo</a> != installed)
<a name="l01187"></a>01187                     <span class="keywordflow">continue</span>;   <span class="comment">/* no inst-&gt;uninst edges, please! */</span>
<a name="l01188"></a>01188 
<a name="l01189"></a>01189                   <span class="comment">/* uninst -&gt; uninst edge. Those make trouble. Only add if we must */</span>
<a name="l01190"></a>01190                   <span class="keywordflow">if</span> (trans-&gt;<a class="code" href="struct__Transaction.html#a592881da1d794d3ea60272a3938d4bf0">transaction_installed</a>[p - installed-&gt;<a class="code" href="struct__Repo.html#a4eb2dd93e4a4f88f13d462f2f111e038">start</a>] &amp;&amp; !<a class="code" href="transaction_8c.html#ad42ceb70c40e5c4fb30caf904a176bfa">havescripts</a>(pool, p))
<a name="l01191"></a>01191                     {
<a name="l01192"></a>01192                       <span class="comment">/* p is obsoleted by another package and has no scripts */</span>
<a name="l01193"></a>01193                       <span class="comment">/* we assume that the obsoletor is good enough to replace p */</span>
<a name="l01194"></a>01194                       <span class="keywordflow">continue</span>;
<a name="l01195"></a>01195                     }
<a name="l01196"></a>01196 <span class="preprocessor">#if 1</span>
<a name="l01197"></a>01197 <span class="preprocessor"></span>                  choice = 0;
<a name="l01198"></a>01198                   <span class="keywordflow">for</span> (j = 0; j &lt; reqq.<a class="code" href="struct__Queue.html#abb0696a77174cd23b5f488ad4c7b45d2">count</a>; j++)
<a name="l01199"></a>01199                     {
<a name="l01200"></a>01200                       <span class="keywordflow">if</span> (i == j)
<a name="l01201"></a>01201                         <span class="keywordflow">continue</span>;
<a name="l01202"></a>01202                       <span class="keywordflow">if</span> (<a class="code" href="transaction_8c.html#a61402722951bcdea81a44be3d0c20bf6">havechoice</a>(od, p, reqq.<a class="code" href="struct__Queue.html#a116eb58bed8ff76bf18f9c16cf1ce5c6">elements</a>[i], reqq.<a class="code" href="struct__Queue.html#a116eb58bed8ff76bf18f9c16cf1ce5c6">elements</a>[j]))
<a name="l01203"></a>01203                         choice++;
<a name="l01204"></a>01204                     }
<a name="l01205"></a>01205 <span class="preprocessor">#endif</span>
<a name="l01206"></a>01206 <span class="preprocessor"></span><span class="preprocessor">#if 0</span>
<a name="l01207"></a>01207 <span class="preprocessor"></span>                  printf(<span class="stringliteral">&quot;add uninst-&gt;uninst edge choice %d (%s -&gt; %s -&gt; %s)\n&quot;</span>, choice, <a class="code" href="pool_8h.html#adf35a6568989887a7ca04422cf6fec98">solvid2str</a>(pool, p), <a class="code" href="poolid_8c.html#afbc7881d0aa3961818b1cc5e00c5a080">dep2str</a>(pool, req), <a class="code" href="pool_8h.html#adf35a6568989887a7ca04422cf6fec98">solvid2str</a>(pool, p2));
<a name="l01208"></a>01208 <span class="preprocessor">#endif</span>
<a name="l01209"></a>01209 <span class="preprocessor"></span>                  <a class="code" href="transaction_8c.html#a858f4eec3e5c4b2c8ca6bfacf870d9a8">addedge</a>(od, p2, p, pre == <a class="code" href="transaction_8c.html#a61e1d12c65169313f8109e6a945e10fa">TYPE_PREREQ</a> ? <a class="code" href="transaction_8c.html#acf3138e6e901c774a26d9d0a910665a9">TYPE_PREREQ_P</a> : <a class="code" href="transaction_8c.html#a08f3c3a82684e5f060354d2baadddf23">TYPE_REQ_P</a>);
<a name="l01210"></a>01210                 }
<a name="l01211"></a>01211             }
<a name="l01212"></a>01212         }
<a name="l01213"></a>01213     }
<a name="l01214"></a>01214   <span class="keywordflow">if</span> (s-&gt;<a class="code" href="struct__Solvable.html#a53b6ec41be31e4aafb5a52e0c7ae2470">conflicts</a>)
<a name="l01215"></a>01215     {
<a name="l01216"></a>01216       conp = s-&gt;<a class="code" href="struct__Solvable.html#a15e0b77fe061c6429a24215191b10f05">repo</a>-&gt;<a class="code" href="struct__Repo.html#afddcfa36231cc08266800bee5b978528">idarraydata</a> + s-&gt;<a class="code" href="struct__Solvable.html#a53b6ec41be31e4aafb5a52e0c7ae2470">conflicts</a>;
<a name="l01217"></a>01217       <span class="keywordflow">while</span> ((con = *conp++) != 0)
<a name="l01218"></a>01218         {
<a name="l01219"></a>01219           <a class="code" href="pool_8h.html#a6529dc5dd039f8d1019aa2e6f9a9011f">FOR_PROVIDES</a>(p2, pp2, con)
<a name="l01220"></a>01220             {
<a name="l01221"></a>01221               <span class="keywordflow">if</span> (p2 == p)
<a name="l01222"></a>01222                 <span class="keywordflow">continue</span>;
<a name="l01223"></a>01223               s2 = pool-&gt;<a class="code" href="struct__Pool.html#a9842c936aa241bad13ba13f21a337319">solvables</a> + p2;
<a name="l01224"></a>01224               <span class="keywordflow">if</span> (!s2-&gt;<a class="code" href="struct__Solvable.html#a15e0b77fe061c6429a24215191b10f05">repo</a>)
<a name="l01225"></a>01225                 <span class="keywordflow">continue</span>;
<a name="l01226"></a>01226               <span class="keywordflow">if</span> (s-&gt;<a class="code" href="struct__Solvable.html#a15e0b77fe061c6429a24215191b10f05">repo</a> == installed)
<a name="l01227"></a>01227                 {
<a name="l01228"></a>01228                   <span class="keywordflow">if</span> (s2-&gt;<a class="code" href="struct__Solvable.html#a15e0b77fe061c6429a24215191b10f05">repo</a> != installed &amp;&amp; <a class="code" href="bitmap_8h.html#ad8ccb9ad3a8ad65f5fe08a988acc503d">MAPTST</a>(&amp;trans-&gt;<a class="code" href="struct__Transaction.html#ac0d758cc5496d3cfe62b8c890d21a47b">transactsmap</a>, p2))
<a name="l01229"></a>01229                     {
<a name="l01230"></a>01230                       <span class="comment">/* deinstall p before installing p2 */</span>
<a name="l01231"></a>01231 <span class="preprocessor">#if 0</span>
<a name="l01232"></a>01232 <span class="preprocessor"></span>                      printf(<span class="stringliteral">&quot;add conflict uninst-&gt;inst edge (%s -&gt; %s -&gt; %s)\n&quot;</span>, <a class="code" href="pool_8h.html#adf35a6568989887a7ca04422cf6fec98">solvid2str</a>(pool, p2), <a class="code" href="poolid_8c.html#afbc7881d0aa3961818b1cc5e00c5a080">dep2str</a>(pool, con), <a class="code" href="pool_8h.html#adf35a6568989887a7ca04422cf6fec98">solvid2str</a>(pool, p));
<a name="l01233"></a>01233 <span class="preprocessor">#endif</span>
<a name="l01234"></a>01234 <span class="preprocessor"></span>                      <a class="code" href="transaction_8c.html#a858f4eec3e5c4b2c8ca6bfacf870d9a8">addedge</a>(od, p2, p, <a class="code" href="transaction_8c.html#ace3ac16641bce9bf9a08de1b7fe33272">TYPE_CON</a>);
<a name="l01235"></a>01235                     }
<a name="l01236"></a>01236                 }
<a name="l01237"></a>01237               <span class="keywordflow">else</span>
<a name="l01238"></a>01238                 {
<a name="l01239"></a>01239                   <span class="keywordflow">if</span> (s2-&gt;<a class="code" href="struct__Solvable.html#a15e0b77fe061c6429a24215191b10f05">repo</a> == installed &amp;&amp; <a class="code" href="bitmap_8h.html#ad8ccb9ad3a8ad65f5fe08a988acc503d">MAPTST</a>(&amp;trans-&gt;<a class="code" href="struct__Transaction.html#ac0d758cc5496d3cfe62b8c890d21a47b">transactsmap</a>, p2))
<a name="l01240"></a>01240                     {
<a name="l01241"></a>01241                       <span class="comment">/* deinstall p2 before installing p */</span>
<a name="l01242"></a>01242 <span class="preprocessor">#if 0</span>
<a name="l01243"></a>01243 <span class="preprocessor"></span>                      printf(<span class="stringliteral">&quot;add conflict uninst-&gt;inst edge (%s -&gt; %s -&gt; %s)\n&quot;</span>, <a class="code" href="pool_8h.html#adf35a6568989887a7ca04422cf6fec98">solvid2str</a>(pool, p), <a class="code" href="poolid_8c.html#afbc7881d0aa3961818b1cc5e00c5a080">dep2str</a>(pool, con), <a class="code" href="pool_8h.html#adf35a6568989887a7ca04422cf6fec98">solvid2str</a>(pool, p2));
<a name="l01244"></a>01244 <span class="preprocessor">#endif</span>
<a name="l01245"></a>01245 <span class="preprocessor"></span>                      <a class="code" href="transaction_8c.html#a858f4eec3e5c4b2c8ca6bfacf870d9a8">addedge</a>(od, p, p2, <a class="code" href="transaction_8c.html#ace3ac16641bce9bf9a08de1b7fe33272">TYPE_CON</a>);
<a name="l01246"></a>01246                     }
<a name="l01247"></a>01247                 }
<a name="l01248"></a>01248 
<a name="l01249"></a>01249             }
<a name="l01250"></a>01250         }
<a name="l01251"></a>01251     }
<a name="l01252"></a>01252   <span class="keywordflow">if</span> (s-&gt;<a class="code" href="struct__Solvable.html#a15e0b77fe061c6429a24215191b10f05">repo</a> == installed &amp;&amp; <a class="code" href="pool_8h.html#a5461c02a232493bcca4f760303e31a7c">solvable_lookup_idarray</a>(s, SOLVABLE_TRIGGERS, &amp;reqq) &amp;&amp; reqq.<a class="code" href="struct__Queue.html#abb0696a77174cd23b5f488ad4c7b45d2">count</a>)
<a name="l01253"></a>01253     {
<a name="l01254"></a>01254       <span class="comment">/* we&#39;re getting deinstalled/updated. Try to do this before our</span>
<a name="l01255"></a>01255 <span class="comment">       * triggers are hit */</span>
<a name="l01256"></a>01256       <span class="keywordflow">for</span> (i = 0; i &lt; reqq.<a class="code" href="struct__Queue.html#abb0696a77174cd23b5f488ad4c7b45d2">count</a>; i++)
<a name="l01257"></a>01257         {
<a name="l01258"></a>01258           <a class="code" href="pooltypes_8h.html#a2e0e6278ac51842ca3aeb53e3fc3ead6">Id</a> tri = reqq.<a class="code" href="struct__Queue.html#a116eb58bed8ff76bf18f9c16cf1ce5c6">elements</a>[i];
<a name="l01259"></a>01259           <a class="code" href="pool_8h.html#a6529dc5dd039f8d1019aa2e6f9a9011f">FOR_PROVIDES</a>(p2, pp2, tri)
<a name="l01260"></a>01260             {
<a name="l01261"></a>01261               <span class="keywordflow">if</span> (p2 == p)
<a name="l01262"></a>01262                 <span class="keywordflow">continue</span>;
<a name="l01263"></a>01263               s2 = pool-&gt;<a class="code" href="struct__Pool.html#a9842c936aa241bad13ba13f21a337319">solvables</a> + p2;
<a name="l01264"></a>01264               <span class="keywordflow">if</span> (!s2-&gt;<a class="code" href="struct__Solvable.html#a15e0b77fe061c6429a24215191b10f05">repo</a>)
<a name="l01265"></a>01265                 <span class="keywordflow">continue</span>;
<a name="l01266"></a>01266               <span class="keywordflow">if</span> (s2-&gt;<a class="code" href="struct__Solvable.html#a5912021e2c3fe505c24a92aa7639dff2">name</a> == s-&gt;<a class="code" href="struct__Solvable.html#a5912021e2c3fe505c24a92aa7639dff2">name</a>)
<a name="l01267"></a>01267                 <span class="keywordflow">continue</span>;       <span class="comment">/* obsoleted anyway */</span>
<a name="l01268"></a>01268               <span class="keywordflow">if</span> (s2-&gt;<a class="code" href="struct__Solvable.html#a15e0b77fe061c6429a24215191b10f05">repo</a> != installed &amp;&amp; <a class="code" href="bitmap_8h.html#ad8ccb9ad3a8ad65f5fe08a988acc503d">MAPTST</a>(&amp;trans-&gt;<a class="code" href="struct__Transaction.html#ac0d758cc5496d3cfe62b8c890d21a47b">transactsmap</a>, p2))
<a name="l01269"></a>01269                 {
<a name="l01270"></a>01270                   <span class="comment">/* deinstall/update p before installing p2 */</span>
<a name="l01271"></a>01271 <span class="preprocessor">#if 0</span>
<a name="l01272"></a>01272 <span class="preprocessor"></span>                  printf(<span class="stringliteral">&quot;add trigger uninst-&gt;inst edge (%s -&gt; %s -&gt; %s)\n&quot;</span>, <a class="code" href="pool_8h.html#adf35a6568989887a7ca04422cf6fec98">solvid2str</a>(pool, p2), <a class="code" href="poolid_8c.html#afbc7881d0aa3961818b1cc5e00c5a080">dep2str</a>(pool, tri), <a class="code" href="pool_8h.html#adf35a6568989887a7ca04422cf6fec98">solvid2str</a>(pool, p));
<a name="l01273"></a>01273 <span class="preprocessor">#endif</span>
<a name="l01274"></a>01274 <span class="preprocessor"></span>                  <a class="code" href="transaction_8c.html#a858f4eec3e5c4b2c8ca6bfacf870d9a8">addedge</a>(od, p2, p, <a class="code" href="transaction_8c.html#ace3ac16641bce9bf9a08de1b7fe33272">TYPE_CON</a>);
<a name="l01275"></a>01275                 }
<a name="l01276"></a>01276             }
<a name="l01277"></a>01277         }
<a name="l01278"></a>01278     }
<a name="l01279"></a>01279   <a class="code" href="queue_8c.html#a701c81a9f7d503837e74d43981e79137">queue_free</a>(&amp;reqq);
<a name="l01280"></a>01280 }
<a name="l01281"></a>01281 
<a name="l01282"></a>01282 
<a name="l01283"></a>01283 <span class="comment">/* break an edge in a cycle */</span>
<a name="l01284"></a>01284 <span class="keyword">static</span> <span class="keywordtype">void</span>
<a name="l01285"></a><a class="code" href="transaction_8c.html#aa3f473362dfc51f54a6067de58e7fc2c">01285</a> <a class="code" href="transaction_8c.html#aa3f473362dfc51f54a6067de58e7fc2c">breakcycle</a>(<span class="keyword">struct</span> <a class="code" href="structorderdata.html">orderdata</a> *od, <a class="code" href="pooltypes_8h.html#a2e0e6278ac51842ca3aeb53e3fc3ead6">Id</a> *cycle)
<a name="l01286"></a>01286 {
<a name="l01287"></a>01287   <a class="code" href="struct__Pool.html">Pool</a> *pool = od-&gt;<a class="code" href="structorderdata.html#a504265b4ce88aae0b2e6139a153094cb">trans</a>-&gt;<a class="code" href="struct__Transaction.html#aeec1bcea114aa72e7c8005b8e08a369b">pool</a>;
<a name="l01288"></a>01288   <a class="code" href="pooltypes_8h.html#a2e0e6278ac51842ca3aeb53e3fc3ead6">Id</a> ddegmin, ddegmax, ddeg;
<a name="l01289"></a>01289   <span class="keywordtype">int</span> k, l;
<a name="l01290"></a>01290   <span class="keyword">struct </span><a class="code" href="struct__TransactionElement.html">_TransactionElement</a> *te;
<a name="l01291"></a>01291 
<a name="l01292"></a>01292   l = 0;
<a name="l01293"></a>01293   ddegmin = ddegmax = 0;
<a name="l01294"></a>01294   <span class="keywordflow">for</span> (k = 0; cycle[k + 1]; k += 2)
<a name="l01295"></a>01295     {
<a name="l01296"></a>01296       ddeg = od-&gt;<a class="code" href="structorderdata.html#aa7d6b79cd94b60508b1390d1c299c83c">edgedata</a>[cycle[k + 1] + 1];
<a name="l01297"></a>01297       <span class="keywordflow">if</span> (ddeg &gt; ddegmax)
<a name="l01298"></a>01298         ddegmax = ddeg;
<a name="l01299"></a>01299       <span class="keywordflow">if</span> (!k || ddeg &lt; ddegmin)
<a name="l01300"></a>01300         {
<a name="l01301"></a>01301           l = k;
<a name="l01302"></a>01302           ddegmin = ddeg;
<a name="l01303"></a>01303           <span class="keywordflow">continue</span>;
<a name="l01304"></a>01304         }
<a name="l01305"></a>01305       <span class="keywordflow">if</span> (ddeg == ddegmin)
<a name="l01306"></a>01306         {
<a name="l01307"></a>01307           <span class="keywordflow">if</span> (<a class="code" href="transaction_8c.html#ad42ceb70c40e5c4fb30caf904a176bfa">havescripts</a>(pool, od-&gt;<a class="code" href="structorderdata.html#af2c9ed95d58301c7b395bb8812b5cddf">tes</a>[cycle[l]].<a class="code" href="struct__TransactionElement.html#a15d7a733a882815e8017cab196175090">p</a>) &amp;&amp; !<a class="code" href="transaction_8c.html#ad42ceb70c40e5c4fb30caf904a176bfa">havescripts</a>(pool, od-&gt;<a class="code" href="structorderdata.html#af2c9ed95d58301c7b395bb8812b5cddf">tes</a>[cycle[k]].<a class="code" href="struct__TransactionElement.html#a15d7a733a882815e8017cab196175090">p</a>))
<a name="l01308"></a>01308             {
<a name="l01309"></a>01309               <span class="comment">/* prefer k, as l comes from a package with contains scriptlets */</span>
<a name="l01310"></a>01310               l = k;
<a name="l01311"></a>01311               ddegmin = ddeg;
<a name="l01312"></a>01312               <span class="keywordflow">continue</span>;
<a name="l01313"></a>01313             }
<a name="l01314"></a>01314           <span class="comment">/* same edge value, check for prereq */</span>
<a name="l01315"></a>01315         }
<a name="l01316"></a>01316     }
<a name="l01317"></a>01317 
<a name="l01318"></a>01318   <span class="comment">/* record brkoen cycle starting with the tail */</span>
<a name="l01319"></a>01319   <a class="code" href="queue_8h.html#a3ba172138b6a04f289def63b198057f1">queue_push</a>(&amp;od-&gt;<a class="code" href="structorderdata.html#a0d5db89a42a09650097dfe8f9e0842f6">cycles</a>, od-&gt;<a class="code" href="structorderdata.html#a386d2b53b22a56e672da397cfa970c08">cyclesdata</a>.<a class="code" href="struct__Queue.html#abb0696a77174cd23b5f488ad4c7b45d2">count</a>);                <span class="comment">/* offset into data */</span>
<a name="l01320"></a>01320   <a class="code" href="queue_8h.html#a3ba172138b6a04f289def63b198057f1">queue_push</a>(&amp;od-&gt;<a class="code" href="structorderdata.html#a0d5db89a42a09650097dfe8f9e0842f6">cycles</a>, k / 2);                               <span class="comment">/* cycle elements */</span>
<a name="l01321"></a>01321   <a class="code" href="queue_8h.html#a3ba172138b6a04f289def63b198057f1">queue_push</a>(&amp;od-&gt;<a class="code" href="structorderdata.html#a0d5db89a42a09650097dfe8f9e0842f6">cycles</a>, od-&gt;<a class="code" href="structorderdata.html#aa7d6b79cd94b60508b1390d1c299c83c">edgedata</a>[cycle[l + 1] + 1]);      <span class="comment">/* broken edge */</span>
<a name="l01322"></a>01322   od-&gt;<a class="code" href="structorderdata.html#aded143184ad79a57bbd973d7b5f7a90e">ncycles</a>++;
<a name="l01323"></a>01323   <span class="keywordflow">for</span> (k = l;;)
<a name="l01324"></a>01324     {
<a name="l01325"></a>01325       k += 2;
<a name="l01326"></a>01326       <span class="keywordflow">if</span> (!cycle[k + 1])
<a name="l01327"></a>01327         k = 0;
<a name="l01328"></a>01328       <a class="code" href="queue_8h.html#a3ba172138b6a04f289def63b198057f1">queue_push</a>(&amp;od-&gt;<a class="code" href="structorderdata.html#a386d2b53b22a56e672da397cfa970c08">cyclesdata</a>, cycle[k]);
<a name="l01329"></a>01329       <span class="keywordflow">if</span> (k == l)
<a name="l01330"></a>01330         <span class="keywordflow">break</span>;
<a name="l01331"></a>01331     }
<a name="l01332"></a>01332   <a class="code" href="queue_8h.html#a3ba172138b6a04f289def63b198057f1">queue_push</a>(&amp;od-&gt;<a class="code" href="structorderdata.html#a386d2b53b22a56e672da397cfa970c08">cyclesdata</a>, 0);       <span class="comment">/* mark end */</span>
<a name="l01333"></a>01333 
<a name="l01334"></a>01334   <span class="comment">/* break that edge */</span>
<a name="l01335"></a>01335   od-&gt;<a class="code" href="structorderdata.html#aa7d6b79cd94b60508b1390d1c299c83c">edgedata</a>[cycle[l + 1] + 1] |= TYPE_BROKEN;
<a name="l01336"></a>01336 
<a name="l01337"></a>01337 <span class="preprocessor">#if 1</span>
<a name="l01338"></a>01338 <span class="preprocessor"></span>  <span class="keywordflow">if</span> (ddegmin &lt; <a class="code" href="transaction_8c.html#a46a79b58e0b40ee48e149ccd71ebf8d3">TYPE_REQ</a>)
<a name="l01339"></a>01339     <span class="keywordflow">return</span>;
<a name="l01340"></a>01340 <span class="preprocessor">#endif</span>
<a name="l01341"></a>01341 <span class="preprocessor"></span>
<a name="l01342"></a>01342   <span class="comment">/* cycle recorded, print it */</span>
<a name="l01343"></a>01343   <span class="keywordflow">if</span> (ddegmin &gt;= <a class="code" href="transaction_8c.html#a46a79b58e0b40ee48e149ccd71ebf8d3">TYPE_REQ</a> &amp;&amp; (ddegmax &amp; <a class="code" href="transaction_8c.html#a61e1d12c65169313f8109e6a945e10fa">TYPE_PREREQ</a>) != 0)
<a name="l01344"></a>01344     <a class="code" href="pool_8h.html#ac2855e39d8eaea31be68bd0fd03574b5">POOL_DEBUG</a>(<a class="code" href="pool_8h.html#a9e7c48e08e7b2a51b41e4d6611a02ace">SAT_DEBUG_STATS</a>, <span class="stringliteral">&quot;CRITICAL &quot;</span>);
<a name="l01345"></a>01345   <a class="code" href="pool_8h.html#ac2855e39d8eaea31be68bd0fd03574b5">POOL_DEBUG</a>(<a class="code" href="pool_8h.html#a9e7c48e08e7b2a51b41e4d6611a02ace">SAT_DEBUG_STATS</a>, <span class="stringliteral">&quot;cycle: --&gt; &quot;</span>);
<a name="l01346"></a>01346   <span class="keywordflow">for</span> (k = 0; cycle[k + 1]; k += 2)
<a name="l01347"></a>01347     {
<a name="l01348"></a>01348       te = od-&gt;<a class="code" href="structorderdata.html#af2c9ed95d58301c7b395bb8812b5cddf">tes</a> +  cycle[k];
<a name="l01349"></a>01349       <span class="keywordflow">if</span> ((od-&gt;<a class="code" href="structorderdata.html#aa7d6b79cd94b60508b1390d1c299c83c">edgedata</a>[cycle[k + 1] + 1] &amp; <a class="code" href="transaction_8c.html#addd825a898ef4e1c1c8ec80b0dcc175c">TYPE_BROKEN</a>) != 0)
<a name="l01350"></a>01350         <a class="code" href="pool_8h.html#ac2855e39d8eaea31be68bd0fd03574b5">POOL_DEBUG</a>(<a class="code" href="pool_8h.html#a9e7c48e08e7b2a51b41e4d6611a02ace">SAT_DEBUG_STATS</a>, <span class="stringliteral">&quot;%s ##%x##&gt; &quot;</span>, <a class="code" href="pool_8h.html#adf35a6568989887a7ca04422cf6fec98">solvid2str</a>(pool, te-&gt;<a class="code" href="struct__TransactionElement.html#a15d7a733a882815e8017cab196175090">p</a>), od-&gt;<a class="code" href="structorderdata.html#aa7d6b79cd94b60508b1390d1c299c83c">edgedata</a>[cycle[k + 1] + 1]);
<a name="l01351"></a>01351       <span class="keywordflow">else</span>
<a name="l01352"></a>01352         <a class="code" href="pool_8h.html#ac2855e39d8eaea31be68bd0fd03574b5">POOL_DEBUG</a>(<a class="code" href="pool_8h.html#a9e7c48e08e7b2a51b41e4d6611a02ace">SAT_DEBUG_STATS</a>, <span class="stringliteral">&quot;%s --%x--&gt; &quot;</span>, <a class="code" href="pool_8h.html#adf35a6568989887a7ca04422cf6fec98">solvid2str</a>(pool, te-&gt;<a class="code" href="struct__TransactionElement.html#a15d7a733a882815e8017cab196175090">p</a>), od-&gt;<a class="code" href="structorderdata.html#aa7d6b79cd94b60508b1390d1c299c83c">edgedata</a>[cycle[k + 1] + 1]);
<a name="l01353"></a>01353     }
<a name="l01354"></a>01354   <a class="code" href="pool_8h.html#ac2855e39d8eaea31be68bd0fd03574b5">POOL_DEBUG</a>(<a class="code" href="pool_8h.html#a9e7c48e08e7b2a51b41e4d6611a02ace">SAT_DEBUG_STATS</a>, <span class="stringliteral">&quot;\n&quot;</span>);
<a name="l01355"></a>01355 }
<a name="l01356"></a>01356 
<a name="l01357"></a>01357 <span class="keyword">static</span> <span class="keyword">inline</span> <span class="keywordtype">void</span>
<a name="l01358"></a><a class="code" href="transaction_8c.html#ad57765f1221cb9ad1f0858b30dc9f88e">01358</a> <a class="code" href="transaction_8c.html#ad57765f1221cb9ad1f0858b30dc9f88e">dump_tes</a>(<span class="keyword">struct</span> <a class="code" href="structorderdata.html">orderdata</a> *od)
<a name="l01359"></a>01359 {
<a name="l01360"></a>01360   <a class="code" href="struct__Pool.html">Pool</a> *pool = od-&gt;<a class="code" href="structorderdata.html#a504265b4ce88aae0b2e6139a153094cb">trans</a>-&gt;<a class="code" href="struct__Transaction.html#aeec1bcea114aa72e7c8005b8e08a369b">pool</a>;
<a name="l01361"></a>01361   <span class="keywordtype">int</span> i, j;
<a name="l01362"></a>01362   <a class="code" href="struct__Queue.html">Queue</a> obsq;
<a name="l01363"></a>01363   <span class="keyword">struct </span><a class="code" href="struct__TransactionElement.html">_TransactionElement</a> *te, *te2;
<a name="l01364"></a>01364 
<a name="l01365"></a>01365   <a class="code" href="queue_8c.html#ae1a64f63dd8cc46bdb2bcd415aa89e5a">queue_init</a>(&amp;obsq);
<a name="l01366"></a>01366   <span class="keywordflow">for</span> (i = 1, te = od-&gt;<a class="code" href="structorderdata.html#af2c9ed95d58301c7b395bb8812b5cddf">tes</a> + i; i &lt; od-&gt;ntes; i++, te++)
<a name="l01367"></a>01367     {
<a name="l01368"></a>01368       <a class="code" href="struct__Solvable.html">Solvable</a> *s = pool-&gt;<a class="code" href="struct__Pool.html#a9842c936aa241bad13ba13f21a337319">solvables</a> + te-&gt;<a class="code" href="struct__TransactionElement.html#a15d7a733a882815e8017cab196175090">p</a>;
<a name="l01369"></a>01369       <a class="code" href="pool_8h.html#ac2855e39d8eaea31be68bd0fd03574b5">POOL_DEBUG</a>(<a class="code" href="pool_8h.html#a570981a4b70f26299efdef38a1cebf3e">SAT_DEBUG_RESULT</a>, <span class="stringliteral">&quot;TE %4d: %c%s\n&quot;</span>, i, s-&gt;<a class="code" href="struct__Solvable.html#a15e0b77fe061c6429a24215191b10f05">repo</a> == pool-&gt;<a class="code" href="struct__Pool.html#a887053f905054298cd61ce1c99e26690">installed</a> ? <span class="charliteral">&#39;-&#39;</span> : <span class="charliteral">&#39;+&#39;</span>, <a class="code" href="pool_8h.html#ac54bf34d95ae90e0368aaf0662cd0783">solvable2str</a>(pool, s));
<a name="l01370"></a>01370       <span class="keywordflow">if</span> (s-&gt;<a class="code" href="struct__Solvable.html#a15e0b77fe061c6429a24215191b10f05">repo</a> != pool-&gt;<a class="code" href="struct__Pool.html#a887053f905054298cd61ce1c99e26690">installed</a>)
<a name="l01371"></a>01371         {
<a name="l01372"></a>01372           <a class="code" href="queue_8h.html#aad3334b89bd00dfaa2d483971bd55a7b">queue_empty</a>(&amp;obsq);
<a name="l01373"></a>01373           <a class="code" href="transaction_8c.html#aaa33152cda972dad9f684b64e376ea05">transaction_all_obs_pkgs</a>(od-&gt;<a class="code" href="structorderdata.html#a504265b4ce88aae0b2e6139a153094cb">trans</a>, te-&gt;<a class="code" href="struct__TransactionElement.html#a15d7a733a882815e8017cab196175090">p</a>, &amp;obsq);
<a name="l01374"></a>01374           <span class="keywordflow">for</span> (j = 0; j &lt; obsq.<a class="code" href="struct__Queue.html#abb0696a77174cd23b5f488ad4c7b45d2">count</a>; j++)
<a name="l01375"></a>01375             <a class="code" href="pool_8h.html#ac2855e39d8eaea31be68bd0fd03574b5">POOL_DEBUG</a>(<a class="code" href="pool_8h.html#a570981a4b70f26299efdef38a1cebf3e">SAT_DEBUG_RESULT</a>, <span class="stringliteral">&quot;         -%s\n&quot;</span>, <a class="code" href="pool_8h.html#adf35a6568989887a7ca04422cf6fec98">solvid2str</a>(pool, obsq.<a class="code" href="struct__Queue.html#a116eb58bed8ff76bf18f9c16cf1ce5c6">elements</a>[j]));
<a name="l01376"></a>01376         }
<a name="l01377"></a>01377       <span class="keywordflow">for</span> (j = te-&gt;<a class="code" href="struct__TransactionElement.html#a83c9f82e48799df8c379ecf0d435572e">edges</a>; od-&gt;<a class="code" href="structorderdata.html#aa7d6b79cd94b60508b1390d1c299c83c">edgedata</a>[j]; j += 2)
<a name="l01378"></a>01378         {
<a name="l01379"></a>01379           te2 = od-&gt;<a class="code" href="structorderdata.html#af2c9ed95d58301c7b395bb8812b5cddf">tes</a> + od-&gt;<a class="code" href="structorderdata.html#aa7d6b79cd94b60508b1390d1c299c83c">edgedata</a>[j];
<a name="l01380"></a>01380           <span class="keywordflow">if</span> ((od-&gt;<a class="code" href="structorderdata.html#aa7d6b79cd94b60508b1390d1c299c83c">edgedata</a>[j + 1] &amp; <a class="code" href="transaction_8c.html#addd825a898ef4e1c1c8ec80b0dcc175c">TYPE_BROKEN</a>) == 0)
<a name="l01381"></a>01381             <a class="code" href="pool_8h.html#ac2855e39d8eaea31be68bd0fd03574b5">POOL_DEBUG</a>(<a class="code" href="pool_8h.html#a570981a4b70f26299efdef38a1cebf3e">SAT_DEBUG_RESULT</a>, <span class="stringliteral">&quot;       --%x--&gt; TE %4d: %s\n&quot;</span>, od-&gt;<a class="code" href="structorderdata.html#aa7d6b79cd94b60508b1390d1c299c83c">edgedata</a>[j + 1], od-&gt;<a class="code" href="structorderdata.html#aa7d6b79cd94b60508b1390d1c299c83c">edgedata</a>[j], <a class="code" href="pool_8h.html#adf35a6568989887a7ca04422cf6fec98">solvid2str</a>(pool, te2-&gt;<a class="code" href="struct__TransactionElement.html#a15d7a733a882815e8017cab196175090">p</a>));
<a name="l01382"></a>01382           <span class="keywordflow">else</span>
<a name="l01383"></a>01383             <a class="code" href="pool_8h.html#ac2855e39d8eaea31be68bd0fd03574b5">POOL_DEBUG</a>(<a class="code" href="pool_8h.html#a570981a4b70f26299efdef38a1cebf3e">SAT_DEBUG_RESULT</a>, <span class="stringliteral">&quot;       ##%x##&gt; TE %4d: %s\n&quot;</span>, od-&gt;<a class="code" href="structorderdata.html#aa7d6b79cd94b60508b1390d1c299c83c">edgedata</a>[j + 1], od-&gt;<a class="code" href="structorderdata.html#aa7d6b79cd94b60508b1390d1c299c83c">edgedata</a>[j], <a class="code" href="pool_8h.html#adf35a6568989887a7ca04422cf6fec98">solvid2str</a>(pool, te2-&gt;<a class="code" href="struct__TransactionElement.html#a15d7a733a882815e8017cab196175090">p</a>));
<a name="l01384"></a>01384         }
<a name="l01385"></a>01385     }
<a name="l01386"></a>01386 }
<a name="l01387"></a>01387 
<a name="l01388"></a>01388 <span class="preprocessor">#if 1</span>
<a name="l01389"></a>01389 <span class="preprocessor"></span><span class="keyword">static</span> <span class="keywordtype">void</span>
<a name="l01390"></a><a class="code" href="transaction_8c.html#aad4b114edd41dd241e065033c7919bc1">01390</a> <a class="code" href="transaction_8c.html#aad4b114edd41dd241e065033c7919bc1">reachable</a>(<span class="keyword">struct</span> <a class="code" href="structorderdata.html">orderdata</a> *od, <a class="code" href="pooltypes_8h.html#a2e0e6278ac51842ca3aeb53e3fc3ead6">Id</a> i)
<a name="l01391"></a>01391 {
<a name="l01392"></a>01392   <span class="keyword">struct </span><a class="code" href="struct__TransactionElement.html">_TransactionElement</a> *te = od-&gt;<a class="code" href="structorderdata.html#af2c9ed95d58301c7b395bb8812b5cddf">tes</a> + i;
<a name="l01393"></a>01393   <span class="keywordtype">int</span> j, k;
<a name="l01394"></a>01394 
<a name="l01395"></a>01395   <span class="keywordflow">if</span> (te-&gt;<a class="code" href="struct__TransactionElement.html#a9a92730d3d2313a63a0520a9214a9615">mark</a> != 0)
<a name="l01396"></a>01396     <span class="keywordflow">return</span>;
<a name="l01397"></a>01397   te-&gt;<a class="code" href="struct__TransactionElement.html#a9a92730d3d2313a63a0520a9214a9615">mark</a> = 1;
<a name="l01398"></a>01398   <span class="keywordflow">for</span> (j = te-&gt;<a class="code" href="struct__TransactionElement.html#a83c9f82e48799df8c379ecf0d435572e">edges</a>; (k = od-&gt;<a class="code" href="structorderdata.html#aa7d6b79cd94b60508b1390d1c299c83c">edgedata</a>[j]) != 0; j += 2)
<a name="l01399"></a>01399     {
<a name="l01400"></a>01400       <span class="keywordflow">if</span> ((od-&gt;<a class="code" href="structorderdata.html#aa7d6b79cd94b60508b1390d1c299c83c">edgedata</a>[j + 1] &amp; <a class="code" href="transaction_8c.html#addd825a898ef4e1c1c8ec80b0dcc175c">TYPE_BROKEN</a>) != 0)
<a name="l01401"></a>01401         <span class="keywordflow">continue</span>;
<a name="l01402"></a>01402       <span class="keywordflow">if</span> (!od-&gt;<a class="code" href="structorderdata.html#af2c9ed95d58301c7b395bb8812b5cddf">tes</a>[k].<a class="code" href="struct__TransactionElement.html#a9a92730d3d2313a63a0520a9214a9615">mark</a>)
<a name="l01403"></a>01403         <a class="code" href="transaction_8c.html#aad4b114edd41dd241e065033c7919bc1">reachable</a>(od, k);
<a name="l01404"></a>01404       <span class="keywordflow">if</span> (od-&gt;<a class="code" href="structorderdata.html#af2c9ed95d58301c7b395bb8812b5cddf">tes</a>[k].<a class="code" href="struct__TransactionElement.html#a9a92730d3d2313a63a0520a9214a9615">mark</a> == 2)
<a name="l01405"></a>01405         {
<a name="l01406"></a>01406           te-&gt;<a class="code" href="struct__TransactionElement.html#a9a92730d3d2313a63a0520a9214a9615">mark</a> = 2;
<a name="l01407"></a>01407           <span class="keywordflow">return</span>;
<a name="l01408"></a>01408         }
<a name="l01409"></a>01409     }
<a name="l01410"></a>01410   te-&gt;<a class="code" href="struct__TransactionElement.html#a9a92730d3d2313a63a0520a9214a9615">mark</a> = -1;
<a name="l01411"></a>01411 }
<a name="l01412"></a>01412 <span class="preprocessor">#endif</span>
<a name="l01413"></a>01413 <span class="preprocessor"></span>
<a name="l01414"></a>01414 <span class="keyword">static</span> <span class="keywordtype">void</span>
<a name="l01415"></a><a class="code" href="transaction_8c.html#aeb8a796b2010d7575d326c263e5abaf5">01415</a> <a class="code" href="transaction_8c.html#aeb8a796b2010d7575d326c263e5abaf5">addcycleedges</a>(<span class="keyword">struct</span> <a class="code" href="structorderdata.html">orderdata</a> *od, <a class="code" href="pooltypes_8h.html#a2e0e6278ac51842ca3aeb53e3fc3ead6">Id</a> *cycle, <a class="code" href="struct__Queue.html">Queue</a> *todo)
<a name="l01416"></a>01416 {
<a name="l01417"></a>01417 <span class="preprocessor">#if 0</span>
<a name="l01418"></a>01418 <span class="preprocessor"></span>  <a class="code" href="struct__Transaction.html">Transaction</a> *trans = od-&gt;<a class="code" href="structorderdata.html#a504265b4ce88aae0b2e6139a153094cb">trans</a>;
<a name="l01419"></a>01419   <a class="code" href="struct__Pool.html">Pool</a> *pool = trans-&gt;<a class="code" href="struct__Transaction.html#aeec1bcea114aa72e7c8005b8e08a369b">pool</a>;
<a name="l01420"></a>01420 <span class="preprocessor">#endif</span>
<a name="l01421"></a>01421 <span class="preprocessor"></span>  <span class="keyword">struct </span><a class="code" href="struct__TransactionElement.html">_TransactionElement</a> *te;
<a name="l01422"></a>01422   <span class="keywordtype">int</span> i, j, k, tail;
<a name="l01423"></a>01423 <span class="preprocessor">#if 1</span>
<a name="l01424"></a>01424 <span class="preprocessor"></span>  <span class="keywordtype">int</span> head;
<a name="l01425"></a>01425 <span class="preprocessor">#endif</span>
<a name="l01426"></a>01426 <span class="preprocessor"></span>
<a name="l01427"></a>01427 <span class="preprocessor">#if 0</span>
<a name="l01428"></a>01428 <span class="preprocessor"></span>  printf(<span class="stringliteral">&quot;addcycleedges\n&quot;</span>);
<a name="l01429"></a>01429   <span class="keywordflow">for</span> (i = 0; (j = cycle[i]) != 0; i++)
<a name="l01430"></a>01430     printf(<span class="stringliteral">&quot;cycle %s\n&quot;</span>, <a class="code" href="pool_8h.html#adf35a6568989887a7ca04422cf6fec98">solvid2str</a>(pool, od-&gt;<a class="code" href="structorderdata.html#af2c9ed95d58301c7b395bb8812b5cddf">tes</a>[j].<a class="code" href="struct__TransactionElement.html#a15d7a733a882815e8017cab196175090">p</a>));
<a name="l01431"></a>01431 <span class="preprocessor">#endif</span>
<a name="l01432"></a>01432 <span class="preprocessor"></span>
<a name="l01433"></a>01433   <span class="comment">/* first add all the tail cycle edges */</span>
<a name="l01434"></a>01434 
<a name="l01435"></a>01435   <span class="comment">/* see what we can reach from the cycle */</span>
<a name="l01436"></a>01436   <a class="code" href="queue_8h.html#aad3334b89bd00dfaa2d483971bd55a7b">queue_empty</a>(todo);
<a name="l01437"></a>01437   <span class="keywordflow">for</span> (i = 1, te = od-&gt;<a class="code" href="structorderdata.html#af2c9ed95d58301c7b395bb8812b5cddf">tes</a> + i; i &lt; od-&gt;ntes; i++, te++)
<a name="l01438"></a>01438     te-&gt;<a class="code" href="struct__TransactionElement.html#a9a92730d3d2313a63a0520a9214a9615">mark</a> = 0;
<a name="l01439"></a>01439   <span class="keywordflow">for</span> (i = 0; (j = cycle[i]) != 0; i++)
<a name="l01440"></a>01440     {
<a name="l01441"></a>01441       od-&gt;<a class="code" href="structorderdata.html#af2c9ed95d58301c7b395bb8812b5cddf">tes</a>[j].<a class="code" href="struct__TransactionElement.html#a9a92730d3d2313a63a0520a9214a9615">mark</a> = -1;
<a name="l01442"></a>01442       <a class="code" href="queue_8h.html#a3ba172138b6a04f289def63b198057f1">queue_push</a>(todo, j);
<a name="l01443"></a>01443     }
<a name="l01444"></a>01444   <span class="keywordflow">while</span> (todo-&gt;<a class="code" href="struct__Queue.html#abb0696a77174cd23b5f488ad4c7b45d2">count</a>)
<a name="l01445"></a>01445     {
<a name="l01446"></a>01446       i = <a class="code" href="queue_8h.html#a001a7f2736f07aef8fc0d1f02dd3dc75">queue_pop</a>(todo);
<a name="l01447"></a>01447       te = od-&gt;<a class="code" href="structorderdata.html#af2c9ed95d58301c7b395bb8812b5cddf">tes</a> + i;
<a name="l01448"></a>01448       <span class="keywordflow">if</span> (te-&gt;<a class="code" href="struct__TransactionElement.html#a9a92730d3d2313a63a0520a9214a9615">mark</a> &gt; 0)
<a name="l01449"></a>01449         <span class="keywordflow">continue</span>;
<a name="l01450"></a>01450       te-&gt;<a class="code" href="struct__TransactionElement.html#a9a92730d3d2313a63a0520a9214a9615">mark</a> = te-&gt;<a class="code" href="struct__TransactionElement.html#a9a92730d3d2313a63a0520a9214a9615">mark</a> &lt; 0 ? 2 : 1;
<a name="l01451"></a>01451       <span class="keywordflow">for</span> (j = te-&gt;<a class="code" href="struct__TransactionElement.html#a83c9f82e48799df8c379ecf0d435572e">edges</a>; (k = od-&gt;<a class="code" href="structorderdata.html#aa7d6b79cd94b60508b1390d1c299c83c">edgedata</a>[j]) != 0; j += 2)
<a name="l01452"></a>01452         {
<a name="l01453"></a>01453           <span class="keywordflow">if</span> ((od-&gt;<a class="code" href="structorderdata.html#aa7d6b79cd94b60508b1390d1c299c83c">edgedata</a>[j + 1] &amp; <a class="code" href="transaction_8c.html#addd825a898ef4e1c1c8ec80b0dcc175c">TYPE_BROKEN</a>) != 0)
<a name="l01454"></a>01454             <span class="keywordflow">continue</span>;
<a name="l01455"></a>01455           <span class="keywordflow">if</span> (od-&gt;<a class="code" href="structorderdata.html#af2c9ed95d58301c7b395bb8812b5cddf">tes</a>[k].<a class="code" href="struct__TransactionElement.html#a9a92730d3d2313a63a0520a9214a9615">mark</a> &gt; 0)
<a name="l01456"></a>01456             <span class="keywordflow">continue</span>;   <span class="comment">/* no need to visit again */</span>
<a name="l01457"></a>01457           <a class="code" href="queue_8h.html#a3ba172138b6a04f289def63b198057f1">queue_push</a>(todo, k);
<a name="l01458"></a>01458         }
<a name="l01459"></a>01459     }
<a name="l01460"></a>01460   <span class="comment">/* now all cycle TEs are marked with 2, all TEs reachable</span>
<a name="l01461"></a>01461 <span class="comment">   * from the cycle are marked with 1 */</span>
<a name="l01462"></a>01462   tail = cycle[0];
<a name="l01463"></a>01463   od-&gt;<a class="code" href="structorderdata.html#af2c9ed95d58301c7b395bb8812b5cddf">tes</a>[tail].<a class="code" href="struct__TransactionElement.html#a9a92730d3d2313a63a0520a9214a9615">mark</a> = 1;       <span class="comment">/* no need to add edges */</span>
<a name="l01464"></a>01464 
<a name="l01465"></a>01465   <span class="keywordflow">for</span> (i = 1, te = od-&gt;<a class="code" href="structorderdata.html#af2c9ed95d58301c7b395bb8812b5cddf">tes</a> + i; i &lt; od-&gt;ntes; i++, te++)
<a name="l01466"></a>01466     {
<a name="l01467"></a>01467       <span class="keywordflow">if</span> (te-&gt;<a class="code" href="struct__TransactionElement.html#a9a92730d3d2313a63a0520a9214a9615">mark</a>)
<a name="l01468"></a>01468         <span class="keywordflow">continue</span>;       <span class="comment">/* reachable from cycle */</span>
<a name="l01469"></a>01469       <span class="keywordflow">for</span> (j = te-&gt;<a class="code" href="struct__TransactionElement.html#a83c9f82e48799df8c379ecf0d435572e">edges</a>; (k = od-&gt;<a class="code" href="structorderdata.html#aa7d6b79cd94b60508b1390d1c299c83c">edgedata</a>[j]) != 0; j += 2)
<a name="l01470"></a>01470         {
<a name="l01471"></a>01471           <span class="keywordflow">if</span> ((od-&gt;<a class="code" href="structorderdata.html#aa7d6b79cd94b60508b1390d1c299c83c">edgedata</a>[j + 1] &amp; <a class="code" href="transaction_8c.html#addd825a898ef4e1c1c8ec80b0dcc175c">TYPE_BROKEN</a>) != 0)
<a name="l01472"></a>01472             <span class="keywordflow">continue</span>;
<a name="l01473"></a>01473           <span class="keywordflow">if</span> (od-&gt;<a class="code" href="structorderdata.html#af2c9ed95d58301c7b395bb8812b5cddf">tes</a>[k].<a class="code" href="struct__TransactionElement.html#a9a92730d3d2313a63a0520a9214a9615">mark</a> != 2)
<a name="l01474"></a>01474             <span class="keywordflow">continue</span>;
<a name="l01475"></a>01475           <span class="comment">/* We found an edge to the cycle. Add an extra edge to the tail */</span>
<a name="l01476"></a>01476           <span class="comment">/* the TE was not reachable, so we&#39;re not creating a new cycle! */</span>
<a name="l01477"></a>01477 <span class="preprocessor">#if 0</span>
<a name="l01478"></a>01478 <span class="preprocessor"></span>          printf(<span class="stringliteral">&quot;adding TO TAIL cycle edge %d-&gt;%d %s-&gt;%s!\n&quot;</span>, i, tail, <a class="code" href="pool_8h.html#adf35a6568989887a7ca04422cf6fec98">solvid2str</a>(pool, od-&gt;<a class="code" href="structorderdata.html#af2c9ed95d58301c7b395bb8812b5cddf">tes</a>[i].<a class="code" href="struct__TransactionElement.html#a15d7a733a882815e8017cab196175090">p</a>), <a class="code" href="pool_8h.html#adf35a6568989887a7ca04422cf6fec98">solvid2str</a>(pool, od-&gt;<a class="code" href="structorderdata.html#af2c9ed95d58301c7b395bb8812b5cddf">tes</a>[tail].<a class="code" href="struct__TransactionElement.html#a15d7a733a882815e8017cab196175090">p</a>));
<a name="l01479"></a>01479 <span class="preprocessor">#endif</span>
<a name="l01480"></a>01480 <span class="preprocessor"></span>          j -= te-&gt;<a class="code" href="struct__TransactionElement.html#a83c9f82e48799df8c379ecf0d435572e">edges</a>;       <span class="comment">/* in case we move */</span>
<a name="l01481"></a>01481           <a class="code" href="transaction_8c.html#a6a7194ba9f917f502f36e8e9a4769dc3">addteedge</a>(od, i, tail, <a class="code" href="transaction_8c.html#ac7999251a8ba673393f546cd60d4f9df">TYPE_CYCLETAIL</a>);
<a name="l01482"></a>01482           j += te-&gt;<a class="code" href="struct__TransactionElement.html#a83c9f82e48799df8c379ecf0d435572e">edges</a>;
<a name="l01483"></a>01483           <span class="keywordflow">break</span>;        <span class="comment">/* one edge is enough */</span>
<a name="l01484"></a>01484         }
<a name="l01485"></a>01485     }
<a name="l01486"></a>01486 
<a name="l01487"></a>01487 <span class="preprocessor">#if 1</span>
<a name="l01488"></a>01488 <span class="preprocessor"></span>  <span class="comment">/* now add all head cycle edges */</span>
<a name="l01489"></a>01489 
<a name="l01490"></a>01490   <span class="comment">/* reset marks */</span>
<a name="l01491"></a>01491   <span class="keywordflow">for</span> (i = 1, te = od-&gt;<a class="code" href="structorderdata.html#af2c9ed95d58301c7b395bb8812b5cddf">tes</a> + i; i &lt; od-&gt;ntes; i++, te++)
<a name="l01492"></a>01492     te-&gt;<a class="code" href="struct__TransactionElement.html#a9a92730d3d2313a63a0520a9214a9615">mark</a> = 0;
<a name="l01493"></a>01493   head = 0;
<a name="l01494"></a>01494   <span class="keywordflow">for</span> (i = 0; (j = cycle[i]) != 0; i++)
<a name="l01495"></a>01495     {
<a name="l01496"></a>01496       head = j;
<a name="l01497"></a>01497       od-&gt;<a class="code" href="structorderdata.html#af2c9ed95d58301c7b395bb8812b5cddf">tes</a>[j].<a class="code" href="struct__TransactionElement.html#a9a92730d3d2313a63a0520a9214a9615">mark</a> = 2;
<a name="l01498"></a>01498     }
<a name="l01499"></a>01499   <span class="comment">/* first the head to save some time */</span>
<a name="l01500"></a>01500   te = od-&gt;<a class="code" href="structorderdata.html#af2c9ed95d58301c7b395bb8812b5cddf">tes</a> + head;
<a name="l01501"></a>01501   <span class="keywordflow">for</span> (j = te-&gt;<a class="code" href="struct__TransactionElement.html#a83c9f82e48799df8c379ecf0d435572e">edges</a>; (k = od-&gt;<a class="code" href="structorderdata.html#aa7d6b79cd94b60508b1390d1c299c83c">edgedata</a>[j]) != 0; j += 2)
<a name="l01502"></a>01502     {
<a name="l01503"></a>01503       <span class="keywordflow">if</span> ((od-&gt;<a class="code" href="structorderdata.html#aa7d6b79cd94b60508b1390d1c299c83c">edgedata</a>[j + 1] &amp; <a class="code" href="transaction_8c.html#addd825a898ef4e1c1c8ec80b0dcc175c">TYPE_BROKEN</a>) != 0)
<a name="l01504"></a>01504         <span class="keywordflow">continue</span>;
<a name="l01505"></a>01505       <span class="keywordflow">if</span> (!od-&gt;<a class="code" href="structorderdata.html#af2c9ed95d58301c7b395bb8812b5cddf">tes</a>[k].<a class="code" href="struct__TransactionElement.html#a9a92730d3d2313a63a0520a9214a9615">mark</a>)
<a name="l01506"></a>01506         <a class="code" href="transaction_8c.html#aad4b114edd41dd241e065033c7919bc1">reachable</a>(od, k);
<a name="l01507"></a>01507       <span class="keywordflow">if</span> (od-&gt;<a class="code" href="structorderdata.html#af2c9ed95d58301c7b395bb8812b5cddf">tes</a>[k].<a class="code" href="struct__TransactionElement.html#a9a92730d3d2313a63a0520a9214a9615">mark</a> == -1)
<a name="l01508"></a>01508         od-&gt;<a class="code" href="structorderdata.html#af2c9ed95d58301c7b395bb8812b5cddf">tes</a>[k].<a class="code" href="struct__TransactionElement.html#a9a92730d3d2313a63a0520a9214a9615">mark</a> = -2;   <span class="comment">/* no need for another edge */</span>
<a name="l01509"></a>01509     }
<a name="l01510"></a>01510   <span class="keywordflow">for</span> (i = 0; cycle[i] != 0; i++)
<a name="l01511"></a>01511     {
<a name="l01512"></a>01512       <span class="keywordflow">if</span> (cycle[i] == head)
<a name="l01513"></a>01513         <span class="keywordflow">break</span>;
<a name="l01514"></a>01514       te = od-&gt;<a class="code" href="structorderdata.html#af2c9ed95d58301c7b395bb8812b5cddf">tes</a> + cycle[i];
<a name="l01515"></a>01515       <span class="keywordflow">for</span> (j = te-&gt;<a class="code" href="struct__TransactionElement.html#a83c9f82e48799df8c379ecf0d435572e">edges</a>; (k = od-&gt;<a class="code" href="structorderdata.html#aa7d6b79cd94b60508b1390d1c299c83c">edgedata</a>[j]) != 0; j += 2)
<a name="l01516"></a>01516         {
<a name="l01517"></a>01517           <span class="keywordflow">if</span> ((od-&gt;<a class="code" href="structorderdata.html#aa7d6b79cd94b60508b1390d1c299c83c">edgedata</a>[j + 1] &amp; <a class="code" href="transaction_8c.html#addd825a898ef4e1c1c8ec80b0dcc175c">TYPE_BROKEN</a>) != 0)
<a name="l01518"></a>01518             <span class="keywordflow">continue</span>;
<a name="l01519"></a>01519           <span class="comment">/* see if we can reach a cycle TE from k */</span>
<a name="l01520"></a>01520           <span class="keywordflow">if</span> (!od-&gt;<a class="code" href="structorderdata.html#af2c9ed95d58301c7b395bb8812b5cddf">tes</a>[k].<a class="code" href="struct__TransactionElement.html#a9a92730d3d2313a63a0520a9214a9615">mark</a>)
<a name="l01521"></a>01521             <a class="code" href="transaction_8c.html#aad4b114edd41dd241e065033c7919bc1">reachable</a>(od, k);
<a name="l01522"></a>01522           <span class="keywordflow">if</span> (od-&gt;<a class="code" href="structorderdata.html#af2c9ed95d58301c7b395bb8812b5cddf">tes</a>[k].<a class="code" href="struct__TransactionElement.html#a9a92730d3d2313a63a0520a9214a9615">mark</a> == -1)
<a name="l01523"></a>01523             {
<a name="l01524"></a>01524 <span class="preprocessor">#if 0</span>
<a name="l01525"></a>01525 <span class="preprocessor"></span>              printf(<span class="stringliteral">&quot;adding FROM HEAD cycle edge %d-&gt;%d %s-&gt;%s [%s]!\n&quot;</span>, head, k, <a class="code" href="pool_8h.html#adf35a6568989887a7ca04422cf6fec98">solvid2str</a>(pool, od-&gt;<a class="code" href="structorderdata.html#af2c9ed95d58301c7b395bb8812b5cddf">tes</a>[head].<a class="code" href="struct__TransactionElement.html#a15d7a733a882815e8017cab196175090">p</a>), <a class="code" href="pool_8h.html#adf35a6568989887a7ca04422cf6fec98">solvid2str</a>(pool, od-&gt;<a class="code" href="structorderdata.html#af2c9ed95d58301c7b395bb8812b5cddf">tes</a>[k].<a class="code" href="struct__TransactionElement.html#a15d7a733a882815e8017cab196175090">p</a>), <a class="code" href="pool_8h.html#adf35a6568989887a7ca04422cf6fec98">solvid2str</a>(pool, od-&gt;<a class="code" href="structorderdata.html#af2c9ed95d58301c7b395bb8812b5cddf">tes</a>[cycle[i]].<a class="code" href="struct__TransactionElement.html#a15d7a733a882815e8017cab196175090">p</a>));
<a name="l01526"></a>01526 <span class="preprocessor">#endif</span>
<a name="l01527"></a>01527 <span class="preprocessor"></span>              <a class="code" href="transaction_8c.html#a6a7194ba9f917f502f36e8e9a4769dc3">addteedge</a>(od, head, k, <a class="code" href="transaction_8c.html#a99f1854edffdacc03f05955592f05837">TYPE_CYCLEHEAD</a>);
<a name="l01528"></a>01528               od-&gt;<a class="code" href="structorderdata.html#af2c9ed95d58301c7b395bb8812b5cddf">tes</a>[k].<a class="code" href="struct__TransactionElement.html#a9a92730d3d2313a63a0520a9214a9615">mark</a> = -2;     <span class="comment">/* no need to add that one again */</span>
<a name="l01529"></a>01529             }
<a name="l01530"></a>01530         }
<a name="l01531"></a>01531     }
<a name="l01532"></a>01532 <span class="preprocessor">#endif</span>
<a name="l01533"></a>01533 <span class="preprocessor"></span>}
<a name="l01534"></a>01534 
<a name="l01535"></a>01535 <span class="keywordtype">void</span>
<a name="l01536"></a><a class="code" href="transaction_8h.html#a182ccd93b11e5ab09dd52a9905ba9b3d">01536</a> <a class="code" href="transaction_8c.html#a182ccd93b11e5ab09dd52a9905ba9b3d">transaction_order</a>(<a class="code" href="struct__Transaction.html">Transaction</a> *trans, <span class="keywordtype">int</span> flags)
<a name="l01537"></a>01537 {
<a name="l01538"></a>01538   <a class="code" href="struct__Pool.html">Pool</a> *pool = trans-&gt;<a class="code" href="struct__Transaction.html#aeec1bcea114aa72e7c8005b8e08a369b">pool</a>;
<a name="l01539"></a>01539   <a class="code" href="struct__Queue.html">Queue</a> *tr = &amp;trans-&gt;<a class="code" href="struct__Transaction.html#a7e05d837578f51e0a26658a2ae37fc4d">steps</a>;
<a name="l01540"></a>01540   <a class="code" href="struct__Repo.html">Repo</a> *installed = pool-&gt;<a class="code" href="struct__Pool.html#a887053f905054298cd61ce1c99e26690">installed</a>;
<a name="l01541"></a>01541   <a class="code" href="pooltypes_8h.html#a2e0e6278ac51842ca3aeb53e3fc3ead6">Id</a> <a class="code" href="struct__TransactionElement.html#a15d7a733a882815e8017cab196175090">p</a>;
<a name="l01542"></a>01542   <a class="code" href="struct__Solvable.html">Solvable</a> *s;
<a name="l01543"></a>01543   <span class="keywordtype">int</span> i, j, k, numte, numedge;
<a name="l01544"></a>01544   <span class="keyword">struct </span><a class="code" href="structorderdata.html">orderdata</a> od;
<a name="l01545"></a>01545   <span class="keyword">struct </span><a class="code" href="struct__TransactionElement.html">_TransactionElement</a> *te;
<a name="l01546"></a>01546   <a class="code" href="struct__Queue.html">Queue</a> todo, obsq, samerepoq, uninstq;
<a name="l01547"></a>01547   <span class="keywordtype">int</span> cycstart, cycel;
<a name="l01548"></a>01548   <a class="code" href="pooltypes_8h.html#a2e0e6278ac51842ca3aeb53e3fc3ead6">Id</a> *cycle;
<a name="l01549"></a>01549   <span class="keywordtype">int</span> oldcount;
<a name="l01550"></a>01550   <span class="keywordtype">int</span> start, now;
<a name="l01551"></a>01551   <a class="code" href="struct__Repo.html">Repo</a> *lastrepo;
<a name="l01552"></a>01552   <span class="keywordtype">int</span> lastmedia;
<a name="l01553"></a>01553   <a class="code" href="pooltypes_8h.html#a2e0e6278ac51842ca3aeb53e3fc3ead6">Id</a> *temedianr;
<a name="l01554"></a>01554 
<a name="l01555"></a>01555   start = now = <a class="code" href="util_8c.html#a10875c1838f0632aabf1a919135a06ee">sat_timems</a>(0);
<a name="l01556"></a>01556   <a class="code" href="pool_8h.html#ac2855e39d8eaea31be68bd0fd03574b5">POOL_DEBUG</a>(<a class="code" href="pool_8h.html#a9e7c48e08e7b2a51b41e4d6611a02ace">SAT_DEBUG_STATS</a>, <span class="stringliteral">&quot;ordering transaction\n&quot;</span>);
<a name="l01557"></a>01557   <span class="comment">/* free old data if present */</span>
<a name="l01558"></a>01558   <span class="keywordflow">if</span> (trans-&gt;<a class="code" href="struct__Transaction.html#a7d6f72d061b26666810132daa1937fa3">orderdata</a>)
<a name="l01559"></a>01559     {
<a name="l01560"></a>01560       <span class="keyword">struct </span><a class="code" href="struct__TransactionOrderdata.html">_TransactionOrderdata</a> *od = trans-&gt;<a class="code" href="struct__Transaction.html#a7d6f72d061b26666810132daa1937fa3">orderdata</a>;
<a name="l01561"></a>01561       od-&gt;<a class="code" href="struct__TransactionOrderdata.html#a434565f1766b3f2d4de59ad7d38338eb">tes</a> = <a class="code" href="util_8c.html#a1f246fae10a89534cfe0583cefb44c11">sat_free</a>(od-&gt;<a class="code" href="struct__TransactionOrderdata.html#a434565f1766b3f2d4de59ad7d38338eb">tes</a>);
<a name="l01562"></a>01562       od-&gt;<a class="code" href="struct__TransactionOrderdata.html#aa04948eac0d951e1c56004b06e8cc101">invedgedata</a> = <a class="code" href="util_8c.html#a1f246fae10a89534cfe0583cefb44c11">sat_free</a>(od-&gt;<a class="code" href="struct__TransactionOrderdata.html#aa04948eac0d951e1c56004b06e8cc101">invedgedata</a>);
<a name="l01563"></a>01563       trans-&gt;<a class="code" href="struct__Transaction.html#a7d6f72d061b26666810132daa1937fa3">orderdata</a> = <a class="code" href="util_8c.html#a1f246fae10a89534cfe0583cefb44c11">sat_free</a>(trans-&gt;<a class="code" href="struct__Transaction.html#a7d6f72d061b26666810132daa1937fa3">orderdata</a>);
<a name="l01564"></a>01564     }
<a name="l01565"></a>01565 
<a name="l01566"></a>01566   <span class="comment">/* create a transaction element for every active component */</span>
<a name="l01567"></a>01567   numte = 0;
<a name="l01568"></a>01568   <span class="keywordflow">for</span> (i = 0; i &lt; tr-&gt;<a class="code" href="struct__Queue.html#abb0696a77174cd23b5f488ad4c7b45d2">count</a>; i++)
<a name="l01569"></a>01569     {
<a name="l01570"></a>01570       p = tr-&gt;<a class="code" href="struct__Queue.html#a116eb58bed8ff76bf18f9c16cf1ce5c6">elements</a>[i];
<a name="l01571"></a>01571       s = pool-&gt;<a class="code" href="struct__Pool.html#a9842c936aa241bad13ba13f21a337319">solvables</a> + p;
<a name="l01572"></a>01572       <span class="keywordflow">if</span> (installed &amp;&amp; s-&gt;<a class="code" href="struct__Solvable.html#a15e0b77fe061c6429a24215191b10f05">repo</a> == installed &amp;&amp; trans-&gt;<a class="code" href="struct__Transaction.html#a592881da1d794d3ea60272a3938d4bf0">transaction_installed</a>[p - installed-&gt;<a class="code" href="struct__Repo.html#a4eb2dd93e4a4f88f13d462f2f111e038">start</a>])
<a name="l01573"></a>01573         <span class="keywordflow">continue</span>;
<a name="l01574"></a>01574       numte++;
<a name="l01575"></a>01575     }
<a name="l01576"></a>01576   <a class="code" href="pool_8h.html#ac2855e39d8eaea31be68bd0fd03574b5">POOL_DEBUG</a>(<a class="code" href="pool_8h.html#a9e7c48e08e7b2a51b41e4d6611a02ace">SAT_DEBUG_STATS</a>, <span class="stringliteral">&quot;transaction elements: %d\n&quot;</span>, numte);
<a name="l01577"></a>01577   <span class="keywordflow">if</span> (!numte)
<a name="l01578"></a>01578     <span class="keywordflow">return</span>;     <span class="comment">/* nothing to do... */</span>
<a name="l01579"></a>01579 
<a name="l01580"></a>01580   numte++;      <span class="comment">/* leave first one zero */</span>
<a name="l01581"></a>01581   memset(&amp;od, 0, <span class="keyword">sizeof</span>(od));
<a name="l01582"></a>01582   od.<a class="code" href="structorderdata.html#a504265b4ce88aae0b2e6139a153094cb">trans</a> = trans;
<a name="l01583"></a>01583   od.<a class="code" href="structorderdata.html#ac4393a568ed39c73f0042a208a3b60d9">ntes</a> = numte;
<a name="l01584"></a>01584   od.<a class="code" href="structorderdata.html#af2c9ed95d58301c7b395bb8812b5cddf">tes</a> = <a class="code" href="util_8c.html#a7964924c069160718b17ac2770d6885d">sat_calloc</a>(numte, <span class="keyword">sizeof</span>(*od.<a class="code" href="structorderdata.html#af2c9ed95d58301c7b395bb8812b5cddf">tes</a>));
<a name="l01585"></a>01585   od.<a class="code" href="structorderdata.html#aa7d6b79cd94b60508b1390d1c299c83c">edgedata</a> = <a class="code" href="util_8h.html#a8f0135824fd0936735b002a452c84cbd">sat_extend</a>(0, 0, 1, <span class="keyword">sizeof</span>(<a class="code" href="pooltypes_8h.html#a2e0e6278ac51842ca3aeb53e3fc3ead6">Id</a>), <a class="code" href="transaction_8c.html#affde009c2a01eff48789464ba08e73b3">EDGEDATA_BLOCK</a>);
<a name="l01586"></a>01586   od.<a class="code" href="structorderdata.html#aa7d6b79cd94b60508b1390d1c299c83c">edgedata</a>[0] = 0;
<a name="l01587"></a>01587   od.<a class="code" href="structorderdata.html#a50802367a905a1a9cb41ea8725fb0e8c">nedgedata</a> = 1;
<a name="l01588"></a>01588   <a class="code" href="queue_8c.html#ae1a64f63dd8cc46bdb2bcd415aa89e5a">queue_init</a>(&amp;od.<a class="code" href="structorderdata.html#a0d5db89a42a09650097dfe8f9e0842f6">cycles</a>);
<a name="l01589"></a>01589 
<a name="l01590"></a>01590   <span class="comment">/* initialize TEs */</span>
<a name="l01591"></a>01591   <span class="keywordflow">for</span> (i = 0, te = od.<a class="code" href="structorderdata.html#af2c9ed95d58301c7b395bb8812b5cddf">tes</a> + 1; i &lt; tr-&gt;count; i++)
<a name="l01592"></a>01592     {
<a name="l01593"></a>01593       p = tr-&gt;<a class="code" href="struct__Queue.html#a116eb58bed8ff76bf18f9c16cf1ce5c6">elements</a>[i];
<a name="l01594"></a>01594       s = pool-&gt;<a class="code" href="struct__Pool.html#a9842c936aa241bad13ba13f21a337319">solvables</a> + p;
<a name="l01595"></a>01595       <span class="keywordflow">if</span> (installed &amp;&amp; s-&gt;<a class="code" href="struct__Solvable.html#a15e0b77fe061c6429a24215191b10f05">repo</a> == installed &amp;&amp; trans-&gt;<a class="code" href="struct__Transaction.html#a592881da1d794d3ea60272a3938d4bf0">transaction_installed</a>[p - installed-&gt;<a class="code" href="struct__Repo.html#a4eb2dd93e4a4f88f13d462f2f111e038">start</a>])
<a name="l01596"></a>01596         <span class="keywordflow">continue</span>;
<a name="l01597"></a>01597       te-&gt;<a class="code" href="struct__TransactionElement.html#a15d7a733a882815e8017cab196175090">p</a> = p;
<a name="l01598"></a>01598       te++;
<a name="l01599"></a>01599     }
<a name="l01600"></a>01600 
<a name="l01601"></a>01601   <span class="comment">/* create dependency graph */</span>
<a name="l01602"></a>01602   <span class="keywordflow">for</span> (i = 0; i &lt; tr-&gt;<a class="code" href="struct__Queue.html#abb0696a77174cd23b5f488ad4c7b45d2">count</a>; i++)
<a name="l01603"></a>01603     <a class="code" href="transaction_8c.html#af4db4a730f550b35c5bee20785ff3b8f">addsolvableedges</a>(&amp;od, pool-&gt;<a class="code" href="struct__Pool.html#a9842c936aa241bad13ba13f21a337319">solvables</a> + tr-&gt;<a class="code" href="struct__Queue.html#a116eb58bed8ff76bf18f9c16cf1ce5c6">elements</a>[i]);
<a name="l01604"></a>01604 
<a name="l01605"></a>01605   <span class="comment">/* count edges */</span>
<a name="l01606"></a>01606   numedge = 0;
<a name="l01607"></a>01607   <span class="keywordflow">for</span> (i = 1, te = od.<a class="code" href="structorderdata.html#af2c9ed95d58301c7b395bb8812b5cddf">tes</a> + i; i &lt; numte; i++, te++)
<a name="l01608"></a>01608     <span class="keywordflow">for</span> (j = te-&gt;<a class="code" href="struct__TransactionElement.html#a83c9f82e48799df8c379ecf0d435572e">edges</a>; od.<a class="code" href="structorderdata.html#aa7d6b79cd94b60508b1390d1c299c83c">edgedata</a>[j]; j += 2)
<a name="l01609"></a>01609       numedge++;
<a name="l01610"></a>01610   <a class="code" href="pool_8h.html#ac2855e39d8eaea31be68bd0fd03574b5">POOL_DEBUG</a>(<a class="code" href="pool_8h.html#a9e7c48e08e7b2a51b41e4d6611a02ace">SAT_DEBUG_STATS</a>, <span class="stringliteral">&quot;edges: %d, edge space: %d\n&quot;</span>, numedge, od.<a class="code" href="structorderdata.html#a50802367a905a1a9cb41ea8725fb0e8c">nedgedata</a> / 2);
<a name="l01611"></a>01611   <a class="code" href="pool_8h.html#ac2855e39d8eaea31be68bd0fd03574b5">POOL_DEBUG</a>(<a class="code" href="pool_8h.html#a9e7c48e08e7b2a51b41e4d6611a02ace">SAT_DEBUG_STATS</a>, <span class="stringliteral">&quot;edge creation took %d ms\n&quot;</span>, <a class="code" href="util_8c.html#a10875c1838f0632aabf1a919135a06ee">sat_timems</a>(now));
<a name="l01612"></a>01612 
<a name="l01613"></a>01613 <span class="preprocessor">#if 0</span>
<a name="l01614"></a>01614 <span class="preprocessor"></span>  <a class="code" href="transaction_8c.html#ad57765f1221cb9ad1f0858b30dc9f88e">dump_tes</a>(&amp;od);
<a name="l01615"></a>01615 <span class="preprocessor">#endif</span>
<a name="l01616"></a>01616 <span class="preprocessor"></span>  
<a name="l01617"></a>01617   now = <a class="code" href="util_8c.html#a10875c1838f0632aabf1a919135a06ee">sat_timems</a>(0);
<a name="l01618"></a>01618   <span class="comment">/* kill all cycles */</span>
<a name="l01619"></a>01619   <a class="code" href="queue_8c.html#ae1a64f63dd8cc46bdb2bcd415aa89e5a">queue_init</a>(&amp;todo);
<a name="l01620"></a>01620   <span class="keywordflow">for</span> (i = numte - 1; i &gt; 0; i--)
<a name="l01621"></a>01621     <a class="code" href="queue_8h.html#a3ba172138b6a04f289def63b198057f1">queue_push</a>(&amp;todo, i);
<a name="l01622"></a>01622 
<a name="l01623"></a>01623   <span class="keywordflow">while</span> (todo.<a class="code" href="struct__Queue.html#abb0696a77174cd23b5f488ad4c7b45d2">count</a>)
<a name="l01624"></a>01624     {
<a name="l01625"></a>01625       i = <a class="code" href="queue_8h.html#a001a7f2736f07aef8fc0d1f02dd3dc75">queue_pop</a>(&amp;todo);
<a name="l01626"></a>01626       <span class="comment">/* printf(&quot;- look at TE %d\n&quot;, i); */</span>
<a name="l01627"></a>01627       <span class="keywordflow">if</span> (i &lt; 0)
<a name="l01628"></a>01628         {
<a name="l01629"></a>01629           i = -i;
<a name="l01630"></a>01630           od.<a class="code" href="structorderdata.html#af2c9ed95d58301c7b395bb8812b5cddf">tes</a>[i].<a class="code" href="struct__TransactionElement.html#a9a92730d3d2313a63a0520a9214a9615">mark</a> = 2;   <span class="comment">/* done with that one */</span>
<a name="l01631"></a>01631           <span class="keywordflow">continue</span>;
<a name="l01632"></a>01632         }
<a name="l01633"></a>01633       te = od.<a class="code" href="structorderdata.html#af2c9ed95d58301c7b395bb8812b5cddf">tes</a> + i;
<a name="l01634"></a>01634       <span class="keywordflow">if</span> (te-&gt;<a class="code" href="struct__TransactionElement.html#a9a92730d3d2313a63a0520a9214a9615">mark</a> == 2)
<a name="l01635"></a>01635         <span class="keywordflow">continue</span>;               <span class="comment">/* already finished before */</span>
<a name="l01636"></a>01636       <span class="keywordflow">if</span> (te-&gt;<a class="code" href="struct__TransactionElement.html#a9a92730d3d2313a63a0520a9214a9615">mark</a> == 0)
<a name="l01637"></a>01637         {
<a name="l01638"></a>01638           <span class="keywordtype">int</span> edgestovisit = 0;
<a name="l01639"></a>01639           <span class="comment">/* new node, visit edges */</span>
<a name="l01640"></a>01640           <span class="keywordflow">for</span> (j = te-&gt;<a class="code" href="struct__TransactionElement.html#a83c9f82e48799df8c379ecf0d435572e">edges</a>; (k = od.<a class="code" href="structorderdata.html#aa7d6b79cd94b60508b1390d1c299c83c">edgedata</a>[j]) != 0; j += 2)
<a name="l01641"></a>01641             {
<a name="l01642"></a>01642               <span class="keywordflow">if</span> ((od.<a class="code" href="structorderdata.html#aa7d6b79cd94b60508b1390d1c299c83c">edgedata</a>[j + 1] &amp; <a class="code" href="transaction_8c.html#addd825a898ef4e1c1c8ec80b0dcc175c">TYPE_BROKEN</a>) != 0)
<a name="l01643"></a>01643                 <span class="keywordflow">continue</span>;
<a name="l01644"></a>01644               <span class="keywordflow">if</span> (od.<a class="code" href="structorderdata.html#af2c9ed95d58301c7b395bb8812b5cddf">tes</a>[k].<a class="code" href="struct__TransactionElement.html#a9a92730d3d2313a63a0520a9214a9615">mark</a> == 2)
<a name="l01645"></a>01645                 <span class="keywordflow">continue</span>;       <span class="comment">/* no need to visit again */</span>
<a name="l01646"></a>01646               <span class="keywordflow">if</span> (!edgestovisit++)
<a name="l01647"></a>01647                 <a class="code" href="queue_8h.html#a3ba172138b6a04f289def63b198057f1">queue_push</a>(&amp;todo, -i);  <span class="comment">/* end of edges marker */</span>
<a name="l01648"></a>01648               <a class="code" href="queue_8h.html#a3ba172138b6a04f289def63b198057f1">queue_push</a>(&amp;todo, k);
<a name="l01649"></a>01649             }
<a name="l01650"></a>01650           <span class="keywordflow">if</span> (!edgestovisit)
<a name="l01651"></a>01651             te-&gt;<a class="code" href="struct__TransactionElement.html#a9a92730d3d2313a63a0520a9214a9615">mark</a> = 2;       <span class="comment">/* no edges, done with that one */</span>
<a name="l01652"></a>01652           <span class="keywordflow">else</span>
<a name="l01653"></a>01653             te-&gt;<a class="code" href="struct__TransactionElement.html#a9a92730d3d2313a63a0520a9214a9615">mark</a> = 1;       <span class="comment">/* under investigation */</span>
<a name="l01654"></a>01654           <span class="keywordflow">continue</span>;
<a name="l01655"></a>01655         }
<a name="l01656"></a>01656       <span class="comment">/* oh no, we found a cycle */</span>
<a name="l01657"></a>01657       <span class="comment">/* find start of cycle node (&lt;0) */</span>
<a name="l01658"></a>01658       <span class="keywordflow">for</span> (j = todo.<a class="code" href="struct__Queue.html#abb0696a77174cd23b5f488ad4c7b45d2">count</a> - 1; j &gt;= 0; j--)
<a name="l01659"></a>01659         <span class="keywordflow">if</span> (todo.<a class="code" href="struct__Queue.html#a116eb58bed8ff76bf18f9c16cf1ce5c6">elements</a>[j] == -i)
<a name="l01660"></a>01660           <span class="keywordflow">break</span>;
<a name="l01661"></a>01661       assert(j &gt;= 0);
<a name="l01662"></a>01662       cycstart = j;
<a name="l01663"></a>01663       <span class="comment">/* build te/edge chain */</span>
<a name="l01664"></a>01664       k = cycstart;
<a name="l01665"></a>01665       <span class="keywordflow">for</span> (j = k; j &lt; todo.<a class="code" href="struct__Queue.html#abb0696a77174cd23b5f488ad4c7b45d2">count</a>; j++)
<a name="l01666"></a>01666         <span class="keywordflow">if</span> (todo.<a class="code" href="struct__Queue.html#a116eb58bed8ff76bf18f9c16cf1ce5c6">elements</a>[j] &lt; 0)
<a name="l01667"></a>01667           todo.<a class="code" href="struct__Queue.html#a116eb58bed8ff76bf18f9c16cf1ce5c6">elements</a>[k++] = -todo.<a class="code" href="struct__Queue.html#a116eb58bed8ff76bf18f9c16cf1ce5c6">elements</a>[j];
<a name="l01668"></a>01668       cycel = k - cycstart;
<a name="l01669"></a>01669       assert(cycel &gt; 1);
<a name="l01670"></a>01670       <span class="comment">/* make room for edges, two extra element for cycle loop + terminating 0 */</span>
<a name="l01671"></a>01671       <span class="keywordflow">while</span> (todo.<a class="code" href="struct__Queue.html#abb0696a77174cd23b5f488ad4c7b45d2">count</a> &lt; cycstart + 2 * cycel + 2)
<a name="l01672"></a>01672         <a class="code" href="queue_8h.html#a3ba172138b6a04f289def63b198057f1">queue_push</a>(&amp;todo, 0);
<a name="l01673"></a>01673       cycle = todo.<a class="code" href="struct__Queue.html#a116eb58bed8ff76bf18f9c16cf1ce5c6">elements</a> + cycstart;
<a name="l01674"></a>01674       cycle[cycel] = i;         <span class="comment">/* close the loop */</span>
<a name="l01675"></a>01675       cycle[2 * cycel + 1] = 0; <span class="comment">/* terminator */</span>
<a name="l01676"></a>01676       <span class="keywordflow">for</span> (k = cycel; k &gt; 0; k--)
<a name="l01677"></a>01677         {
<a name="l01678"></a>01678           cycle[k * 2] = cycle[k];
<a name="l01679"></a>01679           te = od.<a class="code" href="structorderdata.html#af2c9ed95d58301c7b395bb8812b5cddf">tes</a> + cycle[k - 1];
<a name="l01680"></a>01680           assert(te-&gt;<a class="code" href="struct__TransactionElement.html#a9a92730d3d2313a63a0520a9214a9615">mark</a> == 1);
<a name="l01681"></a>01681           te-&gt;<a class="code" href="struct__TransactionElement.html#a9a92730d3d2313a63a0520a9214a9615">mark</a> = 0; <span class="comment">/* reset investigation marker */</span>
<a name="l01682"></a>01682           <span class="comment">/* printf(&quot;searching for edge from %d to %d\n&quot;, cycle[k - 1], cycle[k]); */</span>
<a name="l01683"></a>01683           <span class="keywordflow">for</span> (j = te-&gt;<a class="code" href="struct__TransactionElement.html#a83c9f82e48799df8c379ecf0d435572e">edges</a>; od.<a class="code" href="structorderdata.html#aa7d6b79cd94b60508b1390d1c299c83c">edgedata</a>[j]; j += 2)
<a name="l01684"></a>01684             <span class="keywordflow">if</span> (od.<a class="code" href="structorderdata.html#aa7d6b79cd94b60508b1390d1c299c83c">edgedata</a>[j] == cycle[k])
<a name="l01685"></a>01685               <span class="keywordflow">break</span>;
<a name="l01686"></a>01686           assert(od.<a class="code" href="structorderdata.html#aa7d6b79cd94b60508b1390d1c299c83c">edgedata</a>[j]);
<a name="l01687"></a>01687           cycle[k * 2 - 1] = j;
<a name="l01688"></a>01688         }
<a name="l01689"></a>01689       <span class="comment">/* now cycle looks like this: */</span>
<a name="l01690"></a>01690       <span class="comment">/* te1 edge te2 edge te3 ... teN edge te1 0 */</span>
<a name="l01691"></a>01691       <a class="code" href="transaction_8c.html#aa3f473362dfc51f54a6067de58e7fc2c">breakcycle</a>(&amp;od, cycle);
<a name="l01692"></a>01692       <span class="comment">/* restart with start of cycle */</span>
<a name="l01693"></a>01693       todo.<a class="code" href="struct__Queue.html#abb0696a77174cd23b5f488ad4c7b45d2">count</a> = cycstart + 1;
<a name="l01694"></a>01694     }
<a name="l01695"></a>01695   <a class="code" href="pool_8h.html#ac2855e39d8eaea31be68bd0fd03574b5">POOL_DEBUG</a>(<a class="code" href="pool_8h.html#a9e7c48e08e7b2a51b41e4d6611a02ace">SAT_DEBUG_STATS</a>, <span class="stringliteral">&quot;cycles broken: %d\n&quot;</span>, od.<a class="code" href="structorderdata.html#aded143184ad79a57bbd973d7b5f7a90e">ncycles</a>);
<a name="l01696"></a>01696   <a class="code" href="pool_8h.html#ac2855e39d8eaea31be68bd0fd03574b5">POOL_DEBUG</a>(<a class="code" href="pool_8h.html#a9e7c48e08e7b2a51b41e4d6611a02ace">SAT_DEBUG_STATS</a>, <span class="stringliteral">&quot;cycle breaking took %d ms\n&quot;</span>, <a class="code" href="util_8c.html#a10875c1838f0632aabf1a919135a06ee">sat_timems</a>(now));
<a name="l01697"></a>01697 
<a name="l01698"></a>01698   now = <a class="code" href="util_8c.html#a10875c1838f0632aabf1a919135a06ee">sat_timems</a>(0);
<a name="l01699"></a>01699   <span class="comment">/* now go through all broken cycles and create cycle edges to help</span>
<a name="l01700"></a>01700 <span class="comment">     the ordering */</span>
<a name="l01701"></a>01701    <span class="keywordflow">for</span> (i = od.<a class="code" href="structorderdata.html#a0d5db89a42a09650097dfe8f9e0842f6">cycles</a>.<a class="code" href="struct__Queue.html#abb0696a77174cd23b5f488ad4c7b45d2">count</a> - 3; i &gt;= 0; i -= 3)
<a name="l01702"></a>01702      {
<a name="l01703"></a>01703        <span class="keywordflow">if</span> (od.<a class="code" href="structorderdata.html#a0d5db89a42a09650097dfe8f9e0842f6">cycles</a>.<a class="code" href="struct__Queue.html#a116eb58bed8ff76bf18f9c16cf1ce5c6">elements</a>[i + 2] &gt;= <a class="code" href="transaction_8c.html#a46a79b58e0b40ee48e149ccd71ebf8d3">TYPE_REQ</a>)
<a name="l01704"></a>01704          <a class="code" href="transaction_8c.html#aeb8a796b2010d7575d326c263e5abaf5">addcycleedges</a>(&amp;od, od.<a class="code" href="structorderdata.html#a386d2b53b22a56e672da397cfa970c08">cyclesdata</a>.<a class="code" href="struct__Queue.html#a116eb58bed8ff76bf18f9c16cf1ce5c6">elements</a> + od.<a class="code" href="structorderdata.html#a0d5db89a42a09650097dfe8f9e0842f6">cycles</a>.<a class="code" href="struct__Queue.html#a116eb58bed8ff76bf18f9c16cf1ce5c6">elements</a>[i], &amp;todo);
<a name="l01705"></a>01705      }
<a name="l01706"></a>01706    <span class="keywordflow">for</span> (i = od.<a class="code" href="structorderdata.html#a0d5db89a42a09650097dfe8f9e0842f6">cycles</a>.<a class="code" href="struct__Queue.html#abb0696a77174cd23b5f488ad4c7b45d2">count</a> - 3; i &gt;= 0; i -= 3)
<a name="l01707"></a>01707      {
<a name="l01708"></a>01708        <span class="keywordflow">if</span> (od.<a class="code" href="structorderdata.html#a0d5db89a42a09650097dfe8f9e0842f6">cycles</a>.<a class="code" href="struct__Queue.html#a116eb58bed8ff76bf18f9c16cf1ce5c6">elements</a>[i + 2] &lt; <a class="code" href="transaction_8c.html#a46a79b58e0b40ee48e149ccd71ebf8d3">TYPE_REQ</a>)
<a name="l01709"></a>01709          <a class="code" href="transaction_8c.html#aeb8a796b2010d7575d326c263e5abaf5">addcycleedges</a>(&amp;od, od.<a class="code" href="structorderdata.html#a386d2b53b22a56e672da397cfa970c08">cyclesdata</a>.<a class="code" href="struct__Queue.html#a116eb58bed8ff76bf18f9c16cf1ce5c6">elements</a> + od.<a class="code" href="structorderdata.html#a0d5db89a42a09650097dfe8f9e0842f6">cycles</a>.<a class="code" href="struct__Queue.html#a116eb58bed8ff76bf18f9c16cf1ce5c6">elements</a>[i], &amp;todo);
<a name="l01710"></a>01710      }
<a name="l01711"></a>01711   <a class="code" href="pool_8h.html#ac2855e39d8eaea31be68bd0fd03574b5">POOL_DEBUG</a>(<a class="code" href="pool_8h.html#a9e7c48e08e7b2a51b41e4d6611a02ace">SAT_DEBUG_STATS</a>, <span class="stringliteral">&quot;cycle edge creation took %d ms\n&quot;</span>, <a class="code" href="util_8c.html#a10875c1838f0632aabf1a919135a06ee">sat_timems</a>(now));
<a name="l01712"></a>01712 
<a name="l01713"></a>01713 <span class="preprocessor">#if 0</span>
<a name="l01714"></a>01714 <span class="preprocessor"></span>  <a class="code" href="transaction_8c.html#ad57765f1221cb9ad1f0858b30dc9f88e">dump_tes</a>(&amp;od);
<a name="l01715"></a>01715 <span class="preprocessor">#endif</span>
<a name="l01716"></a>01716 <span class="preprocessor"></span>  <span class="comment">/* all edges are finally set up and there are no cycles, now the easy part.</span>
<a name="l01717"></a>01717 <span class="comment">   * Create an ordered transaction */</span>
<a name="l01718"></a>01718   now = <a class="code" href="util_8c.html#a10875c1838f0632aabf1a919135a06ee">sat_timems</a>(0);
<a name="l01719"></a>01719   <span class="comment">/* first invert all edges */</span>
<a name="l01720"></a>01720   <span class="keywordflow">for</span> (i = 1, te = od.<a class="code" href="structorderdata.html#af2c9ed95d58301c7b395bb8812b5cddf">tes</a> + i; i &lt; numte; i++, te++)
<a name="l01721"></a>01721     te-&gt;<a class="code" href="struct__TransactionElement.html#a9a92730d3d2313a63a0520a9214a9615">mark</a> = 1;       <span class="comment">/* term 0 */</span>
<a name="l01722"></a>01722   <span class="keywordflow">for</span> (i = 1, te = od.<a class="code" href="structorderdata.html#af2c9ed95d58301c7b395bb8812b5cddf">tes</a> + i; i &lt; numte; i++, te++)
<a name="l01723"></a>01723     {
<a name="l01724"></a>01724       <span class="keywordflow">for</span> (j = te-&gt;<a class="code" href="struct__TransactionElement.html#a83c9f82e48799df8c379ecf0d435572e">edges</a>; od.<a class="code" href="structorderdata.html#aa7d6b79cd94b60508b1390d1c299c83c">edgedata</a>[j]; j += 2)
<a name="l01725"></a>01725         {
<a name="l01726"></a>01726           <span class="keywordflow">if</span> ((od.<a class="code" href="structorderdata.html#aa7d6b79cd94b60508b1390d1c299c83c">edgedata</a>[j + 1] &amp; <a class="code" href="transaction_8c.html#addd825a898ef4e1c1c8ec80b0dcc175c">TYPE_BROKEN</a>) != 0)
<a name="l01727"></a>01727             <span class="keywordflow">continue</span>;
<a name="l01728"></a>01728           od.<a class="code" href="structorderdata.html#af2c9ed95d58301c7b395bb8812b5cddf">tes</a>[od.<a class="code" href="structorderdata.html#aa7d6b79cd94b60508b1390d1c299c83c">edgedata</a>[j]].<a class="code" href="struct__TransactionElement.html#a9a92730d3d2313a63a0520a9214a9615">mark</a>++;
<a name="l01729"></a>01729         }
<a name="l01730"></a>01730     }
<a name="l01731"></a>01731   j = 1;
<a name="l01732"></a>01732   <span class="keywordflow">for</span> (i = 1, te = od.<a class="code" href="structorderdata.html#af2c9ed95d58301c7b395bb8812b5cddf">tes</a> + i; i &lt; numte; i++, te++)
<a name="l01733"></a>01733     {
<a name="l01734"></a>01734       te-&gt;<a class="code" href="struct__TransactionElement.html#a9a92730d3d2313a63a0520a9214a9615">mark</a> += j;
<a name="l01735"></a>01735       j = te-&gt;<a class="code" href="struct__TransactionElement.html#a9a92730d3d2313a63a0520a9214a9615">mark</a>;
<a name="l01736"></a>01736     }
<a name="l01737"></a>01737   <a class="code" href="pool_8h.html#ac2855e39d8eaea31be68bd0fd03574b5">POOL_DEBUG</a>(<a class="code" href="pool_8h.html#a9e7c48e08e7b2a51b41e4d6611a02ace">SAT_DEBUG_STATS</a>, <span class="stringliteral">&quot;invedge space: %d\n&quot;</span>, j + 1);
<a name="l01738"></a>01738   od.<a class="code" href="structorderdata.html#a961f78ed70429961291bb497f7251e94">invedgedata</a> = <a class="code" href="util_8c.html#a7964924c069160718b17ac2770d6885d">sat_calloc</a>(j + 1, <span class="keyword">sizeof</span>(<a class="code" href="pooltypes_8h.html#a2e0e6278ac51842ca3aeb53e3fc3ead6">Id</a>));
<a name="l01739"></a>01739   <span class="keywordflow">for</span> (i = 1, te = od.<a class="code" href="structorderdata.html#af2c9ed95d58301c7b395bb8812b5cddf">tes</a> + i; i &lt; numte; i++, te++)
<a name="l01740"></a>01740     {
<a name="l01741"></a>01741       <span class="keywordflow">for</span> (j = te-&gt;<a class="code" href="struct__TransactionElement.html#a83c9f82e48799df8c379ecf0d435572e">edges</a>; od.<a class="code" href="structorderdata.html#aa7d6b79cd94b60508b1390d1c299c83c">edgedata</a>[j]; j += 2)
<a name="l01742"></a>01742         {
<a name="l01743"></a>01743           <span class="keywordflow">if</span> ((od.<a class="code" href="structorderdata.html#aa7d6b79cd94b60508b1390d1c299c83c">edgedata</a>[j + 1] &amp; <a class="code" href="transaction_8c.html#addd825a898ef4e1c1c8ec80b0dcc175c">TYPE_BROKEN</a>) != 0)
<a name="l01744"></a>01744             <span class="keywordflow">continue</span>;
<a name="l01745"></a>01745           od.<a class="code" href="structorderdata.html#a961f78ed70429961291bb497f7251e94">invedgedata</a>[--od.<a class="code" href="structorderdata.html#af2c9ed95d58301c7b395bb8812b5cddf">tes</a>[od.<a class="code" href="structorderdata.html#aa7d6b79cd94b60508b1390d1c299c83c">edgedata</a>[j]].<a class="code" href="struct__TransactionElement.html#a9a92730d3d2313a63a0520a9214a9615">mark</a>] = i;
<a name="l01746"></a>01746         }
<a name="l01747"></a>01747     }
<a name="l01748"></a>01748   <span class="keywordflow">for</span> (i = 1, te = od.<a class="code" href="structorderdata.html#af2c9ed95d58301c7b395bb8812b5cddf">tes</a> + i; i &lt; numte; i++, te++)
<a name="l01749"></a>01749     te-&gt;<a class="code" href="struct__TransactionElement.html#a83c9f82e48799df8c379ecf0d435572e">edges</a> = te-&gt;<a class="code" href="struct__TransactionElement.html#a9a92730d3d2313a63a0520a9214a9615">mark</a>;       <span class="comment">/* edges now points into invedgedata */</span>
<a name="l01750"></a>01750   od.<a class="code" href="structorderdata.html#aa7d6b79cd94b60508b1390d1c299c83c">edgedata</a> = <a class="code" href="util_8c.html#a1f246fae10a89534cfe0583cefb44c11">sat_free</a>(od.<a class="code" href="structorderdata.html#aa7d6b79cd94b60508b1390d1c299c83c">edgedata</a>);
<a name="l01751"></a>01751   od.<a class="code" href="structorderdata.html#a50802367a905a1a9cb41ea8725fb0e8c">nedgedata</a> = j + 1;
<a name="l01752"></a>01752 
<a name="l01753"></a>01753   <span class="comment">/* now the final ordering */</span>
<a name="l01754"></a>01754   <span class="keywordflow">for</span> (i = 1, te = od.<a class="code" href="structorderdata.html#af2c9ed95d58301c7b395bb8812b5cddf">tes</a> + i; i &lt; numte; i++, te++)
<a name="l01755"></a>01755     te-&gt;<a class="code" href="struct__TransactionElement.html#a9a92730d3d2313a63a0520a9214a9615">mark</a> = 0;
<a name="l01756"></a>01756   <span class="keywordflow">for</span> (i = 1, te = od.<a class="code" href="structorderdata.html#af2c9ed95d58301c7b395bb8812b5cddf">tes</a> + i; i &lt; numte; i++, te++)
<a name="l01757"></a>01757     <span class="keywordflow">for</span> (j = te-&gt;<a class="code" href="struct__TransactionElement.html#a83c9f82e48799df8c379ecf0d435572e">edges</a>; od.<a class="code" href="structorderdata.html#a961f78ed70429961291bb497f7251e94">invedgedata</a>[j]; j++)
<a name="l01758"></a>01758       od.<a class="code" href="structorderdata.html#af2c9ed95d58301c7b395bb8812b5cddf">tes</a>[od.<a class="code" href="structorderdata.html#a961f78ed70429961291bb497f7251e94">invedgedata</a>[j]].<a class="code" href="struct__TransactionElement.html#a9a92730d3d2313a63a0520a9214a9615">mark</a>++;
<a name="l01759"></a>01759 
<a name="l01760"></a>01760   <a class="code" href="queue_8c.html#ae1a64f63dd8cc46bdb2bcd415aa89e5a">queue_init</a>(&amp;samerepoq);
<a name="l01761"></a>01761   <a class="code" href="queue_8c.html#ae1a64f63dd8cc46bdb2bcd415aa89e5a">queue_init</a>(&amp;uninstq);
<a name="l01762"></a>01762   <a class="code" href="queue_8h.html#aad3334b89bd00dfaa2d483971bd55a7b">queue_empty</a>(&amp;todo);
<a name="l01763"></a>01763   <span class="keywordflow">for</span> (i = 1, te = od.<a class="code" href="structorderdata.html#af2c9ed95d58301c7b395bb8812b5cddf">tes</a> + i; i &lt; numte; i++, te++)
<a name="l01764"></a>01764     <span class="keywordflow">if</span> (te-&gt;<a class="code" href="struct__TransactionElement.html#a9a92730d3d2313a63a0520a9214a9615">mark</a> == 0)
<a name="l01765"></a>01765       {
<a name="l01766"></a>01766         <span class="keywordflow">if</span> (installed &amp;&amp; pool-&gt;<a class="code" href="struct__Pool.html#a9842c936aa241bad13ba13f21a337319">solvables</a>[te-&gt;<a class="code" href="struct__TransactionElement.html#a15d7a733a882815e8017cab196175090">p</a>].<a class="code" href="struct__Solvable.html#a15e0b77fe061c6429a24215191b10f05">repo</a> == installed)
<a name="l01767"></a>01767           <a class="code" href="queue_8h.html#a3ba172138b6a04f289def63b198057f1">queue_push</a>(&amp;uninstq, i);
<a name="l01768"></a>01768         <span class="keywordflow">else</span>
<a name="l01769"></a>01769           <a class="code" href="queue_8h.html#a3ba172138b6a04f289def63b198057f1">queue_push</a>(&amp;todo, i);
<a name="l01770"></a>01770       }
<a name="l01771"></a>01771   assert(todo.<a class="code" href="struct__Queue.html#abb0696a77174cd23b5f488ad4c7b45d2">count</a> &gt; 0 || uninstq.<a class="code" href="struct__Queue.html#abb0696a77174cd23b5f488ad4c7b45d2">count</a> &gt; 0);
<a name="l01772"></a>01772   oldcount = tr-&gt;<a class="code" href="struct__Queue.html#abb0696a77174cd23b5f488ad4c7b45d2">count</a>;
<a name="l01773"></a>01773   <a class="code" href="queue_8h.html#aad3334b89bd00dfaa2d483971bd55a7b">queue_empty</a>(tr);
<a name="l01774"></a>01774 
<a name="l01775"></a>01775   <a class="code" href="queue_8c.html#ae1a64f63dd8cc46bdb2bcd415aa89e5a">queue_init</a>(&amp;obsq);
<a name="l01776"></a>01776   
<a name="l01777"></a>01777   lastrepo = 0;
<a name="l01778"></a>01778   lastmedia = 0;
<a name="l01779"></a>01779   temedianr = <a class="code" href="util_8c.html#a7964924c069160718b17ac2770d6885d">sat_calloc</a>(numte, <span class="keyword">sizeof</span>(<a class="code" href="pooltypes_8h.html#a2e0e6278ac51842ca3aeb53e3fc3ead6">Id</a>));
<a name="l01780"></a>01780   <span class="keywordflow">for</span> (i = 1; i &lt; numte; i++)
<a name="l01781"></a>01781     {
<a name="l01782"></a>01782       <a class="code" href="struct__Solvable.html">Solvable</a> *s = pool-&gt;<a class="code" href="struct__Pool.html#a9842c936aa241bad13ba13f21a337319">solvables</a> + od.<a class="code" href="structorderdata.html#af2c9ed95d58301c7b395bb8812b5cddf">tes</a>[i].<a class="code" href="struct__TransactionElement.html#a15d7a733a882815e8017cab196175090">p</a>;
<a name="l01783"></a>01783       <span class="keywordflow">if</span> (installed &amp;&amp; s-&gt;<a class="code" href="struct__Solvable.html#a15e0b77fe061c6429a24215191b10f05">repo</a> == installed)
<a name="l01784"></a>01784         j = 1;
<a name="l01785"></a>01785       <span class="keywordflow">else</span>
<a name="l01786"></a>01786         j = <a class="code" href="pool_8h.html#a441b6e6c581a991a6f2b7abf40a5639a">solvable_lookup_num</a>(s, SOLVABLE_MEDIANR, 1);
<a name="l01787"></a>01787       temedianr[i] = j;
<a name="l01788"></a>01788     }
<a name="l01789"></a>01789   <span class="keywordflow">for</span> (;;)
<a name="l01790"></a>01790     {
<a name="l01791"></a>01791       <span class="comment">/* select an TE i */</span>
<a name="l01792"></a>01792       <span class="keywordflow">if</span> (uninstq.<a class="code" href="struct__Queue.html#abb0696a77174cd23b5f488ad4c7b45d2">count</a>)
<a name="l01793"></a>01793         i = <a class="code" href="queue_8h.html#af7209659c6135ca3573c32a375b417b0">queue_shift</a>(&amp;uninstq);
<a name="l01794"></a>01794       <span class="keywordflow">else</span> <span class="keywordflow">if</span> (samerepoq.<a class="code" href="struct__Queue.html#abb0696a77174cd23b5f488ad4c7b45d2">count</a>)
<a name="l01795"></a>01795         i = <a class="code" href="queue_8h.html#af7209659c6135ca3573c32a375b417b0">queue_shift</a>(&amp;samerepoq);
<a name="l01796"></a>01796       <span class="keywordflow">else</span> <span class="keywordflow">if</span> (todo.<a class="code" href="struct__Queue.html#abb0696a77174cd23b5f488ad4c7b45d2">count</a>)
<a name="l01797"></a>01797         {
<a name="l01798"></a>01798           <span class="comment">/* find next repo/media */</span>
<a name="l01799"></a>01799           <span class="keywordflow">for</span> (j = 0; j &lt; todo.<a class="code" href="struct__Queue.html#abb0696a77174cd23b5f488ad4c7b45d2">count</a>; j++)
<a name="l01800"></a>01800             {
<a name="l01801"></a>01801               <span class="keywordflow">if</span> (!j || temedianr[todo.<a class="code" href="struct__Queue.html#a116eb58bed8ff76bf18f9c16cf1ce5c6">elements</a>[j]] &lt; lastmedia)
<a name="l01802"></a>01802                 {
<a name="l01803"></a>01803                   i = j;
<a name="l01804"></a>01804                   lastmedia = temedianr[todo.<a class="code" href="struct__Queue.html#a116eb58bed8ff76bf18f9c16cf1ce5c6">elements</a>[j]];
<a name="l01805"></a>01805                 }
<a name="l01806"></a>01806             }
<a name="l01807"></a>01807           lastrepo = pool-&gt;<a class="code" href="struct__Pool.html#a9842c936aa241bad13ba13f21a337319">solvables</a>[od.<a class="code" href="structorderdata.html#af2c9ed95d58301c7b395bb8812b5cddf">tes</a>[todo.<a class="code" href="struct__Queue.html#a116eb58bed8ff76bf18f9c16cf1ce5c6">elements</a>[i]].<a class="code" href="struct__TransactionElement.html#a15d7a733a882815e8017cab196175090">p</a>].<a class="code" href="struct__Solvable.html#a15e0b77fe061c6429a24215191b10f05">repo</a>;
<a name="l01808"></a>01808 
<a name="l01809"></a>01809           <span class="comment">/* move all matching TEs to samerepoq */</span>
<a name="l01810"></a>01810           <span class="keywordflow">for</span> (i = j = 0; j &lt; todo.<a class="code" href="struct__Queue.html#abb0696a77174cd23b5f488ad4c7b45d2">count</a>; j++)
<a name="l01811"></a>01811             {
<a name="l01812"></a>01812               <span class="keywordtype">int</span> k = todo.<a class="code" href="struct__Queue.html#a116eb58bed8ff76bf18f9c16cf1ce5c6">elements</a>[j];
<a name="l01813"></a>01813               <span class="keywordflow">if</span> (temedianr[k] == lastmedia &amp;&amp; pool-&gt;<a class="code" href="struct__Pool.html#a9842c936aa241bad13ba13f21a337319">solvables</a>[od.<a class="code" href="structorderdata.html#af2c9ed95d58301c7b395bb8812b5cddf">tes</a>[k].<a class="code" href="struct__TransactionElement.html#a15d7a733a882815e8017cab196175090">p</a>].<a class="code" href="struct__Solvable.html#a15e0b77fe061c6429a24215191b10f05">repo</a> == lastrepo)
<a name="l01814"></a>01814                 <a class="code" href="queue_8h.html#a3ba172138b6a04f289def63b198057f1">queue_push</a>(&amp;samerepoq, k);
<a name="l01815"></a>01815               <span class="keywordflow">else</span>
<a name="l01816"></a>01816                 todo.<a class="code" href="struct__Queue.html#a116eb58bed8ff76bf18f9c16cf1ce5c6">elements</a>[i++] = k;
<a name="l01817"></a>01817             }
<a name="l01818"></a>01818           todo.<a class="code" href="struct__Queue.html#abb0696a77174cd23b5f488ad4c7b45d2">count</a> = i;
<a name="l01819"></a>01819 
<a name="l01820"></a>01820           assert(samerepoq.<a class="code" href="struct__Queue.html#abb0696a77174cd23b5f488ad4c7b45d2">count</a>);
<a name="l01821"></a>01821           i = <a class="code" href="queue_8h.html#af7209659c6135ca3573c32a375b417b0">queue_shift</a>(&amp;samerepoq);
<a name="l01822"></a>01822         }
<a name="l01823"></a>01823       <span class="keywordflow">else</span>
<a name="l01824"></a>01824         <span class="keywordflow">break</span>;
<a name="l01825"></a>01825 
<a name="l01826"></a>01826       te = od.<a class="code" href="structorderdata.html#af2c9ed95d58301c7b395bb8812b5cddf">tes</a> + i;
<a name="l01827"></a>01827       <a class="code" href="queue_8h.html#a3ba172138b6a04f289def63b198057f1">queue_push</a>(tr, te-&gt;<a class="code" href="struct__TransactionElement.html#a15d7a733a882815e8017cab196175090">p</a>);
<a name="l01828"></a>01828 <span class="preprocessor">#if 0</span>
<a name="l01829"></a>01829 <span class="preprocessor"></span>printf(<span class="stringliteral">&quot;do %s [%d]\n&quot;</span>, <a class="code" href="pool_8h.html#adf35a6568989887a7ca04422cf6fec98">solvid2str</a>(pool, te-&gt;<a class="code" href="struct__TransactionElement.html#a15d7a733a882815e8017cab196175090">p</a>), temedianr[i]);
<a name="l01830"></a>01830 <span class="preprocessor">#endif</span>
<a name="l01831"></a>01831 <span class="preprocessor"></span>      s = pool-&gt;<a class="code" href="struct__Pool.html#a9842c936aa241bad13ba13f21a337319">solvables</a> + te-&gt;<a class="code" href="struct__TransactionElement.html#a15d7a733a882815e8017cab196175090">p</a>;
<a name="l01832"></a>01832       <span class="keywordflow">for</span> (j = te-&gt;<a class="code" href="struct__TransactionElement.html#a83c9f82e48799df8c379ecf0d435572e">edges</a>; od.<a class="code" href="structorderdata.html#a961f78ed70429961291bb497f7251e94">invedgedata</a>[j]; j++)
<a name="l01833"></a>01833         {
<a name="l01834"></a>01834           <span class="keyword">struct </span><a class="code" href="struct__TransactionElement.html">_TransactionElement</a> *te2 = od.<a class="code" href="structorderdata.html#af2c9ed95d58301c7b395bb8812b5cddf">tes</a> + od.<a class="code" href="structorderdata.html#a961f78ed70429961291bb497f7251e94">invedgedata</a>[j];
<a name="l01835"></a>01835           assert(te2-&gt;<a class="code" href="struct__TransactionElement.html#a9a92730d3d2313a63a0520a9214a9615">mark</a> &gt; 0);
<a name="l01836"></a>01836           <span class="keywordflow">if</span> (--te2-&gt;<a class="code" href="struct__TransactionElement.html#a9a92730d3d2313a63a0520a9214a9615">mark</a> == 0)
<a name="l01837"></a>01837             {
<a name="l01838"></a>01838               <a class="code" href="struct__Solvable.html">Solvable</a> *s = pool-&gt;<a class="code" href="struct__Pool.html#a9842c936aa241bad13ba13f21a337319">solvables</a> + te2-&gt;<a class="code" href="struct__TransactionElement.html#a15d7a733a882815e8017cab196175090">p</a>;
<a name="l01839"></a>01839 <span class="preprocessor">#if 0</span>
<a name="l01840"></a>01840 <span class="preprocessor"></span>printf(<span class="stringliteral">&quot;free %s [%d]\n&quot;</span>, <a class="code" href="pool_8h.html#adf35a6568989887a7ca04422cf6fec98">solvid2str</a>(pool, te2-&gt;<a class="code" href="struct__TransactionElement.html#a15d7a733a882815e8017cab196175090">p</a>), temedianr[od.<a class="code" href="structorderdata.html#a961f78ed70429961291bb497f7251e94">invedgedata</a>[j]]);
<a name="l01841"></a>01841 <span class="preprocessor">#endif</span>
<a name="l01842"></a>01842 <span class="preprocessor"></span>              <span class="keywordflow">if</span> (installed &amp;&amp; s-&gt;<a class="code" href="struct__Solvable.html#a15e0b77fe061c6429a24215191b10f05">repo</a> == installed)
<a name="l01843"></a>01843                 <a class="code" href="queue_8h.html#a3ba172138b6a04f289def63b198057f1">queue_push</a>(&amp;uninstq, od.<a class="code" href="structorderdata.html#a961f78ed70429961291bb497f7251e94">invedgedata</a>[j]);
<a name="l01844"></a>01844               <span class="keywordflow">else</span> <span class="keywordflow">if</span> (s-&gt;<a class="code" href="struct__Solvable.html#a15e0b77fe061c6429a24215191b10f05">repo</a> == lastrepo &amp;&amp; temedianr[od.<a class="code" href="structorderdata.html#a961f78ed70429961291bb497f7251e94">invedgedata</a>[j]] == lastmedia)
<a name="l01845"></a>01845                 <a class="code" href="queue_8h.html#a3ba172138b6a04f289def63b198057f1">queue_push</a>(&amp;samerepoq, od.<a class="code" href="structorderdata.html#a961f78ed70429961291bb497f7251e94">invedgedata</a>[j]);
<a name="l01846"></a>01846               <span class="keywordflow">else</span>
<a name="l01847"></a>01847                 <a class="code" href="queue_8h.html#a3ba172138b6a04f289def63b198057f1">queue_push</a>(&amp;todo, od.<a class="code" href="structorderdata.html#a961f78ed70429961291bb497f7251e94">invedgedata</a>[j]);
<a name="l01848"></a>01848             }
<a name="l01849"></a>01849         }
<a name="l01850"></a>01850     }
<a name="l01851"></a>01851   <a class="code" href="util_8c.html#a1f246fae10a89534cfe0583cefb44c11">sat_free</a>(temedianr);
<a name="l01852"></a>01852   <a class="code" href="queue_8c.html#a701c81a9f7d503837e74d43981e79137">queue_free</a>(&amp;todo);
<a name="l01853"></a>01853   <a class="code" href="queue_8c.html#a701c81a9f7d503837e74d43981e79137">queue_free</a>(&amp;samerepoq);
<a name="l01854"></a>01854   <a class="code" href="queue_8c.html#a701c81a9f7d503837e74d43981e79137">queue_free</a>(&amp;uninstq);
<a name="l01855"></a>01855   <a class="code" href="queue_8c.html#a701c81a9f7d503837e74d43981e79137">queue_free</a>(&amp;obsq);
<a name="l01856"></a>01856   <span class="keywordflow">for</span> (i = 1, te = od.<a class="code" href="structorderdata.html#af2c9ed95d58301c7b395bb8812b5cddf">tes</a> + i; i &lt; numte; i++, te++)
<a name="l01857"></a>01857     assert(te-&gt;<a class="code" href="struct__TransactionElement.html#a9a92730d3d2313a63a0520a9214a9615">mark</a> == 0);
<a name="l01858"></a>01858 
<a name="l01859"></a>01859   <span class="comment">/* add back obsoleted packages */</span>
<a name="l01860"></a>01860   <a class="code" href="transaction_8c.html#ac4869604b601cb1979410d4565cd1619">transaction_add_obsoleted</a>(trans);
<a name="l01861"></a>01861   assert(tr-&gt;<a class="code" href="struct__Queue.html#abb0696a77174cd23b5f488ad4c7b45d2">count</a> == oldcount);
<a name="l01862"></a>01862 
<a name="l01863"></a>01863   <a class="code" href="pool_8h.html#ac2855e39d8eaea31be68bd0fd03574b5">POOL_DEBUG</a>(<a class="code" href="pool_8h.html#a9e7c48e08e7b2a51b41e4d6611a02ace">SAT_DEBUG_STATS</a>, <span class="stringliteral">&quot;creating new transaction took %d ms\n&quot;</span>, <a class="code" href="util_8c.html#a10875c1838f0632aabf1a919135a06ee">sat_timems</a>(now));
<a name="l01864"></a>01864   <a class="code" href="pool_8h.html#ac2855e39d8eaea31be68bd0fd03574b5">POOL_DEBUG</a>(<a class="code" href="pool_8h.html#a9e7c48e08e7b2a51b41e4d6611a02ace">SAT_DEBUG_STATS</a>, <span class="stringliteral">&quot;transaction ordering took %d ms\n&quot;</span>, <a class="code" href="util_8c.html#a10875c1838f0632aabf1a919135a06ee">sat_timems</a>(start));
<a name="l01865"></a>01865 
<a name="l01866"></a>01866   <span class="keywordflow">if</span> ((flags &amp; <a class="code" href="transaction_8h.html#a29b59571c3f42cd1a01d486d9a793a07">SOLVER_TRANSACTION_KEEP_ORDERDATA</a>) != 0)
<a name="l01867"></a>01867     {
<a name="l01868"></a>01868       trans-&gt;<a class="code" href="struct__Transaction.html#a7d6f72d061b26666810132daa1937fa3">orderdata</a> = <a class="code" href="util_8c.html#a7964924c069160718b17ac2770d6885d">sat_calloc</a>(1, <span class="keyword">sizeof</span>(*trans-&gt;<a class="code" href="struct__Transaction.html#a7d6f72d061b26666810132daa1937fa3">orderdata</a>));
<a name="l01869"></a>01869       trans-&gt;<a class="code" href="struct__Transaction.html#a7d6f72d061b26666810132daa1937fa3">orderdata</a>-&gt;<a class="code" href="struct__TransactionOrderdata.html#a434565f1766b3f2d4de59ad7d38338eb">tes</a> = od.<a class="code" href="structorderdata.html#af2c9ed95d58301c7b395bb8812b5cddf">tes</a>;
<a name="l01870"></a>01870       trans-&gt;<a class="code" href="struct__Transaction.html#a7d6f72d061b26666810132daa1937fa3">orderdata</a>-&gt;<a class="code" href="struct__TransactionOrderdata.html#a1341a51bc715ad00740aa4fc4e0965d9">ntes</a> = numte;
<a name="l01871"></a>01871       trans-&gt;<a class="code" href="struct__Transaction.html#a7d6f72d061b26666810132daa1937fa3">orderdata</a>-&gt;<a class="code" href="struct__TransactionOrderdata.html#aa04948eac0d951e1c56004b06e8cc101">invedgedata</a> = od.<a class="code" href="structorderdata.html#a961f78ed70429961291bb497f7251e94">invedgedata</a>;
<a name="l01872"></a>01872       trans-&gt;<a class="code" href="struct__Transaction.html#a7d6f72d061b26666810132daa1937fa3">orderdata</a>-&gt;<a class="code" href="struct__TransactionOrderdata.html#a8816e5b8bd23a05d6a73dcee3aa3c26b">ninvedgedata</a> = od.<a class="code" href="structorderdata.html#a50802367a905a1a9cb41ea8725fb0e8c">nedgedata</a>;
<a name="l01873"></a>01873     }
<a name="l01874"></a>01874   <span class="keywordflow">else</span>
<a name="l01875"></a>01875     {
<a name="l01876"></a>01876       <a class="code" href="util_8c.html#a1f246fae10a89534cfe0583cefb44c11">sat_free</a>(od.<a class="code" href="structorderdata.html#af2c9ed95d58301c7b395bb8812b5cddf">tes</a>);
<a name="l01877"></a>01877       <a class="code" href="util_8c.html#a1f246fae10a89534cfe0583cefb44c11">sat_free</a>(od.<a class="code" href="structorderdata.html#a961f78ed70429961291bb497f7251e94">invedgedata</a>);
<a name="l01878"></a>01878     }
<a name="l01879"></a>01879 }
<a name="l01880"></a>01880 
<a name="l01881"></a>01881 
<a name="l01882"></a>01882 <span class="keywordtype">int</span>
<a name="l01883"></a><a class="code" href="transaction_8h.html#a86104171e947f81c7434bbe861f503c0">01883</a> <a class="code" href="transaction_8c.html#a86104171e947f81c7434bbe861f503c0">transaction_order_add_choices</a>(<a class="code" href="struct__Transaction.html">Transaction</a> *trans, <a class="code" href="pooltypes_8h.html#a2e0e6278ac51842ca3aeb53e3fc3ead6">Id</a> chosen, <a class="code" href="struct__Queue.html">Queue</a> *choices)
<a name="l01884"></a>01884 {
<a name="l01885"></a>01885   <span class="keywordtype">int</span> i, j;
<a name="l01886"></a>01886   <span class="keyword">struct </span><a class="code" href="struct__TransactionOrderdata.html">_TransactionOrderdata</a> *od = trans-&gt;<a class="code" href="struct__Transaction.html#a7d6f72d061b26666810132daa1937fa3">orderdata</a>;
<a name="l01887"></a>01887   <span class="keyword">struct </span><a class="code" href="struct__TransactionElement.html">_TransactionElement</a> *te;
<a name="l01888"></a>01888 
<a name="l01889"></a>01889   <span class="keywordflow">if</span> (!od)
<a name="l01890"></a>01890      <span class="keywordflow">return</span> choices-&gt;<a class="code" href="struct__Queue.html#abb0696a77174cd23b5f488ad4c7b45d2">count</a>;
<a name="l01891"></a>01891   <span class="keywordflow">if</span> (!chosen)
<a name="l01892"></a>01892     {
<a name="l01893"></a>01893       <span class="comment">/* initialization step */</span>
<a name="l01894"></a>01894       <span class="keywordflow">for</span> (i = 1, te = od-&gt;<a class="code" href="struct__TransactionOrderdata.html#a434565f1766b3f2d4de59ad7d38338eb">tes</a> + i; i &lt; od-&gt;ntes; i++, te++)
<a name="l01895"></a>01895         te-&gt;<a class="code" href="struct__TransactionElement.html#a9a92730d3d2313a63a0520a9214a9615">mark</a> = 0;
<a name="l01896"></a>01896       <span class="keywordflow">for</span> (i = 1, te = od-&gt;<a class="code" href="struct__TransactionOrderdata.html#a434565f1766b3f2d4de59ad7d38338eb">tes</a> + i; i &lt; od-&gt;ntes; i++, te++)
<a name="l01897"></a>01897         {
<a name="l01898"></a>01898           <span class="keywordflow">for</span> (j = te-&gt;<a class="code" href="struct__TransactionElement.html#a83c9f82e48799df8c379ecf0d435572e">edges</a>; od-&gt;<a class="code" href="struct__TransactionOrderdata.html#aa04948eac0d951e1c56004b06e8cc101">invedgedata</a>[j]; j++)
<a name="l01899"></a>01899             od-&gt;<a class="code" href="struct__TransactionOrderdata.html#a434565f1766b3f2d4de59ad7d38338eb">tes</a>[od-&gt;<a class="code" href="struct__TransactionOrderdata.html#aa04948eac0d951e1c56004b06e8cc101">invedgedata</a>[j]].<a class="code" href="struct__TransactionElement.html#a9a92730d3d2313a63a0520a9214a9615">mark</a>++;
<a name="l01900"></a>01900         }
<a name="l01901"></a>01901       <span class="keywordflow">for</span> (i = 1, te = od-&gt;<a class="code" href="struct__TransactionOrderdata.html#a434565f1766b3f2d4de59ad7d38338eb">tes</a> + i; i &lt; od-&gt;ntes; i++, te++)
<a name="l01902"></a>01902         <span class="keywordflow">if</span> (!te-&gt;<a class="code" href="struct__TransactionElement.html#a9a92730d3d2313a63a0520a9214a9615">mark</a>)
<a name="l01903"></a>01903           <a class="code" href="queue_8h.html#a3ba172138b6a04f289def63b198057f1">queue_push</a>(choices, te-&gt;<a class="code" href="struct__TransactionElement.html#a15d7a733a882815e8017cab196175090">p</a>);
<a name="l01904"></a>01904       <span class="keywordflow">return</span> choices-&gt;<a class="code" href="struct__Queue.html#abb0696a77174cd23b5f488ad4c7b45d2">count</a>;
<a name="l01905"></a>01905     }
<a name="l01906"></a>01906   <span class="keywordflow">for</span> (i = 1, te = od-&gt;<a class="code" href="struct__TransactionOrderdata.html#a434565f1766b3f2d4de59ad7d38338eb">tes</a> + i; i &lt; od-&gt;ntes; i++, te++)
<a name="l01907"></a>01907     <span class="keywordflow">if</span> (te-&gt;<a class="code" href="struct__TransactionElement.html#a15d7a733a882815e8017cab196175090">p</a> == chosen)
<a name="l01908"></a>01908       <span class="keywordflow">break</span>;
<a name="l01909"></a>01909   <span class="keywordflow">if</span> (i == od-&gt;<a class="code" href="struct__TransactionOrderdata.html#a1341a51bc715ad00740aa4fc4e0965d9">ntes</a>)
<a name="l01910"></a>01910     <span class="keywordflow">return</span> choices-&gt;<a class="code" href="struct__Queue.html#abb0696a77174cd23b5f488ad4c7b45d2">count</a>;
<a name="l01911"></a>01911   <span class="keywordflow">if</span> (te-&gt;<a class="code" href="struct__TransactionElement.html#a9a92730d3d2313a63a0520a9214a9615">mark</a> &gt; 0)
<a name="l01912"></a>01912     {
<a name="l01913"></a>01913       <span class="comment">/* hey! out-of-order installation! */</span>
<a name="l01914"></a>01914       te-&gt;<a class="code" href="struct__TransactionElement.html#a9a92730d3d2313a63a0520a9214a9615">mark</a> = -1;
<a name="l01915"></a>01915     }
<a name="l01916"></a>01916   <span class="keywordflow">for</span> (j = te-&gt;<a class="code" href="struct__TransactionElement.html#a83c9f82e48799df8c379ecf0d435572e">edges</a>; od-&gt;<a class="code" href="struct__TransactionOrderdata.html#aa04948eac0d951e1c56004b06e8cc101">invedgedata</a>[j]; j++)
<a name="l01917"></a>01917     {
<a name="l01918"></a>01918       te = od-&gt;<a class="code" href="struct__TransactionOrderdata.html#a434565f1766b3f2d4de59ad7d38338eb">tes</a> + od-&gt;<a class="code" href="struct__TransactionOrderdata.html#aa04948eac0d951e1c56004b06e8cc101">invedgedata</a>[j];
<a name="l01919"></a>01919       assert(te-&gt;<a class="code" href="struct__TransactionElement.html#a9a92730d3d2313a63a0520a9214a9615">mark</a> &gt; 0 || te-&gt;<a class="code" href="struct__TransactionElement.html#a9a92730d3d2313a63a0520a9214a9615">mark</a> == -1);
<a name="l01920"></a>01920       <span class="keywordflow">if</span> (te-&gt;<a class="code" href="struct__TransactionElement.html#a9a92730d3d2313a63a0520a9214a9615">mark</a> &gt; 0 &amp;&amp; --te-&gt;<a class="code" href="struct__TransactionElement.html#a9a92730d3d2313a63a0520a9214a9615">mark</a> == 0)
<a name="l01921"></a>01921         <a class="code" href="queue_8h.html#a3ba172138b6a04f289def63b198057f1">queue_push</a>(choices, te-&gt;<a class="code" href="struct__TransactionElement.html#a15d7a733a882815e8017cab196175090">p</a>);
<a name="l01922"></a>01922     }
<a name="l01923"></a>01923   <span class="keywordflow">return</span> choices-&gt;<a class="code" href="struct__Queue.html#abb0696a77174cd23b5f488ad4c7b45d2">count</a>;
<a name="l01924"></a>01924 }
<a name="l01925"></a>01925 
<a name="l01926"></a>01926 <span class="keywordtype">void</span>
<a name="l01927"></a><a class="code" href="transaction_8h.html#ac4869604b601cb1979410d4565cd1619">01927</a> <a class="code" href="transaction_8c.html#ac4869604b601cb1979410d4565cd1619">transaction_add_obsoleted</a>(<a class="code" href="struct__Transaction.html">Transaction</a> *trans)
<a name="l01928"></a>01928 {
<a name="l01929"></a>01929   <a class="code" href="struct__Pool.html">Pool</a> *pool = trans-&gt;<a class="code" href="struct__Transaction.html#aeec1bcea114aa72e7c8005b8e08a369b">pool</a>;
<a name="l01930"></a>01930   <a class="code" href="struct__Repo.html">Repo</a> *installed = pool-&gt;<a class="code" href="struct__Pool.html#a887053f905054298cd61ce1c99e26690">installed</a>;
<a name="l01931"></a>01931   <a class="code" href="pooltypes_8h.html#a2e0e6278ac51842ca3aeb53e3fc3ead6">Id</a> <a class="code" href="struct__TransactionElement.html#a15d7a733a882815e8017cab196175090">p</a>;
<a name="l01932"></a>01932   <a class="code" href="struct__Solvable.html">Solvable</a> *s;
<a name="l01933"></a>01933   <span class="keywordtype">int</span> i, j, k, max, oldcount;
<a name="l01934"></a>01934   <a class="code" href="struct__Map.html">Map</a> done;
<a name="l01935"></a>01935   <a class="code" href="struct__Queue.html">Queue</a> obsq, *steps;
<a name="l01936"></a>01936 
<a name="l01937"></a>01937   <span class="keywordflow">if</span> (!installed || !trans-&gt;<a class="code" href="struct__Transaction.html#a7e05d837578f51e0a26658a2ae37fc4d">steps</a>.<a class="code" href="struct__Queue.html#abb0696a77174cd23b5f488ad4c7b45d2">count</a>)
<a name="l01938"></a>01938     <span class="keywordflow">return</span>;
<a name="l01939"></a>01939   <span class="comment">/* calculate upper bound */</span>
<a name="l01940"></a>01940   max = 0;
<a name="l01941"></a>01941   <a class="code" href="repo_8h.html#ad2d411118e6dc06fdd38f7ec68c3bb32">FOR_REPO_SOLVABLES</a>(installed, p, s)
<a name="l01942"></a>01942     <span class="keywordflow">if</span> (<a class="code" href="bitmap_8h.html#ad8ccb9ad3a8ad65f5fe08a988acc503d">MAPTST</a>(&amp;trans-&gt;<a class="code" href="struct__Transaction.html#ac0d758cc5496d3cfe62b8c890d21a47b">transactsmap</a>, p))
<a name="l01943"></a>01943       max++;
<a name="l01944"></a>01944   <span class="keywordflow">if</span> (!max)
<a name="l01945"></a>01945     <span class="keywordflow">return</span>;
<a name="l01946"></a>01946   <span class="comment">/* make room */</span>
<a name="l01947"></a>01947   steps = &amp;trans-&gt;<a class="code" href="struct__Transaction.html#a7e05d837578f51e0a26658a2ae37fc4d">steps</a>;
<a name="l01948"></a>01948   oldcount = steps-&gt;<a class="code" href="struct__Queue.html#abb0696a77174cd23b5f488ad4c7b45d2">count</a>;
<a name="l01949"></a>01949   <a class="code" href="queue_8c.html#a7562085f8877e63b592c4f109b94eebb">queue_insertn</a>(steps, 0, max);
<a name="l01950"></a>01950 
<a name="l01951"></a>01951   <span class="comment">/* now add em */</span>
<a name="l01952"></a>01952   <a class="code" href="bitmap_8c.html#a8d8010a0f9f491483c12e83ae3a9082e">map_init</a>(&amp;done, installed-&gt;<a class="code" href="struct__Repo.html#aca3e16cc200b9c236963f56bf038a7bc">end</a> - installed-&gt;<a class="code" href="struct__Repo.html#a4eb2dd93e4a4f88f13d462f2f111e038">start</a>);
<a name="l01953"></a>01953   <a class="code" href="queue_8c.html#ae1a64f63dd8cc46bdb2bcd415aa89e5a">queue_init</a>(&amp;obsq);
<a name="l01954"></a>01954   <span class="keywordflow">for</span> (j = 0, i = max; i &lt; steps-&gt;<a class="code" href="struct__Queue.html#abb0696a77174cd23b5f488ad4c7b45d2">count</a>; i++)
<a name="l01955"></a>01955     {
<a name="l01956"></a>01956       p = trans-&gt;<a class="code" href="struct__Transaction.html#a7e05d837578f51e0a26658a2ae37fc4d">steps</a>.<a class="code" href="struct__Queue.html#a116eb58bed8ff76bf18f9c16cf1ce5c6">elements</a>[i];
<a name="l01957"></a>01957       <span class="keywordflow">if</span> (pool-&gt;<a class="code" href="struct__Pool.html#a9842c936aa241bad13ba13f21a337319">solvables</a>[p].<a class="code" href="struct__Solvable.html#a15e0b77fe061c6429a24215191b10f05">repo</a> == installed)
<a name="l01958"></a>01958         {
<a name="l01959"></a>01959           <span class="keywordflow">if</span> (!trans-&gt;<a class="code" href="struct__Transaction.html#a592881da1d794d3ea60272a3938d4bf0">transaction_installed</a>[p - pool-&gt;<a class="code" href="struct__Pool.html#a887053f905054298cd61ce1c99e26690">installed</a>-&gt;<a class="code" href="struct__Repo.html#a4eb2dd93e4a4f88f13d462f2f111e038">start</a>])
<a name="l01960"></a>01960             trans-&gt;<a class="code" href="struct__Transaction.html#a7e05d837578f51e0a26658a2ae37fc4d">steps</a>.<a class="code" href="struct__Queue.html#a116eb58bed8ff76bf18f9c16cf1ce5c6">elements</a>[j++] = p;
<a name="l01961"></a>01961           <span class="keywordflow">continue</span>;
<a name="l01962"></a>01962         }
<a name="l01963"></a>01963       trans-&gt;<a class="code" href="struct__Transaction.html#a7e05d837578f51e0a26658a2ae37fc4d">steps</a>.<a class="code" href="struct__Queue.html#a116eb58bed8ff76bf18f9c16cf1ce5c6">elements</a>[j++] = p;
<a name="l01964"></a>01964       <a class="code" href="queue_8h.html#aad3334b89bd00dfaa2d483971bd55a7b">queue_empty</a>(&amp;obsq);
<a name="l01965"></a>01965       <a class="code" href="transaction_8c.html#aaa33152cda972dad9f684b64e376ea05">transaction_all_obs_pkgs</a>(trans, p, &amp;obsq);
<a name="l01966"></a>01966       <span class="keywordflow">for</span> (k = 0; k &lt; obsq.<a class="code" href="struct__Queue.html#abb0696a77174cd23b5f488ad4c7b45d2">count</a>; k++)
<a name="l01967"></a>01967         {
<a name="l01968"></a>01968           p = obsq.<a class="code" href="struct__Queue.html#a116eb58bed8ff76bf18f9c16cf1ce5c6">elements</a>[k];
<a name="l01969"></a>01969           assert(p &gt;= installed-&gt;<a class="code" href="struct__Repo.html#a4eb2dd93e4a4f88f13d462f2f111e038">start</a> &amp;&amp; p &lt; installed-&gt;end);
<a name="l01970"></a>01970           <span class="keywordflow">if</span> (<a class="code" href="bitmap_8h.html#ad8ccb9ad3a8ad65f5fe08a988acc503d">MAPTST</a>(&amp;done, p - installed-&gt;<a class="code" href="struct__Repo.html#a4eb2dd93e4a4f88f13d462f2f111e038">start</a>))
<a name="l01971"></a>01971             <span class="keywordflow">continue</span>;
<a name="l01972"></a>01972           <a class="code" href="bitmap_8h.html#a33557e357513f5b3faef527bb320183c">MAPSET</a>(&amp;done, p - installed-&gt;<a class="code" href="struct__Repo.html#a4eb2dd93e4a4f88f13d462f2f111e038">start</a>);
<a name="l01973"></a>01973           trans-&gt;<a class="code" href="struct__Transaction.html#a7e05d837578f51e0a26658a2ae37fc4d">steps</a>.<a class="code" href="struct__Queue.html#a116eb58bed8ff76bf18f9c16cf1ce5c6">elements</a>[j++] = p;
<a name="l01974"></a>01974         }
<a name="l01975"></a>01975     }
<a name="l01976"></a>01976 
<a name="l01977"></a>01977   <span class="comment">/* free unneeded space */</span>
<a name="l01978"></a>01978   <a class="code" href="queue_8h.html#a3d44295bc0a7c18851544ee537f4e07a">queue_truncate</a>(steps, j);
<a name="l01979"></a>01979   <a class="code" href="bitmap_8c.html#a85426cea64351e7b4477370824ddd75f">map_free</a>(&amp;done);
<a name="l01980"></a>01980   <a class="code" href="queue_8c.html#a701c81a9f7d503837e74d43981e79137">queue_free</a>(&amp;obsq);
<a name="l01981"></a>01981 }
<a name="l01982"></a>01982 
<a name="l01983"></a>01983 <span class="keyword">static</span> <span class="keywordtype">void</span>
<a name="l01984"></a><a class="code" href="transaction_8c.html#aac5adfefdc0120dcd2073a0eaded7270">01984</a> <a class="code" href="transaction_8c.html#aac5adfefdc0120dcd2073a0eaded7270">transaction_check_pkg</a>(<a class="code" href="struct__Transaction.html">Transaction</a> *trans, <a class="code" href="pooltypes_8h.html#a2e0e6278ac51842ca3aeb53e3fc3ead6">Id</a> tepkg, <a class="code" href="pooltypes_8h.html#a2e0e6278ac51842ca3aeb53e3fc3ead6">Id</a> pkg, <a class="code" href="struct__Map.html">Map</a> *ins, <a class="code" href="struct__Map.html">Map</a> *seen, <span class="keywordtype">int</span> onlyprereq, <a class="code" href="pooltypes_8h.html#a2e0e6278ac51842ca3aeb53e3fc3ead6">Id</a> noconfpkg, <span class="keywordtype">int</span> depth)
<a name="l01985"></a>01985 {
<a name="l01986"></a>01986   <a class="code" href="struct__Pool.html">Pool</a> *pool = trans-&gt;<a class="code" href="struct__Transaction.html#aeec1bcea114aa72e7c8005b8e08a369b">pool</a>;
<a name="l01987"></a>01987   <a class="code" href="pooltypes_8h.html#a2e0e6278ac51842ca3aeb53e3fc3ead6">Id</a> <a class="code" href="struct__TransactionElement.html#a15d7a733a882815e8017cab196175090">p</a>, pp;
<a name="l01988"></a>01988   <a class="code" href="struct__Solvable.html">Solvable</a> *s;
<a name="l01989"></a>01989   <span class="keywordtype">int</span> good;
<a name="l01990"></a>01990 
<a name="l01991"></a>01991   <span class="keywordflow">if</span> (<a class="code" href="bitmap_8h.html#ad8ccb9ad3a8ad65f5fe08a988acc503d">MAPTST</a>(seen, pkg))
<a name="l01992"></a>01992     <span class="keywordflow">return</span>;
<a name="l01993"></a>01993   <a class="code" href="bitmap_8h.html#a33557e357513f5b3faef527bb320183c">MAPSET</a>(seen, pkg);
<a name="l01994"></a>01994   s = pool-&gt;<a class="code" href="struct__Pool.html#a9842c936aa241bad13ba13f21a337319">solvables</a> + pkg;
<a name="l01995"></a>01995 <span class="preprocessor">#if 0</span>
<a name="l01996"></a>01996 <span class="preprocessor"></span>  printf(<span class="stringliteral">&quot;- %*s%c%s\n&quot;</span>, depth * 2, <span class="stringliteral">&quot;&quot;</span>, s-&gt;<a class="code" href="struct__Solvable.html#a15e0b77fe061c6429a24215191b10f05">repo</a> == pool-&gt;<a class="code" href="struct__Pool.html#a887053f905054298cd61ce1c99e26690">installed</a> ? <span class="charliteral">&#39;-&#39;</span> : <span class="charliteral">&#39;+&#39;</span>, <a class="code" href="pool_8h.html#ac54bf34d95ae90e0368aaf0662cd0783">solvable2str</a>(pool, s));
<a name="l01997"></a>01997 <span class="preprocessor">#endif</span>
<a name="l01998"></a>01998 <span class="preprocessor"></span>  <span class="keywordflow">if</span> (s-&gt;<a class="code" href="struct__Solvable.html#a0920d25d5be01033af30796d19280c65">requires</a>)
<a name="l01999"></a>01999     {
<a name="l02000"></a>02000       <a class="code" href="pooltypes_8h.html#a2e0e6278ac51842ca3aeb53e3fc3ead6">Id</a> req, *reqp;
<a name="l02001"></a>02001       <span class="keywordtype">int</span> inpre = 0;
<a name="l02002"></a>02002       reqp = s-&gt;<a class="code" href="struct__Solvable.html#a15e0b77fe061c6429a24215191b10f05">repo</a>-&gt;<a class="code" href="struct__Repo.html#afddcfa36231cc08266800bee5b978528">idarraydata</a> + s-&gt;<a class="code" href="struct__Solvable.html#a0920d25d5be01033af30796d19280c65">requires</a>;
<a name="l02003"></a>02003       <span class="keywordflow">while</span> ((req = *reqp++) != 0)
<a name="l02004"></a>02004         {
<a name="l02005"></a>02005           <span class="keywordflow">if</span> (req == SOLVABLE_PREREQMARKER)
<a name="l02006"></a>02006             {
<a name="l02007"></a>02007               inpre = 1;
<a name="l02008"></a>02008               <span class="keywordflow">continue</span>;
<a name="l02009"></a>02009             }
<a name="l02010"></a>02010           <span class="keywordflow">if</span> (onlyprereq &amp;&amp; !inpre)
<a name="l02011"></a>02011             <span class="keywordflow">continue</span>;
<a name="l02012"></a>02012           <span class="keywordflow">if</span> (!strncmp(<a class="code" href="poolid_8c.html#a8a844727bd2258ef240555fc629b2fa7">id2str</a>(pool, req), <span class="stringliteral">&quot;rpmlib(&quot;</span>, 7))
<a name="l02013"></a>02013             <span class="keywordflow">continue</span>;
<a name="l02014"></a>02014           good = 0;
<a name="l02015"></a>02015           <span class="comment">/* first check kept packages, then freshly installed, then not yet uninstalled */</span>
<a name="l02016"></a>02016           <a class="code" href="pool_8h.html#a6529dc5dd039f8d1019aa2e6f9a9011f">FOR_PROVIDES</a>(p, pp, req)
<a name="l02017"></a>02017             {
<a name="l02018"></a>02018               <span class="keywordflow">if</span> (!<a class="code" href="bitmap_8h.html#ad8ccb9ad3a8ad65f5fe08a988acc503d">MAPTST</a>(ins, p))
<a name="l02019"></a>02019                 <span class="keywordflow">continue</span>;
<a name="l02020"></a>02020               <span class="keywordflow">if</span> (<a class="code" href="bitmap_8h.html#ad8ccb9ad3a8ad65f5fe08a988acc503d">MAPTST</a>(&amp;trans-&gt;<a class="code" href="struct__Transaction.html#ac0d758cc5496d3cfe62b8c890d21a47b">transactsmap</a>, p))
<a name="l02021"></a>02021                 <span class="keywordflow">continue</span>;
<a name="l02022"></a>02022               good++;
<a name="l02023"></a>02023               <a class="code" href="transaction_8c.html#aac5adfefdc0120dcd2073a0eaded7270">transaction_check_pkg</a>(trans, tepkg, p, ins, seen, 0, noconfpkg, depth + 1);
<a name="l02024"></a>02024             }
<a name="l02025"></a>02025           <span class="keywordflow">if</span> (!good)
<a name="l02026"></a>02026             {
<a name="l02027"></a>02027               <a class="code" href="pool_8h.html#a6529dc5dd039f8d1019aa2e6f9a9011f">FOR_PROVIDES</a>(p, pp, req)
<a name="l02028"></a>02028                 {
<a name="l02029"></a>02029                   <span class="keywordflow">if</span> (!<a class="code" href="bitmap_8h.html#ad8ccb9ad3a8ad65f5fe08a988acc503d">MAPTST</a>(ins, p))
<a name="l02030"></a>02030                     <span class="keywordflow">continue</span>;
<a name="l02031"></a>02031                   <span class="keywordflow">if</span> (pool-&gt;<a class="code" href="struct__Pool.html#a9842c936aa241bad13ba13f21a337319">solvables</a>[p].<a class="code" href="struct__Solvable.html#a15e0b77fe061c6429a24215191b10f05">repo</a> == pool-&gt;<a class="code" href="struct__Pool.html#a887053f905054298cd61ce1c99e26690">installed</a>)
<a name="l02032"></a>02032                     <span class="keywordflow">continue</span>;
<a name="l02033"></a>02033                   good++;
<a name="l02034"></a>02034                   <a class="code" href="transaction_8c.html#aac5adfefdc0120dcd2073a0eaded7270">transaction_check_pkg</a>(trans, tepkg, p, ins, seen, 0, noconfpkg, depth + 1);
<a name="l02035"></a>02035                 }
<a name="l02036"></a>02036             }
<a name="l02037"></a>02037           <span class="keywordflow">if</span> (!good)
<a name="l02038"></a>02038             {
<a name="l02039"></a>02039               <a class="code" href="pool_8h.html#a6529dc5dd039f8d1019aa2e6f9a9011f">FOR_PROVIDES</a>(p, pp, req)
<a name="l02040"></a>02040                 {
<a name="l02041"></a>02041                   <span class="keywordflow">if</span> (!<a class="code" href="bitmap_8h.html#ad8ccb9ad3a8ad65f5fe08a988acc503d">MAPTST</a>(ins, p))
<a name="l02042"></a>02042                     <span class="keywordflow">continue</span>;
<a name="l02043"></a>02043                   good++;
<a name="l02044"></a>02044                   <a class="code" href="transaction_8c.html#aac5adfefdc0120dcd2073a0eaded7270">transaction_check_pkg</a>(trans, tepkg, p, ins, seen, 0, noconfpkg, depth + 1);
<a name="l02045"></a>02045                 }
<a name="l02046"></a>02046             }
<a name="l02047"></a>02047           <span class="keywordflow">if</span> (!good)
<a name="l02048"></a>02048             {
<a name="l02049"></a>02049               <a class="code" href="pool_8h.html#ac2855e39d8eaea31be68bd0fd03574b5">POOL_DEBUG</a>(<a class="code" href="pool_8h.html#a570981a4b70f26299efdef38a1cebf3e">SAT_DEBUG_RESULT</a>, <span class="stringliteral">&quot;  %c%s: nothing provides %s needed by %c%s\n&quot;</span>, pool-&gt;<a class="code" href="struct__Pool.html#a9842c936aa241bad13ba13f21a337319">solvables</a>[tepkg].<a class="code" href="struct__Solvable.html#a15e0b77fe061c6429a24215191b10f05">repo</a> == pool-&gt;<a class="code" href="struct__Pool.html#a887053f905054298cd61ce1c99e26690">installed</a> ? <span class="charliteral">&#39;-&#39;</span> : <span class="charliteral">&#39;+&#39;</span>, <a class="code" href="pool_8h.html#adf35a6568989887a7ca04422cf6fec98">solvid2str</a>(pool, tepkg), <a class="code" href="poolid_8c.html#afbc7881d0aa3961818b1cc5e00c5a080">dep2str</a>(pool, req), s-&gt;<a class="code" href="struct__Solvable.html#a15e0b77fe061c6429a24215191b10f05">repo</a> == pool-&gt;<a class="code" href="struct__Pool.html#a887053f905054298cd61ce1c99e26690">installed</a> ? <span class="charliteral">&#39;-&#39;</span> : <span class="charliteral">&#39;+&#39;</span>, <a class="code" href="pool_8h.html#ac54bf34d95ae90e0368aaf0662cd0783">solvable2str</a>(pool, s));
<a name="l02050"></a>02050             }
<a name="l02051"></a>02051         }
<a name="l02052"></a>02052     }
<a name="l02053"></a>02053 }
<a name="l02054"></a>02054 
<a name="l02055"></a>02055 <span class="keywordtype">void</span>
<a name="l02056"></a><a class="code" href="transaction_8h.html#aa21362943701ea9292c520c86dd466d3">02056</a> <a class="code" href="transaction_8c.html#aa21362943701ea9292c520c86dd466d3">transaction_check_order</a>(<a class="code" href="struct__Transaction.html">Transaction</a> *trans)
<a name="l02057"></a>02057 {
<a name="l02058"></a>02058   <a class="code" href="struct__Pool.html">Pool</a> *pool = trans-&gt;<a class="code" href="struct__Transaction.html#aeec1bcea114aa72e7c8005b8e08a369b">pool</a>;
<a name="l02059"></a>02059   <a class="code" href="struct__Solvable.html">Solvable</a> *s;
<a name="l02060"></a>02060   <a class="code" href="pooltypes_8h.html#a2e0e6278ac51842ca3aeb53e3fc3ead6">Id</a> <a class="code" href="struct__TransactionElement.html#a15d7a733a882815e8017cab196175090">p</a>, lastins;
<a name="l02061"></a>02061   <a class="code" href="struct__Map.html">Map</a> ins, seen;
<a name="l02062"></a>02062   <span class="keywordtype">int</span> i;
<a name="l02063"></a>02063 
<a name="l02064"></a>02064   <a class="code" href="pool_8h.html#ac2855e39d8eaea31be68bd0fd03574b5">POOL_DEBUG</a>(<a class="code" href="pool_8h.html#a14b5b32140eef83eed3196f89fc55e34">SAT_WARN</a>, <span class="stringliteral">&quot;\nchecking transaction order...\n&quot;</span>);
<a name="l02065"></a>02065   <a class="code" href="bitmap_8c.html#a8d8010a0f9f491483c12e83ae3a9082e">map_init</a>(&amp;ins, pool-&gt;<a class="code" href="struct__Pool.html#a00e935f7b65616513799ac9e26fefa31">nsolvables</a>);
<a name="l02066"></a>02066   <a class="code" href="bitmap_8c.html#a8d8010a0f9f491483c12e83ae3a9082e">map_init</a>(&amp;seen, pool-&gt;<a class="code" href="struct__Pool.html#a00e935f7b65616513799ac9e26fefa31">nsolvables</a>);
<a name="l02067"></a>02067   <span class="keywordflow">if</span> (pool-&gt;<a class="code" href="struct__Pool.html#a887053f905054298cd61ce1c99e26690">installed</a>)
<a name="l02068"></a>02068     <a class="code" href="repo_8h.html#ad2d411118e6dc06fdd38f7ec68c3bb32">FOR_REPO_SOLVABLES</a>(pool-&gt;<a class="code" href="struct__Pool.html#a887053f905054298cd61ce1c99e26690">installed</a>, p, s)
<a name="l02069"></a>02069       <a class="code" href="bitmap_8h.html#a33557e357513f5b3faef527bb320183c">MAPSET</a>(&amp;ins, p);
<a name="l02070"></a>02070   lastins = 0;
<a name="l02071"></a>02071   <span class="keywordflow">for</span> (i = 0; i &lt; trans-&gt;<a class="code" href="struct__Transaction.html#a7e05d837578f51e0a26658a2ae37fc4d">steps</a>.<a class="code" href="struct__Queue.html#abb0696a77174cd23b5f488ad4c7b45d2">count</a>; i++)
<a name="l02072"></a>02072     {
<a name="l02073"></a>02073       p = trans-&gt;<a class="code" href="struct__Transaction.html#a7e05d837578f51e0a26658a2ae37fc4d">steps</a>.<a class="code" href="struct__Queue.html#a116eb58bed8ff76bf18f9c16cf1ce5c6">elements</a>[i];
<a name="l02074"></a>02074       s = pool-&gt;<a class="code" href="struct__Pool.html#a9842c936aa241bad13ba13f21a337319">solvables</a> + p;
<a name="l02075"></a>02075       <span class="keywordflow">if</span> (s-&gt;<a class="code" href="struct__Solvable.html#a15e0b77fe061c6429a24215191b10f05">repo</a> != pool-&gt;<a class="code" href="struct__Pool.html#a887053f905054298cd61ce1c99e26690">installed</a>)
<a name="l02076"></a>02076         lastins = p;
<a name="l02077"></a>02077       <span class="keywordflow">if</span> (s-&gt;<a class="code" href="struct__Solvable.html#a15e0b77fe061c6429a24215191b10f05">repo</a> != pool-&gt;<a class="code" href="struct__Pool.html#a887053f905054298cd61ce1c99e26690">installed</a>)
<a name="l02078"></a>02078         <a class="code" href="bitmap_8h.html#a33557e357513f5b3faef527bb320183c">MAPSET</a>(&amp;ins, p);
<a name="l02079"></a>02079       <span class="keywordflow">if</span> (<a class="code" href="transaction_8c.html#ad42ceb70c40e5c4fb30caf904a176bfa">havescripts</a>(pool, p))
<a name="l02080"></a>02080         {
<a name="l02081"></a>02081           <a class="code" href="bitmap_8h.html#a400be62926a3976f8c42614712d4274a">MAPZERO</a>(&amp;seen);
<a name="l02082"></a>02082           <a class="code" href="transaction_8c.html#aac5adfefdc0120dcd2073a0eaded7270">transaction_check_pkg</a>(trans, p, p, &amp;ins, &amp;seen, 1, lastins, 0);
<a name="l02083"></a>02083         }
<a name="l02084"></a>02084       <span class="keywordflow">if</span> (s-&gt;<a class="code" href="struct__Solvable.html#a15e0b77fe061c6429a24215191b10f05">repo</a> == pool-&gt;<a class="code" href="struct__Pool.html#a887053f905054298cd61ce1c99e26690">installed</a>)
<a name="l02085"></a>02085         <a class="code" href="bitmap_8h.html#a4520be65a5431b300ed0ab7a9a910201">MAPCLR</a>(&amp;ins, p);
<a name="l02086"></a>02086     }
<a name="l02087"></a>02087   <a class="code" href="bitmap_8c.html#a85426cea64351e7b4477370824ddd75f">map_free</a>(&amp;seen);
<a name="l02088"></a>02088   <a class="code" href="bitmap_8c.html#a85426cea64351e7b4477370824ddd75f">map_free</a>(&amp;ins);
<a name="l02089"></a>02089   <a class="code" href="pool_8h.html#ac2855e39d8eaea31be68bd0fd03574b5">POOL_DEBUG</a>(<a class="code" href="pool_8h.html#a14b5b32140eef83eed3196f89fc55e34">SAT_WARN</a>, <span class="stringliteral">&quot;transaction order check done.\n&quot;</span>);
<a name="l02090"></a>02090 }
</pre></div></div>
</div>
<hr class="footer"/><address class="footer"><small>Generated on Sun Oct 17 2010 15:21:23 for satsolver by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.7.1 </small></address>
</body>
</html>
