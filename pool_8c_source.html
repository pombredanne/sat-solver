<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>satsolver: src/pool.c Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<!-- Generated by Doxygen 1.7.1 -->
<div class="navigation" id="top">
  <div class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="pages.html"><span>Related&nbsp;Pages</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
      <li><a href="dirs.html"><span>Directories</span></a></li>
    </ul>
  </div>
  <div class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&nbsp;List</span></a></li>
      <li><a href="globals.html"><span>File&nbsp;Members</span></a></li>
    </ul>
  </div>
  <div class="navpath">
    <ul>
      <li><a class="el" href="dir_4422304925a660d7ad9b44d0ebab103c.html">src</a>      </li>
    </ul>
  </div>
</div>
<div class="header">
  <div class="headertitle">
<h1>pool.c</h1>  </div>
</div>
<div class="contents">
<a href="pool_8c.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 <span class="comment">/*</span>
<a name="l00002"></a>00002 <span class="comment"> * Copyright (c) 2007-2009, Novell Inc.</span>
<a name="l00003"></a>00003 <span class="comment"> *</span>
<a name="l00004"></a>00004 <span class="comment"> * This program is licensed under the BSD license, read LICENSE.BSD</span>
<a name="l00005"></a>00005 <span class="comment"> * for further information</span>
<a name="l00006"></a>00006 <span class="comment"> */</span>
<a name="l00007"></a>00007 
<a name="l00008"></a>00008 <span class="comment">/*</span>
<a name="l00009"></a>00009 <span class="comment"> * pool.c</span>
<a name="l00010"></a>00010 <span class="comment"> * </span>
<a name="l00011"></a>00011 <span class="comment"> * The pool contains information about solvables</span>
<a name="l00012"></a>00012 <span class="comment"> * stored optimized for memory consumption and fast retrieval.</span>
<a name="l00013"></a>00013 <span class="comment"> */</span>
<a name="l00014"></a>00014 
<a name="l00015"></a>00015 <span class="preprocessor">#include &lt;stdio.h&gt;</span>
<a name="l00016"></a>00016 <span class="preprocessor">#include &lt;stdlib.h&gt;</span>
<a name="l00017"></a>00017 <span class="preprocessor">#include &lt;stdarg.h&gt;</span>
<a name="l00018"></a>00018 <span class="preprocessor">#include &lt;unistd.h&gt;</span>
<a name="l00019"></a>00019 <span class="preprocessor">#include &lt;string.h&gt;</span>
<a name="l00020"></a>00020 
<a name="l00021"></a>00021 <span class="preprocessor">#include &quot;<a class="code" href="pool_8h.html">pool.h</a>&quot;</span>
<a name="l00022"></a>00022 <span class="preprocessor">#include &quot;<a class="code" href="repo_8h.html">repo.h</a>&quot;</span>
<a name="l00023"></a>00023 <span class="preprocessor">#include &quot;<a class="code" href="poolid_8h.html">poolid.h</a>&quot;</span>
<a name="l00024"></a>00024 <span class="preprocessor">#include &quot;<a class="code" href="poolid__private_8h.html">poolid_private.h</a>&quot;</span>
<a name="l00025"></a>00025 <span class="preprocessor">#include &quot;<a class="code" href="poolarch_8h.html">poolarch.h</a>&quot;</span>
<a name="l00026"></a>00026 <span class="preprocessor">#include &quot;<a class="code" href="util_8h.html">util.h</a>&quot;</span>
<a name="l00027"></a>00027 <span class="preprocessor">#include &quot;<a class="code" href="bitmap_8h.html">bitmap.h</a>&quot;</span>
<a name="l00028"></a>00028 <span class="preprocessor">#include &quot;<a class="code" href="evr_8h.html">evr.h</a>&quot;</span>
<a name="l00029"></a>00029 
<a name="l00030"></a><a class="code" href="pool_8c.html#a93c15d8b1f5104fa5382349a01c1c56e">00030</a> <span class="preprocessor">#define SOLVABLE_BLOCK  255</span>
<a name="l00031"></a>00031 <span class="preprocessor"></span>
<a name="l00032"></a><a class="code" href="pool_8c.html#ac83961fb891b1d7a9b955ce58cc60af2">00032</a> <span class="preprocessor">#define KNOWNID_INITIALIZE</span>
<a name="l00033"></a>00033 <span class="preprocessor"></span><span class="preprocessor">#include &quot;<a class="code" href="knownid_8h.html">knownid.h</a>&quot;</span>
<a name="l00034"></a>00034 <span class="preprocessor">#undef KNOWNID_INITIALIZE</span>
<a name="l00035"></a>00035 <span class="preprocessor"></span>
<a name="l00036"></a>00036 <span class="comment">/* create pool */</span>
<a name="l00037"></a>00037 <a class="code" href="struct__Pool.html">Pool</a> *
<a name="l00038"></a><a class="code" href="pool_8h.html#a6e3f022987f2ea6885bd43733f2fc87f">00038</a> <a class="code" href="pool_8c.html#a6e3f022987f2ea6885bd43733f2fc87f" title="Creates a new pool.">pool_create</a>(<span class="keywordtype">void</span>)
<a name="l00039"></a>00039 {
<a name="l00040"></a>00040   <a class="code" href="struct__Pool.html">Pool</a> *pool;
<a name="l00041"></a>00041   <a class="code" href="struct__Solvable.html">Solvable</a> *s;
<a name="l00042"></a>00042 
<a name="l00043"></a>00043   pool = (<a class="code" href="struct__Pool.html">Pool</a> *)<a class="code" href="util_8c.html#a7964924c069160718b17ac2770d6885d">sat_calloc</a>(1, <span class="keyword">sizeof</span>(*pool));
<a name="l00044"></a>00044 
<a name="l00045"></a>00045   <a class="code" href="strpool_8c.html#a37e07816c4cf6ca10aa7abceec226d4d">stringpool_init</a> (&amp;pool-&gt;<a class="code" href="struct__Pool.html#afa7b61374ab18cfea97f12796850a638">ss</a>, initpool_data);
<a name="l00046"></a>00046 
<a name="l00047"></a>00047   <span class="comment">/* alloc space for RelDep 0 */</span>
<a name="l00048"></a>00048   pool-&gt;<a class="code" href="struct__Pool.html#ab8716e046f64950d23126d2db2ea19f5">rels</a> = <a class="code" href="util_8h.html#a063db5a7df2130b54f8fc0abd51c5837">sat_extend_resize</a>(0, 1, <span class="keyword">sizeof</span>(<a class="code" href="struct__Reldep.html">Reldep</a>), <a class="code" href="poolid__private_8h.html#ae924f4974ac8f1d7a8b65f8308112d94">REL_BLOCK</a>);
<a name="l00049"></a>00049   pool-&gt;<a class="code" href="struct__Pool.html#ae4eb69a89bfd02139401474c41f1c82d">nrels</a> = 1;
<a name="l00050"></a>00050   memset(pool-&gt;<a class="code" href="struct__Pool.html#ab8716e046f64950d23126d2db2ea19f5">rels</a>, 0, <span class="keyword">sizeof</span>(<a class="code" href="struct__Reldep.html">Reldep</a>));
<a name="l00051"></a>00051 
<a name="l00052"></a>00052   <span class="comment">/* alloc space for Solvable 0 and system solvable */</span>
<a name="l00053"></a>00053   pool-&gt;<a class="code" href="struct__Pool.html#a9842c936aa241bad13ba13f21a337319">solvables</a> = <a class="code" href="util_8h.html#a063db5a7df2130b54f8fc0abd51c5837">sat_extend_resize</a>(0, 2, <span class="keyword">sizeof</span>(<a class="code" href="struct__Solvable.html">Solvable</a>), <a class="code" href="pool_8c.html#a93c15d8b1f5104fa5382349a01c1c56e">SOLVABLE_BLOCK</a>);
<a name="l00054"></a>00054   pool-&gt;<a class="code" href="struct__Pool.html#a00e935f7b65616513799ac9e26fefa31">nsolvables</a> = 2;
<a name="l00055"></a>00055   memset(pool-&gt;<a class="code" href="struct__Pool.html#a9842c936aa241bad13ba13f21a337319">solvables</a>, 0, 2 * <span class="keyword">sizeof</span>(<a class="code" href="struct__Solvable.html">Solvable</a>));
<a name="l00056"></a>00056   s = pool-&gt;<a class="code" href="struct__Pool.html#a9842c936aa241bad13ba13f21a337319">solvables</a> + SYSTEMSOLVABLE;
<a name="l00057"></a>00057   s-&gt;<a class="code" href="struct__Solvable.html#a5912021e2c3fe505c24a92aa7639dff2">name</a> = SYSTEM_SYSTEM;
<a name="l00058"></a>00058   s-&gt;<a class="code" href="struct__Solvable.html#a51ba374144373934101befc2bd20150b">arch</a> = ARCH_NOARCH;
<a name="l00059"></a>00059   s-&gt;<a class="code" href="struct__Solvable.html#ae776af434c21800db6c01a75c2e6a4f6">evr</a> = ID_EMPTY;
<a name="l00060"></a>00060 
<a name="l00061"></a>00061   <a class="code" href="queue_8c.html#ae1a64f63dd8cc46bdb2bcd415aa89e5a">queue_init</a>(&amp;pool-&gt;<a class="code" href="struct__Pool.html#afb260a5b67a937c285bcb86a09b1414f">vendormap</a>);
<a name="l00062"></a>00062 
<a name="l00063"></a>00063   pool-&gt;<a class="code" href="struct__Pool.html#a891712f62e9bd24319e006e88f7086a1">debugmask</a> = SAT_DEBUG_RESULT;   <span class="comment">/* FIXME */</span>
<a name="l00064"></a>00064 <span class="preprocessor">#ifdef FEDORA</span>
<a name="l00065"></a>00065 <span class="preprocessor"></span>  pool-&gt;<a class="code" href="struct__Pool.html#acdf3981cb1a41707c6ddf7efe9a105f0">obsoleteusescolors</a> = 1;
<a name="l00066"></a>00066 <span class="preprocessor">#endif</span>
<a name="l00067"></a>00067 <span class="preprocessor"></span><span class="preprocessor">#ifdef DEBIAN </span>
<a name="l00068"></a>00068 <span class="preprocessor"></span>  pool-&gt;<a class="code" href="struct__Pool.html#a0c66353c7c044a075fb487754173a534">allowselfconflicts</a> = 1;
<a name="l00069"></a>00069 <span class="preprocessor"># ifdef MULTI_SEMANTICS</span>
<a name="l00070"></a>00070 <span class="preprocessor"></span>  pool-&gt;disttype = DISTTYPE_DEB;
<a name="l00071"></a>00071 <span class="preprocessor"># endif</span>
<a name="l00072"></a>00072 <span class="preprocessor"></span><span class="preprocessor">#endif</span>
<a name="l00073"></a>00073 <span class="preprocessor"></span>  <span class="keywordflow">return</span> pool;
<a name="l00074"></a>00074 }
<a name="l00075"></a>00075 
<a name="l00076"></a>00076 
<a name="l00077"></a>00077 <span class="comment">/* free all the resources of our pool */</span>
<a name="l00078"></a>00078 <span class="keywordtype">void</span>
<a name="l00079"></a><a class="code" href="pool_8h.html#a26409fa67306bc6ec6f7712d37c1d10e">00079</a> <a class="code" href="pool_8c.html#a26409fa67306bc6ec6f7712d37c1d10e" title="Delete a pool.">pool_free</a>(<a class="code" href="struct__Pool.html">Pool</a> *pool)
<a name="l00080"></a>00080 {
<a name="l00081"></a>00081   <span class="keywordtype">int</span> i;
<a name="l00082"></a>00082 
<a name="l00083"></a>00083   <a class="code" href="pool_8c.html#a14dd275466a52e37d15ba44422bffe81">pool_freewhatprovides</a>(pool);
<a name="l00084"></a>00084   <a class="code" href="poolid_8c.html#a7fc8f28d414b0a5aa3016a4f60a93eae">pool_freeidhashes</a>(pool);
<a name="l00085"></a>00085   <a class="code" href="repo_8c.html#a89b038702063be8cdd7e0234161b69ce">repo_freeallrepos</a>(pool, 1);
<a name="l00086"></a>00086   <a class="code" href="util_8c.html#a1f246fae10a89534cfe0583cefb44c11">sat_free</a>(pool-&gt;<a class="code" href="struct__Pool.html#ad924ffa18ddae53f5ce4d900090518f1">id2arch</a>);
<a name="l00087"></a>00087   <a class="code" href="util_8c.html#a1f246fae10a89534cfe0583cefb44c11">sat_free</a>(pool-&gt;<a class="code" href="struct__Pool.html#a9842c936aa241bad13ba13f21a337319">solvables</a>);
<a name="l00088"></a>00088   <a class="code" href="strpool_8c.html#af6e2da0212267e5576aa0203daec043a">stringpool_free</a>(&amp;pool-&gt;<a class="code" href="struct__Pool.html#afa7b61374ab18cfea97f12796850a638">ss</a>);
<a name="l00089"></a>00089   <a class="code" href="util_8c.html#a1f246fae10a89534cfe0583cefb44c11">sat_free</a>(pool-&gt;<a class="code" href="struct__Pool.html#ab8716e046f64950d23126d2db2ea19f5">rels</a>);
<a name="l00090"></a>00090   <a class="code" href="queue_8c.html#a701c81a9f7d503837e74d43981e79137">queue_free</a>(&amp;pool-&gt;<a class="code" href="struct__Pool.html#afb260a5b67a937c285bcb86a09b1414f">vendormap</a>);
<a name="l00091"></a>00091   <span class="keywordflow">for</span> (i = 0; i &lt; POOL_TMPSPACEBUF; i++)
<a name="l00092"></a>00092     <a class="code" href="util_8c.html#a1f246fae10a89534cfe0583cefb44c11">sat_free</a>(pool-&gt;<a class="code" href="struct__Pool.html#a3aad8fabb675d5e1d2081e82ac64347b">tmpspacebuf</a>[i]);
<a name="l00093"></a>00093   <span class="keywordflow">for</span> (i = 0; i &lt; pool-&gt;<a class="code" href="struct__Pool.html#a0a0f8b691f395c82664d09b7f47ca551">nlanguages</a>; i++)
<a name="l00094"></a>00094     free((<span class="keywordtype">char</span> *)pool-&gt;<a class="code" href="struct__Pool.html#a2ca7be3e21cfa4fe847b79a6e7e5597c">languages</a>[i]);
<a name="l00095"></a>00095   <a class="code" href="util_8c.html#a1f246fae10a89534cfe0583cefb44c11">sat_free</a>(pool-&gt;<a class="code" href="struct__Pool.html#a2ca7be3e21cfa4fe847b79a6e7e5597c">languages</a>);
<a name="l00096"></a>00096   <a class="code" href="util_8c.html#a1f246fae10a89534cfe0583cefb44c11">sat_free</a>(pool-&gt;<a class="code" href="struct__Pool.html#a113eebd0e691fa339619459de8fcd110">languagecache</a>);
<a name="l00097"></a>00097   <a class="code" href="util_8c.html#a1f246fae10a89534cfe0583cefb44c11">sat_free</a>(pool);
<a name="l00098"></a>00098 }
<a name="l00099"></a>00099 
<a name="l00100"></a>00100 <span class="preprocessor">#ifdef MULTI_SEMANTICS</span>
<a name="l00101"></a>00101 <span class="preprocessor"></span><span class="keywordtype">void</span>
<a name="l00102"></a>00102 pool_setdisttype(<a class="code" href="struct__Pool.html">Pool</a> *pool, <span class="keywordtype">int</span> disttype)
<a name="l00103"></a>00103 {
<a name="l00104"></a>00104   pool-&gt;disttype = disttype;
<a name="l00105"></a>00105 }
<a name="l00106"></a>00106 <span class="preprocessor">#endif</span>
<a name="l00107"></a>00107 <span class="preprocessor"></span>
<a name="l00108"></a>00108 <a class="code" href="pooltypes_8h.html#a2e0e6278ac51842ca3aeb53e3fc3ead6">Id</a>
<a name="l00109"></a><a class="code" href="pool_8h.html#aa2c820ca3aab78709e094f5b0f31cb5c">00109</a> <a class="code" href="pool_8c.html#aa2c820ca3aab78709e094f5b0f31cb5c" title="Solvable management.">pool_add_solvable</a>(<a class="code" href="struct__Pool.html">Pool</a> *pool)
<a name="l00110"></a>00110 {
<a name="l00111"></a>00111   pool-&gt;<a class="code" href="struct__Pool.html#a9842c936aa241bad13ba13f21a337319">solvables</a> = <a class="code" href="util_8h.html#a8f0135824fd0936735b002a452c84cbd">sat_extend</a>(pool-&gt;<a class="code" href="struct__Pool.html#a9842c936aa241bad13ba13f21a337319">solvables</a>, pool-&gt;<a class="code" href="struct__Pool.html#a00e935f7b65616513799ac9e26fefa31">nsolvables</a>, 1, <span class="keyword">sizeof</span>(<a class="code" href="struct__Solvable.html">Solvable</a>), <a class="code" href="pool_8c.html#a93c15d8b1f5104fa5382349a01c1c56e">SOLVABLE_BLOCK</a>);
<a name="l00112"></a>00112   memset(pool-&gt;<a class="code" href="struct__Pool.html#a9842c936aa241bad13ba13f21a337319">solvables</a> + pool-&gt;<a class="code" href="struct__Pool.html#a00e935f7b65616513799ac9e26fefa31">nsolvables</a>, 0, <span class="keyword">sizeof</span>(<a class="code" href="struct__Solvable.html">Solvable</a>));
<a name="l00113"></a>00113   <span class="keywordflow">return</span> pool-&gt;<a class="code" href="struct__Pool.html#a00e935f7b65616513799ac9e26fefa31">nsolvables</a>++;
<a name="l00114"></a>00114 }
<a name="l00115"></a>00115 
<a name="l00116"></a>00116 <a class="code" href="pooltypes_8h.html#a2e0e6278ac51842ca3aeb53e3fc3ead6">Id</a>
<a name="l00117"></a><a class="code" href="pool_8h.html#a2f2f801d71aed8c5f3902c869c82c8ca">00117</a> <a class="code" href="pool_8c.html#a2f2f801d71aed8c5f3902c869c82c8ca">pool_add_solvable_block</a>(<a class="code" href="struct__Pool.html">Pool</a> *pool, <span class="keywordtype">int</span> count)
<a name="l00118"></a>00118 {
<a name="l00119"></a>00119   <a class="code" href="pooltypes_8h.html#a2e0e6278ac51842ca3aeb53e3fc3ead6">Id</a> nsolvables = pool-&gt;<a class="code" href="struct__Pool.html#a00e935f7b65616513799ac9e26fefa31">nsolvables</a>;
<a name="l00120"></a>00120   <span class="keywordflow">if</span> (!count)
<a name="l00121"></a>00121     <span class="keywordflow">return</span> nsolvables;
<a name="l00122"></a>00122   pool-&gt;<a class="code" href="struct__Pool.html#a9842c936aa241bad13ba13f21a337319">solvables</a> = <a class="code" href="util_8h.html#a8f0135824fd0936735b002a452c84cbd">sat_extend</a>(pool-&gt;<a class="code" href="struct__Pool.html#a9842c936aa241bad13ba13f21a337319">solvables</a>, pool-&gt;<a class="code" href="struct__Pool.html#a00e935f7b65616513799ac9e26fefa31">nsolvables</a>, count, <span class="keyword">sizeof</span>(<a class="code" href="struct__Solvable.html">Solvable</a>), <a class="code" href="pool_8c.html#a93c15d8b1f5104fa5382349a01c1c56e">SOLVABLE_BLOCK</a>);
<a name="l00123"></a>00123   memset(pool-&gt;<a class="code" href="struct__Pool.html#a9842c936aa241bad13ba13f21a337319">solvables</a> + nsolvables, 0, <span class="keyword">sizeof</span>(<a class="code" href="struct__Solvable.html">Solvable</a>) * count);
<a name="l00124"></a>00124   pool-&gt;<a class="code" href="struct__Pool.html#a00e935f7b65616513799ac9e26fefa31">nsolvables</a> += count;
<a name="l00125"></a>00125   <span class="keywordflow">return</span> nsolvables;
<a name="l00126"></a>00126 }
<a name="l00127"></a>00127 
<a name="l00128"></a>00128 <span class="keywordtype">void</span>
<a name="l00129"></a><a class="code" href="pool_8h.html#ac2e59d8add3ac8b858760604065bbde2">00129</a> <a class="code" href="pool_8c.html#ac2e59d8add3ac8b858760604065bbde2">pool_free_solvable_block</a>(<a class="code" href="struct__Pool.html">Pool</a> *pool, <a class="code" href="pooltypes_8h.html#a2e0e6278ac51842ca3aeb53e3fc3ead6">Id</a> start, <span class="keywordtype">int</span> count, <span class="keywordtype">int</span> reuseids)
<a name="l00130"></a>00130 {
<a name="l00131"></a>00131   <span class="keywordflow">if</span> (!count)
<a name="l00132"></a>00132     <span class="keywordflow">return</span>;
<a name="l00133"></a>00133   <span class="keywordflow">if</span> (reuseids &amp;&amp; start + count == pool-&gt;<a class="code" href="struct__Pool.html#a00e935f7b65616513799ac9e26fefa31">nsolvables</a>)
<a name="l00134"></a>00134     {
<a name="l00135"></a>00135       <span class="comment">/* might want to shrink solvable array */</span>
<a name="l00136"></a>00136       pool-&gt;<a class="code" href="struct__Pool.html#a00e935f7b65616513799ac9e26fefa31">nsolvables</a> = start;
<a name="l00137"></a>00137       <span class="keywordflow">return</span>;
<a name="l00138"></a>00138     }
<a name="l00139"></a>00139   memset(pool-&gt;<a class="code" href="struct__Pool.html#a9842c936aa241bad13ba13f21a337319">solvables</a> + start, 0, <span class="keyword">sizeof</span>(<a class="code" href="struct__Solvable.html">Solvable</a>) * count);
<a name="l00140"></a>00140 }
<a name="l00141"></a>00141 
<a name="l00142"></a>00142 
<a name="l00143"></a>00143 <span class="keywordtype">void</span>
<a name="l00144"></a><a class="code" href="pool_8h.html#a9c20aa55bc808fd8c17cd4544a90f894">00144</a> <a class="code" href="pool_8c.html#a08c2ad05ac1dba538ad5502cd0fd5303">pool_set_installed</a>(<a class="code" href="struct__Pool.html">Pool</a> *pool, <a class="code" href="struct__Repo.html">Repo</a> *installed)
<a name="l00145"></a>00145 {
<a name="l00146"></a>00146   <span class="keywordflow">if</span> (pool-&gt;<a class="code" href="struct__Pool.html#a887053f905054298cd61ce1c99e26690">installed</a> == installed)
<a name="l00147"></a>00147     <span class="keywordflow">return</span>;
<a name="l00148"></a>00148   pool-&gt;<a class="code" href="struct__Pool.html#a887053f905054298cd61ce1c99e26690">installed</a> = installed;
<a name="l00149"></a>00149   <a class="code" href="pool_8c.html#a14dd275466a52e37d15ba44422bffe81">pool_freewhatprovides</a>(pool);
<a name="l00150"></a>00150 }
<a name="l00151"></a>00151 
<a name="l00152"></a>00152 <span class="keyword">static</span> <span class="keywordtype">int</span>
<a name="l00153"></a><a class="code" href="pool_8c.html#a276daf3f233072cea26e4a17bf98c475">00153</a> <a class="code" href="pool_8c.html#a276daf3f233072cea26e4a17bf98c475">pool_shrink_whatprovides_sortcmp</a>(<span class="keyword">const</span> <span class="keywordtype">void</span> *ap, <span class="keyword">const</span> <span class="keywordtype">void</span> *bp, <span class="keywordtype">void</span> *dp)
<a name="l00154"></a>00154 {
<a name="l00155"></a>00155   <span class="keywordtype">int</span> r;
<a name="l00156"></a>00156   <a class="code" href="struct__Pool.html">Pool</a> *pool = dp;
<a name="l00157"></a>00157   <a class="code" href="pooltypes_8h.html#a2e0e6278ac51842ca3aeb53e3fc3ead6">Id</a> oa, ob, *da, *db;
<a name="l00158"></a>00158   oa = pool-&gt;<a class="code" href="struct__Pool.html#a7b0e54d95aef1bc00bda08c2c844d377">whatprovides</a>[*(<a class="code" href="pooltypes_8h.html#a2e0e6278ac51842ca3aeb53e3fc3ead6">Id</a> *)ap];
<a name="l00159"></a>00159   ob = pool-&gt;<a class="code" href="struct__Pool.html#a7b0e54d95aef1bc00bda08c2c844d377">whatprovides</a>[*(<a class="code" href="pooltypes_8h.html#a2e0e6278ac51842ca3aeb53e3fc3ead6">Id</a> *)bp];
<a name="l00160"></a>00160   <span class="keywordflow">if</span> (oa == ob)
<a name="l00161"></a>00161     <span class="keywordflow">return</span> *(<a class="code" href="pooltypes_8h.html#a2e0e6278ac51842ca3aeb53e3fc3ead6">Id</a> *)ap - *(<a class="code" href="pooltypes_8h.html#a2e0e6278ac51842ca3aeb53e3fc3ead6">Id</a> *)bp;
<a name="l00162"></a>00162   <span class="keywordflow">if</span> (!oa)
<a name="l00163"></a>00163     <span class="keywordflow">return</span> -1;
<a name="l00164"></a>00164   <span class="keywordflow">if</span> (!ob)
<a name="l00165"></a>00165     <span class="keywordflow">return</span> 1;
<a name="l00166"></a>00166   da = pool-&gt;<a class="code" href="struct__Pool.html#a0cdb8c9d12440e6e59b7b569259ef493">whatprovidesdata</a> + oa;
<a name="l00167"></a>00167   db = pool-&gt;<a class="code" href="struct__Pool.html#a0cdb8c9d12440e6e59b7b569259ef493">whatprovidesdata</a> + ob;
<a name="l00168"></a>00168   <span class="keywordflow">while</span> (*db)
<a name="l00169"></a>00169     <span class="keywordflow">if</span> ((r = (*da++ - *db++)) != 0)
<a name="l00170"></a>00170       <span class="keywordflow">return</span> r;
<a name="l00171"></a>00171   <span class="keywordflow">if</span> (*da)
<a name="l00172"></a>00172     <span class="keywordflow">return</span> *da;
<a name="l00173"></a>00173   <span class="keywordflow">return</span> *(<a class="code" href="pooltypes_8h.html#a2e0e6278ac51842ca3aeb53e3fc3ead6">Id</a> *)ap - *(<a class="code" href="pooltypes_8h.html#a2e0e6278ac51842ca3aeb53e3fc3ead6">Id</a> *)bp;
<a name="l00174"></a>00174 }
<a name="l00175"></a>00175 
<a name="l00176"></a>00176 <span class="comment">/*</span>
<a name="l00177"></a>00177 <span class="comment"> * pool_shrink_whatprovides  - unify whatprovides data</span>
<a name="l00178"></a>00178 <span class="comment"> *</span>
<a name="l00179"></a>00179 <span class="comment"> * whatprovides_rel must be empty for this to work!</span>
<a name="l00180"></a>00180 <span class="comment"> *</span>
<a name="l00181"></a>00181 <span class="comment"> */</span>
<a name="l00182"></a>00182 <span class="keyword">static</span> <span class="keywordtype">void</span>
<a name="l00183"></a><a class="code" href="pool_8c.html#a8c3c762abfedc4e9a89adadaf3ccc6be">00183</a> <a class="code" href="pool_8c.html#a8c3c762abfedc4e9a89adadaf3ccc6be">pool_shrink_whatprovides</a>(<a class="code" href="struct__Pool.html">Pool</a> *pool)
<a name="l00184"></a>00184 {
<a name="l00185"></a>00185   <a class="code" href="pooltypes_8h.html#a2e0e6278ac51842ca3aeb53e3fc3ead6">Id</a> i, id;
<a name="l00186"></a>00186   <a class="code" href="pooltypes_8h.html#a2e0e6278ac51842ca3aeb53e3fc3ead6">Id</a> *sorted;
<a name="l00187"></a>00187   <a class="code" href="pooltypes_8h.html#a2e0e6278ac51842ca3aeb53e3fc3ead6">Id</a> lastid, *last, *dp, *lp;
<a name="l00188"></a>00188   <a class="code" href="pooltypes_8h.html#ac8d1df6975469fe7c63e8a750755200f">Offset</a> o;
<a name="l00189"></a>00189   <span class="keywordtype">int</span> r;
<a name="l00190"></a>00190 
<a name="l00191"></a>00191   <span class="keywordflow">if</span> (pool-&gt;<a class="code" href="struct__Pool.html#afa7b61374ab18cfea97f12796850a638">ss</a>.<a class="code" href="struct__Stringpool.html#a2bf0e8ba450ec30d60076977912dfd5f">nstrings</a> &lt; 3)
<a name="l00192"></a>00192     <span class="keywordflow">return</span>;
<a name="l00193"></a>00193   sorted = <a class="code" href="util_8c.html#ab9d2d14a104453bab5b20a3e449db52b">sat_malloc2</a>(pool-&gt;<a class="code" href="struct__Pool.html#afa7b61374ab18cfea97f12796850a638">ss</a>.<a class="code" href="struct__Stringpool.html#a2bf0e8ba450ec30d60076977912dfd5f">nstrings</a>, <span class="keyword">sizeof</span>(<a class="code" href="pooltypes_8h.html#a2e0e6278ac51842ca3aeb53e3fc3ead6">Id</a>));
<a name="l00194"></a>00194   <span class="keywordflow">for</span> (<span class="keywordtype">id</span> = 0; <span class="keywordtype">id</span> &lt; pool-&gt;<a class="code" href="struct__Pool.html#afa7b61374ab18cfea97f12796850a638">ss</a>.<a class="code" href="struct__Stringpool.html#a2bf0e8ba450ec30d60076977912dfd5f">nstrings</a>; <span class="keywordtype">id</span>++)
<a name="l00195"></a>00195     sorted[<span class="keywordtype">id</span>] = <span class="keywordtype">id</span>;
<a name="l00196"></a>00196   <a class="code" href="util_8c.html#a23a8607fedc58dfceea738fc835160ab">sat_sort</a>(sorted + 1, pool-&gt;<a class="code" href="struct__Pool.html#afa7b61374ab18cfea97f12796850a638">ss</a>.<a class="code" href="struct__Stringpool.html#a2bf0e8ba450ec30d60076977912dfd5f">nstrings</a> - 1, <span class="keyword">sizeof</span>(<a class="code" href="pooltypes_8h.html#a2e0e6278ac51842ca3aeb53e3fc3ead6">Id</a>), <a class="code" href="pool_8c.html#a276daf3f233072cea26e4a17bf98c475">pool_shrink_whatprovides_sortcmp</a>, pool);
<a name="l00197"></a>00197   last = 0;
<a name="l00198"></a>00198   lastid = 0;
<a name="l00199"></a>00199   <span class="keywordflow">for</span> (i = 1; i &lt; pool-&gt;<a class="code" href="struct__Pool.html#afa7b61374ab18cfea97f12796850a638">ss</a>.<a class="code" href="struct__Stringpool.html#a2bf0e8ba450ec30d60076977912dfd5f">nstrings</a>; i++)
<a name="l00200"></a>00200     {
<a name="l00201"></a>00201       <span class="keywordtype">id</span> = sorted[i];
<a name="l00202"></a>00202       o = pool-&gt;<a class="code" href="struct__Pool.html#a7b0e54d95aef1bc00bda08c2c844d377">whatprovides</a>[id];
<a name="l00203"></a>00203       <span class="keywordflow">if</span> (o == 0 || o == 1)
<a name="l00204"></a>00204         <span class="keywordflow">continue</span>;
<a name="l00205"></a>00205       dp = pool-&gt;<a class="code" href="struct__Pool.html#a0cdb8c9d12440e6e59b7b569259ef493">whatprovidesdata</a> + o;
<a name="l00206"></a>00206       <span class="keywordflow">if</span> (last)
<a name="l00207"></a>00207         {
<a name="l00208"></a>00208           lp = last;
<a name="l00209"></a>00209           <span class="keywordflow">while</span> (*dp)   
<a name="l00210"></a>00210             <span class="keywordflow">if</span> (*dp++ != *lp++)
<a name="l00211"></a>00211               {
<a name="l00212"></a>00212                 last = 0;
<a name="l00213"></a>00213                 <span class="keywordflow">break</span>;
<a name="l00214"></a>00214               }
<a name="l00215"></a>00215           <span class="keywordflow">if</span> (last &amp;&amp; *lp)
<a name="l00216"></a>00216             last = 0;
<a name="l00217"></a>00217           <span class="keywordflow">if</span> (last)
<a name="l00218"></a>00218             {
<a name="l00219"></a>00219               pool-&gt;<a class="code" href="struct__Pool.html#a7b0e54d95aef1bc00bda08c2c844d377">whatprovides</a>[id] = -lastid;
<a name="l00220"></a>00220               <span class="keywordflow">continue</span>;
<a name="l00221"></a>00221             }
<a name="l00222"></a>00222         }
<a name="l00223"></a>00223       last = pool-&gt;<a class="code" href="struct__Pool.html#a0cdb8c9d12440e6e59b7b569259ef493">whatprovidesdata</a> + o;
<a name="l00224"></a>00224       lastid = id;
<a name="l00225"></a>00225     }
<a name="l00226"></a>00226   <a class="code" href="util_8c.html#a1f246fae10a89534cfe0583cefb44c11">sat_free</a>(sorted);
<a name="l00227"></a>00227   dp = pool-&gt;<a class="code" href="struct__Pool.html#a0cdb8c9d12440e6e59b7b569259ef493">whatprovidesdata</a> + 2;
<a name="l00228"></a>00228   <span class="keywordflow">for</span> (<span class="keywordtype">id</span> = 1; <span class="keywordtype">id</span> &lt; pool-&gt;<a class="code" href="struct__Pool.html#afa7b61374ab18cfea97f12796850a638">ss</a>.<a class="code" href="struct__Stringpool.html#a2bf0e8ba450ec30d60076977912dfd5f">nstrings</a>; <span class="keywordtype">id</span>++)
<a name="l00229"></a>00229     {
<a name="l00230"></a>00230       o = pool-&gt;<a class="code" href="struct__Pool.html#a7b0e54d95aef1bc00bda08c2c844d377">whatprovides</a>[id];
<a name="l00231"></a>00231       <span class="keywordflow">if</span> (o == 0 || o == 1)
<a name="l00232"></a>00232         <span class="keywordflow">continue</span>;
<a name="l00233"></a>00233       <span class="keywordflow">if</span> ((<a class="code" href="pooltypes_8h.html#a2e0e6278ac51842ca3aeb53e3fc3ead6">Id</a>)o &lt; 0)
<a name="l00234"></a>00234         {
<a name="l00235"></a>00235           i = -(Id)o;
<a name="l00236"></a>00236           <span class="keywordflow">if</span> (i &gt;= <span class="keywordtype">id</span>)
<a name="l00237"></a>00237             abort();
<a name="l00238"></a>00238           pool-&gt;<a class="code" href="struct__Pool.html#a7b0e54d95aef1bc00bda08c2c844d377">whatprovides</a>[id] = pool-&gt;<a class="code" href="struct__Pool.html#a7b0e54d95aef1bc00bda08c2c844d377">whatprovides</a>[i];
<a name="l00239"></a>00239           <span class="keywordflow">continue</span>;
<a name="l00240"></a>00240         }
<a name="l00241"></a>00241       lp = pool-&gt;<a class="code" href="struct__Pool.html#a0cdb8c9d12440e6e59b7b569259ef493">whatprovidesdata</a> + o;
<a name="l00242"></a>00242       <span class="keywordflow">if</span> (lp &lt; dp)
<a name="l00243"></a>00243         abort();
<a name="l00244"></a>00244       pool-&gt;<a class="code" href="struct__Pool.html#a7b0e54d95aef1bc00bda08c2c844d377">whatprovides</a>[id] = dp - pool-&gt;<a class="code" href="struct__Pool.html#a0cdb8c9d12440e6e59b7b569259ef493">whatprovidesdata</a>;
<a name="l00245"></a>00245       <span class="keywordflow">while</span> ((*dp++ = *lp++) != 0)
<a name="l00246"></a>00246         ;
<a name="l00247"></a>00247     }
<a name="l00248"></a>00248   o = dp - pool-&gt;<a class="code" href="struct__Pool.html#a0cdb8c9d12440e6e59b7b569259ef493">whatprovidesdata</a>;
<a name="l00249"></a>00249   <a class="code" href="pool_8h.html#ac2855e39d8eaea31be68bd0fd03574b5">POOL_DEBUG</a>(<a class="code" href="pool_8h.html#a9e7c48e08e7b2a51b41e4d6611a02ace">SAT_DEBUG_STATS</a>, <span class="stringliteral">&quot;shrunk whatprovidesdata from %d to %d\n&quot;</span>, pool-&gt;<a class="code" href="struct__Pool.html#ac811604b741766bfa5a6c0846144041b">whatprovidesdataoff</a>, o);
<a name="l00250"></a>00250   <span class="keywordflow">if</span> (pool-&gt;<a class="code" href="struct__Pool.html#ac811604b741766bfa5a6c0846144041b">whatprovidesdataoff</a> == o)
<a name="l00251"></a>00251     <span class="keywordflow">return</span>;
<a name="l00252"></a>00252   r = pool-&gt;<a class="code" href="struct__Pool.html#ac811604b741766bfa5a6c0846144041b">whatprovidesdataoff</a> - o;
<a name="l00253"></a>00253   pool-&gt;<a class="code" href="struct__Pool.html#ac811604b741766bfa5a6c0846144041b">whatprovidesdataoff</a> = o;
<a name="l00254"></a>00254   pool-&gt;<a class="code" href="struct__Pool.html#a0cdb8c9d12440e6e59b7b569259ef493">whatprovidesdata</a> = <a class="code" href="util_8c.html#a43839a29e1a3e9f13247e89c9057d6fa">sat_realloc</a>(pool-&gt;<a class="code" href="struct__Pool.html#a0cdb8c9d12440e6e59b7b569259ef493">whatprovidesdata</a>, (o + pool-&gt;<a class="code" href="struct__Pool.html#aa985d83455680bfbb5ce5503338f8e1d">whatprovidesdataleft</a>) * <span class="keyword">sizeof</span>(<a class="code" href="pooltypes_8h.html#a2e0e6278ac51842ca3aeb53e3fc3ead6">Id</a>));
<a name="l00255"></a>00255   <span class="keywordflow">if</span> (r &gt; pool-&gt;<a class="code" href="struct__Pool.html#aa985d83455680bfbb5ce5503338f8e1d">whatprovidesdataleft</a>)
<a name="l00256"></a>00256     r = pool-&gt;<a class="code" href="struct__Pool.html#aa985d83455680bfbb5ce5503338f8e1d">whatprovidesdataleft</a>;
<a name="l00257"></a>00257   memset(pool-&gt;<a class="code" href="struct__Pool.html#a0cdb8c9d12440e6e59b7b569259ef493">whatprovidesdata</a> + o, 0, r * <span class="keyword">sizeof</span>(<a class="code" href="pooltypes_8h.html#a2e0e6278ac51842ca3aeb53e3fc3ead6">Id</a>));
<a name="l00258"></a>00258 }
<a name="l00259"></a>00259 
<a name="l00260"></a>00260 
<a name="l00261"></a>00261 <span class="comment">/*</span>
<a name="l00262"></a>00262 <span class="comment"> * pool_createwhatprovides()</span>
<a name="l00263"></a>00263 <span class="comment"> * </span>
<a name="l00264"></a>00264 <span class="comment"> * create hashes over pool of solvables to ease provide lookups</span>
<a name="l00265"></a>00265 <span class="comment"> * </span>
<a name="l00266"></a>00266 <span class="comment"> */</span>
<a name="l00267"></a>00267 <span class="keywordtype">void</span>
<a name="l00268"></a><a class="code" href="pool_8h.html#ad6ce961b562075f2846e2132b1a2f2b0">00268</a> <a class="code" href="pool_8c.html#ad6ce961b562075f2846e2132b1a2f2b0" title="Prepares a pool for solving.">pool_createwhatprovides</a>(<a class="code" href="struct__Pool.html">Pool</a> *pool)
<a name="l00269"></a>00269 {
<a name="l00270"></a>00270   <span class="keywordtype">int</span> i, num, np, extra;
<a name="l00271"></a>00271   <a class="code" href="pooltypes_8h.html#ac8d1df6975469fe7c63e8a750755200f">Offset</a> off;
<a name="l00272"></a>00272   <a class="code" href="struct__Solvable.html">Solvable</a> *s;
<a name="l00273"></a>00273   <a class="code" href="pooltypes_8h.html#a2e0e6278ac51842ca3aeb53e3fc3ead6">Id</a> id;
<a name="l00274"></a>00274   <a class="code" href="pooltypes_8h.html#ac8d1df6975469fe7c63e8a750755200f">Offset</a> *idp, n;
<a name="l00275"></a>00275   <a class="code" href="pooltypes_8h.html#ac8d1df6975469fe7c63e8a750755200f">Offset</a> *whatprovides;
<a name="l00276"></a>00276   <a class="code" href="pooltypes_8h.html#a2e0e6278ac51842ca3aeb53e3fc3ead6">Id</a> *whatprovidesdata, *d;
<a name="l00277"></a>00277   <a class="code" href="struct__Repo.html">Repo</a> *installed = pool-&gt;<a class="code" href="struct__Pool.html#a887053f905054298cd61ce1c99e26690">installed</a>;
<a name="l00278"></a>00278   <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> now;
<a name="l00279"></a>00279 
<a name="l00280"></a>00280   now = <a class="code" href="util_8c.html#a10875c1838f0632aabf1a919135a06ee">sat_timems</a>(0);
<a name="l00281"></a>00281   <a class="code" href="pool_8h.html#ac2855e39d8eaea31be68bd0fd03574b5">POOL_DEBUG</a>(<a class="code" href="pool_8h.html#a9e7c48e08e7b2a51b41e4d6611a02ace">SAT_DEBUG_STATS</a>, <span class="stringliteral">&quot;number of solvables: %d\n&quot;</span>, pool-&gt;<a class="code" href="struct__Pool.html#a00e935f7b65616513799ac9e26fefa31">nsolvables</a>);
<a name="l00282"></a>00282   <a class="code" href="pool_8h.html#ac2855e39d8eaea31be68bd0fd03574b5">POOL_DEBUG</a>(<a class="code" href="pool_8h.html#a9e7c48e08e7b2a51b41e4d6611a02ace">SAT_DEBUG_STATS</a>, <span class="stringliteral">&quot;number of ids: %d + %d\n&quot;</span>, pool-&gt;<a class="code" href="struct__Pool.html#afa7b61374ab18cfea97f12796850a638">ss</a>.<a class="code" href="struct__Stringpool.html#a2bf0e8ba450ec30d60076977912dfd5f">nstrings</a>, pool-&gt;<a class="code" href="struct__Pool.html#ae4eb69a89bfd02139401474c41f1c82d">nrels</a>);
<a name="l00283"></a>00283 
<a name="l00284"></a>00284   <a class="code" href="poolid_8c.html#a7fc8f28d414b0a5aa3016a4f60a93eae">pool_freeidhashes</a>(pool);      <span class="comment">/* XXX: should not be here! */</span>
<a name="l00285"></a>00285   <a class="code" href="pool_8c.html#a14dd275466a52e37d15ba44422bffe81">pool_freewhatprovides</a>(pool);
<a name="l00286"></a>00286   num = pool-&gt;<a class="code" href="struct__Pool.html#afa7b61374ab18cfea97f12796850a638">ss</a>.<a class="code" href="struct__Stringpool.html#a2bf0e8ba450ec30d60076977912dfd5f">nstrings</a>;
<a name="l00287"></a>00287   pool-&gt;<a class="code" href="struct__Pool.html#a7b0e54d95aef1bc00bda08c2c844d377">whatprovides</a> = whatprovides = <a class="code" href="util_8h.html#a5cac73df93a60c92517fa4af2e621566">sat_calloc_block</a>(num, <span class="keyword">sizeof</span>(<a class="code" href="pooltypes_8h.html#ac8d1df6975469fe7c63e8a750755200f">Offset</a>), <a class="code" href="poolid__private_8h.html#a69c98be15a33ae7f76b0638bb9fb2fe3">WHATPROVIDES_BLOCK</a>);
<a name="l00288"></a>00288   pool-&gt;<a class="code" href="struct__Pool.html#ab2a4049b7aafbf2dc18c64eaf3367824">whatprovides_rel</a> = <a class="code" href="util_8h.html#a5cac73df93a60c92517fa4af2e621566">sat_calloc_block</a>(pool-&gt;<a class="code" href="struct__Pool.html#ae4eb69a89bfd02139401474c41f1c82d">nrels</a>, <span class="keyword">sizeof</span>(<a class="code" href="pooltypes_8h.html#ac8d1df6975469fe7c63e8a750755200f">Offset</a>), <a class="code" href="poolid__private_8h.html#a69c98be15a33ae7f76b0638bb9fb2fe3">WHATPROVIDES_BLOCK</a>);
<a name="l00289"></a>00289 
<a name="l00290"></a>00290   <span class="comment">/* count providers for each name */</span>
<a name="l00291"></a>00291   <span class="keywordflow">for</span> (i = pool-&gt;<a class="code" href="struct__Pool.html#a00e935f7b65616513799ac9e26fefa31">nsolvables</a> - 1; i &gt; 0; i--)
<a name="l00292"></a>00292     {
<a name="l00293"></a>00293       <a class="code" href="pooltypes_8h.html#a2e0e6278ac51842ca3aeb53e3fc3ead6">Id</a> *pp;
<a name="l00294"></a>00294       s = pool-&gt;<a class="code" href="struct__Pool.html#a9842c936aa241bad13ba13f21a337319">solvables</a> + i;
<a name="l00295"></a>00295       <span class="keywordflow">if</span> (!s-&gt;<a class="code" href="struct__Solvable.html#aca85fe4ba80026035c22f0596db71657">provides</a> || !s-&gt;<a class="code" href="struct__Solvable.html#a15e0b77fe061c6429a24215191b10f05">repo</a> || s-&gt;<a class="code" href="struct__Solvable.html#a15e0b77fe061c6429a24215191b10f05">repo</a>-&gt;<a class="code" href="struct__Repo.html#a637e3e83a1a07551b8bf6e73a654083d">disabled</a>)
<a name="l00296"></a>00296         <span class="keywordflow">continue</span>;
<a name="l00297"></a>00297       <span class="comment">/* we always need the installed solvable in the whatprovides data,</span>
<a name="l00298"></a>00298 <span class="comment">         otherwise obsoletes/conflicts on them won&#39;t work */</span>
<a name="l00299"></a>00299       <span class="keywordflow">if</span> (s-&gt;<a class="code" href="struct__Solvable.html#a15e0b77fe061c6429a24215191b10f05">repo</a> != installed &amp;&amp; !<a class="code" href="repo_8h.html#a5549b2545f7256db4e7e5985a9701633">pool_installable</a>(pool, s))
<a name="l00300"></a>00300         <span class="keywordflow">continue</span>;
<a name="l00301"></a>00301       pp = s-&gt;<a class="code" href="struct__Solvable.html#a15e0b77fe061c6429a24215191b10f05">repo</a>-&gt;<a class="code" href="struct__Repo.html#afddcfa36231cc08266800bee5b978528">idarraydata</a> + s-&gt;<a class="code" href="struct__Solvable.html#aca85fe4ba80026035c22f0596db71657">provides</a>;
<a name="l00302"></a>00302       <span class="keywordflow">while</span> ((<span class="keywordtype">id</span> = *pp++) != 0)
<a name="l00303"></a>00303         {
<a name="l00304"></a>00304           <span class="keywordflow">while</span> (<a class="code" href="pool_8h.html#a723c8c54fdd5d81be4b612c0d2868c2d">ISRELDEP</a>(<span class="keywordtype">id</span>))
<a name="l00305"></a>00305             {
<a name="l00306"></a>00306               <a class="code" href="struct__Reldep.html">Reldep</a> *rd = <a class="code" href="pool_8h.html#a7f1a1ed4e318be6edd66e5d94d7912bb">GETRELDEP</a>(pool, <span class="keywordtype">id</span>);
<a name="l00307"></a>00307               <span class="keywordtype">id</span> = rd-&gt;<a class="code" href="struct__Reldep.html#a0fa6e0cb741e79dcd2e92d9e65cf8ce5">name</a>;
<a name="l00308"></a>00308             }
<a name="l00309"></a>00309           whatprovides[id]++;          <span class="comment">/* inc count of providers */</span>
<a name="l00310"></a>00310         }
<a name="l00311"></a>00311     }
<a name="l00312"></a>00312 
<a name="l00313"></a>00313   off = 2;      <span class="comment">/* first entry is undef, second is empty list */</span>
<a name="l00314"></a>00314   np = 0;                              <span class="comment">/* number of names provided */</span>
<a name="l00315"></a>00315   <span class="keywordflow">for</span> (i = 0, idp = whatprovides; i &lt; num; i++, idp++)
<a name="l00316"></a>00316     {
<a name="l00317"></a>00317       n = *idp;
<a name="l00318"></a>00318       <span class="keywordflow">if</span> (!n)                          <span class="comment">/* no providers */</span>
<a name="l00319"></a>00319         <span class="keywordflow">continue</span>;
<a name="l00320"></a>00320       off += n;                        <span class="comment">/* make space for all providers */</span>
<a name="l00321"></a>00321       *idp = off++;                    <span class="comment">/* now idp points to terminating zero */</span>
<a name="l00322"></a>00322       np++;                            <span class="comment">/* inc # of provider &#39;slots&#39; for stats */</span>
<a name="l00323"></a>00323     }
<a name="l00324"></a>00324 
<a name="l00325"></a>00325   <a class="code" href="pool_8h.html#ac2855e39d8eaea31be68bd0fd03574b5">POOL_DEBUG</a>(<a class="code" href="pool_8h.html#a9e7c48e08e7b2a51b41e4d6611a02ace">SAT_DEBUG_STATS</a>, <span class="stringliteral">&quot;provide ids: %d\n&quot;</span>, np);
<a name="l00326"></a>00326 
<a name="l00327"></a>00327   <span class="comment">/* reserve some space for relation data */</span>
<a name="l00328"></a>00328   extra = 2 * pool-&gt;<a class="code" href="struct__Pool.html#ae4eb69a89bfd02139401474c41f1c82d">nrels</a>;
<a name="l00329"></a>00329   <span class="keywordflow">if</span> (extra &lt; 256)
<a name="l00330"></a>00330     extra = 256;
<a name="l00331"></a>00331 
<a name="l00332"></a>00332   <a class="code" href="pool_8h.html#ac2855e39d8eaea31be68bd0fd03574b5">POOL_DEBUG</a>(<a class="code" href="pool_8h.html#a9e7c48e08e7b2a51b41e4d6611a02ace">SAT_DEBUG_STATS</a>, <span class="stringliteral">&quot;provide space needed: %d + %d\n&quot;</span>, off, extra);
<a name="l00333"></a>00333 
<a name="l00334"></a>00334   <span class="comment">/* alloc space for all providers + extra */</span>
<a name="l00335"></a>00335   whatprovidesdata = <a class="code" href="util_8c.html#a7964924c069160718b17ac2770d6885d">sat_calloc</a>(off + extra, <span class="keyword">sizeof</span>(<a class="code" href="pooltypes_8h.html#a2e0e6278ac51842ca3aeb53e3fc3ead6">Id</a>));
<a name="l00336"></a>00336 
<a name="l00337"></a>00337   <span class="comment">/* now fill data for all provides */</span>
<a name="l00338"></a>00338   <span class="keywordflow">for</span> (i = pool-&gt;<a class="code" href="struct__Pool.html#a00e935f7b65616513799ac9e26fefa31">nsolvables</a> - 1; i &gt; 0; i--)
<a name="l00339"></a>00339     {
<a name="l00340"></a>00340       <a class="code" href="pooltypes_8h.html#a2e0e6278ac51842ca3aeb53e3fc3ead6">Id</a> *pp;
<a name="l00341"></a>00341       s = pool-&gt;<a class="code" href="struct__Pool.html#a9842c936aa241bad13ba13f21a337319">solvables</a> + i;
<a name="l00342"></a>00342       <span class="keywordflow">if</span> (!s-&gt;<a class="code" href="struct__Solvable.html#aca85fe4ba80026035c22f0596db71657">provides</a> || !s-&gt;<a class="code" href="struct__Solvable.html#a15e0b77fe061c6429a24215191b10f05">repo</a> || s-&gt;<a class="code" href="struct__Solvable.html#a15e0b77fe061c6429a24215191b10f05">repo</a>-&gt;<a class="code" href="struct__Repo.html#a637e3e83a1a07551b8bf6e73a654083d">disabled</a>)
<a name="l00343"></a>00343         <span class="keywordflow">continue</span>;
<a name="l00344"></a>00344       <span class="keywordflow">if</span> (s-&gt;<a class="code" href="struct__Solvable.html#a15e0b77fe061c6429a24215191b10f05">repo</a> != installed &amp;&amp; !<a class="code" href="repo_8h.html#a5549b2545f7256db4e7e5985a9701633">pool_installable</a>(pool, s))
<a name="l00345"></a>00345         <span class="keywordflow">continue</span>;
<a name="l00346"></a>00346 
<a name="l00347"></a>00347       <span class="comment">/* for all provides of this solvable */</span>
<a name="l00348"></a>00348       pp = s-&gt;<a class="code" href="struct__Solvable.html#a15e0b77fe061c6429a24215191b10f05">repo</a>-&gt;<a class="code" href="struct__Repo.html#afddcfa36231cc08266800bee5b978528">idarraydata</a> + s-&gt;<a class="code" href="struct__Solvable.html#aca85fe4ba80026035c22f0596db71657">provides</a>;
<a name="l00349"></a>00349       <span class="keywordflow">while</span> ((<span class="keywordtype">id</span> = *pp++) != 0)
<a name="l00350"></a>00350         {
<a name="l00351"></a>00351           <span class="keywordflow">while</span> (<a class="code" href="pool_8h.html#a723c8c54fdd5d81be4b612c0d2868c2d">ISRELDEP</a>(<span class="keywordtype">id</span>))
<a name="l00352"></a>00352             {
<a name="l00353"></a>00353               <a class="code" href="struct__Reldep.html">Reldep</a> *rd = <a class="code" href="pool_8h.html#a7f1a1ed4e318be6edd66e5d94d7912bb">GETRELDEP</a>(pool, <span class="keywordtype">id</span>);
<a name="l00354"></a>00354               <span class="keywordtype">id</span> = rd-&gt;<a class="code" href="struct__Reldep.html#a0fa6e0cb741e79dcd2e92d9e65cf8ce5">name</a>;
<a name="l00355"></a>00355             }
<a name="l00356"></a>00356           d = whatprovidesdata + whatprovides[id];   <span class="comment">/* offset into whatprovidesdata */</span>
<a name="l00357"></a>00357           <span class="keywordflow">if</span> (*d != i)          <span class="comment">/* don&#39;t add same solvable twice */</span>
<a name="l00358"></a>00358             {
<a name="l00359"></a>00359               d[-1] = i;
<a name="l00360"></a>00360               whatprovides[id]--;
<a name="l00361"></a>00361             }
<a name="l00362"></a>00362         }
<a name="l00363"></a>00363     }
<a name="l00364"></a>00364   pool-&gt;<a class="code" href="struct__Pool.html#a0cdb8c9d12440e6e59b7b569259ef493">whatprovidesdata</a> = whatprovidesdata;
<a name="l00365"></a>00365   pool-&gt;<a class="code" href="struct__Pool.html#ac811604b741766bfa5a6c0846144041b">whatprovidesdataoff</a> = off;
<a name="l00366"></a>00366   pool-&gt;<a class="code" href="struct__Pool.html#aa985d83455680bfbb5ce5503338f8e1d">whatprovidesdataleft</a> = extra;
<a name="l00367"></a>00367   <a class="code" href="pool_8c.html#a8c3c762abfedc4e9a89adadaf3ccc6be">pool_shrink_whatprovides</a>(pool);
<a name="l00368"></a>00368   <a class="code" href="pool_8h.html#ac2855e39d8eaea31be68bd0fd03574b5">POOL_DEBUG</a>(<a class="code" href="pool_8h.html#a9e7c48e08e7b2a51b41e4d6611a02ace">SAT_DEBUG_STATS</a>, <span class="stringliteral">&quot;whatprovides memory used: %d K id array, %d K data\n&quot;</span>, (pool-&gt;<a class="code" href="struct__Pool.html#afa7b61374ab18cfea97f12796850a638">ss</a>.<a class="code" href="struct__Stringpool.html#a2bf0e8ba450ec30d60076977912dfd5f">nstrings</a> + pool-&gt;<a class="code" href="struct__Pool.html#ae4eb69a89bfd02139401474c41f1c82d">nrels</a> + <a class="code" href="poolid__private_8h.html#a69c98be15a33ae7f76b0638bb9fb2fe3">WHATPROVIDES_BLOCK</a>) / (<span class="keywordtype">int</span>)(1024/<span class="keyword">sizeof</span>(<a class="code" href="pooltypes_8h.html#a2e0e6278ac51842ca3aeb53e3fc3ead6">Id</a>)), (pool-&gt;<a class="code" href="struct__Pool.html#ac811604b741766bfa5a6c0846144041b">whatprovidesdataoff</a> + pool-&gt;<a class="code" href="struct__Pool.html#aa985d83455680bfbb5ce5503338f8e1d">whatprovidesdataleft</a>) / (<span class="keywordtype">int</span>)(1024/<span class="keyword">sizeof</span>(<a class="code" href="pooltypes_8h.html#a2e0e6278ac51842ca3aeb53e3fc3ead6">Id</a>)));
<a name="l00369"></a>00369   <a class="code" href="pool_8h.html#ac2855e39d8eaea31be68bd0fd03574b5">POOL_DEBUG</a>(<a class="code" href="pool_8h.html#a9e7c48e08e7b2a51b41e4d6611a02ace">SAT_DEBUG_STATS</a>, <span class="stringliteral">&quot;createwhatprovides took %d ms\n&quot;</span>, <a class="code" href="util_8c.html#a10875c1838f0632aabf1a919135a06ee">sat_timems</a>(now));
<a name="l00370"></a>00370 }
<a name="l00371"></a>00371 
<a name="l00372"></a>00372 <span class="comment">/*</span>
<a name="l00373"></a>00373 <span class="comment"> * free all of our whatprovides data</span>
<a name="l00374"></a>00374 <span class="comment"> * be careful, everything internalized with pool_queuetowhatprovides is</span>
<a name="l00375"></a>00375 <span class="comment"> * gone, too</span>
<a name="l00376"></a>00376 <span class="comment"> */</span>
<a name="l00377"></a>00377 <span class="keywordtype">void</span>
<a name="l00378"></a><a class="code" href="pool_8h.html#a14dd275466a52e37d15ba44422bffe81">00378</a> <a class="code" href="pool_8c.html#a14dd275466a52e37d15ba44422bffe81">pool_freewhatprovides</a>(<a class="code" href="struct__Pool.html">Pool</a> *pool)
<a name="l00379"></a>00379 {
<a name="l00380"></a>00380   pool-&gt;<a class="code" href="struct__Pool.html#a7b0e54d95aef1bc00bda08c2c844d377">whatprovides</a> = <a class="code" href="util_8c.html#a1f246fae10a89534cfe0583cefb44c11">sat_free</a>(pool-&gt;<a class="code" href="struct__Pool.html#a7b0e54d95aef1bc00bda08c2c844d377">whatprovides</a>);
<a name="l00381"></a>00381   pool-&gt;<a class="code" href="struct__Pool.html#ab2a4049b7aafbf2dc18c64eaf3367824">whatprovides_rel</a> = <a class="code" href="util_8c.html#a1f246fae10a89534cfe0583cefb44c11">sat_free</a>(pool-&gt;<a class="code" href="struct__Pool.html#ab2a4049b7aafbf2dc18c64eaf3367824">whatprovides_rel</a>);
<a name="l00382"></a>00382   pool-&gt;<a class="code" href="struct__Pool.html#a0cdb8c9d12440e6e59b7b569259ef493">whatprovidesdata</a> = <a class="code" href="util_8c.html#a1f246fae10a89534cfe0583cefb44c11">sat_free</a>(pool-&gt;<a class="code" href="struct__Pool.html#a0cdb8c9d12440e6e59b7b569259ef493">whatprovidesdata</a>);
<a name="l00383"></a>00383   pool-&gt;<a class="code" href="struct__Pool.html#ac811604b741766bfa5a6c0846144041b">whatprovidesdataoff</a> = 0;
<a name="l00384"></a>00384   pool-&gt;<a class="code" href="struct__Pool.html#aa985d83455680bfbb5ce5503338f8e1d">whatprovidesdataleft</a> = 0;
<a name="l00385"></a>00385 }
<a name="l00386"></a>00386 
<a name="l00387"></a>00387 
<a name="l00388"></a>00388 <span class="comment">/******************************************************************************/</span>
<a name="l00389"></a>00389 
<a name="l00390"></a>00390 <span class="comment">/*</span>
<a name="l00391"></a>00391 <span class="comment"> * pool_queuetowhatprovides  - add queue contents to whatprovidesdata</span>
<a name="l00392"></a>00392 <span class="comment"> * </span>
<a name="l00393"></a>00393 <span class="comment"> * on-demand filling of provider information</span>
<a name="l00394"></a>00394 <span class="comment"> * move queue data into whatprovidesdata</span>
<a name="l00395"></a>00395 <span class="comment"> * q: queue of Ids</span>
<a name="l00396"></a>00396 <span class="comment"> * returns: Offset into whatprovides</span>
<a name="l00397"></a>00397 <span class="comment"> *</span>
<a name="l00398"></a>00398 <span class="comment"> */</span>
<a name="l00399"></a>00399 <a class="code" href="pooltypes_8h.html#a2e0e6278ac51842ca3aeb53e3fc3ead6">Id</a>
<a name="l00400"></a><a class="code" href="pool_8h.html#a951749501558dae97cb20b059652f7fb">00400</a> <a class="code" href="pool_8c.html#a951749501558dae97cb20b059652f7fb">pool_queuetowhatprovides</a>(<a class="code" href="struct__Pool.html">Pool</a> *pool, <a class="code" href="struct__Queue.html">Queue</a> *q)
<a name="l00401"></a>00401 {
<a name="l00402"></a>00402   <a class="code" href="pooltypes_8h.html#ac8d1df6975469fe7c63e8a750755200f">Offset</a> off;
<a name="l00403"></a>00403   <span class="keywordtype">int</span> count = q-&gt;<a class="code" href="struct__Queue.html#abb0696a77174cd23b5f488ad4c7b45d2">count</a>;
<a name="l00404"></a>00404 
<a name="l00405"></a>00405   <span class="keywordflow">if</span> (count == 0)                      <span class="comment">/* queue empty -&gt; 1 */</span>
<a name="l00406"></a>00406     <span class="keywordflow">return</span> 1;
<a name="l00407"></a>00407 
<a name="l00408"></a>00408   <span class="comment">/* extend whatprovidesdata if needed, +1 for ID_NULL-termination */</span>
<a name="l00409"></a>00409   <span class="keywordflow">if</span> (pool-&gt;<a class="code" href="struct__Pool.html#aa985d83455680bfbb5ce5503338f8e1d">whatprovidesdataleft</a> &lt; count + 1)
<a name="l00410"></a>00410     {
<a name="l00411"></a>00411       <a class="code" href="pool_8h.html#ac2855e39d8eaea31be68bd0fd03574b5">POOL_DEBUG</a>(<a class="code" href="pool_8h.html#a9e7c48e08e7b2a51b41e4d6611a02ace">SAT_DEBUG_STATS</a>, <span class="stringliteral">&quot;growing provides hash data...\n&quot;</span>);
<a name="l00412"></a>00412       pool-&gt;<a class="code" href="struct__Pool.html#a0cdb8c9d12440e6e59b7b569259ef493">whatprovidesdata</a> = <a class="code" href="util_8c.html#a43839a29e1a3e9f13247e89c9057d6fa">sat_realloc</a>(pool-&gt;<a class="code" href="struct__Pool.html#a0cdb8c9d12440e6e59b7b569259ef493">whatprovidesdata</a>, (pool-&gt;<a class="code" href="struct__Pool.html#ac811604b741766bfa5a6c0846144041b">whatprovidesdataoff</a> + count + 4096) * <span class="keyword">sizeof</span>(<a class="code" href="pooltypes_8h.html#a2e0e6278ac51842ca3aeb53e3fc3ead6">Id</a>));
<a name="l00413"></a>00413       pool-&gt;<a class="code" href="struct__Pool.html#aa985d83455680bfbb5ce5503338f8e1d">whatprovidesdataleft</a> = count + 4096;
<a name="l00414"></a>00414     }
<a name="l00415"></a>00415 
<a name="l00416"></a>00416   <span class="comment">/* copy queue to next free slot */</span>
<a name="l00417"></a>00417   off = pool-&gt;<a class="code" href="struct__Pool.html#ac811604b741766bfa5a6c0846144041b">whatprovidesdataoff</a>;
<a name="l00418"></a>00418   memcpy(pool-&gt;<a class="code" href="struct__Pool.html#a0cdb8c9d12440e6e59b7b569259ef493">whatprovidesdata</a> + pool-&gt;<a class="code" href="struct__Pool.html#ac811604b741766bfa5a6c0846144041b">whatprovidesdataoff</a>, q-&gt;<a class="code" href="struct__Queue.html#a116eb58bed8ff76bf18f9c16cf1ce5c6">elements</a>, count * <span class="keyword">sizeof</span>(<a class="code" href="pooltypes_8h.html#a2e0e6278ac51842ca3aeb53e3fc3ead6">Id</a>));
<a name="l00419"></a>00419 
<a name="l00420"></a>00420   <span class="comment">/* adapt count and ID_NULL-terminate */</span>
<a name="l00421"></a>00421   pool-&gt;<a class="code" href="struct__Pool.html#ac811604b741766bfa5a6c0846144041b">whatprovidesdataoff</a> += count;
<a name="l00422"></a>00422   pool-&gt;<a class="code" href="struct__Pool.html#a0cdb8c9d12440e6e59b7b569259ef493">whatprovidesdata</a>[pool-&gt;<a class="code" href="struct__Pool.html#ac811604b741766bfa5a6c0846144041b">whatprovidesdataoff</a>++] = ID_NULL;
<a name="l00423"></a>00423   pool-&gt;<a class="code" href="struct__Pool.html#aa985d83455680bfbb5ce5503338f8e1d">whatprovidesdataleft</a> -= count + 1;
<a name="l00424"></a>00424 
<a name="l00425"></a>00425   <span class="keywordflow">return</span> (<a class="code" href="pooltypes_8h.html#a2e0e6278ac51842ca3aeb53e3fc3ead6">Id</a>)off;
<a name="l00426"></a>00426 }
<a name="l00427"></a>00427 
<a name="l00428"></a>00428 
<a name="l00429"></a>00429 <span class="comment">/*************************************************************************/</span>
<a name="l00430"></a>00430 
<a name="l00431"></a>00431 <span class="preprocessor">#if defined(MULTI_SEMANTICS)</span>
<a name="l00432"></a>00432 <span class="preprocessor"></span><span class="preprocessor"># define EVRCMP_DEPCMP (pool-&gt;disttype == DISTTYPE_DEB ? EVRCMP_COMPARE : EVRCMP_MATCH_RELEASE)</span>
<a name="l00433"></a>00433 <span class="preprocessor"></span><span class="preprocessor">#elif defined(DEBIAN_SEMANTICS)</span>
<a name="l00434"></a>00434 <span class="preprocessor"></span><span class="preprocessor"># define EVRCMP_DEPCMP EVRCMP_COMPARE</span>
<a name="l00435"></a>00435 <span class="preprocessor"></span><span class="preprocessor">#else</span>
<a name="l00436"></a><a class="code" href="pool_8c.html#a1c51217cfa64349f5dcb7e420c197705">00436</a> <span class="preprocessor"></span><span class="preprocessor"># define EVRCMP_DEPCMP EVRCMP_MATCH_RELEASE</span>
<a name="l00437"></a>00437 <span class="preprocessor"></span><span class="preprocessor">#endif</span>
<a name="l00438"></a>00438 <span class="preprocessor"></span>
<a name="l00439"></a>00439 <span class="comment">/* check if a package&#39;s nevr matches a dependency */</span>
<a name="l00440"></a>00440 
<a name="l00441"></a>00441 <span class="keywordtype">int</span>
<a name="l00442"></a><a class="code" href="pool_8h.html#a667de17afd950d2100da4c24269e8079">00442</a> <a class="code" href="pool_8c.html#a667de17afd950d2100da4c24269e8079">pool_match_nevr_rel</a>(<a class="code" href="struct__Pool.html">Pool</a> *pool, <a class="code" href="struct__Solvable.html">Solvable</a> *s, <a class="code" href="pooltypes_8h.html#a2e0e6278ac51842ca3aeb53e3fc3ead6">Id</a> d)
<a name="l00443"></a>00443 {
<a name="l00444"></a>00444   <a class="code" href="struct__Reldep.html">Reldep</a> *rd = <a class="code" href="pool_8h.html#a7f1a1ed4e318be6edd66e5d94d7912bb">GETRELDEP</a>(pool, d);
<a name="l00445"></a>00445   <a class="code" href="pooltypes_8h.html#a2e0e6278ac51842ca3aeb53e3fc3ead6">Id</a> name = rd-&gt;<a class="code" href="struct__Reldep.html#a0fa6e0cb741e79dcd2e92d9e65cf8ce5">name</a>;
<a name="l00446"></a>00446   <a class="code" href="pooltypes_8h.html#a2e0e6278ac51842ca3aeb53e3fc3ead6">Id</a> evr = rd-&gt;<a class="code" href="struct__Reldep.html#ae2f8a0a4b825a136c57b3f447e0007d0">evr</a>;
<a name="l00447"></a>00447   <span class="keywordtype">int</span> flags = rd-&gt;<a class="code" href="struct__Reldep.html#a05495175469a6853de6455b96ad1b2f4">flags</a>;
<a name="l00448"></a>00448 
<a name="l00449"></a>00449   <span class="keywordflow">if</span> (flags &gt; 7)
<a name="l00450"></a>00450     {
<a name="l00451"></a>00451       <span class="keywordflow">switch</span> (flags)
<a name="l00452"></a>00452         {
<a name="l00453"></a>00453         <span class="keywordflow">case</span> <a class="code" href="pool_8h.html#ab77ef2ecc7e71011a7d40274340e1efb">REL_ARCH</a>:
<a name="l00454"></a>00454           <span class="keywordflow">if</span> (s-&gt;<a class="code" href="struct__Solvable.html#a51ba374144373934101befc2bd20150b">arch</a> != evr)
<a name="l00455"></a>00455             <span class="keywordflow">return</span> 0;
<a name="l00456"></a>00456           <span class="keywordflow">return</span> <a class="code" href="pool_8h.html#a1f2bd95045b7a58d9237da8aeaeee6de">pool_match_nevr</a>(pool, s, name);
<a name="l00457"></a>00457         <span class="keywordflow">case</span> <a class="code" href="pool_8h.html#a71bae2aeb6a481e83f1a860135247d46">REL_OR</a>:
<a name="l00458"></a>00458           <span class="keywordflow">if</span> (<a class="code" href="pool_8h.html#a1f2bd95045b7a58d9237da8aeaeee6de">pool_match_nevr</a>(pool, s, name))
<a name="l00459"></a>00459             <span class="keywordflow">return</span> 1;
<a name="l00460"></a>00460           <span class="keywordflow">return</span> <a class="code" href="pool_8h.html#a1f2bd95045b7a58d9237da8aeaeee6de">pool_match_nevr</a>(pool, s, evr);
<a name="l00461"></a>00461         <span class="keywordflow">case</span> <a class="code" href="pool_8h.html#a9ac9bdbe363e6214d52ba84044185f17">REL_AND</a>:
<a name="l00462"></a>00462         <span class="keywordflow">case</span> <a class="code" href="pool_8h.html#aa5e2abb7b838bb7bcb705cab2350c5c3">REL_WITH</a>:
<a name="l00463"></a>00463           <span class="keywordflow">if</span> (!<a class="code" href="pool_8h.html#a1f2bd95045b7a58d9237da8aeaeee6de">pool_match_nevr</a>(pool, s, name))
<a name="l00464"></a>00464             <span class="keywordflow">return</span> 0;
<a name="l00465"></a>00465           <span class="keywordflow">return</span> <a class="code" href="pool_8h.html#a1f2bd95045b7a58d9237da8aeaeee6de">pool_match_nevr</a>(pool, s, evr);
<a name="l00466"></a>00466         <span class="keywordflow">default</span>:
<a name="l00467"></a>00467           <span class="keywordflow">return</span> 0;
<a name="l00468"></a>00468         }
<a name="l00469"></a>00469     }
<a name="l00470"></a>00470   <span class="keywordflow">if</span> (!<a class="code" href="pool_8h.html#a1f2bd95045b7a58d9237da8aeaeee6de">pool_match_nevr</a>(pool, s, name))
<a name="l00471"></a>00471     <span class="keywordflow">return</span> 0;
<a name="l00472"></a>00472   <span class="keywordflow">if</span> (evr == s-&gt;<a class="code" href="struct__Solvable.html#ae776af434c21800db6c01a75c2e6a4f6">evr</a>)
<a name="l00473"></a>00473     <span class="keywordflow">return</span> flags &amp; 2 ? 1 : 0;
<a name="l00474"></a>00474   <span class="keywordflow">if</span> (!flags)
<a name="l00475"></a>00475     <span class="keywordflow">return</span> 0;
<a name="l00476"></a>00476   <span class="keywordflow">if</span> (flags == 7)
<a name="l00477"></a>00477     <span class="keywordflow">return</span> 1;
<a name="l00478"></a>00478   <span class="keywordflow">if</span> (flags != 2 &amp;&amp; flags != 5)
<a name="l00479"></a>00479     flags ^= 5;
<a name="l00480"></a>00480   <span class="keywordflow">if</span> ((flags &amp; (1 &lt;&lt; (1 + <a class="code" href="evr_8c.html#af1c0c1a0a8bb84cb85d4e9c9707330ba">evrcmp</a>(pool, s-&gt;<a class="code" href="struct__Solvable.html#ae776af434c21800db6c01a75c2e6a4f6">evr</a>, evr, <a class="code" href="pool_8c.html#a1c51217cfa64349f5dcb7e420c197705">EVRCMP_DEPCMP</a>)))) != 0)
<a name="l00481"></a>00481     <span class="keywordflow">return</span> 1;
<a name="l00482"></a>00482   <span class="keywordflow">return</span> 0;
<a name="l00483"></a>00483 }
<a name="l00484"></a>00484 
<a name="l00485"></a>00485 <span class="comment">/* match (flags, evr) against provider (pflags, pevr) */</span>
<a name="l00486"></a>00486 <span class="keyword">static</span> <span class="keyword">inline</span> <span class="keywordtype">int</span>
<a name="l00487"></a><a class="code" href="pool_8c.html#af2a7365363135c485a8f2247a97244c8">00487</a> <a class="code" href="pool_8c.html#af2a7365363135c485a8f2247a97244c8">pool_match_flags_evr</a>(<a class="code" href="struct__Pool.html">Pool</a> *pool, <span class="keywordtype">int</span> pflags, <a class="code" href="pooltypes_8h.html#a2e0e6278ac51842ca3aeb53e3fc3ead6">Id</a> pevr, <span class="keywordtype">int</span> flags, <span class="keywordtype">int</span> evr)
<a name="l00488"></a>00488 {
<a name="l00489"></a>00489   <span class="keywordflow">if</span> (!pflags || !flags || pflags &gt;= 8 || flags &gt;= 8)
<a name="l00490"></a>00490     <span class="keywordflow">return</span> 0;
<a name="l00491"></a>00491   <span class="keywordflow">if</span> (flags == 7 || pflags == 7)
<a name="l00492"></a>00492     <span class="keywordflow">return</span> 1;           <span class="comment">/* rel provides every version */</span>
<a name="l00493"></a>00493   <span class="keywordflow">if</span> ((pflags &amp; flags &amp; 5) != 0)
<a name="l00494"></a>00494     <span class="keywordflow">return</span> 1;           <span class="comment">/* both rels show in the same direction */</span>
<a name="l00495"></a>00495   <span class="keywordflow">if</span> (pevr == evr)
<a name="l00496"></a>00496     {
<a name="l00497"></a>00497       <span class="keywordflow">if</span> ((pflags &amp; flags &amp; 2) != 0)
<a name="l00498"></a>00498         <span class="keywordflow">return</span> 1;       <span class="comment">/* both have &#39;=&#39;, match */</span>
<a name="l00499"></a>00499     }
<a name="l00500"></a>00500   <span class="keywordflow">else</span>
<a name="l00501"></a>00501     {
<a name="l00502"></a>00502       <span class="keywordtype">int</span> f = flags == 5 ? 5 : flags == 2 ? pflags : (flags ^ 5) &amp; (pflags | 5);
<a name="l00503"></a>00503       <span class="keywordflow">if</span> ((f &amp; (1 &lt;&lt; (1 + <a class="code" href="evr_8c.html#af1c0c1a0a8bb84cb85d4e9c9707330ba">evrcmp</a>(pool, pevr, evr, <a class="code" href="pool_8c.html#a1c51217cfa64349f5dcb7e420c197705">EVRCMP_DEPCMP</a>)))) != 0)
<a name="l00504"></a>00504         <span class="keywordflow">return</span> 1;
<a name="l00505"></a>00505     }
<a name="l00506"></a>00506   <span class="keywordflow">return</span> 0;
<a name="l00507"></a>00507 }
<a name="l00508"></a>00508 
<a name="l00509"></a>00509 <span class="comment">/* match two dependencies (d1 = provider) */</span>
<a name="l00510"></a>00510 
<a name="l00511"></a>00511 <span class="keywordtype">int</span>
<a name="l00512"></a><a class="code" href="pool_8h.html#aa44931e0100c67d88f0dba6a0c312645">00512</a> <a class="code" href="pool_8c.html#aa44931e0100c67d88f0dba6a0c312645">pool_match_dep</a>(<a class="code" href="struct__Pool.html">Pool</a> *pool, <a class="code" href="pooltypes_8h.html#a2e0e6278ac51842ca3aeb53e3fc3ead6">Id</a> d1, <a class="code" href="pooltypes_8h.html#a2e0e6278ac51842ca3aeb53e3fc3ead6">Id</a> d2)
<a name="l00513"></a>00513 {
<a name="l00514"></a>00514   <a class="code" href="struct__Reldep.html">Reldep</a> *rd1, *rd2;
<a name="l00515"></a>00515 
<a name="l00516"></a>00516   <span class="keywordflow">if</span> (d1 == d2)
<a name="l00517"></a>00517     <span class="keywordflow">return</span> 1;
<a name="l00518"></a>00518   <span class="keywordflow">if</span> (!<a class="code" href="pool_8h.html#a723c8c54fdd5d81be4b612c0d2868c2d">ISRELDEP</a>(d1))
<a name="l00519"></a>00519     {
<a name="l00520"></a>00520       <span class="keywordflow">if</span> (!<a class="code" href="pool_8h.html#a723c8c54fdd5d81be4b612c0d2868c2d">ISRELDEP</a>(d2))
<a name="l00521"></a>00521         <span class="keywordflow">return</span> 0;
<a name="l00522"></a>00522       rd2 = <a class="code" href="pool_8h.html#a7f1a1ed4e318be6edd66e5d94d7912bb">GETRELDEP</a>(pool, d2);
<a name="l00523"></a>00523       <span class="keywordflow">return</span> <a class="code" href="pool_8c.html#aa44931e0100c67d88f0dba6a0c312645">pool_match_dep</a>(pool, d1, rd2-&gt;<a class="code" href="struct__Reldep.html#a0fa6e0cb741e79dcd2e92d9e65cf8ce5">name</a>);
<a name="l00524"></a>00524     }
<a name="l00525"></a>00525   rd1 = <a class="code" href="pool_8h.html#a7f1a1ed4e318be6edd66e5d94d7912bb">GETRELDEP</a>(pool, d1);
<a name="l00526"></a>00526   <span class="keywordflow">if</span> (!<a class="code" href="pool_8h.html#a723c8c54fdd5d81be4b612c0d2868c2d">ISRELDEP</a>(d2))
<a name="l00527"></a>00527     {
<a name="l00528"></a>00528       <span class="keywordflow">return</span> <a class="code" href="pool_8c.html#aa44931e0100c67d88f0dba6a0c312645">pool_match_dep</a>(pool, rd1-&gt;<a class="code" href="struct__Reldep.html#a0fa6e0cb741e79dcd2e92d9e65cf8ce5">name</a>, d2);
<a name="l00529"></a>00529     }
<a name="l00530"></a>00530   rd2 = <a class="code" href="pool_8h.html#a7f1a1ed4e318be6edd66e5d94d7912bb">GETRELDEP</a>(pool, d2);
<a name="l00531"></a>00531   <span class="comment">/* first match name */</span>
<a name="l00532"></a>00532   <span class="keywordflow">if</span> (!<a class="code" href="pool_8c.html#aa44931e0100c67d88f0dba6a0c312645">pool_match_dep</a>(pool, rd1-&gt;<a class="code" href="struct__Reldep.html#a0fa6e0cb741e79dcd2e92d9e65cf8ce5">name</a>, rd2-&gt;<a class="code" href="struct__Reldep.html#a0fa6e0cb741e79dcd2e92d9e65cf8ce5">name</a>))
<a name="l00533"></a>00533     <span class="keywordflow">return</span> 0;
<a name="l00534"></a>00534   <span class="comment">/* name matches, check flags and evr */</span>
<a name="l00535"></a>00535   <span class="keywordflow">return</span> <a class="code" href="pool_8c.html#af2a7365363135c485a8f2247a97244c8">pool_match_flags_evr</a>(pool, rd1-&gt;<a class="code" href="struct__Reldep.html#a05495175469a6853de6455b96ad1b2f4">flags</a>, rd1-&gt;<a class="code" href="struct__Reldep.html#ae2f8a0a4b825a136c57b3f447e0007d0">evr</a>, rd2-&gt;<a class="code" href="struct__Reldep.html#a05495175469a6853de6455b96ad1b2f4">flags</a>, rd2-&gt;<a class="code" href="struct__Reldep.html#ae2f8a0a4b825a136c57b3f447e0007d0">evr</a>);
<a name="l00536"></a>00536 }
<a name="l00537"></a>00537 
<a name="l00538"></a>00538 <span class="comment">/*</span>
<a name="l00539"></a>00539 <span class="comment"> * addrelproviders</span>
<a name="l00540"></a>00540 <span class="comment"> * </span>
<a name="l00541"></a>00541 <span class="comment"> * add packages fulfilling the relation to whatprovides array</span>
<a name="l00542"></a>00542 <span class="comment"> * no exact providers, do range match</span>
<a name="l00543"></a>00543 <span class="comment"> * </span>
<a name="l00544"></a>00544 <span class="comment"> */</span>
<a name="l00545"></a>00545 
<a name="l00546"></a>00546 <a class="code" href="pooltypes_8h.html#a2e0e6278ac51842ca3aeb53e3fc3ead6">Id</a>
<a name="l00547"></a><a class="code" href="pool_8h.html#a56a7007b2a5c3cad62a38bd30bb85178">00547</a> <a class="code" href="pool_8c.html#a56a7007b2a5c3cad62a38bd30bb85178">pool_addrelproviders</a>(<a class="code" href="struct__Pool.html">Pool</a> *pool, <a class="code" href="pooltypes_8h.html#a2e0e6278ac51842ca3aeb53e3fc3ead6">Id</a> d)
<a name="l00548"></a>00548 {
<a name="l00549"></a>00549   <a class="code" href="struct__Reldep.html">Reldep</a> *rd = <a class="code" href="pool_8h.html#a7f1a1ed4e318be6edd66e5d94d7912bb">GETRELDEP</a>(pool, d);
<a name="l00550"></a>00550   <a class="code" href="struct__Reldep.html">Reldep</a> *prd;
<a name="l00551"></a>00551   <a class="code" href="struct__Queue.html">Queue</a> plist;
<a name="l00552"></a>00552   <a class="code" href="pooltypes_8h.html#a2e0e6278ac51842ca3aeb53e3fc3ead6">Id</a> buf[16];
<a name="l00553"></a>00553   <a class="code" href="pooltypes_8h.html#a2e0e6278ac51842ca3aeb53e3fc3ead6">Id</a> name = rd-&gt;<a class="code" href="struct__Reldep.html#a0fa6e0cb741e79dcd2e92d9e65cf8ce5">name</a>;
<a name="l00554"></a>00554   <a class="code" href="pooltypes_8h.html#a2e0e6278ac51842ca3aeb53e3fc3ead6">Id</a> evr = rd-&gt;<a class="code" href="struct__Reldep.html#ae2f8a0a4b825a136c57b3f447e0007d0">evr</a>;
<a name="l00555"></a>00555   <span class="keywordtype">int</span> flags = rd-&gt;<a class="code" href="struct__Reldep.html#a05495175469a6853de6455b96ad1b2f4">flags</a>;
<a name="l00556"></a>00556   <a class="code" href="pooltypes_8h.html#a2e0e6278ac51842ca3aeb53e3fc3ead6">Id</a> pid, *pidp;
<a name="l00557"></a>00557   <a class="code" href="pooltypes_8h.html#a2e0e6278ac51842ca3aeb53e3fc3ead6">Id</a> p, *pp;
<a name="l00558"></a>00558 
<a name="l00559"></a>00559   d = <a class="code" href="pool_8h.html#a45170c4b0420778f3a8e3780bfeee43e">GETRELID</a>(d);
<a name="l00560"></a>00560   <a class="code" href="queue_8c.html#a5988db301609a3b7ab6666e50c61430e">queue_init_buffer</a>(&amp;plist, buf, <span class="keyword">sizeof</span>(buf)/<span class="keyword">sizeof</span>(*buf));
<a name="l00561"></a>00561 
<a name="l00562"></a>00562   <span class="keywordflow">if</span> (flags &gt;= 8)
<a name="l00563"></a>00563     {
<a name="l00564"></a>00564       <span class="comment">/* special relation */</span>
<a name="l00565"></a>00565       <a class="code" href="pooltypes_8h.html#a2e0e6278ac51842ca3aeb53e3fc3ead6">Id</a> wp = 0;
<a name="l00566"></a>00566       <a class="code" href="pooltypes_8h.html#a2e0e6278ac51842ca3aeb53e3fc3ead6">Id</a> *pp2, *pp3;
<a name="l00567"></a>00567 
<a name="l00568"></a>00568       <span class="keywordflow">switch</span> (flags)
<a name="l00569"></a>00569         {
<a name="l00570"></a>00570         <span class="keywordflow">case</span> <a class="code" href="pool_8h.html#a9ac9bdbe363e6214d52ba84044185f17">REL_AND</a>:
<a name="l00571"></a>00571         <span class="keywordflow">case</span> <a class="code" href="pool_8h.html#aa5e2abb7b838bb7bcb705cab2350c5c3">REL_WITH</a>:
<a name="l00572"></a>00572           wp = <a class="code" href="pool_8h.html#a3cad3c123b71f28a59a92cafa2ae1140">pool_whatprovides</a>(pool, name);
<a name="l00573"></a>00573           pp2 = <a class="code" href="pool_8h.html#af21fe308922972607173d0fe4d197fae">pool_whatprovides_ptr</a>(pool, evr);
<a name="l00574"></a>00574           pp = pool-&gt;<a class="code" href="struct__Pool.html#a0cdb8c9d12440e6e59b7b569259ef493">whatprovidesdata</a> + wp;
<a name="l00575"></a>00575           <span class="keywordflow">while</span> ((p = *pp++) != 0)
<a name="l00576"></a>00576             {
<a name="l00577"></a>00577               <span class="keywordflow">for</span> (pp3 = pp2; *pp3; pp3++)
<a name="l00578"></a>00578                 <span class="keywordflow">if</span> (*pp3 == p)
<a name="l00579"></a>00579                   <span class="keywordflow">break</span>;
<a name="l00580"></a>00580               <span class="keywordflow">if</span> (*pp3)
<a name="l00581"></a>00581                 <a class="code" href="queue_8h.html#a3ba172138b6a04f289def63b198057f1">queue_push</a>(&amp;plist, p);  <span class="comment">/* found it */</span>
<a name="l00582"></a>00582               <span class="keywordflow">else</span>
<a name="l00583"></a>00583                 wp = 0;
<a name="l00584"></a>00584             }
<a name="l00585"></a>00585           <span class="keywordflow">break</span>;
<a name="l00586"></a>00586         <span class="keywordflow">case</span> <a class="code" href="pool_8h.html#a71bae2aeb6a481e83f1a860135247d46">REL_OR</a>:
<a name="l00587"></a>00587           wp = <a class="code" href="pool_8h.html#a3cad3c123b71f28a59a92cafa2ae1140">pool_whatprovides</a>(pool, name);
<a name="l00588"></a>00588           pp = pool-&gt;<a class="code" href="struct__Pool.html#a0cdb8c9d12440e6e59b7b569259ef493">whatprovidesdata</a> + wp;
<a name="l00589"></a>00589           <span class="keywordflow">if</span> (!*pp)
<a name="l00590"></a>00590             wp = <a class="code" href="pool_8h.html#a3cad3c123b71f28a59a92cafa2ae1140">pool_whatprovides</a>(pool, evr);
<a name="l00591"></a>00591           <span class="keywordflow">else</span>
<a name="l00592"></a>00592             {
<a name="l00593"></a>00593               <span class="keywordtype">int</span> cnt;
<a name="l00594"></a>00594               <span class="keywordflow">while</span> ((p = *pp++) != 0)
<a name="l00595"></a>00595                 <a class="code" href="queue_8h.html#a3ba172138b6a04f289def63b198057f1">queue_push</a>(&amp;plist, p);
<a name="l00596"></a>00596               cnt = plist.<a class="code" href="struct__Queue.html#abb0696a77174cd23b5f488ad4c7b45d2">count</a>;
<a name="l00597"></a>00597               pp = <a class="code" href="pool_8h.html#af21fe308922972607173d0fe4d197fae">pool_whatprovides_ptr</a>(pool, evr);
<a name="l00598"></a>00598               <span class="keywordflow">while</span> ((p = *pp++) != 0)
<a name="l00599"></a>00599                 <a class="code" href="queue_8h.html#af11d92559906d939f448d415105a66b3">queue_pushunique</a>(&amp;plist, p);
<a name="l00600"></a>00600               <span class="keywordflow">if</span> (plist.<a class="code" href="struct__Queue.html#abb0696a77174cd23b5f488ad4c7b45d2">count</a> != cnt)
<a name="l00601"></a>00601                 wp = 0;
<a name="l00602"></a>00602             }
<a name="l00603"></a>00603           <span class="keywordflow">break</span>;
<a name="l00604"></a>00604         <span class="keywordflow">case</span> <a class="code" href="pool_8h.html#a1bd7c2b318685c04b52146ed6f193244">REL_NAMESPACE</a>:
<a name="l00605"></a>00605           <span class="keywordflow">if</span> (name == NAMESPACE_OTHERPROVIDERS)
<a name="l00606"></a>00606             {
<a name="l00607"></a>00607               wp = <a class="code" href="pool_8h.html#a3cad3c123b71f28a59a92cafa2ae1140">pool_whatprovides</a>(pool, evr);
<a name="l00608"></a>00608               <span class="keywordflow">break</span>;
<a name="l00609"></a>00609             }
<a name="l00610"></a>00610           <span class="keywordflow">if</span> (pool-&gt;<a class="code" href="struct__Pool.html#a394848619bb0c128998ac3a7bce78056">nscallback</a>)
<a name="l00611"></a>00611             {
<a name="l00612"></a>00612               <span class="comment">/* ask callback which packages provide the dependency</span>
<a name="l00613"></a>00613 <span class="comment">               * 0:  none</span>
<a name="l00614"></a>00614 <span class="comment">               * 1:  the system (aka SYSTEMSOLVABLE)</span>
<a name="l00615"></a>00615 <span class="comment">               * &gt;1: set of packages, stored as offset on whatprovidesdata</span>
<a name="l00616"></a>00616 <span class="comment">               */</span>
<a name="l00617"></a>00617               p = pool-&gt;<a class="code" href="struct__Pool.html#a394848619bb0c128998ac3a7bce78056">nscallback</a>(pool, pool-&gt;<a class="code" href="struct__Pool.html#a07634a96058453c0703f73114c82afa1">nscallbackdata</a>, name, evr);
<a name="l00618"></a>00618               <span class="keywordflow">if</span> (p &gt; 1)
<a name="l00619"></a>00619                 wp = p;
<a name="l00620"></a>00620               <span class="keywordflow">if</span> (p == 1)
<a name="l00621"></a>00621                 <a class="code" href="queue_8h.html#a3ba172138b6a04f289def63b198057f1">queue_push</a>(&amp;plist, <a class="code" href="pool_8h.html#abd207d4eeed4b96e8dd1a25e2dce7f52">SYSTEMSOLVABLE</a>);
<a name="l00622"></a>00622             }
<a name="l00623"></a>00623           <span class="keywordflow">break</span>;
<a name="l00624"></a>00624         <span class="keywordflow">case</span> <a class="code" href="pool_8h.html#ab77ef2ecc7e71011a7d40274340e1efb">REL_ARCH</a>:
<a name="l00625"></a>00625           <span class="comment">/* small hack: make it possible to match &lt;pkg&gt;.src</span>
<a name="l00626"></a>00626 <span class="comment">           * we have to iterate over the solvables as src packages do not</span>
<a name="l00627"></a>00627 <span class="comment">           * provide anything, thus they are not indexed in our</span>
<a name="l00628"></a>00628 <span class="comment">           * whatprovides hash */</span>
<a name="l00629"></a>00629           <span class="keywordflow">if</span> (evr == ARCH_SRC)
<a name="l00630"></a>00630             {
<a name="l00631"></a>00631               <a class="code" href="struct__Solvable.html">Solvable</a> *s;
<a name="l00632"></a>00632               <span class="keywordflow">for</span> (p = 1, s = pool-&gt;<a class="code" href="struct__Pool.html#a9842c936aa241bad13ba13f21a337319">solvables</a> + p; p &lt; pool-&gt;nsolvables; p++, s++)
<a name="l00633"></a>00633                 {
<a name="l00634"></a>00634                   <span class="keywordflow">if</span> (s-&gt;<a class="code" href="struct__Solvable.html#a51ba374144373934101befc2bd20150b">arch</a> != ARCH_SRC &amp;&amp; s-&gt;<a class="code" href="struct__Solvable.html#a51ba374144373934101befc2bd20150b">arch</a> != ARCH_NOSRC)
<a name="l00635"></a>00635                     <span class="keywordflow">continue</span>;
<a name="l00636"></a>00636                   <span class="keywordflow">if</span> (<a class="code" href="pool_8h.html#a1f2bd95045b7a58d9237da8aeaeee6de">pool_match_nevr</a>(pool, s, name))
<a name="l00637"></a>00637                     <a class="code" href="queue_8h.html#a3ba172138b6a04f289def63b198057f1">queue_push</a>(&amp;plist, p);
<a name="l00638"></a>00638                 }
<a name="l00639"></a>00639               <span class="keywordflow">break</span>;
<a name="l00640"></a>00640             }
<a name="l00641"></a>00641           wp = <a class="code" href="pool_8h.html#a3cad3c123b71f28a59a92cafa2ae1140">pool_whatprovides</a>(pool, name);
<a name="l00642"></a>00642           pp = pool-&gt;<a class="code" href="struct__Pool.html#a0cdb8c9d12440e6e59b7b569259ef493">whatprovidesdata</a> + wp;
<a name="l00643"></a>00643           <span class="keywordflow">while</span> ((p = *pp++) != 0)
<a name="l00644"></a>00644             {
<a name="l00645"></a>00645               <a class="code" href="struct__Solvable.html">Solvable</a> *s = pool-&gt;<a class="code" href="struct__Pool.html#a9842c936aa241bad13ba13f21a337319">solvables</a> + p;
<a name="l00646"></a>00646               <span class="keywordflow">if</span> (s-&gt;<a class="code" href="struct__Solvable.html#a51ba374144373934101befc2bd20150b">arch</a> == evr)
<a name="l00647"></a>00647                 <a class="code" href="queue_8h.html#a3ba172138b6a04f289def63b198057f1">queue_push</a>(&amp;plist, p);
<a name="l00648"></a>00648               <span class="keywordflow">else</span>
<a name="l00649"></a>00649                 wp = 0;
<a name="l00650"></a>00650             }
<a name="l00651"></a>00651           <span class="keywordflow">break</span>;
<a name="l00652"></a>00652         <span class="keywordflow">case</span> <a class="code" href="pool_8h.html#ae76a4247e589585ea45295087a8bc806">REL_FILECONFLICT</a>:
<a name="l00653"></a>00653           pp = <a class="code" href="pool_8h.html#af21fe308922972607173d0fe4d197fae">pool_whatprovides_ptr</a>(pool, name);
<a name="l00654"></a>00654           <span class="keywordflow">while</span> ((p = *pp++) != 0)
<a name="l00655"></a>00655             {
<a name="l00656"></a>00656               <a class="code" href="pooltypes_8h.html#a2e0e6278ac51842ca3aeb53e3fc3ead6">Id</a> origd = <a class="code" href="pool_8h.html#a722fed0612f075570c90fb8ffc48e8d6">MAKERELDEP</a>(d);
<a name="l00657"></a>00657               <a class="code" href="struct__Solvable.html">Solvable</a> *s = pool-&gt;<a class="code" href="struct__Pool.html#a9842c936aa241bad13ba13f21a337319">solvables</a> + p;
<a name="l00658"></a>00658               <span class="keywordflow">if</span> (!s-&gt;<a class="code" href="struct__Solvable.html#aca85fe4ba80026035c22f0596db71657">provides</a>)
<a name="l00659"></a>00659                 <span class="keywordflow">continue</span>;
<a name="l00660"></a>00660               pidp = s-&gt;<a class="code" href="struct__Solvable.html#a15e0b77fe061c6429a24215191b10f05">repo</a>-&gt;<a class="code" href="struct__Repo.html#afddcfa36231cc08266800bee5b978528">idarraydata</a> + s-&gt;<a class="code" href="struct__Solvable.html#aca85fe4ba80026035c22f0596db71657">provides</a>;
<a name="l00661"></a>00661               <span class="keywordflow">while</span> ((pid = *pidp++) != 0)
<a name="l00662"></a>00662                 <span class="keywordflow">if</span> (pid == origd)
<a name="l00663"></a>00663                   <span class="keywordflow">break</span>;
<a name="l00664"></a>00664               <span class="keywordflow">if</span> (pid)
<a name="l00665"></a>00665                 <a class="code" href="queue_8h.html#a3ba172138b6a04f289def63b198057f1">queue_push</a>(&amp;plist, p);
<a name="l00666"></a>00666             }
<a name="l00667"></a>00667           <span class="keywordflow">break</span>;
<a name="l00668"></a>00668         <span class="keywordflow">default</span>:
<a name="l00669"></a>00669           <span class="keywordflow">break</span>;
<a name="l00670"></a>00670         }
<a name="l00671"></a>00671       <span class="keywordflow">if</span> (wp)
<a name="l00672"></a>00672         {
<a name="l00673"></a>00673           <span class="comment">/* we can reuse an existing entry */</span>
<a name="l00674"></a>00674           <a class="code" href="queue_8c.html#a701c81a9f7d503837e74d43981e79137">queue_free</a>(&amp;plist);
<a name="l00675"></a>00675           pool-&gt;<a class="code" href="struct__Pool.html#ab2a4049b7aafbf2dc18c64eaf3367824">whatprovides_rel</a>[d] = wp;
<a name="l00676"></a>00676           <span class="keywordflow">return</span> wp;
<a name="l00677"></a>00677         }
<a name="l00678"></a>00678     }
<a name="l00679"></a>00679   <span class="keywordflow">else</span> <span class="keywordflow">if</span> (flags)
<a name="l00680"></a>00680     {
<a name="l00681"></a>00681       <span class="comment">/* simple version comparison relation */</span>
<a name="l00682"></a>00682 <span class="preprocessor">#if 0</span>
<a name="l00683"></a>00683 <span class="preprocessor"></span>      <a class="code" href="pool_8h.html#ac2855e39d8eaea31be68bd0fd03574b5">POOL_DEBUG</a>(<a class="code" href="pool_8h.html#a9e7c48e08e7b2a51b41e4d6611a02ace">SAT_DEBUG_STATS</a>, <span class="stringliteral">&quot;addrelproviders: what provides %s?\n&quot;</span>, <a class="code" href="poolid_8c.html#afbc7881d0aa3961818b1cc5e00c5a080">dep2str</a>(pool, name));
<a name="l00684"></a>00684 <span class="preprocessor">#endif</span>
<a name="l00685"></a>00685 <span class="preprocessor"></span>      pp = <a class="code" href="pool_8h.html#af21fe308922972607173d0fe4d197fae">pool_whatprovides_ptr</a>(pool, name);
<a name="l00686"></a>00686       <span class="keywordflow">while</span> (<a class="code" href="pool_8h.html#a723c8c54fdd5d81be4b612c0d2868c2d">ISRELDEP</a>(name))
<a name="l00687"></a>00687         {
<a name="l00688"></a>00688           rd = <a class="code" href="pool_8h.html#a7f1a1ed4e318be6edd66e5d94d7912bb">GETRELDEP</a>(pool, name);
<a name="l00689"></a>00689           name = rd-&gt;<a class="code" href="struct__Reldep.html#a0fa6e0cb741e79dcd2e92d9e65cf8ce5">name</a>;
<a name="l00690"></a>00690         }
<a name="l00691"></a>00691       <span class="keywordflow">while</span> ((p = *pp++) != 0)
<a name="l00692"></a>00692         {
<a name="l00693"></a>00693           <a class="code" href="struct__Solvable.html">Solvable</a> *s = pool-&gt;<a class="code" href="struct__Pool.html#a9842c936aa241bad13ba13f21a337319">solvables</a> + p;
<a name="l00694"></a>00694           <span class="keywordflow">if</span> (!s-&gt;<a class="code" href="struct__Solvable.html#aca85fe4ba80026035c22f0596db71657">provides</a>)
<a name="l00695"></a>00695             {
<a name="l00696"></a>00696               <span class="comment">/* no provides - check nevr */</span>
<a name="l00697"></a>00697               <span class="keywordflow">if</span> (<a class="code" href="pool_8c.html#a667de17afd950d2100da4c24269e8079">pool_match_nevr_rel</a>(pool, s, <a class="code" href="pool_8h.html#a722fed0612f075570c90fb8ffc48e8d6">MAKERELDEP</a>(d)))
<a name="l00698"></a>00698                 <a class="code" href="queue_8h.html#a3ba172138b6a04f289def63b198057f1">queue_push</a>(&amp;plist, p);
<a name="l00699"></a>00699               <span class="keywordflow">continue</span>;
<a name="l00700"></a>00700             }
<a name="l00701"></a>00701           <span class="comment">/* solvable p provides name in some rels */</span>
<a name="l00702"></a>00702           pidp = s-&gt;<a class="code" href="struct__Solvable.html#a15e0b77fe061c6429a24215191b10f05">repo</a>-&gt;<a class="code" href="struct__Repo.html#afddcfa36231cc08266800bee5b978528">idarraydata</a> + s-&gt;<a class="code" href="struct__Solvable.html#aca85fe4ba80026035c22f0596db71657">provides</a>;
<a name="l00703"></a>00703           <span class="keywordflow">while</span> ((pid = *pidp++) != 0)
<a name="l00704"></a>00704             {
<a name="l00705"></a>00705               <span class="keywordflow">if</span> (pid == name)
<a name="l00706"></a>00706                 {
<a name="l00707"></a>00707 <span class="preprocessor">#if defined(MULTI_SEMANTICS)</span>
<a name="l00708"></a>00708 <span class="preprocessor"></span>                  <span class="keywordflow">if</span> (pool-&gt;disttype == DISTTYPE_DEB)
<a name="l00709"></a>00709                     <span class="keywordflow">continue</span>;
<a name="l00710"></a>00710                   <span class="keywordflow">else</span>
<a name="l00711"></a>00711                     <span class="keywordflow">break</span>;
<a name="l00712"></a>00712 <span class="preprocessor">#elif defined(DEBIAN_SEMANTICS)</span>
<a name="l00713"></a>00713 <span class="preprocessor"></span>                  <span class="keywordflow">continue</span>;             <span class="comment">/* unversioned provides can</span>
<a name="l00714"></a>00714 <span class="comment">                                         * never match versioned deps */</span>
<a name="l00715"></a>00715 <span class="preprocessor">#else</span>
<a name="l00716"></a>00716 <span class="preprocessor"></span>                  <span class="keywordflow">break</span>;                <span class="comment">/* yes, provides all versions */</span>
<a name="l00717"></a>00717 <span class="preprocessor">#endif</span>
<a name="l00718"></a>00718 <span class="preprocessor"></span>                }
<a name="l00719"></a>00719               <span class="keywordflow">if</span> (!<a class="code" href="pool_8h.html#a723c8c54fdd5d81be4b612c0d2868c2d">ISRELDEP</a>(pid))
<a name="l00720"></a>00720                 <span class="keywordflow">continue</span>;               <span class="comment">/* wrong provides name */</span>
<a name="l00721"></a>00721               prd = <a class="code" href="pool_8h.html#a7f1a1ed4e318be6edd66e5d94d7912bb">GETRELDEP</a>(pool, pid);
<a name="l00722"></a>00722               <span class="keywordflow">if</span> (prd-&gt;<a class="code" href="struct__Reldep.html#a0fa6e0cb741e79dcd2e92d9e65cf8ce5">name</a> != name)
<a name="l00723"></a>00723                 <span class="keywordflow">continue</span>;               <span class="comment">/* wrong provides name */</span>
<a name="l00724"></a>00724               <span class="comment">/* right package, both deps are rels. check flags/evr */</span>
<a name="l00725"></a>00725               <span class="keywordflow">if</span> (<a class="code" href="pool_8c.html#af2a7365363135c485a8f2247a97244c8">pool_match_flags_evr</a>(pool, prd-&gt;<a class="code" href="struct__Reldep.html#a05495175469a6853de6455b96ad1b2f4">flags</a>, prd-&gt;<a class="code" href="struct__Reldep.html#ae2f8a0a4b825a136c57b3f447e0007d0">evr</a>, flags, evr))
<a name="l00726"></a>00726                 <span class="keywordflow">break</span>;  <span class="comment">/* matches */</span>
<a name="l00727"></a>00727             }
<a name="l00728"></a>00728           <span class="keywordflow">if</span> (!pid)
<a name="l00729"></a>00729             <span class="keywordflow">continue</span>;   <span class="comment">/* none of the providers matched */</span>
<a name="l00730"></a>00730           <a class="code" href="queue_8h.html#a3ba172138b6a04f289def63b198057f1">queue_push</a>(&amp;plist, p);
<a name="l00731"></a>00731         }
<a name="l00732"></a>00732       <span class="comment">/* make our system solvable provide all unknown rpmlib() stuff */</span>
<a name="l00733"></a>00733       <span class="keywordflow">if</span> (plist.<a class="code" href="struct__Queue.html#abb0696a77174cd23b5f488ad4c7b45d2">count</a> == 0 &amp;&amp; !strncmp(<a class="code" href="poolid_8c.html#a8a844727bd2258ef240555fc629b2fa7">id2str</a>(pool, name), <span class="stringliteral">&quot;rpmlib(&quot;</span>, 7))
<a name="l00734"></a>00734         <a class="code" href="queue_8h.html#a3ba172138b6a04f289def63b198057f1">queue_push</a>(&amp;plist, <a class="code" href="pool_8h.html#abd207d4eeed4b96e8dd1a25e2dce7f52">SYSTEMSOLVABLE</a>);
<a name="l00735"></a>00735     }
<a name="l00736"></a>00736   <span class="comment">/* add providers to whatprovides */</span>
<a name="l00737"></a>00737 <span class="preprocessor">#if 0</span>
<a name="l00738"></a>00738 <span class="preprocessor"></span>  <a class="code" href="pool_8h.html#ac2855e39d8eaea31be68bd0fd03574b5">POOL_DEBUG</a>(<a class="code" href="pool_8h.html#a9e7c48e08e7b2a51b41e4d6611a02ace">SAT_DEBUG_STATS</a>, <span class="stringliteral">&quot;addrelproviders: adding %d packages to %d\n&quot;</span>, plist.<a class="code" href="struct__Queue.html#abb0696a77174cd23b5f488ad4c7b45d2">count</a>, d);
<a name="l00739"></a>00739 <span class="preprocessor">#endif</span>
<a name="l00740"></a>00740 <span class="preprocessor"></span>  pool-&gt;<a class="code" href="struct__Pool.html#ab2a4049b7aafbf2dc18c64eaf3367824">whatprovides_rel</a>[d] = <a class="code" href="pool_8c.html#a951749501558dae97cb20b059652f7fb">pool_queuetowhatprovides</a>(pool, &amp;plist);
<a name="l00741"></a>00741   <a class="code" href="queue_8c.html#a701c81a9f7d503837e74d43981e79137">queue_free</a>(&amp;plist);
<a name="l00742"></a>00742 
<a name="l00743"></a>00743   <span class="keywordflow">return</span> pool-&gt;<a class="code" href="struct__Pool.html#ab2a4049b7aafbf2dc18c64eaf3367824">whatprovides_rel</a>[d];
<a name="l00744"></a>00744 }
<a name="l00745"></a>00745 
<a name="l00746"></a>00746 <span class="comment">/*************************************************************************/</span>
<a name="l00747"></a>00747 
<a name="l00748"></a>00748 <span class="keywordtype">void</span>
<a name="l00749"></a><a class="code" href="pool_8c.html#a18f09cd27955e8a6e7d23e3a5c4c40fc">00749</a> <a class="code" href="pool_8c.html#a18f09cd27955e8a6e7d23e3a5c4c40fc">pool_debug</a>(<a class="code" href="struct__Pool.html">Pool</a> *pool, <span class="keywordtype">int</span> type, <span class="keyword">const</span> <span class="keywordtype">char</span> *format, ...)
<a name="l00750"></a>00750 {
<a name="l00751"></a>00751   va_list args;
<a name="l00752"></a>00752   <span class="keywordtype">char</span> buf[1024];
<a name="l00753"></a>00753 
<a name="l00754"></a>00754   <span class="keywordflow">if</span> ((type &amp; (<a class="code" href="pool_8h.html#ad17ca04f3cad42e3e7d2eb37e5eabfa2">SAT_FATAL</a>|<a class="code" href="pool_8h.html#a07c9bffa5fb927908b3c82fde9a3136f">SAT_ERROR</a>)) == 0)
<a name="l00755"></a>00755     {
<a name="l00756"></a>00756       <span class="keywordflow">if</span> ((pool-&gt;<a class="code" href="struct__Pool.html#a891712f62e9bd24319e006e88f7086a1">debugmask</a> &amp; type) == 0)
<a name="l00757"></a>00757         <span class="keywordflow">return</span>;
<a name="l00758"></a>00758     }
<a name="l00759"></a>00759   va_start(args, format);
<a name="l00760"></a>00760   <span class="keywordflow">if</span> (!pool-&gt;<a class="code" href="struct__Pool.html#aeaa51cf49baf5eeea4707f6279df3451">debugcallback</a>)
<a name="l00761"></a>00761     {
<a name="l00762"></a>00762       <span class="keywordflow">if</span> ((type &amp; (<a class="code" href="pool_8h.html#ad17ca04f3cad42e3e7d2eb37e5eabfa2">SAT_FATAL</a>|<a class="code" href="pool_8h.html#a07c9bffa5fb927908b3c82fde9a3136f">SAT_ERROR</a>)) == 0 &amp;&amp; !(pool-&gt;<a class="code" href="struct__Pool.html#a891712f62e9bd24319e006e88f7086a1">debugmask</a> &amp; <a class="code" href="pool_8h.html#a9111fc7e5c28b92f646f35daa66929cd">SAT_DEBUG_TO_STDERR</a>))
<a name="l00763"></a>00763         vprintf(format, args);
<a name="l00764"></a>00764       <span class="keywordflow">else</span>
<a name="l00765"></a>00765         vfprintf(stderr, format, args);
<a name="l00766"></a>00766       <span class="keywordflow">return</span>;
<a name="l00767"></a>00767     }
<a name="l00768"></a>00768   vsnprintf(buf, <span class="keyword">sizeof</span>(buf), format, args);
<a name="l00769"></a>00769   pool-&gt;<a class="code" href="struct__Pool.html#aeaa51cf49baf5eeea4707f6279df3451">debugcallback</a>(pool, pool-&gt;<a class="code" href="struct__Pool.html#a3d8fa4943e6bd474bae1a389217a06aa">debugcallbackdata</a>, type, buf);
<a name="l00770"></a>00770 }
<a name="l00771"></a>00771 
<a name="l00772"></a>00772 <span class="keywordtype">void</span>
<a name="l00773"></a><a class="code" href="pool_8h.html#af45eec0b74c0945d71cb9e17f3df2a07">00773</a> <a class="code" href="pool_8c.html#af45eec0b74c0945d71cb9e17f3df2a07">pool_setdebuglevel</a>(<a class="code" href="struct__Pool.html">Pool</a> *pool, <span class="keywordtype">int</span> level)
<a name="l00774"></a>00774 {
<a name="l00775"></a>00775   <span class="keywordtype">int</span> mask = SAT_DEBUG_RESULT;
<a name="l00776"></a>00776   <span class="keywordflow">if</span> (level &gt; 0)
<a name="l00777"></a>00777     mask |= <a class="code" href="pool_8h.html#a9e7c48e08e7b2a51b41e4d6611a02ace">SAT_DEBUG_STATS</a>|<a class="code" href="pool_8h.html#a723747e75934ef144a620756146d16e0">SAT_DEBUG_ANALYZE</a>|<a class="code" href="pool_8h.html#a1dcd118b501e094fa6a626720c2e0ac9">SAT_DEBUG_UNSOLVABLE</a>|<a class="code" href="pool_8h.html#aaa35aa0d2b1c2c65d7a17ad587885d14">SAT_DEBUG_SOLVER</a>|SAT_DEBUG_TRANSACTION;
<a name="l00778"></a>00778   <span class="keywordflow">if</span> (level &gt; 1)
<a name="l00779"></a>00779     mask |= <a class="code" href="pool_8h.html#a97ca177fa0d5047055c31c67a830f823">SAT_DEBUG_JOB</a>|<a class="code" href="pool_8h.html#afd737f722763bdc0c84084d762343f51">SAT_DEBUG_SOLUTIONS</a>|SAT_DEBUG_POLICY;
<a name="l00780"></a>00780   <span class="keywordflow">if</span> (level &gt; 2)
<a name="l00781"></a>00781     mask |= SAT_DEBUG_PROPAGATE;
<a name="l00782"></a>00782   <span class="keywordflow">if</span> (level &gt; 3)
<a name="l00783"></a>00783     mask |= SAT_DEBUG_RULE_CREATION;
<a name="l00784"></a>00784   <span class="keywordflow">if</span> (level &gt; 4)
<a name="l00785"></a>00785     mask |= SAT_DEBUG_SCHUBI;
<a name="l00786"></a>00786   mask |= pool-&gt;<a class="code" href="struct__Pool.html#a891712f62e9bd24319e006e88f7086a1">debugmask</a> &amp; SAT_DEBUG_TO_STDERR;        <span class="comment">/* keep bit */</span>
<a name="l00787"></a>00787   pool-&gt;<a class="code" href="struct__Pool.html#a891712f62e9bd24319e006e88f7086a1">debugmask</a> = mask;
<a name="l00788"></a>00788 }
<a name="l00789"></a>00789 
<a name="l00790"></a>00790 <span class="comment">/*************************************************************************/</span>
<a name="l00791"></a>00791 
<a name="l00792"></a><a class="code" href="structsearchfiles.html">00792</a> <span class="keyword">struct </span><a class="code" href="structsearchfiles.html">searchfiles</a> {
<a name="l00793"></a><a class="code" href="structsearchfiles.html#a8cb9da12cea3df07ded9f458441780e0">00793</a>   <a class="code" href="pooltypes_8h.html#a2e0e6278ac51842ca3aeb53e3fc3ead6">Id</a> *<a class="code" href="structsearchfiles.html#a8cb9da12cea3df07ded9f458441780e0">ids</a>;
<a name="l00794"></a><a class="code" href="structsearchfiles.html#a9df91f6576d29e829c7a7fc9c5a14609">00794</a>   <span class="keywordtype">char</span> **<a class="code" href="structsearchfiles.html#a9df91f6576d29e829c7a7fc9c5a14609">dirs</a>;
<a name="l00795"></a><a class="code" href="structsearchfiles.html#ae282bc4187f1856314aad2e78cae90b2">00795</a>   <span class="keywordtype">char</span> **<a class="code" href="structsearchfiles.html#ae282bc4187f1856314aad2e78cae90b2">names</a>;
<a name="l00796"></a><a class="code" href="structsearchfiles.html#aa586f02128e6dd22579ce29c834cb4f4">00796</a>   <span class="keywordtype">int</span> <a class="code" href="structsearchfiles.html#aa586f02128e6dd22579ce29c834cb4f4">nfiles</a>;
<a name="l00797"></a><a class="code" href="structsearchfiles.html#a64003a6d20c96c17f689f93bc9fa0ad8">00797</a>   <a class="code" href="struct__Map.html">Map</a> <a class="code" href="structsearchfiles.html#a64003a6d20c96c17f689f93bc9fa0ad8">seen</a>;
<a name="l00798"></a>00798 };
<a name="l00799"></a>00799 
<a name="l00800"></a><a class="code" href="pool_8c.html#a48d04505fd12e1062b49d31909856942">00800</a> <span class="preprocessor">#define SEARCHFILES_BLOCK 127</span>
<a name="l00801"></a>00801 <span class="preprocessor"></span>
<a name="l00802"></a>00802 <span class="keyword">static</span> <span class="keywordtype">void</span>
<a name="l00803"></a><a class="code" href="pool_8c.html#a4ed97186265304aaa4fa20f6a9c2021e">00803</a> <a class="code" href="pool_8c.html#a4ed97186265304aaa4fa20f6a9c2021e">pool_addfileprovides_dep</a>(<a class="code" href="struct__Pool.html">Pool</a> *pool, <a class="code" href="pooltypes_8h.html#a2e0e6278ac51842ca3aeb53e3fc3ead6">Id</a> *ida, <span class="keyword">struct</span> <a class="code" href="structsearchfiles.html">searchfiles</a> *sf, <span class="keyword">struct</span> <a class="code" href="structsearchfiles.html">searchfiles</a> *isf)
<a name="l00804"></a>00804 {
<a name="l00805"></a>00805   <a class="code" href="pooltypes_8h.html#a2e0e6278ac51842ca3aeb53e3fc3ead6">Id</a> dep, sid;
<a name="l00806"></a>00806   <span class="keyword">const</span> <span class="keywordtype">char</span> *s, *sr;
<a name="l00807"></a>00807   <span class="keyword">struct </span><a class="code" href="structsearchfiles.html">searchfiles</a> *csf;
<a name="l00808"></a>00808 
<a name="l00809"></a>00809   <span class="keywordflow">while</span> ((dep = *ida++) != 0)
<a name="l00810"></a>00810     {
<a name="l00811"></a>00811       csf = sf;
<a name="l00812"></a>00812       <span class="keywordflow">while</span> (<a class="code" href="pool_8h.html#a723c8c54fdd5d81be4b612c0d2868c2d">ISRELDEP</a>(dep))
<a name="l00813"></a>00813         {
<a name="l00814"></a>00814           <a class="code" href="struct__Reldep.html">Reldep</a> *rd;
<a name="l00815"></a>00815           sid = pool-&gt;<a class="code" href="struct__Pool.html#afa7b61374ab18cfea97f12796850a638">ss</a>.<a class="code" href="struct__Stringpool.html#a2bf0e8ba450ec30d60076977912dfd5f">nstrings</a> + <a class="code" href="pool_8h.html#a45170c4b0420778f3a8e3780bfeee43e">GETRELID</a>(dep);
<a name="l00816"></a>00816           <span class="keywordflow">if</span> (<a class="code" href="bitmap_8h.html#ad8ccb9ad3a8ad65f5fe08a988acc503d">MAPTST</a>(&amp;csf-&gt;<a class="code" href="structsearchfiles.html#a64003a6d20c96c17f689f93bc9fa0ad8">seen</a>, sid))
<a name="l00817"></a>00817             {
<a name="l00818"></a>00818               dep = 0;
<a name="l00819"></a>00819               <span class="keywordflow">break</span>;
<a name="l00820"></a>00820             }
<a name="l00821"></a>00821           <a class="code" href="bitmap_8h.html#a33557e357513f5b3faef527bb320183c">MAPSET</a>(&amp;csf-&gt;<a class="code" href="structsearchfiles.html#a64003a6d20c96c17f689f93bc9fa0ad8">seen</a>, sid);
<a name="l00822"></a>00822           rd = <a class="code" href="pool_8h.html#a7f1a1ed4e318be6edd66e5d94d7912bb">GETRELDEP</a>(pool, dep);
<a name="l00823"></a>00823           <span class="keywordflow">if</span> (rd-&gt;<a class="code" href="struct__Reldep.html#a05495175469a6853de6455b96ad1b2f4">flags</a> &lt; 8)
<a name="l00824"></a>00824             dep = rd-&gt;<a class="code" href="struct__Reldep.html#a0fa6e0cb741e79dcd2e92d9e65cf8ce5">name</a>;
<a name="l00825"></a>00825           <span class="keywordflow">else</span> <span class="keywordflow">if</span> (rd-&gt;<a class="code" href="struct__Reldep.html#a05495175469a6853de6455b96ad1b2f4">flags</a> == <a class="code" href="pool_8h.html#a1bd7c2b318685c04b52146ed6f193244">REL_NAMESPACE</a>)
<a name="l00826"></a>00826             {
<a name="l00827"></a>00827               <span class="keywordflow">if</span> (rd-&gt;<a class="code" href="struct__Reldep.html#a0fa6e0cb741e79dcd2e92d9e65cf8ce5">name</a> == NAMESPACE_INSTALLED || rd-&gt;<a class="code" href="struct__Reldep.html#a0fa6e0cb741e79dcd2e92d9e65cf8ce5">name</a> == NAMESPACE_SPLITPROVIDES)
<a name="l00828"></a>00828                 {
<a name="l00829"></a>00829                   csf = isf;
<a name="l00830"></a>00830                   <span class="keywordflow">if</span> (!csf || <a class="code" href="bitmap_8h.html#ad8ccb9ad3a8ad65f5fe08a988acc503d">MAPTST</a>(&amp;csf-&gt;<a class="code" href="structsearchfiles.html#a64003a6d20c96c17f689f93bc9fa0ad8">seen</a>, sid))
<a name="l00831"></a>00831                     {
<a name="l00832"></a>00832                       dep = 0;
<a name="l00833"></a>00833                       <span class="keywordflow">break</span>;
<a name="l00834"></a>00834                     }
<a name="l00835"></a>00835                   <a class="code" href="bitmap_8h.html#a33557e357513f5b3faef527bb320183c">MAPSET</a>(&amp;csf-&gt;<a class="code" href="structsearchfiles.html#a64003a6d20c96c17f689f93bc9fa0ad8">seen</a>, sid);
<a name="l00836"></a>00836                 }
<a name="l00837"></a>00837               dep = rd-&gt;<a class="code" href="struct__Reldep.html#ae2f8a0a4b825a136c57b3f447e0007d0">evr</a>;
<a name="l00838"></a>00838             }
<a name="l00839"></a>00839           <span class="keywordflow">else</span> <span class="keywordflow">if</span> (rd-&gt;<a class="code" href="struct__Reldep.html#a05495175469a6853de6455b96ad1b2f4">flags</a> == <a class="code" href="pool_8h.html#ae76a4247e589585ea45295087a8bc806">REL_FILECONFLICT</a>)
<a name="l00840"></a>00840             {
<a name="l00841"></a>00841               dep = 0;
<a name="l00842"></a>00842               <span class="keywordflow">break</span>;
<a name="l00843"></a>00843             }
<a name="l00844"></a>00844           <span class="keywordflow">else</span>
<a name="l00845"></a>00845             {
<a name="l00846"></a>00846               <a class="code" href="pooltypes_8h.html#a2e0e6278ac51842ca3aeb53e3fc3ead6">Id</a> <a class="code" href="structsearchfiles.html#a8cb9da12cea3df07ded9f458441780e0">ids</a>[2];
<a name="l00847"></a>00847               ids[0] = rd-&gt;<a class="code" href="struct__Reldep.html#a0fa6e0cb741e79dcd2e92d9e65cf8ce5">name</a>;
<a name="l00848"></a>00848               ids[1] = 0;
<a name="l00849"></a>00849               <a class="code" href="pool_8c.html#a4ed97186265304aaa4fa20f6a9c2021e">pool_addfileprovides_dep</a>(pool, ids, csf, isf);
<a name="l00850"></a>00850               dep = rd-&gt;<a class="code" href="struct__Reldep.html#ae2f8a0a4b825a136c57b3f447e0007d0">evr</a>;
<a name="l00851"></a>00851             }
<a name="l00852"></a>00852         }
<a name="l00853"></a>00853       <span class="keywordflow">if</span> (!dep)
<a name="l00854"></a>00854         <span class="keywordflow">continue</span>;
<a name="l00855"></a>00855       <span class="keywordflow">if</span> (<a class="code" href="bitmap_8h.html#ad8ccb9ad3a8ad65f5fe08a988acc503d">MAPTST</a>(&amp;csf-&gt;<a class="code" href="structsearchfiles.html#a64003a6d20c96c17f689f93bc9fa0ad8">seen</a>, dep))
<a name="l00856"></a>00856         <span class="keywordflow">continue</span>;
<a name="l00857"></a>00857       <a class="code" href="bitmap_8h.html#a33557e357513f5b3faef527bb320183c">MAPSET</a>(&amp;csf-&gt;<a class="code" href="structsearchfiles.html#a64003a6d20c96c17f689f93bc9fa0ad8">seen</a>, dep);
<a name="l00858"></a>00858       s = <a class="code" href="poolid_8c.html#a8a844727bd2258ef240555fc629b2fa7">id2str</a>(pool, dep);
<a name="l00859"></a>00859       <span class="keywordflow">if</span> (*s != <span class="charliteral">&#39;/&#39;</span>)
<a name="l00860"></a>00860         <span class="keywordflow">continue</span>;
<a name="l00861"></a>00861       csf-&gt;<a class="code" href="structsearchfiles.html#a8cb9da12cea3df07ded9f458441780e0">ids</a> = <a class="code" href="util_8h.html#a8f0135824fd0936735b002a452c84cbd">sat_extend</a>(csf-&gt;<a class="code" href="structsearchfiles.html#a8cb9da12cea3df07ded9f458441780e0">ids</a>, csf-&gt;<a class="code" href="structsearchfiles.html#aa586f02128e6dd22579ce29c834cb4f4">nfiles</a>, 1, <span class="keyword">sizeof</span>(<a class="code" href="pooltypes_8h.html#a2e0e6278ac51842ca3aeb53e3fc3ead6">Id</a>), <a class="code" href="pool_8c.html#a48d04505fd12e1062b49d31909856942">SEARCHFILES_BLOCK</a>);
<a name="l00862"></a>00862       csf-&gt;<a class="code" href="structsearchfiles.html#a9df91f6576d29e829c7a7fc9c5a14609">dirs</a> = <a class="code" href="util_8h.html#a8f0135824fd0936735b002a452c84cbd">sat_extend</a>(csf-&gt;<a class="code" href="structsearchfiles.html#a9df91f6576d29e829c7a7fc9c5a14609">dirs</a>, csf-&gt;<a class="code" href="structsearchfiles.html#aa586f02128e6dd22579ce29c834cb4f4">nfiles</a>, 1, <span class="keyword">sizeof</span>(<span class="keyword">const</span> <span class="keywordtype">char</span> *), <a class="code" href="pool_8c.html#a48d04505fd12e1062b49d31909856942">SEARCHFILES_BLOCK</a>);
<a name="l00863"></a>00863       csf-&gt;<a class="code" href="structsearchfiles.html#ae282bc4187f1856314aad2e78cae90b2">names</a> = <a class="code" href="util_8h.html#a8f0135824fd0936735b002a452c84cbd">sat_extend</a>(csf-&gt;<a class="code" href="structsearchfiles.html#ae282bc4187f1856314aad2e78cae90b2">names</a>, csf-&gt;<a class="code" href="structsearchfiles.html#aa586f02128e6dd22579ce29c834cb4f4">nfiles</a>, 1, <span class="keyword">sizeof</span>(<span class="keyword">const</span> <span class="keywordtype">char</span> *), <a class="code" href="pool_8c.html#a48d04505fd12e1062b49d31909856942">SEARCHFILES_BLOCK</a>);
<a name="l00864"></a>00864       csf-&gt;<a class="code" href="structsearchfiles.html#a8cb9da12cea3df07ded9f458441780e0">ids</a>[csf-&gt;<a class="code" href="structsearchfiles.html#aa586f02128e6dd22579ce29c834cb4f4">nfiles</a>] = dep;
<a name="l00865"></a>00865       sr = strrchr(s, <span class="charliteral">&#39;/&#39;</span>);
<a name="l00866"></a>00866       csf-&gt;<a class="code" href="structsearchfiles.html#ae282bc4187f1856314aad2e78cae90b2">names</a>[csf-&gt;<a class="code" href="structsearchfiles.html#aa586f02128e6dd22579ce29c834cb4f4">nfiles</a>] = strdup(sr + 1);
<a name="l00867"></a>00867       csf-&gt;<a class="code" href="structsearchfiles.html#a9df91f6576d29e829c7a7fc9c5a14609">dirs</a>[csf-&gt;<a class="code" href="structsearchfiles.html#aa586f02128e6dd22579ce29c834cb4f4">nfiles</a>] = <a class="code" href="util_8c.html#afb257b2d8e6aac7a5a4c64c6c36d8b5b" title="malloc exits with error message on error">sat_malloc</a>(sr - s + 1);
<a name="l00868"></a>00868       <span class="keywordflow">if</span> (sr != s)
<a name="l00869"></a>00869         strncpy(csf-&gt;<a class="code" href="structsearchfiles.html#a9df91f6576d29e829c7a7fc9c5a14609">dirs</a>[csf-&gt;<a class="code" href="structsearchfiles.html#aa586f02128e6dd22579ce29c834cb4f4">nfiles</a>], s, sr - s);
<a name="l00870"></a>00870       csf-&gt;<a class="code" href="structsearchfiles.html#a9df91f6576d29e829c7a7fc9c5a14609">dirs</a>[csf-&gt;<a class="code" href="structsearchfiles.html#aa586f02128e6dd22579ce29c834cb4f4">nfiles</a>][sr - s] = 0;
<a name="l00871"></a>00871       csf-&gt;<a class="code" href="structsearchfiles.html#aa586f02128e6dd22579ce29c834cb4f4">nfiles</a>++;
<a name="l00872"></a>00872     }
<a name="l00873"></a>00873 }
<a name="l00874"></a>00874 
<a name="l00875"></a><a class="code" href="structaddfileprovides__cbdata.html">00875</a> <span class="keyword">struct </span><a class="code" href="structaddfileprovides__cbdata.html">addfileprovides_cbdata</a> {
<a name="l00876"></a><a class="code" href="structaddfileprovides__cbdata.html#ad9ad39853e6788d35be955d46b0a77e4">00876</a>   <span class="keywordtype">int</span> <a class="code" href="structaddfileprovides__cbdata.html#ad9ad39853e6788d35be955d46b0a77e4">nfiles</a>;
<a name="l00877"></a><a class="code" href="structaddfileprovides__cbdata.html#ad72840ed46bcb67d2d0aae77a790159b">00877</a>   <a class="code" href="pooltypes_8h.html#a2e0e6278ac51842ca3aeb53e3fc3ead6">Id</a> *<a class="code" href="structaddfileprovides__cbdata.html#ad72840ed46bcb67d2d0aae77a790159b">ids</a>;
<a name="l00878"></a><a class="code" href="structaddfileprovides__cbdata.html#aaecd38a128f97ec93c280280745ca241">00878</a>   <span class="keywordtype">char</span> **<a class="code" href="structaddfileprovides__cbdata.html#aaecd38a128f97ec93c280280745ca241">dirs</a>;
<a name="l00879"></a><a class="code" href="structaddfileprovides__cbdata.html#ae995f69a2cdc1117c9aa0e7df59c3ace">00879</a>   <span class="keywordtype">char</span> **<a class="code" href="structaddfileprovides__cbdata.html#ae995f69a2cdc1117c9aa0e7df59c3ace">names</a>;
<a name="l00880"></a>00880 
<a name="l00881"></a><a class="code" href="structaddfileprovides__cbdata.html#a43d3a0d2a15758cdcab0090ce924323a">00881</a>   <a class="code" href="pooltypes_8h.html#a2e0e6278ac51842ca3aeb53e3fc3ead6">Id</a> *<a class="code" href="structaddfileprovides__cbdata.html#a43d3a0d2a15758cdcab0090ce924323a">dids</a>;
<a name="l00882"></a>00882 
<a name="l00883"></a><a class="code" href="structaddfileprovides__cbdata.html#a09045087092842831c18439cc0e9963c">00883</a>   <a class="code" href="struct__Map.html">Map</a> <a class="code" href="structaddfileprovides__cbdata.html#a09045087092842831c18439cc0e9963c">providedids</a>;
<a name="l00884"></a>00884 
<a name="l00885"></a><a class="code" href="structaddfileprovides__cbdata.html#a7bcfb88a4cbdc07387d714408f563016">00885</a>   <a class="code" href="struct__Map.html">Map</a> <a class="code" href="structaddfileprovides__cbdata.html#a7bcfb88a4cbdc07387d714408f563016">useddirs</a>;
<a name="l00886"></a>00886 };
<a name="l00887"></a>00887 
<a name="l00888"></a>00888 <span class="keyword">static</span> <span class="keywordtype">int</span>
<a name="l00889"></a><a class="code" href="pool_8c.html#abbfc473c8543c23bbf0610f27a1fbf8c">00889</a> <a class="code" href="pool_8c.html#abbfc473c8543c23bbf0610f27a1fbf8c">addfileprovides_cb</a>(<span class="keywordtype">void</span> *cbdata, <a class="code" href="struct__Solvable.html">Solvable</a> *s, <a class="code" href="struct__Repodata.html">Repodata</a> *data, <a class="code" href="struct__Repokey.html">Repokey</a> *key, <a class="code" href="struct__KeyValue.html">KeyValue</a> *value)
<a name="l00890"></a>00890 {
<a name="l00891"></a>00891   <span class="keyword">struct </span><a class="code" href="structaddfileprovides__cbdata.html">addfileprovides_cbdata</a> *cbd = cbdata;
<a name="l00892"></a>00892   <span class="keywordtype">int</span> i;
<a name="l00893"></a>00893 
<a name="l00894"></a>00894   <span class="keywordflow">if</span> (!cbd-&gt;<a class="code" href="structaddfileprovides__cbdata.html#a7bcfb88a4cbdc07387d714408f563016">useddirs</a>.<a class="code" href="struct__Map.html#a6f33ba32c40c61ac1ab1c96919b77ee0">size</a>)
<a name="l00895"></a>00895     {
<a name="l00896"></a>00896       <a class="code" href="bitmap_8c.html#a8d8010a0f9f491483c12e83ae3a9082e">map_init</a>(&amp;cbd-&gt;<a class="code" href="structaddfileprovides__cbdata.html#a7bcfb88a4cbdc07387d714408f563016">useddirs</a>, data-&gt;<a class="code" href="struct__Repodata.html#aae19b05ba2da163a3cd86e3a6cc8366e">dirpool</a>.<a class="code" href="struct__Dirpool.html#a927d250625ed1619e30ca1a4010ecfe9">ndirs</a> + 1);
<a name="l00897"></a>00897       <span class="keywordflow">for</span> (i = 0; i &lt; cbd-&gt;<a class="code" href="structaddfileprovides__cbdata.html#ad9ad39853e6788d35be955d46b0a77e4">nfiles</a>; i++)
<a name="l00898"></a>00898         {
<a name="l00899"></a>00899           <a class="code" href="pooltypes_8h.html#a2e0e6278ac51842ca3aeb53e3fc3ead6">Id</a> did;
<a name="l00900"></a>00900           <span class="keywordflow">if</span> (<a class="code" href="bitmap_8h.html#ad8ccb9ad3a8ad65f5fe08a988acc503d">MAPTST</a>(&amp;cbd-&gt;<a class="code" href="structaddfileprovides__cbdata.html#a09045087092842831c18439cc0e9963c">providedids</a>, cbd-&gt;<a class="code" href="structaddfileprovides__cbdata.html#ad72840ed46bcb67d2d0aae77a790159b">ids</a>[i]))
<a name="l00901"></a>00901             {
<a name="l00902"></a>00902               cbd-&gt;<a class="code" href="structaddfileprovides__cbdata.html#a43d3a0d2a15758cdcab0090ce924323a">dids</a>[i] = 0;
<a name="l00903"></a>00903               <span class="keywordflow">continue</span>;
<a name="l00904"></a>00904             }
<a name="l00905"></a>00905           did = <a class="code" href="repodata_8c.html#aa3a319b0879f88581f9737f8b26a18cc">repodata_str2dir</a>(data, cbd-&gt;<a class="code" href="structaddfileprovides__cbdata.html#aaecd38a128f97ec93c280280745ca241">dirs</a>[i], 0);
<a name="l00906"></a>00906           cbd-&gt;<a class="code" href="structaddfileprovides__cbdata.html#a43d3a0d2a15758cdcab0090ce924323a">dids</a>[i] = did;
<a name="l00907"></a>00907           <span class="keywordflow">if</span> (did)
<a name="l00908"></a>00908             <a class="code" href="bitmap_8h.html#a33557e357513f5b3faef527bb320183c">MAPSET</a>(&amp;cbd-&gt;<a class="code" href="structaddfileprovides__cbdata.html#a7bcfb88a4cbdc07387d714408f563016">useddirs</a>, did);
<a name="l00909"></a>00909         }
<a name="l00910"></a>00910     }
<a name="l00911"></a>00911   <span class="keywordflow">if</span> (value-&gt;<a class="code" href="struct__KeyValue.html#ac2c2167e288ab3511dc6b419eff19877">id</a> &gt;= data-&gt;<a class="code" href="struct__Repodata.html#aae19b05ba2da163a3cd86e3a6cc8366e">dirpool</a>.<a class="code" href="struct__Dirpool.html#a927d250625ed1619e30ca1a4010ecfe9">ndirs</a> || !<a class="code" href="bitmap_8h.html#ad8ccb9ad3a8ad65f5fe08a988acc503d">MAPTST</a>(&amp;cbd-&gt;<a class="code" href="structaddfileprovides__cbdata.html#a7bcfb88a4cbdc07387d714408f563016">useddirs</a>, value-&gt;<a class="code" href="struct__KeyValue.html#ac2c2167e288ab3511dc6b419eff19877">id</a>))
<a name="l00912"></a>00912     <span class="keywordflow">return</span> 0;
<a name="l00913"></a>00913   <span class="keywordflow">for</span> (i = 0; i &lt; cbd-&gt;<a class="code" href="structaddfileprovides__cbdata.html#ad9ad39853e6788d35be955d46b0a77e4">nfiles</a>; i++)
<a name="l00914"></a>00914     {
<a name="l00915"></a>00915       <span class="keywordflow">if</span> (cbd-&gt;<a class="code" href="structaddfileprovides__cbdata.html#a43d3a0d2a15758cdcab0090ce924323a">dids</a>[i] != value-&gt;<a class="code" href="struct__KeyValue.html#ac2c2167e288ab3511dc6b419eff19877">id</a>)
<a name="l00916"></a>00916         <span class="keywordflow">continue</span>;
<a name="l00917"></a>00917       <span class="keywordflow">if</span> (!strcmp(cbd-&gt;<a class="code" href="structaddfileprovides__cbdata.html#ae995f69a2cdc1117c9aa0e7df59c3ace">names</a>[i], value-&gt;<a class="code" href="struct__KeyValue.html#a8a1b531f7b4dceb9f8adf915faf48e08">str</a>))
<a name="l00918"></a>00918         <span class="keywordflow">break</span>;
<a name="l00919"></a>00919     }
<a name="l00920"></a>00920   <span class="keywordflow">if</span> (i == cbd-&gt;<a class="code" href="structaddfileprovides__cbdata.html#ad9ad39853e6788d35be955d46b0a77e4">nfiles</a>)
<a name="l00921"></a>00921     <span class="keywordflow">return</span> 0;
<a name="l00922"></a>00922   s-&gt;<a class="code" href="struct__Solvable.html#aca85fe4ba80026035c22f0596db71657">provides</a> = <a class="code" href="repo_8c.html#ad035ce4b23179cd53edc538c834b27bd">repo_addid_dep</a>(s-&gt;<a class="code" href="struct__Solvable.html#a15e0b77fe061c6429a24215191b10f05">repo</a>, s-&gt;<a class="code" href="struct__Solvable.html#aca85fe4ba80026035c22f0596db71657">provides</a>, cbd-&gt;<a class="code" href="structaddfileprovides__cbdata.html#ad72840ed46bcb67d2d0aae77a790159b">ids</a>[i], SOLVABLE_FILEMARKER);
<a name="l00923"></a>00923   <span class="keywordflow">return</span> 0;
<a name="l00924"></a>00924 }
<a name="l00925"></a>00925 
<a name="l00926"></a>00926 <span class="keyword">static</span> <span class="keywordtype">void</span>
<a name="l00927"></a><a class="code" href="pool_8c.html#a2ebc724a3fa31d81054ca6b97e95bfd7">00927</a> <a class="code" href="pool_8c.html#a2ebc724a3fa31d81054ca6b97e95bfd7">pool_addfileprovides_search</a>(<a class="code" href="struct__Pool.html">Pool</a> *pool, <span class="keyword">struct</span> <a class="code" href="structaddfileprovides__cbdata.html">addfileprovides_cbdata</a> *cbd, <span class="keyword">struct</span> <a class="code" href="structsearchfiles.html">searchfiles</a> *sf, <a class="code" href="struct__Repo.html">Repo</a> *repoonly)
<a name="l00928"></a>00928 {
<a name="l00929"></a>00929   <a class="code" href="pooltypes_8h.html#a2e0e6278ac51842ca3aeb53e3fc3ead6">Id</a> p;
<a name="l00930"></a>00930   <a class="code" href="struct__Repodata.html">Repodata</a> *data;
<a name="l00931"></a>00931   <a class="code" href="struct__Repo.html">Repo</a> *repo;
<a name="l00932"></a>00932   <a class="code" href="struct__Queue.html">Queue</a> fileprovidesq;
<a name="l00933"></a>00933   <span class="keywordtype">int</span> i, j, repoid, repodataid;
<a name="l00934"></a>00934   <span class="keywordtype">int</span> provstart, provend;
<a name="l00935"></a>00935   <a class="code" href="struct__Map.html">Map</a> donemap;
<a name="l00936"></a>00936   <span class="keywordtype">int</span> ndone, incomplete;
<a name="l00937"></a>00937 
<a name="l00938"></a>00938   <span class="keywordflow">if</span> (!pool-&gt;<a class="code" href="struct__Pool.html#a405de8203c6d57f0e35d76943b7bd84e">nrepos</a>)
<a name="l00939"></a>00939     <span class="keywordflow">return</span>;
<a name="l00940"></a>00940 
<a name="l00941"></a>00941   cbd-&gt;<a class="code" href="structaddfileprovides__cbdata.html#ad9ad39853e6788d35be955d46b0a77e4">nfiles</a> = sf-&gt;<a class="code" href="structsearchfiles.html#aa586f02128e6dd22579ce29c834cb4f4">nfiles</a>;
<a name="l00942"></a>00942   cbd-&gt;<a class="code" href="structaddfileprovides__cbdata.html#ad72840ed46bcb67d2d0aae77a790159b">ids</a> = sf-&gt;<a class="code" href="structsearchfiles.html#a8cb9da12cea3df07ded9f458441780e0">ids</a>;
<a name="l00943"></a>00943   cbd-&gt;<a class="code" href="structaddfileprovides__cbdata.html#aaecd38a128f97ec93c280280745ca241">dirs</a> = sf-&gt;<a class="code" href="structsearchfiles.html#a9df91f6576d29e829c7a7fc9c5a14609">dirs</a>;
<a name="l00944"></a>00944   cbd-&gt;<a class="code" href="structaddfileprovides__cbdata.html#ae995f69a2cdc1117c9aa0e7df59c3ace">names</a> = sf-&gt;<a class="code" href="structsearchfiles.html#ae282bc4187f1856314aad2e78cae90b2">names</a>;
<a name="l00945"></a>00945   cbd-&gt;<a class="code" href="structaddfileprovides__cbdata.html#a43d3a0d2a15758cdcab0090ce924323a">dids</a> = <a class="code" href="util_8c.html#a8f5176ce31f7fb335f55fcae625149ea">sat_realloc2</a>(cbd-&gt;<a class="code" href="structaddfileprovides__cbdata.html#a43d3a0d2a15758cdcab0090ce924323a">dids</a>, sf-&gt;<a class="code" href="structsearchfiles.html#aa586f02128e6dd22579ce29c834cb4f4">nfiles</a>, <span class="keyword">sizeof</span>(<a class="code" href="pooltypes_8h.html#a2e0e6278ac51842ca3aeb53e3fc3ead6">Id</a>));
<a name="l00946"></a>00946   <a class="code" href="bitmap_8c.html#a8d8010a0f9f491483c12e83ae3a9082e">map_init</a>(&amp;cbd-&gt;<a class="code" href="structaddfileprovides__cbdata.html#a09045087092842831c18439cc0e9963c">providedids</a>, pool-&gt;<a class="code" href="struct__Pool.html#afa7b61374ab18cfea97f12796850a638">ss</a>.<a class="code" href="struct__Stringpool.html#a2bf0e8ba450ec30d60076977912dfd5f">nstrings</a>);
<a name="l00947"></a>00947 
<a name="l00948"></a>00948   repoid = 0;
<a name="l00949"></a>00949   repo = repoonly ? repoonly : pool-&gt;<a class="code" href="struct__Pool.html#acd50c1c34cd96f8bf0b14bab7505aade">repos</a>[0];
<a name="l00950"></a>00950   <a class="code" href="bitmap_8c.html#a8d8010a0f9f491483c12e83ae3a9082e">map_init</a>(&amp;donemap, pool-&gt;<a class="code" href="struct__Pool.html#a00e935f7b65616513799ac9e26fefa31">nsolvables</a>);
<a name="l00951"></a>00951   <a class="code" href="queue_8c.html#ae1a64f63dd8cc46bdb2bcd415aa89e5a">queue_init</a>(&amp;fileprovidesq);
<a name="l00952"></a>00952   provstart = provend = 0;
<a name="l00953"></a>00953   <span class="keywordflow">for</span> (;;)
<a name="l00954"></a>00954     {
<a name="l00955"></a>00955       <span class="keywordflow">if</span> (repo-&gt;<a class="code" href="struct__Repo.html#a637e3e83a1a07551b8bf6e73a654083d">disabled</a>)
<a name="l00956"></a>00956         {
<a name="l00957"></a>00957           <span class="keywordflow">if</span> (repoonly || ++repoid == pool-&gt;<a class="code" href="struct__Pool.html#a405de8203c6d57f0e35d76943b7bd84e">nrepos</a>)
<a name="l00958"></a>00958             <span class="keywordflow">break</span>;
<a name="l00959"></a>00959           repo = pool-&gt;<a class="code" href="struct__Pool.html#acd50c1c34cd96f8bf0b14bab7505aade">repos</a>[repoid];
<a name="l00960"></a>00960           <span class="keywordflow">continue</span>;
<a name="l00961"></a>00961         }
<a name="l00962"></a>00962       ndone = 0;
<a name="l00963"></a>00963       <span class="keywordflow">for</span> (data = repo-&gt;<a class="code" href="struct__Repo.html#a2dfdb93a6ac25e5b52d874f8c2a40ecc">repodata</a>, repodataid = 0; repodataid &lt; repo-&gt;nrepodata; repodataid++, data++)
<a name="l00964"></a>00964         {
<a name="l00965"></a>00965           <span class="keywordflow">if</span> (ndone &gt;= repo-&gt;<a class="code" href="struct__Repo.html#a71f8addb47dc90a36295f2993e30b24d">nsolvables</a>)
<a name="l00966"></a>00966             <span class="keywordflow">break</span>;
<a name="l00967"></a>00967 
<a name="l00968"></a>00968           <span class="keywordflow">if</span> (<a class="code" href="repodata_8c.html#a31de7655b029740fffee1ae35038bd75">repodata_lookup_idarray</a>(data, <a class="code" href="repodata_8h.html#af14939da8f462cf22a17d1fa7d4fe2f1">SOLVID_META</a>, REPOSITORY_ADDEDFILEPROVIDES, &amp;fileprovidesq))
<a name="l00969"></a>00969             {
<a name="l00970"></a>00970               <a class="code" href="bitmap_8h.html#a3689e90523eaa603e82ed057778b5f18">map_empty</a>(&amp;cbd-&gt;<a class="code" href="structaddfileprovides__cbdata.html#a09045087092842831c18439cc0e9963c">providedids</a>);
<a name="l00971"></a>00971               <span class="keywordflow">for</span> (i = 0; i &lt; fileprovidesq.<a class="code" href="struct__Queue.html#abb0696a77174cd23b5f488ad4c7b45d2">count</a>; i++)
<a name="l00972"></a>00972                 <a class="code" href="bitmap_8h.html#a33557e357513f5b3faef527bb320183c">MAPSET</a>(&amp;cbd-&gt;<a class="code" href="structaddfileprovides__cbdata.html#a09045087092842831c18439cc0e9963c">providedids</a>, fileprovidesq.<a class="code" href="struct__Queue.html#a116eb58bed8ff76bf18f9c16cf1ce5c6">elements</a>[i]);
<a name="l00973"></a>00973               provstart = data-&gt;<a class="code" href="struct__Repodata.html#a4511574292e484437fd7eca03f74b41f">start</a>;
<a name="l00974"></a>00974               provend = data-&gt;<a class="code" href="struct__Repodata.html#a79054fe8102a97d5b6f79470764a281d">end</a>;
<a name="l00975"></a>00975               <span class="keywordflow">for</span> (i = 0; i &lt; cbd-&gt;<a class="code" href="structaddfileprovides__cbdata.html#ad9ad39853e6788d35be955d46b0a77e4">nfiles</a>; i++)
<a name="l00976"></a>00976                 <span class="keywordflow">if</span> (!<a class="code" href="bitmap_8h.html#ad8ccb9ad3a8ad65f5fe08a988acc503d">MAPTST</a>(&amp;cbd-&gt;<a class="code" href="structaddfileprovides__cbdata.html#a09045087092842831c18439cc0e9963c">providedids</a>, cbd-&gt;<a class="code" href="structaddfileprovides__cbdata.html#ad72840ed46bcb67d2d0aae77a790159b">ids</a>[i]))
<a name="l00977"></a>00977                   <span class="keywordflow">break</span>;
<a name="l00978"></a>00978               <span class="keywordflow">if</span> (i == cbd-&gt;<a class="code" href="structaddfileprovides__cbdata.html#ad9ad39853e6788d35be955d46b0a77e4">nfiles</a>)
<a name="l00979"></a>00979                 {
<a name="l00980"></a>00980                   <span class="comment">/* great! no need to search files */</span>
<a name="l00981"></a>00981                   <span class="keywordflow">for</span> (p = data-&gt;<a class="code" href="struct__Repodata.html#a4511574292e484437fd7eca03f74b41f">start</a>; p &lt; data-&gt;end; p++)
<a name="l00982"></a>00982                     <span class="keywordflow">if</span> (pool-&gt;<a class="code" href="struct__Pool.html#a9842c936aa241bad13ba13f21a337319">solvables</a>[p].<a class="code" href="struct__Solvable.html#a15e0b77fe061c6429a24215191b10f05">repo</a> == repo)
<a name="l00983"></a>00983                       {
<a name="l00984"></a>00984                         <span class="keywordflow">if</span> (<a class="code" href="bitmap_8h.html#ad8ccb9ad3a8ad65f5fe08a988acc503d">MAPTST</a>(&amp;donemap, p))
<a name="l00985"></a>00985                           <span class="keywordflow">continue</span>;
<a name="l00986"></a>00986                         <a class="code" href="bitmap_8h.html#a33557e357513f5b3faef527bb320183c">MAPSET</a>(&amp;donemap, p);
<a name="l00987"></a>00987                         ndone++;
<a name="l00988"></a>00988                       }
<a name="l00989"></a>00989                   <span class="keywordflow">continue</span>;
<a name="l00990"></a>00990                 }
<a name="l00991"></a>00991             }
<a name="l00992"></a>00992 
<a name="l00993"></a>00993           <span class="keywordflow">if</span> (!<a class="code" href="repodata_8h.html#af1f569a8f6dc6bbced79668ebe94b9a6">repodata_has_keyname</a>(data, SOLVABLE_FILELIST))
<a name="l00994"></a>00994             <span class="keywordflow">continue</span>;
<a name="l00995"></a>00995 
<a name="l00996"></a>00996           <span class="keywordflow">if</span> (data-&gt;<a class="code" href="struct__Repodata.html#a4511574292e484437fd7eca03f74b41f">start</a> &lt; provstart || data-&gt;<a class="code" href="struct__Repodata.html#a79054fe8102a97d5b6f79470764a281d">end</a> &gt; provend)
<a name="l00997"></a>00997             {
<a name="l00998"></a>00998               <a class="code" href="bitmap_8h.html#a3689e90523eaa603e82ed057778b5f18">map_empty</a>(&amp;cbd-&gt;<a class="code" href="structaddfileprovides__cbdata.html#a09045087092842831c18439cc0e9963c">providedids</a>);
<a name="l00999"></a>00999               provstart = provend = 0;
<a name="l01000"></a>01000             }
<a name="l01001"></a>01001 
<a name="l01002"></a>01002           <span class="comment">/* check if the data is incomplete */</span>
<a name="l01003"></a>01003           incomplete = 0;
<a name="l01004"></a>01004           <span class="keywordflow">if</span> (data-&gt;<a class="code" href="struct__Repodata.html#ada7d689e033d72b0891d6767f30513fa">state</a> == <a class="code" href="repodata_8h.html#a42abbea04c61883c3880501a2d724444">REPODATA_AVAILABLE</a>)
<a name="l01005"></a>01005             {
<a name="l01006"></a>01006               <span class="keywordflow">for</span> (j = 1; j &lt; data-&gt;<a class="code" href="struct__Repodata.html#a099b77c06a605b39b224d43251adfe1b">nkeys</a>; j++)
<a name="l01007"></a>01007                 <span class="keywordflow">if</span> (data-&gt;<a class="code" href="struct__Repodata.html#afadb4fd1a071d5d5a29ac7561c9766d4">keys</a>[j].<a class="code" href="struct__Repokey.html#a8db2eceba48d61804428086a7e0ef9fd">name</a> != REPOSITORY_SOLVABLES &amp;&amp; data-&gt;<a class="code" href="struct__Repodata.html#afadb4fd1a071d5d5a29ac7561c9766d4">keys</a>[j].<a class="code" href="struct__Repokey.html#a8db2eceba48d61804428086a7e0ef9fd">name</a> != SOLVABLE_FILELIST)
<a name="l01008"></a>01008                   <span class="keywordflow">break</span>;
<a name="l01009"></a>01009               <span class="keywordflow">if</span> (j &lt; data-&gt;nkeys)
<a name="l01010"></a>01010                 {
<a name="l01011"></a>01011 <span class="preprocessor">#if 0</span>
<a name="l01012"></a>01012 <span class="preprocessor"></span>                  <span class="keywordflow">for</span> (i = 0; i &lt; cbd-&gt;<a class="code" href="structaddfileprovides__cbdata.html#ad9ad39853e6788d35be955d46b0a77e4">nfiles</a>; i++)
<a name="l01013"></a>01013                     <span class="keywordflow">if</span> (!<a class="code" href="bitmap_8h.html#ad8ccb9ad3a8ad65f5fe08a988acc503d">MAPTST</a>(&amp;cbd-&gt;<a class="code" href="structaddfileprovides__cbdata.html#a09045087092842831c18439cc0e9963c">providedids</a>, cbd-&gt;<a class="code" href="structaddfileprovides__cbdata.html#ad72840ed46bcb67d2d0aae77a790159b">ids</a>[i]) &amp;&amp; !<a class="code" href="repodata_8c.html#a2bd03007ab3bb5a49c6567710e51dc34">repodata_filelistfilter_matches</a>(data, <a class="code" href="poolid_8c.html#a8a844727bd2258ef240555fc629b2fa7">id2str</a>(pool, cbd-&gt;<a class="code" href="structaddfileprovides__cbdata.html#ad72840ed46bcb67d2d0aae77a790159b">ids</a>[i])))
<a name="l01014"></a>01014                       printf(<span class="stringliteral">&quot;need complete filelist because of %s\n&quot;</span>, <a class="code" href="poolid_8c.html#a8a844727bd2258ef240555fc629b2fa7">id2str</a>(pool, cbd-&gt;<a class="code" href="structaddfileprovides__cbdata.html#ad72840ed46bcb67d2d0aae77a790159b">ids</a>[i]));
<a name="l01015"></a>01015 <span class="preprocessor">#endif</span>
<a name="l01016"></a>01016 <span class="preprocessor"></span>                  <span class="keywordflow">for</span> (i = 0; i &lt; cbd-&gt;<a class="code" href="structaddfileprovides__cbdata.html#ad9ad39853e6788d35be955d46b0a77e4">nfiles</a>; i++)
<a name="l01017"></a>01017                     <span class="keywordflow">if</span> (!<a class="code" href="bitmap_8h.html#ad8ccb9ad3a8ad65f5fe08a988acc503d">MAPTST</a>(&amp;cbd-&gt;<a class="code" href="structaddfileprovides__cbdata.html#a09045087092842831c18439cc0e9963c">providedids</a>, cbd-&gt;<a class="code" href="structaddfileprovides__cbdata.html#ad72840ed46bcb67d2d0aae77a790159b">ids</a>[i]) &amp;&amp; !<a class="code" href="repodata_8c.html#a2bd03007ab3bb5a49c6567710e51dc34">repodata_filelistfilter_matches</a>(data, <a class="code" href="poolid_8c.html#a8a844727bd2258ef240555fc629b2fa7">id2str</a>(pool, cbd-&gt;<a class="code" href="structaddfileprovides__cbdata.html#ad72840ed46bcb67d2d0aae77a790159b">ids</a>[i])))
<a name="l01018"></a>01018                       <span class="keywordflow">break</span>;
<a name="l01019"></a>01019                   <span class="keywordflow">if</span> (i &lt; cbd-&gt;<a class="code" href="structaddfileprovides__cbdata.html#ad9ad39853e6788d35be955d46b0a77e4">nfiles</a>)
<a name="l01020"></a>01020                     incomplete = 1;
<a name="l01021"></a>01021                 }
<a name="l01022"></a>01022             }
<a name="l01023"></a>01023 
<a name="l01024"></a>01024           <span class="comment">/* do the search */</span>
<a name="l01025"></a>01025           <a class="code" href="bitmap_8c.html#a8d8010a0f9f491483c12e83ae3a9082e">map_init</a>(&amp;cbd-&gt;<a class="code" href="structaddfileprovides__cbdata.html#a7bcfb88a4cbdc07387d714408f563016">useddirs</a>, 0);
<a name="l01026"></a>01026           <span class="keywordflow">for</span> (p = data-&gt;<a class="code" href="struct__Repodata.html#a4511574292e484437fd7eca03f74b41f">start</a>; p &lt; data-&gt;end; p++)
<a name="l01027"></a>01027             <span class="keywordflow">if</span> (pool-&gt;<a class="code" href="struct__Pool.html#a9842c936aa241bad13ba13f21a337319">solvables</a>[p].<a class="code" href="struct__Solvable.html#a15e0b77fe061c6429a24215191b10f05">repo</a> == repo)
<a name="l01028"></a>01028               {
<a name="l01029"></a>01029                 <span class="keywordflow">if</span> (<a class="code" href="bitmap_8h.html#ad8ccb9ad3a8ad65f5fe08a988acc503d">MAPTST</a>(&amp;donemap, p))
<a name="l01030"></a>01030                   <span class="keywordflow">continue</span>;
<a name="l01031"></a>01031                 <a class="code" href="repodata_8c.html#a3ccf123b4c9958271af8a112aa030e69">repodata_search</a>(data, p, SOLVABLE_FILELIST, 0, <a class="code" href="pool_8c.html#abbfc473c8543c23bbf0610f27a1fbf8c">addfileprovides_cb</a>, cbd);
<a name="l01032"></a>01032                 <span class="keywordflow">if</span> (!incomplete)
<a name="l01033"></a>01033                   {
<a name="l01034"></a>01034                     <a class="code" href="bitmap_8h.html#a33557e357513f5b3faef527bb320183c">MAPSET</a>(&amp;donemap, p);
<a name="l01035"></a>01035                     ndone++;
<a name="l01036"></a>01036                   }
<a name="l01037"></a>01037               }
<a name="l01038"></a>01038           <a class="code" href="bitmap_8c.html#a85426cea64351e7b4477370824ddd75f">map_free</a>(&amp;cbd-&gt;<a class="code" href="structaddfileprovides__cbdata.html#a7bcfb88a4cbdc07387d714408f563016">useddirs</a>);
<a name="l01039"></a>01039         }
<a name="l01040"></a>01040 
<a name="l01041"></a>01041       <span class="keywordflow">if</span> (repoonly || ++repoid == pool-&gt;<a class="code" href="struct__Pool.html#a405de8203c6d57f0e35d76943b7bd84e">nrepos</a>)
<a name="l01042"></a>01042         <span class="keywordflow">break</span>;
<a name="l01043"></a>01043       repo = pool-&gt;<a class="code" href="struct__Pool.html#acd50c1c34cd96f8bf0b14bab7505aade">repos</a>[repoid];
<a name="l01044"></a>01044     }
<a name="l01045"></a>01045   <a class="code" href="bitmap_8c.html#a85426cea64351e7b4477370824ddd75f">map_free</a>(&amp;donemap);
<a name="l01046"></a>01046   <a class="code" href="queue_8c.html#a701c81a9f7d503837e74d43981e79137">queue_free</a>(&amp;fileprovidesq);
<a name="l01047"></a>01047   <a class="code" href="bitmap_8c.html#a85426cea64351e7b4477370824ddd75f">map_free</a>(&amp;cbd-&gt;<a class="code" href="structaddfileprovides__cbdata.html#a09045087092842831c18439cc0e9963c">providedids</a>);
<a name="l01048"></a>01048 }
<a name="l01049"></a>01049 
<a name="l01050"></a>01050 <span class="keywordtype">void</span>
<a name="l01051"></a><a class="code" href="pool_8h.html#af2c1edd4365161168d9ec6e2edd320f4">01051</a> <a class="code" href="pool_8c.html#adca92587e7f3caedefce34e426f63798">pool_addfileprovides_ids</a>(<a class="code" href="struct__Pool.html">Pool</a> *pool, <a class="code" href="struct__Repo.html">Repo</a> *installed, <a class="code" href="pooltypes_8h.html#a2e0e6278ac51842ca3aeb53e3fc3ead6">Id</a> **idp)
<a name="l01052"></a>01052 {
<a name="l01053"></a>01053   <a class="code" href="struct__Solvable.html">Solvable</a> *s;
<a name="l01054"></a>01054   <a class="code" href="struct__Repo.html">Repo</a> *repo;
<a name="l01055"></a>01055   <span class="keyword">struct </span><a class="code" href="structsearchfiles.html">searchfiles</a> sf, isf, *isfp;
<a name="l01056"></a>01056   <span class="keyword">struct </span><a class="code" href="structaddfileprovides__cbdata.html">addfileprovides_cbdata</a> cbd;
<a name="l01057"></a>01057   <span class="keywordtype">int</span> i;
<a name="l01058"></a>01058   <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> now;
<a name="l01059"></a>01059 
<a name="l01060"></a>01060   now = <a class="code" href="util_8c.html#a10875c1838f0632aabf1a919135a06ee">sat_timems</a>(0);
<a name="l01061"></a>01061   memset(&amp;sf, 0, <span class="keyword">sizeof</span>(sf));
<a name="l01062"></a>01062   <a class="code" href="bitmap_8c.html#a8d8010a0f9f491483c12e83ae3a9082e">map_init</a>(&amp;sf.<a class="code" href="structsearchfiles.html#a64003a6d20c96c17f689f93bc9fa0ad8">seen</a>, pool-&gt;<a class="code" href="struct__Pool.html#afa7b61374ab18cfea97f12796850a638">ss</a>.<a class="code" href="struct__Stringpool.html#a2bf0e8ba450ec30d60076977912dfd5f">nstrings</a> + pool-&gt;<a class="code" href="struct__Pool.html#ae4eb69a89bfd02139401474c41f1c82d">nrels</a>);
<a name="l01063"></a>01063   memset(&amp;isf, 0, <span class="keyword">sizeof</span>(isf));
<a name="l01064"></a>01064   <a class="code" href="bitmap_8c.html#a8d8010a0f9f491483c12e83ae3a9082e">map_init</a>(&amp;isf.<a class="code" href="structsearchfiles.html#a64003a6d20c96c17f689f93bc9fa0ad8">seen</a>, pool-&gt;<a class="code" href="struct__Pool.html#afa7b61374ab18cfea97f12796850a638">ss</a>.<a class="code" href="struct__Stringpool.html#a2bf0e8ba450ec30d60076977912dfd5f">nstrings</a> + pool-&gt;<a class="code" href="struct__Pool.html#ae4eb69a89bfd02139401474c41f1c82d">nrels</a>);
<a name="l01065"></a>01065 
<a name="l01066"></a>01066   isfp = installed ? &amp;isf : 0;
<a name="l01067"></a>01067   <span class="keywordflow">for</span> (i = 1, s = pool-&gt;<a class="code" href="struct__Pool.html#a9842c936aa241bad13ba13f21a337319">solvables</a> + i; i &lt; pool-&gt;nsolvables; i++, s++)
<a name="l01068"></a>01068     {
<a name="l01069"></a>01069       repo = s-&gt;<a class="code" href="struct__Solvable.html#a15e0b77fe061c6429a24215191b10f05">repo</a>;
<a name="l01070"></a>01070       <span class="keywordflow">if</span> (!repo)
<a name="l01071"></a>01071         <span class="keywordflow">continue</span>;
<a name="l01072"></a>01072       <span class="keywordflow">if</span> (s-&gt;<a class="code" href="struct__Solvable.html#a2eb11a5e84d9a4141fd44e9e9f2d0124">obsoletes</a>)
<a name="l01073"></a>01073         <a class="code" href="pool_8c.html#a4ed97186265304aaa4fa20f6a9c2021e">pool_addfileprovides_dep</a>(pool, repo-&gt;<a class="code" href="struct__Repo.html#afddcfa36231cc08266800bee5b978528">idarraydata</a> + s-&gt;<a class="code" href="struct__Solvable.html#a2eb11a5e84d9a4141fd44e9e9f2d0124">obsoletes</a>, &amp;sf, isfp);
<a name="l01074"></a>01074       <span class="keywordflow">if</span> (s-&gt;<a class="code" href="struct__Solvable.html#a53b6ec41be31e4aafb5a52e0c7ae2470">conflicts</a>)
<a name="l01075"></a>01075         <a class="code" href="pool_8c.html#a4ed97186265304aaa4fa20f6a9c2021e">pool_addfileprovides_dep</a>(pool, repo-&gt;<a class="code" href="struct__Repo.html#afddcfa36231cc08266800bee5b978528">idarraydata</a> + s-&gt;<a class="code" href="struct__Solvable.html#a53b6ec41be31e4aafb5a52e0c7ae2470">conflicts</a>, &amp;sf, isfp);
<a name="l01076"></a>01076       <span class="keywordflow">if</span> (s-&gt;<a class="code" href="struct__Solvable.html#a0920d25d5be01033af30796d19280c65">requires</a>)
<a name="l01077"></a>01077         <a class="code" href="pool_8c.html#a4ed97186265304aaa4fa20f6a9c2021e">pool_addfileprovides_dep</a>(pool, repo-&gt;<a class="code" href="struct__Repo.html#afddcfa36231cc08266800bee5b978528">idarraydata</a> + s-&gt;<a class="code" href="struct__Solvable.html#a0920d25d5be01033af30796d19280c65">requires</a>, &amp;sf, isfp);
<a name="l01078"></a>01078       <span class="keywordflow">if</span> (s-&gt;<a class="code" href="struct__Solvable.html#ae1f2dbd627c9da9717265ec42f0922f5">recommends</a>)
<a name="l01079"></a>01079         <a class="code" href="pool_8c.html#a4ed97186265304aaa4fa20f6a9c2021e">pool_addfileprovides_dep</a>(pool, repo-&gt;<a class="code" href="struct__Repo.html#afddcfa36231cc08266800bee5b978528">idarraydata</a> + s-&gt;<a class="code" href="struct__Solvable.html#ae1f2dbd627c9da9717265ec42f0922f5">recommends</a>, &amp;sf, isfp);
<a name="l01080"></a>01080       <span class="keywordflow">if</span> (s-&gt;<a class="code" href="struct__Solvable.html#a6b4459e6a610479d09fba8bab9f3abbb">suggests</a>)
<a name="l01081"></a>01081         <a class="code" href="pool_8c.html#a4ed97186265304aaa4fa20f6a9c2021e">pool_addfileprovides_dep</a>(pool, repo-&gt;<a class="code" href="struct__Repo.html#afddcfa36231cc08266800bee5b978528">idarraydata</a> + s-&gt;<a class="code" href="struct__Solvable.html#a6b4459e6a610479d09fba8bab9f3abbb">suggests</a>, &amp;sf, isfp);
<a name="l01082"></a>01082       <span class="keywordflow">if</span> (s-&gt;<a class="code" href="struct__Solvable.html#a79c815d6fb1a42d4c4de10411d87de82">supplements</a>)
<a name="l01083"></a>01083         <a class="code" href="pool_8c.html#a4ed97186265304aaa4fa20f6a9c2021e">pool_addfileprovides_dep</a>(pool, repo-&gt;<a class="code" href="struct__Repo.html#afddcfa36231cc08266800bee5b978528">idarraydata</a> + s-&gt;<a class="code" href="struct__Solvable.html#a79c815d6fb1a42d4c4de10411d87de82">supplements</a>, &amp;sf, isfp);
<a name="l01084"></a>01084       <span class="keywordflow">if</span> (s-&gt;<a class="code" href="struct__Solvable.html#aabcd1942ec228c6eceed9d2c16204833">enhances</a>)
<a name="l01085"></a>01085         <a class="code" href="pool_8c.html#a4ed97186265304aaa4fa20f6a9c2021e">pool_addfileprovides_dep</a>(pool, repo-&gt;<a class="code" href="struct__Repo.html#afddcfa36231cc08266800bee5b978528">idarraydata</a> + s-&gt;<a class="code" href="struct__Solvable.html#aabcd1942ec228c6eceed9d2c16204833">enhances</a>, &amp;sf, isfp);
<a name="l01086"></a>01086     }
<a name="l01087"></a>01087   <a class="code" href="bitmap_8c.html#a85426cea64351e7b4477370824ddd75f">map_free</a>(&amp;sf.<a class="code" href="structsearchfiles.html#a64003a6d20c96c17f689f93bc9fa0ad8">seen</a>);
<a name="l01088"></a>01088   <a class="code" href="bitmap_8c.html#a85426cea64351e7b4477370824ddd75f">map_free</a>(&amp;isf.<a class="code" href="structsearchfiles.html#a64003a6d20c96c17f689f93bc9fa0ad8">seen</a>);
<a name="l01089"></a>01089   <a class="code" href="pool_8h.html#ac2855e39d8eaea31be68bd0fd03574b5">POOL_DEBUG</a>(<a class="code" href="pool_8h.html#a9e7c48e08e7b2a51b41e4d6611a02ace">SAT_DEBUG_STATS</a>, <span class="stringliteral">&quot;found %d file dependencies, %d installed file dependencies\n&quot;</span>, sf.<a class="code" href="structsearchfiles.html#aa586f02128e6dd22579ce29c834cb4f4">nfiles</a>, isf.<a class="code" href="structsearchfiles.html#aa586f02128e6dd22579ce29c834cb4f4">nfiles</a>);
<a name="l01090"></a>01090   cbd.<a class="code" href="structaddfileprovides__cbdata.html#a43d3a0d2a15758cdcab0090ce924323a">dids</a> = 0;
<a name="l01091"></a>01091   <span class="keywordflow">if</span> (idp)
<a name="l01092"></a>01092     *idp = 0;
<a name="l01093"></a>01093   <span class="keywordflow">if</span> (sf.<a class="code" href="structsearchfiles.html#aa586f02128e6dd22579ce29c834cb4f4">nfiles</a>)
<a name="l01094"></a>01094     {
<a name="l01095"></a>01095 <span class="preprocessor">#if 0</span>
<a name="l01096"></a>01096 <span class="preprocessor"></span>      <span class="keywordflow">for</span> (i = 0; i &lt; sf.<a class="code" href="structsearchfiles.html#aa586f02128e6dd22579ce29c834cb4f4">nfiles</a>; i++)
<a name="l01097"></a>01097         <a class="code" href="pool_8h.html#ac2855e39d8eaea31be68bd0fd03574b5">POOL_DEBUG</a>(<a class="code" href="pool_8h.html#a9e7c48e08e7b2a51b41e4d6611a02ace">SAT_DEBUG_STATS</a>, <span class="stringliteral">&quot;looking up %s in filelist\n&quot;</span>, <a class="code" href="poolid_8c.html#a8a844727bd2258ef240555fc629b2fa7">id2str</a>(pool, sf.<a class="code" href="structsearchfiles.html#a8cb9da12cea3df07ded9f458441780e0">ids</a>[i]));
<a name="l01098"></a>01098 <span class="preprocessor">#endif</span>
<a name="l01099"></a>01099 <span class="preprocessor"></span>      <a class="code" href="pool_8c.html#a2ebc724a3fa31d81054ca6b97e95bfd7">pool_addfileprovides_search</a>(pool, &amp;cbd, &amp;sf, 0);
<a name="l01100"></a>01100       <span class="keywordflow">if</span> (idp)
<a name="l01101"></a>01101         {
<a name="l01102"></a>01102           sf.<a class="code" href="structsearchfiles.html#a8cb9da12cea3df07ded9f458441780e0">ids</a> = <a class="code" href="util_8h.html#a8f0135824fd0936735b002a452c84cbd">sat_extend</a>(sf.<a class="code" href="structsearchfiles.html#a8cb9da12cea3df07ded9f458441780e0">ids</a>, sf.<a class="code" href="structsearchfiles.html#aa586f02128e6dd22579ce29c834cb4f4">nfiles</a>, 1, <span class="keyword">sizeof</span>(<a class="code" href="pooltypes_8h.html#a2e0e6278ac51842ca3aeb53e3fc3ead6">Id</a>), <a class="code" href="pool_8c.html#a48d04505fd12e1062b49d31909856942">SEARCHFILES_BLOCK</a>);
<a name="l01103"></a>01103           sf.<a class="code" href="structsearchfiles.html#a8cb9da12cea3df07ded9f458441780e0">ids</a>[sf.<a class="code" href="structsearchfiles.html#aa586f02128e6dd22579ce29c834cb4f4">nfiles</a>] = 0;
<a name="l01104"></a>01104           *idp = sf.<a class="code" href="structsearchfiles.html#a8cb9da12cea3df07ded9f458441780e0">ids</a>;
<a name="l01105"></a>01105           sf.<a class="code" href="structsearchfiles.html#a8cb9da12cea3df07ded9f458441780e0">ids</a> = 0;
<a name="l01106"></a>01106         }
<a name="l01107"></a>01107       <a class="code" href="util_8c.html#a1f246fae10a89534cfe0583cefb44c11">sat_free</a>(sf.<a class="code" href="structsearchfiles.html#a8cb9da12cea3df07ded9f458441780e0">ids</a>);
<a name="l01108"></a>01108       <span class="keywordflow">for</span> (i = 0; i &lt; sf.<a class="code" href="structsearchfiles.html#aa586f02128e6dd22579ce29c834cb4f4">nfiles</a>; i++)
<a name="l01109"></a>01109         {
<a name="l01110"></a>01110           <a class="code" href="util_8c.html#a1f246fae10a89534cfe0583cefb44c11">sat_free</a>(sf.<a class="code" href="structsearchfiles.html#a9df91f6576d29e829c7a7fc9c5a14609">dirs</a>[i]);
<a name="l01111"></a>01111           <a class="code" href="util_8c.html#a1f246fae10a89534cfe0583cefb44c11">sat_free</a>(sf.<a class="code" href="structsearchfiles.html#ae282bc4187f1856314aad2e78cae90b2">names</a>[i]);
<a name="l01112"></a>01112         }
<a name="l01113"></a>01113       <a class="code" href="util_8c.html#a1f246fae10a89534cfe0583cefb44c11">sat_free</a>(sf.<a class="code" href="structsearchfiles.html#a9df91f6576d29e829c7a7fc9c5a14609">dirs</a>);
<a name="l01114"></a>01114       <a class="code" href="util_8c.html#a1f246fae10a89534cfe0583cefb44c11">sat_free</a>(sf.<a class="code" href="structsearchfiles.html#ae282bc4187f1856314aad2e78cae90b2">names</a>);
<a name="l01115"></a>01115     }
<a name="l01116"></a>01116   <span class="keywordflow">if</span> (isf.<a class="code" href="structsearchfiles.html#aa586f02128e6dd22579ce29c834cb4f4">nfiles</a>)
<a name="l01117"></a>01117     {
<a name="l01118"></a>01118 <span class="preprocessor">#if 0</span>
<a name="l01119"></a>01119 <span class="preprocessor"></span>      <span class="keywordflow">for</span> (i = 0; i &lt; isf.<a class="code" href="structsearchfiles.html#aa586f02128e6dd22579ce29c834cb4f4">nfiles</a>; i++)
<a name="l01120"></a>01120         <a class="code" href="pool_8h.html#ac2855e39d8eaea31be68bd0fd03574b5">POOL_DEBUG</a>(<a class="code" href="pool_8h.html#a9e7c48e08e7b2a51b41e4d6611a02ace">SAT_DEBUG_STATS</a>, <span class="stringliteral">&quot;looking up %s in installed filelist\n&quot;</span>, <a class="code" href="poolid_8c.html#a8a844727bd2258ef240555fc629b2fa7">id2str</a>(pool, isf.<a class="code" href="structsearchfiles.html#a8cb9da12cea3df07ded9f458441780e0">ids</a>[i]));
<a name="l01121"></a>01121 <span class="preprocessor">#endif</span>
<a name="l01122"></a>01122 <span class="preprocessor"></span>      <span class="keywordflow">if</span> (installed)
<a name="l01123"></a>01123         <a class="code" href="pool_8c.html#a2ebc724a3fa31d81054ca6b97e95bfd7">pool_addfileprovides_search</a>(pool, &amp;cbd, &amp;isf, installed);
<a name="l01124"></a>01124       <a class="code" href="util_8c.html#a1f246fae10a89534cfe0583cefb44c11">sat_free</a>(isf.<a class="code" href="structsearchfiles.html#a8cb9da12cea3df07ded9f458441780e0">ids</a>);
<a name="l01125"></a>01125       <span class="keywordflow">for</span> (i = 0; i &lt; isf.<a class="code" href="structsearchfiles.html#aa586f02128e6dd22579ce29c834cb4f4">nfiles</a>; i++)
<a name="l01126"></a>01126         {
<a name="l01127"></a>01127           <a class="code" href="util_8c.html#a1f246fae10a89534cfe0583cefb44c11">sat_free</a>(isf.<a class="code" href="structsearchfiles.html#a9df91f6576d29e829c7a7fc9c5a14609">dirs</a>[i]);
<a name="l01128"></a>01128           <a class="code" href="util_8c.html#a1f246fae10a89534cfe0583cefb44c11">sat_free</a>(isf.<a class="code" href="structsearchfiles.html#ae282bc4187f1856314aad2e78cae90b2">names</a>[i]);
<a name="l01129"></a>01129         }
<a name="l01130"></a>01130       <a class="code" href="util_8c.html#a1f246fae10a89534cfe0583cefb44c11">sat_free</a>(isf.<a class="code" href="structsearchfiles.html#a9df91f6576d29e829c7a7fc9c5a14609">dirs</a>);
<a name="l01131"></a>01131       <a class="code" href="util_8c.html#a1f246fae10a89534cfe0583cefb44c11">sat_free</a>(isf.<a class="code" href="structsearchfiles.html#ae282bc4187f1856314aad2e78cae90b2">names</a>);
<a name="l01132"></a>01132     }
<a name="l01133"></a>01133   <a class="code" href="util_8c.html#a1f246fae10a89534cfe0583cefb44c11">sat_free</a>(cbd.<a class="code" href="structaddfileprovides__cbdata.html#a43d3a0d2a15758cdcab0090ce924323a">dids</a>);
<a name="l01134"></a>01134   <a class="code" href="pool_8c.html#a14dd275466a52e37d15ba44422bffe81">pool_freewhatprovides</a>(pool);  <span class="comment">/* as we have added provides */</span>
<a name="l01135"></a>01135   <a class="code" href="pool_8h.html#ac2855e39d8eaea31be68bd0fd03574b5">POOL_DEBUG</a>(<a class="code" href="pool_8h.html#a9e7c48e08e7b2a51b41e4d6611a02ace">SAT_DEBUG_STATS</a>, <span class="stringliteral">&quot;addfileprovides took %d ms\n&quot;</span>, <a class="code" href="util_8c.html#a10875c1838f0632aabf1a919135a06ee">sat_timems</a>(now));
<a name="l01136"></a>01136 }
<a name="l01137"></a>01137 
<a name="l01138"></a>01138 <span class="keywordtype">void</span>
<a name="l01139"></a><a class="code" href="pool_8h.html#a651edb36adf4b4f58426767505bb1a62">01139</a> <a class="code" href="pool_8c.html#a651edb36adf4b4f58426767505bb1a62">pool_addfileprovides</a>(<a class="code" href="struct__Pool.html">Pool</a> *pool)
<a name="l01140"></a>01140 {
<a name="l01141"></a>01141   <a class="code" href="pool_8c.html#adca92587e7f3caedefce34e426f63798">pool_addfileprovides_ids</a>(pool, pool-&gt;<a class="code" href="struct__Pool.html#a887053f905054298cd61ce1c99e26690">installed</a>, 0);
<a name="l01142"></a>01142 }
<a name="l01143"></a>01143 
<a name="l01144"></a>01144 <span class="keywordtype">void</span>
<a name="l01145"></a><a class="code" href="pool_8h.html#a8950f8739acaeb954d5e963fc6ab90ec">01145</a> <a class="code" href="pool_8c.html#a8950f8739acaeb954d5e963fc6ab90ec">pool_search</a>(<a class="code" href="struct__Pool.html">Pool</a> *pool, <a class="code" href="pooltypes_8h.html#a2e0e6278ac51842ca3aeb53e3fc3ead6">Id</a> p, <a class="code" href="pooltypes_8h.html#a2e0e6278ac51842ca3aeb53e3fc3ead6">Id</a> key, <span class="keyword">const</span> <span class="keywordtype">char</span> *match, <span class="keywordtype">int</span> flags, <span class="keywordtype">int</span> (*callback)(<span class="keywordtype">void</span> *cbdata, <a class="code" href="struct__Solvable.html">Solvable</a> *s, <span class="keyword">struct</span> <a class="code" href="struct__Repodata.html">_Repodata</a> *data, <span class="keyword">struct</span> <a class="code" href="struct__Repokey.html">_Repokey</a> *key, <span class="keyword">struct</span> <a class="code" href="struct__KeyValue.html">_KeyValue</a> *kv), <span class="keywordtype">void</span> *cbdata)
<a name="l01146"></a>01146 {
<a name="l01147"></a>01147   <span class="keywordflow">if</span> (p)
<a name="l01148"></a>01148     {
<a name="l01149"></a>01149       <span class="keywordflow">if</span> (pool-&gt;<a class="code" href="struct__Pool.html#a9842c936aa241bad13ba13f21a337319">solvables</a>[p].<a class="code" href="struct__Solvable.html#a15e0b77fe061c6429a24215191b10f05">repo</a>)
<a name="l01150"></a>01150         <a class="code" href="repo_8c.html#acfa8ad01d505b448a6002c07eb03212a">repo_search</a>(pool-&gt;<a class="code" href="struct__Pool.html#a9842c936aa241bad13ba13f21a337319">solvables</a>[p].<a class="code" href="struct__Solvable.html#a15e0b77fe061c6429a24215191b10f05">repo</a>, p, key, match, flags, callback, cbdata);
<a name="l01151"></a>01151       <span class="keywordflow">return</span>;
<a name="l01152"></a>01152     }
<a name="l01153"></a>01153   <span class="comment">/* FIXME: obey callback return value! */</span>
<a name="l01154"></a>01154   <span class="keywordflow">for</span> (p = 1; p &lt; pool-&gt;<a class="code" href="struct__Pool.html#a00e935f7b65616513799ac9e26fefa31">nsolvables</a>; p++)
<a name="l01155"></a>01155     <span class="keywordflow">if</span> (pool-&gt;<a class="code" href="struct__Pool.html#a9842c936aa241bad13ba13f21a337319">solvables</a>[p].<a class="code" href="struct__Solvable.html#a15e0b77fe061c6429a24215191b10f05">repo</a>)
<a name="l01156"></a>01156       <a class="code" href="repo_8c.html#acfa8ad01d505b448a6002c07eb03212a">repo_search</a>(pool-&gt;<a class="code" href="struct__Pool.html#a9842c936aa241bad13ba13f21a337319">solvables</a>[p].<a class="code" href="struct__Solvable.html#a15e0b77fe061c6429a24215191b10f05">repo</a>, p, key, match, flags, callback, cbdata);
<a name="l01157"></a>01157 }
<a name="l01158"></a>01158 
<a name="l01159"></a>01159 <span class="keywordtype">void</span>
<a name="l01160"></a><a class="code" href="pool_8h.html#ad2c2c61f2b4694d10102ca8d12107ac3">01160</a> <a class="code" href="pool_8c.html#ad2c2c61f2b4694d10102ca8d12107ac3">pool_clear_pos</a>(<a class="code" href="struct__Pool.html">Pool</a> *pool)
<a name="l01161"></a>01161 {
<a name="l01162"></a>01162   memset(&amp;pool-&gt;<a class="code" href="struct__Pool.html#abe637b2c911c90240c4941ae0eea3796">pos</a>, 0, <span class="keyword">sizeof</span>(pool-&gt;<a class="code" href="struct__Pool.html#abe637b2c911c90240c4941ae0eea3796">pos</a>));
<a name="l01163"></a>01163 }
<a name="l01164"></a>01164 
<a name="l01165"></a>01165 
<a name="l01166"></a>01166 <span class="keywordtype">void</span>
<a name="l01167"></a><a class="code" href="pool_8h.html#a6fd6d5110751002d167b1c1683bf3ac1">01167</a> <a class="code" href="pool_8c.html#a6fd6d5110751002d167b1c1683bf3ac1">pool_set_languages</a>(<a class="code" href="struct__Pool.html">Pool</a> *pool, <span class="keyword">const</span> <span class="keywordtype">char</span> **languages, <span class="keywordtype">int</span> nlanguages)
<a name="l01168"></a>01168 {
<a name="l01169"></a>01169   <span class="keywordtype">int</span> i;
<a name="l01170"></a>01170 
<a name="l01171"></a>01171   pool-&gt;<a class="code" href="struct__Pool.html#a113eebd0e691fa339619459de8fcd110">languagecache</a> = <a class="code" href="util_8c.html#a1f246fae10a89534cfe0583cefb44c11">sat_free</a>(pool-&gt;<a class="code" href="struct__Pool.html#a113eebd0e691fa339619459de8fcd110">languagecache</a>);
<a name="l01172"></a>01172   pool-&gt;<a class="code" href="struct__Pool.html#a8f7d507f21115b278d1ffe7a187f82ab">languagecacheother</a> = 0;
<a name="l01173"></a>01173   <span class="keywordflow">if</span> (pool-&gt;<a class="code" href="struct__Pool.html#a0a0f8b691f395c82664d09b7f47ca551">nlanguages</a>)
<a name="l01174"></a>01174     {
<a name="l01175"></a>01175       <span class="keywordflow">for</span> (i = 0; i &lt; pool-&gt;<a class="code" href="struct__Pool.html#a0a0f8b691f395c82664d09b7f47ca551">nlanguages</a>; i++)
<a name="l01176"></a>01176         free((<span class="keywordtype">char</span> *)pool-&gt;<a class="code" href="struct__Pool.html#a2ca7be3e21cfa4fe847b79a6e7e5597c">languages</a>[i]);
<a name="l01177"></a>01177       free(pool-&gt;<a class="code" href="struct__Pool.html#a2ca7be3e21cfa4fe847b79a6e7e5597c">languages</a>);
<a name="l01178"></a>01178     }
<a name="l01179"></a>01179   pool-&gt;<a class="code" href="struct__Pool.html#a0a0f8b691f395c82664d09b7f47ca551">nlanguages</a> = nlanguages;
<a name="l01180"></a>01180   <span class="keywordflow">if</span> (!nlanguages)
<a name="l01181"></a>01181     <span class="keywordflow">return</span>;
<a name="l01182"></a>01182   pool-&gt;<a class="code" href="struct__Pool.html#a2ca7be3e21cfa4fe847b79a6e7e5597c">languages</a> = <a class="code" href="util_8c.html#a7964924c069160718b17ac2770d6885d">sat_calloc</a>(nlanguages, <span class="keyword">sizeof</span>(<span class="keyword">const</span> <span class="keywordtype">char</span> **));
<a name="l01183"></a>01183   <span class="keywordflow">for</span> (i = 0; i &lt; pool-&gt;<a class="code" href="struct__Pool.html#a0a0f8b691f395c82664d09b7f47ca551">nlanguages</a>; i++)
<a name="l01184"></a>01184     pool-&gt;<a class="code" href="struct__Pool.html#a2ca7be3e21cfa4fe847b79a6e7e5597c">languages</a>[i] = strdup(languages[i]);
<a name="l01185"></a>01185 }
<a name="l01186"></a>01186 
<a name="l01187"></a>01187 <a class="code" href="pooltypes_8h.html#a2e0e6278ac51842ca3aeb53e3fc3ead6">Id</a>
<a name="l01188"></a><a class="code" href="pool_8h.html#ae7f7b66776e9b76450e838f811581570">01188</a> <a class="code" href="pool_8c.html#ae7f7b66776e9b76450e838f811581570">pool_id2langid</a>(<a class="code" href="struct__Pool.html">Pool</a> *pool, <a class="code" href="pooltypes_8h.html#a2e0e6278ac51842ca3aeb53e3fc3ead6">Id</a> <span class="keywordtype">id</span>, <span class="keyword">const</span> <span class="keywordtype">char</span> *lang, <span class="keywordtype">int</span> create)
<a name="l01189"></a>01189 {
<a name="l01190"></a>01190   <span class="keyword">const</span> <span class="keywordtype">char</span> *n;
<a name="l01191"></a>01191   <span class="keywordtype">char</span> buf[256], *p;
<a name="l01192"></a>01192   <span class="keywordtype">int</span> l;
<a name="l01193"></a>01193 
<a name="l01194"></a>01194   <span class="keywordflow">if</span> (!lang)
<a name="l01195"></a>01195     <span class="keywordflow">return</span> id;
<a name="l01196"></a>01196   n = <a class="code" href="poolid_8c.html#a8a844727bd2258ef240555fc629b2fa7">id2str</a>(pool, <span class="keywordtype">id</span>);
<a name="l01197"></a>01197   l = strlen(n) + strlen(lang) + 2;
<a name="l01198"></a>01198   <span class="keywordflow">if</span> (l &gt; <span class="keyword">sizeof</span>(buf))
<a name="l01199"></a>01199     p = <a class="code" href="util_8c.html#afb257b2d8e6aac7a5a4c64c6c36d8b5b" title="malloc exits with error message on error">sat_malloc</a>(strlen(n) + strlen(lang) + 2);
<a name="l01200"></a>01200   <span class="keywordflow">else</span>
<a name="l01201"></a>01201     p = buf;
<a name="l01202"></a>01202   sprintf(p, <span class="stringliteral">&quot;%s:%s&quot;</span>, n, lang);
<a name="l01203"></a>01203   <span class="keywordtype">id</span> = <a class="code" href="poolid_8c.html#ad7352e5986a8eb7bb5fdf0158f445a09">str2id</a>(pool, p, create);
<a name="l01204"></a>01204   <span class="keywordflow">if</span> (p != buf)
<a name="l01205"></a>01205     free(p);
<a name="l01206"></a>01206   <span class="keywordflow">return</span> id;
<a name="l01207"></a>01207 }
<a name="l01208"></a>01208 
<a name="l01209"></a>01209 <span class="keywordtype">char</span> *
<a name="l01210"></a><a class="code" href="pool_8h.html#a7d23f3f42b8e836a6e0ace06bd99f889">01210</a> <a class="code" href="pool_8c.html#a52f22722ec60db05e2599adc89b2a099">pool_alloctmpspace</a>(<a class="code" href="struct__Pool.html">Pool</a> *pool, <span class="keywordtype">int</span> len)
<a name="l01211"></a>01211 {
<a name="l01212"></a>01212   <span class="keywordtype">int</span> n = pool-&gt;<a class="code" href="struct__Pool.html#ac05be421296cb635ad3f5f93b456c569">tmpspacen</a>;
<a name="l01213"></a>01213   <span class="keywordflow">if</span> (!len)
<a name="l01214"></a>01214     <span class="keywordflow">return</span> 0;
<a name="l01215"></a>01215   <span class="keywordflow">if</span> (len &gt; pool-&gt;<a class="code" href="struct__Pool.html#a26d4cf1247d1dfc5e373eb10d3e863fe">tmpspacelen</a>[n])
<a name="l01216"></a>01216     {
<a name="l01217"></a>01217       pool-&gt;<a class="code" href="struct__Pool.html#a3aad8fabb675d5e1d2081e82ac64347b">tmpspacebuf</a>[n] = <a class="code" href="util_8c.html#a43839a29e1a3e9f13247e89c9057d6fa">sat_realloc</a>(pool-&gt;<a class="code" href="struct__Pool.html#a3aad8fabb675d5e1d2081e82ac64347b">tmpspacebuf</a>[n], len + 32);
<a name="l01218"></a>01218       pool-&gt;<a class="code" href="struct__Pool.html#a26d4cf1247d1dfc5e373eb10d3e863fe">tmpspacelen</a>[n] = len + 32;
<a name="l01219"></a>01219     }
<a name="l01220"></a>01220   pool-&gt;<a class="code" href="struct__Pool.html#ac05be421296cb635ad3f5f93b456c569">tmpspacen</a> = (n + 1) % <a class="code" href="pool_8h.html#a2fcb498d3206a8b880f90b4bc25c56b5">POOL_TMPSPACEBUF</a>;
<a name="l01221"></a>01221   <span class="keywordflow">return</span> pool-&gt;<a class="code" href="struct__Pool.html#a3aad8fabb675d5e1d2081e82ac64347b">tmpspacebuf</a>[n];
<a name="l01222"></a>01222 }
<a name="l01223"></a>01223 
<a name="l01224"></a>01224 <span class="keywordtype">char</span> *
<a name="l01225"></a><a class="code" href="pool_8h.html#a1be33a63f52abe35ffa009b2e6e8d65b">01225</a> <a class="code" href="pool_8c.html#a1be33a63f52abe35ffa009b2e6e8d65b">pool_tmpjoin</a>(<a class="code" href="struct__Pool.html">Pool</a> *pool, <span class="keyword">const</span> <span class="keywordtype">char</span> *str1, <span class="keyword">const</span> <span class="keywordtype">char</span> *str2, <span class="keyword">const</span> <span class="keywordtype">char</span> *str3)
<a name="l01226"></a>01226 {
<a name="l01227"></a>01227   <span class="keywordtype">int</span> l1, l2, l3;
<a name="l01228"></a>01228   <span class="keywordtype">char</span> *s, *str;
<a name="l01229"></a>01229   l1 = str1 ? strlen(str1) : 0;
<a name="l01230"></a>01230   l2 = str2 ? strlen(str2) : 0;
<a name="l01231"></a>01231   l3 = str3 ? strlen(str3) : 0;
<a name="l01232"></a>01232   s = str = <a class="code" href="pool_8c.html#a52f22722ec60db05e2599adc89b2a099">pool_alloctmpspace</a>(pool, l1 + l2 + l3 + 1);
<a name="l01233"></a>01233   <span class="keywordflow">if</span> (l1)
<a name="l01234"></a>01234     {
<a name="l01235"></a>01235       strcpy(s, str1);
<a name="l01236"></a>01236       s += l1;
<a name="l01237"></a>01237     }
<a name="l01238"></a>01238   <span class="keywordflow">if</span> (l2)
<a name="l01239"></a>01239     {
<a name="l01240"></a>01240       strcpy(s, str2);
<a name="l01241"></a>01241       s += l2;
<a name="l01242"></a>01242     }
<a name="l01243"></a>01243   <span class="keywordflow">if</span> (l3)
<a name="l01244"></a>01244     {
<a name="l01245"></a>01245       strcpy(s, str3);
<a name="l01246"></a>01246       s += l3;
<a name="l01247"></a>01247     }
<a name="l01248"></a>01248   *s = 0;
<a name="l01249"></a>01249   <span class="keywordflow">return</span> str;
<a name="l01250"></a>01250 }
<a name="l01251"></a>01251 
<a name="l01252"></a>01252 
<a name="l01253"></a>01253 <span class="comment">/*******************************************************************/</span>
<a name="l01254"></a>01254 
<a name="l01255"></a><a class="code" href="structmptree.html">01255</a> <span class="keyword">struct </span><a class="code" href="structmptree.html">mptree</a> {
<a name="l01256"></a><a class="code" href="structmptree.html#aa27c97da08757173bad059c305a2573d">01256</a>   <a class="code" href="pooltypes_8h.html#a2e0e6278ac51842ca3aeb53e3fc3ead6">Id</a> <a class="code" href="structmptree.html#aa27c97da08757173bad059c305a2573d">sibling</a>;
<a name="l01257"></a><a class="code" href="structmptree.html#af99a91cc3c9db125a8adc2a7014eb8f2">01257</a>   <a class="code" href="pooltypes_8h.html#a2e0e6278ac51842ca3aeb53e3fc3ead6">Id</a> <a class="code" href="structmptree.html#af99a91cc3c9db125a8adc2a7014eb8f2">child</a>;
<a name="l01258"></a><a class="code" href="structmptree.html#a9ee94fc676977f91276ea1479f3e83fd">01258</a>   <span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="structmptree.html#a9ee94fc676977f91276ea1479f3e83fd">comp</a>;
<a name="l01259"></a><a class="code" href="structmptree.html#a338e18adcf07ecb4500f7734fb689659">01259</a>   <span class="keywordtype">int</span> <a class="code" href="structmptree.html#a338e18adcf07ecb4500f7734fb689659">compl</a>;
<a name="l01260"></a><a class="code" href="structmptree.html#a8636f35cc108430b6445101102412703">01260</a>   <a class="code" href="pooltypes_8h.html#a2e0e6278ac51842ca3aeb53e3fc3ead6">Id</a> <a class="code" href="structmptree.html#a8636f35cc108430b6445101102412703">mountpoint</a>;
<a name="l01261"></a>01261 };
<a name="l01262"></a>01262 
<a name="l01263"></a><a class="code" href="structducbdata.html">01263</a> <span class="keyword">struct </span><a class="code" href="structducbdata.html">ducbdata</a> {
<a name="l01264"></a><a class="code" href="structducbdata.html#a68fae49d9e0d9c03747ff2be737be179">01264</a>   <a class="code" href="struct__DUChanges.html">DUChanges</a> *<a class="code" href="structducbdata.html#a68fae49d9e0d9c03747ff2be737be179">mps</a>;
<a name="l01265"></a><a class="code" href="structducbdata.html#a71098601c6df401e450cfae3cf87716c">01265</a>   <span class="keyword">struct </span><a class="code" href="structmptree.html">mptree</a> *<a class="code" href="structmptree.html">mptree</a>;
<a name="l01266"></a><a class="code" href="structducbdata.html#a50176f6cebe1f5d112db80ebe708b9ce">01266</a>   <span class="keywordtype">int</span> <a class="code" href="structducbdata.html#a50176f6cebe1f5d112db80ebe708b9ce">addsub</a>;
<a name="l01267"></a><a class="code" href="structducbdata.html#a7e0fcba112f3eec38d6b4e2a84d55aa9">01267</a>   <span class="keywordtype">int</span> <a class="code" href="structducbdata.html#a7e0fcba112f3eec38d6b4e2a84d55aa9">hasdu</a>;
<a name="l01268"></a>01268 
<a name="l01269"></a><a class="code" href="structducbdata.html#a2d3dfeb363ab70afcbe5d4b9acaff763">01269</a>   <a class="code" href="pooltypes_8h.html#a2e0e6278ac51842ca3aeb53e3fc3ead6">Id</a> *<a class="code" href="structducbdata.html#a2d3dfeb363ab70afcbe5d4b9acaff763">dirmap</a>;
<a name="l01270"></a><a class="code" href="structducbdata.html#a8847d5979aeebfa69b6df6642bae90f5">01270</a>   <span class="keywordtype">int</span> <a class="code" href="structducbdata.html#a8847d5979aeebfa69b6df6642bae90f5">nmap</a>;
<a name="l01271"></a><a class="code" href="structducbdata.html#ab62783a13af48e155d64a6df935d31fc">01271</a>   <a class="code" href="struct__Repodata.html">Repodata</a> *<a class="code" href="structducbdata.html#ab62783a13af48e155d64a6df935d31fc">olddata</a>;
<a name="l01272"></a>01272 };
<a name="l01273"></a>01273 
<a name="l01274"></a>01274 
<a name="l01275"></a>01275 <span class="keyword">static</span> <span class="keywordtype">int</span>
<a name="l01276"></a><a class="code" href="pool_8c.html#ad7c6eaddf9bd94d4f1a1210be15b11ae">01276</a> <a class="code" href="pool_8c.html#ad7c6eaddf9bd94d4f1a1210be15b11ae">solver_fill_DU_cb</a>(<span class="keywordtype">void</span> *cbdata, <a class="code" href="struct__Solvable.html">Solvable</a> *s, <a class="code" href="struct__Repodata.html">Repodata</a> *data, <a class="code" href="struct__Repokey.html">Repokey</a> *key, <a class="code" href="struct__KeyValue.html">KeyValue</a> *value)
<a name="l01277"></a>01277 {
<a name="l01278"></a>01278   <span class="keyword">struct </span><a class="code" href="structducbdata.html">ducbdata</a> *cbd = cbdata;
<a name="l01279"></a>01279   <a class="code" href="pooltypes_8h.html#a2e0e6278ac51842ca3aeb53e3fc3ead6">Id</a> mp;
<a name="l01280"></a>01280 
<a name="l01281"></a>01281   <span class="keywordflow">if</span> (data != cbd-&gt;<a class="code" href="structducbdata.html#ab62783a13af48e155d64a6df935d31fc">olddata</a>)
<a name="l01282"></a>01282     {
<a name="l01283"></a>01283       <a class="code" href="pooltypes_8h.html#a2e0e6278ac51842ca3aeb53e3fc3ead6">Id</a> dn, mp, comp, *<a class="code" href="structducbdata.html#a2d3dfeb363ab70afcbe5d4b9acaff763">dirmap</a>, *dirs;
<a name="l01284"></a>01284       <span class="keywordtype">int</span> i, compl;
<a name="l01285"></a>01285       <span class="keyword">const</span> <span class="keywordtype">char</span> *compstr;
<a name="l01286"></a>01286       <span class="keyword">struct </span><a class="code" href="structmptree.html">mptree</a> *<a class="code" href="structmptree.html">mptree</a>;
<a name="l01287"></a>01287 
<a name="l01288"></a>01288       <span class="comment">/* create map from dir to mptree */</span>
<a name="l01289"></a>01289       cbd-&gt;<a class="code" href="structducbdata.html#a2d3dfeb363ab70afcbe5d4b9acaff763">dirmap</a> = <a class="code" href="util_8c.html#a1f246fae10a89534cfe0583cefb44c11">sat_free</a>(cbd-&gt;<a class="code" href="structducbdata.html#a2d3dfeb363ab70afcbe5d4b9acaff763">dirmap</a>);
<a name="l01290"></a>01290       cbd-&gt;<a class="code" href="structducbdata.html#a8847d5979aeebfa69b6df6642bae90f5">nmap</a> = 0;
<a name="l01291"></a>01291       dirmap = <a class="code" href="util_8c.html#a7964924c069160718b17ac2770d6885d">sat_calloc</a>(data-&gt;<a class="code" href="struct__Repodata.html#aae19b05ba2da163a3cd86e3a6cc8366e">dirpool</a>.<a class="code" href="struct__Dirpool.html#a927d250625ed1619e30ca1a4010ecfe9">ndirs</a>, <span class="keyword">sizeof</span>(<a class="code" href="pooltypes_8h.html#a2e0e6278ac51842ca3aeb53e3fc3ead6">Id</a>));
<a name="l01292"></a>01292       mptree = cbd-&gt;<a class="code" href="structducbdata.html#a71098601c6df401e450cfae3cf87716c">mptree</a>;
<a name="l01293"></a>01293       mp = 0;
<a name="l01294"></a>01294       <span class="keywordflow">for</span> (dn = 2, dirs = data-&gt;<a class="code" href="struct__Repodata.html#aae19b05ba2da163a3cd86e3a6cc8366e">dirpool</a>.<a class="code" href="struct__Dirpool.html#a19736e5d09313e8ceccdf349dc0615dc">dirs</a> + dn; dn &lt; data-&gt;dirpool.ndirs; dn++)
<a name="l01295"></a>01295         {
<a name="l01296"></a>01296           comp = *dirs++;
<a name="l01297"></a>01297           <span class="keywordflow">if</span> (comp &lt;= 0)
<a name="l01298"></a>01298             {
<a name="l01299"></a>01299               mp = dirmap[-comp];
<a name="l01300"></a>01300               <span class="keywordflow">continue</span>;
<a name="l01301"></a>01301             }
<a name="l01302"></a>01302           <span class="keywordflow">if</span> (mp &lt; 0)
<a name="l01303"></a>01303             {
<a name="l01304"></a>01304               <span class="comment">/* unconnected */</span>
<a name="l01305"></a>01305               dirmap[dn] = mp;
<a name="l01306"></a>01306               <span class="keywordflow">continue</span>;
<a name="l01307"></a>01307             }
<a name="l01308"></a>01308           <span class="keywordflow">if</span> (!mptree[mp].<a class="code" href="structmptree.html#af99a91cc3c9db125a8adc2a7014eb8f2">child</a>)
<a name="l01309"></a>01309             {
<a name="l01310"></a>01310               dirmap[dn] = -mp;
<a name="l01311"></a>01311               <span class="keywordflow">continue</span>;
<a name="l01312"></a>01312             }
<a name="l01313"></a>01313           <span class="keywordflow">if</span> (data-&gt;<a class="code" href="struct__Repodata.html#ab8a9609e3952d09489ca2b61473afdbb">localpool</a>)
<a name="l01314"></a>01314             compstr = <a class="code" href="strpool_8h.html#a6e1c78946c6b41eac9cbb1965e193475">stringpool_id2str</a>(&amp;data-&gt;<a class="code" href="struct__Repodata.html#a7ef4842f155ec4128e39d71284459383">spool</a>, comp);
<a name="l01315"></a>01315           <span class="keywordflow">else</span>
<a name="l01316"></a>01316             compstr = <a class="code" href="poolid_8c.html#a8a844727bd2258ef240555fc629b2fa7">id2str</a>(data-&gt;<a class="code" href="struct__Repodata.html#ad31405e80e3f4aabc3969fe5e8592caf">repo</a>-&gt;<a class="code" href="struct__Repo.html#a6bd8127a73ebfe52aa09498f969e0b47">pool</a>, comp);
<a name="l01317"></a>01317           compl = strlen(compstr);
<a name="l01318"></a>01318           <span class="keywordflow">for</span> (i = mptree[mp].child; i; i = mptree[i].<a class="code" href="structmptree.html#aa27c97da08757173bad059c305a2573d">sibling</a>)
<a name="l01319"></a>01319             <span class="keywordflow">if</span> (mptree[i].compl == compl &amp;&amp; !strncmp(mptree[i].comp, compstr, compl))
<a name="l01320"></a>01320               <span class="keywordflow">break</span>;
<a name="l01321"></a>01321           dirmap[dn] = i ? i : -mp;
<a name="l01322"></a>01322         }
<a name="l01323"></a>01323       <span class="comment">/* change dirmap to point to mountpoint instead of mptree */</span>
<a name="l01324"></a>01324       <span class="keywordflow">for</span> (dn = 0; dn &lt; data-&gt;<a class="code" href="struct__Repodata.html#aae19b05ba2da163a3cd86e3a6cc8366e">dirpool</a>.<a class="code" href="struct__Dirpool.html#a927d250625ed1619e30ca1a4010ecfe9">ndirs</a>; dn++)
<a name="l01325"></a>01325         {
<a name="l01326"></a>01326           mp = dirmap[dn];
<a name="l01327"></a>01327           dirmap[dn] = mptree[mp &gt; 0 ? mp : -mp].<a class="code" href="structmptree.html#a8636f35cc108430b6445101102412703">mountpoint</a>;
<a name="l01328"></a>01328         }
<a name="l01329"></a>01329       cbd-&gt;<a class="code" href="structducbdata.html#a2d3dfeb363ab70afcbe5d4b9acaff763">dirmap</a> = dirmap;
<a name="l01330"></a>01330       cbd-&gt;<a class="code" href="structducbdata.html#a8847d5979aeebfa69b6df6642bae90f5">nmap</a> = data-&gt;<a class="code" href="struct__Repodata.html#aae19b05ba2da163a3cd86e3a6cc8366e">dirpool</a>.<a class="code" href="struct__Dirpool.html#a927d250625ed1619e30ca1a4010ecfe9">ndirs</a>;
<a name="l01331"></a>01331       cbd-&gt;<a class="code" href="structducbdata.html#ab62783a13af48e155d64a6df935d31fc">olddata</a> = data;
<a name="l01332"></a>01332     }
<a name="l01333"></a>01333   cbd-&gt;<a class="code" href="structducbdata.html#a7e0fcba112f3eec38d6b4e2a84d55aa9">hasdu</a> = 1;
<a name="l01334"></a>01334   <span class="keywordflow">if</span> (value-&gt;<a class="code" href="struct__KeyValue.html#ac2c2167e288ab3511dc6b419eff19877">id</a> &lt; 0 || value-&gt;<a class="code" href="struct__KeyValue.html#ac2c2167e288ab3511dc6b419eff19877">id</a> &gt;= cbd-&gt;<a class="code" href="structducbdata.html#a8847d5979aeebfa69b6df6642bae90f5">nmap</a>)
<a name="l01335"></a>01335     <span class="keywordflow">return</span> 0;
<a name="l01336"></a>01336   mp = cbd-&gt;<a class="code" href="structducbdata.html#a2d3dfeb363ab70afcbe5d4b9acaff763">dirmap</a>[value-&gt;<a class="code" href="struct__KeyValue.html#ac2c2167e288ab3511dc6b419eff19877">id</a>];
<a name="l01337"></a>01337   <span class="keywordflow">if</span> (mp &lt; 0)
<a name="l01338"></a>01338     <span class="keywordflow">return</span> 0;
<a name="l01339"></a>01339   <span class="keywordflow">if</span> (cbd-&gt;<a class="code" href="structducbdata.html#a50176f6cebe1f5d112db80ebe708b9ce">addsub</a> &gt; 0)
<a name="l01340"></a>01340     {
<a name="l01341"></a>01341       cbd-&gt;<a class="code" href="structducbdata.html#a68fae49d9e0d9c03747ff2be737be179">mps</a>[mp].<a class="code" href="struct__DUChanges.html#abc422f25fffc039952395d1ee7bab60b">kbytes</a> += value-&gt;<a class="code" href="struct__KeyValue.html#a53be9e6f6eda42668f97d1068476c862">num</a>;
<a name="l01342"></a>01342       cbd-&gt;<a class="code" href="structducbdata.html#a68fae49d9e0d9c03747ff2be737be179">mps</a>[mp].<a class="code" href="struct__DUChanges.html#a747259be58ec8b938e15acae871c776b">files</a> += value-&gt;<a class="code" href="struct__KeyValue.html#a84f14418316b9613684596fa502f28dd">num2</a>;
<a name="l01343"></a>01343     }
<a name="l01344"></a>01344   <span class="keywordflow">else</span>
<a name="l01345"></a>01345     {
<a name="l01346"></a>01346       cbd-&gt;<a class="code" href="structducbdata.html#a68fae49d9e0d9c03747ff2be737be179">mps</a>[mp].<a class="code" href="struct__DUChanges.html#abc422f25fffc039952395d1ee7bab60b">kbytes</a> -= value-&gt;<a class="code" href="struct__KeyValue.html#a53be9e6f6eda42668f97d1068476c862">num</a>;
<a name="l01347"></a>01347       cbd-&gt;<a class="code" href="structducbdata.html#a68fae49d9e0d9c03747ff2be737be179">mps</a>[mp].<a class="code" href="struct__DUChanges.html#a747259be58ec8b938e15acae871c776b">files</a> -= value-&gt;<a class="code" href="struct__KeyValue.html#a84f14418316b9613684596fa502f28dd">num2</a>;
<a name="l01348"></a>01348     }
<a name="l01349"></a>01349   <span class="keywordflow">return</span> 0;
<a name="l01350"></a>01350 }
<a name="l01351"></a>01351 
<a name="l01352"></a>01352 <span class="keyword">static</span> <span class="keywordtype">void</span>
<a name="l01353"></a><a class="code" href="pool_8c.html#acfa2b249522fbb77e851f59b40f267b6">01353</a> <a class="code" href="pool_8c.html#acfa2b249522fbb77e851f59b40f267b6">propagate_mountpoints</a>(<span class="keyword">struct</span> <a class="code" href="structmptree.html">mptree</a> *<a class="code" href="structmptree.html">mptree</a>, <span class="keywordtype">int</span> pos, <a class="code" href="pooltypes_8h.html#a2e0e6278ac51842ca3aeb53e3fc3ead6">Id</a> <a class="code" href="structmptree.html#a8636f35cc108430b6445101102412703">mountpoint</a>)
<a name="l01354"></a>01354 {
<a name="l01355"></a>01355   <span class="keywordtype">int</span> i;
<a name="l01356"></a>01356   <span class="keywordflow">if</span> (mptree[pos].mountpoint == -1)
<a name="l01357"></a>01357     mptree[pos].<a class="code" href="structmptree.html#a8636f35cc108430b6445101102412703">mountpoint</a> = mountpoint;
<a name="l01358"></a>01358   <span class="keywordflow">else</span>
<a name="l01359"></a>01359     mountpoint = mptree[pos].<a class="code" href="structmptree.html#a8636f35cc108430b6445101102412703">mountpoint</a>;
<a name="l01360"></a>01360   <span class="keywordflow">for</span> (i = mptree[pos].<a class="code" href="structmptree.html#af99a91cc3c9db125a8adc2a7014eb8f2">child</a>; i; i = mptree[i].<a class="code" href="structmptree.html#aa27c97da08757173bad059c305a2573d">sibling</a>)
<a name="l01361"></a>01361     <a class="code" href="pool_8c.html#acfa2b249522fbb77e851f59b40f267b6">propagate_mountpoints</a>(mptree, i, mountpoint);
<a name="l01362"></a>01362 }
<a name="l01363"></a>01363 
<a name="l01364"></a><a class="code" href="pool_8c.html#a6e919f476a31375138a3ae679196cd4d">01364</a> <span class="preprocessor">#define MPTREE_BLOCK 15</span>
<a name="l01365"></a>01365 <span class="preprocessor"></span>
<a name="l01366"></a>01366 <span class="keywordtype">void</span>
<a name="l01367"></a><a class="code" href="pool_8h.html#a7c20afd6c8e40d2af7f4d5d04355fdb7">01367</a> <a class="code" href="pool_8c.html#a7c20afd6c8e40d2af7f4d5d04355fdb7">pool_calc_duchanges</a>(<a class="code" href="struct__Pool.html">Pool</a> *pool, <a class="code" href="struct__Map.html">Map</a> *installedmap, <a class="code" href="struct__DUChanges.html">DUChanges</a> *mps, <span class="keywordtype">int</span> nmps)
<a name="l01368"></a>01368 {
<a name="l01369"></a>01369   <span class="keywordtype">char</span> *p;
<a name="l01370"></a>01370   <span class="keyword">const</span> <span class="keywordtype">char</span> *path, *compstr;
<a name="l01371"></a>01371   <span class="keyword">struct </span><a class="code" href="structmptree.html">mptree</a> *<a class="code" href="structmptree.html">mptree</a>;
<a name="l01372"></a>01372   <span class="keywordtype">int</span> i, nmptree;
<a name="l01373"></a>01373   <span class="keywordtype">int</span> pos, <a class="code" href="structmptree.html#a338e18adcf07ecb4500f7734fb689659">compl</a>;
<a name="l01374"></a>01374   <span class="keywordtype">int</span> mp;
<a name="l01375"></a>01375   <span class="keyword">struct </span><a class="code" href="structducbdata.html">ducbdata</a> cbd;
<a name="l01376"></a>01376   <a class="code" href="struct__Solvable.html">Solvable</a> *s;
<a name="l01377"></a>01377   <a class="code" href="pooltypes_8h.html#a2e0e6278ac51842ca3aeb53e3fc3ead6">Id</a> sp;
<a name="l01378"></a>01378   <a class="code" href="struct__Map.html">Map</a> ignoredu;
<a name="l01379"></a>01379   <a class="code" href="struct__Repo.html">Repo</a> *oldinstalled = pool-&gt;<a class="code" href="struct__Pool.html#a887053f905054298cd61ce1c99e26690">installed</a>;
<a name="l01380"></a>01380 
<a name="l01381"></a>01381   memset(&amp;ignoredu, 0, <span class="keyword">sizeof</span>(ignoredu));
<a name="l01382"></a>01382   cbd.<a class="code" href="structducbdata.html#a68fae49d9e0d9c03747ff2be737be179">mps</a> = mps;
<a name="l01383"></a>01383   cbd.<a class="code" href="structducbdata.html#a50176f6cebe1f5d112db80ebe708b9ce">addsub</a> = 0;
<a name="l01384"></a>01384   cbd.<a class="code" href="structducbdata.html#a2d3dfeb363ab70afcbe5d4b9acaff763">dirmap</a> = 0;
<a name="l01385"></a>01385   cbd.<a class="code" href="structducbdata.html#a8847d5979aeebfa69b6df6642bae90f5">nmap</a> = 0;
<a name="l01386"></a>01386   cbd.<a class="code" href="structducbdata.html#ab62783a13af48e155d64a6df935d31fc">olddata</a> = 0;
<a name="l01387"></a>01387 
<a name="l01388"></a>01388   mptree = <a class="code" href="util_8h.html#a063db5a7df2130b54f8fc0abd51c5837">sat_extend_resize</a>(0, 1, <span class="keyword">sizeof</span>(<span class="keyword">struct</span> mptree), <a class="code" href="pool_8c.html#a6e919f476a31375138a3ae679196cd4d">MPTREE_BLOCK</a>);
<a name="l01389"></a>01389 
<a name="l01390"></a>01390   <span class="comment">/* our root node */</span>
<a name="l01391"></a>01391   mptree[0].<a class="code" href="structmptree.html#aa27c97da08757173bad059c305a2573d">sibling</a> = 0;
<a name="l01392"></a>01392   mptree[0].<a class="code" href="structmptree.html#af99a91cc3c9db125a8adc2a7014eb8f2">child</a> = 0;
<a name="l01393"></a>01393   mptree[0].<a class="code" href="structmptree.html#a9ee94fc676977f91276ea1479f3e83fd">comp</a> = 0;
<a name="l01394"></a>01394   mptree[0].<a class="code" href="structmptree.html#a338e18adcf07ecb4500f7734fb689659">compl</a> = 0;
<a name="l01395"></a>01395   mptree[0].<a class="code" href="structmptree.html#a8636f35cc108430b6445101102412703">mountpoint</a> = -1;
<a name="l01396"></a>01396   nmptree = 1;
<a name="l01397"></a>01397   
<a name="l01398"></a>01398   <span class="comment">/* create component tree */</span>
<a name="l01399"></a>01399   <span class="keywordflow">for</span> (mp = 0; mp &lt; nmps; mp++)
<a name="l01400"></a>01400     {
<a name="l01401"></a>01401       mps[mp].<a class="code" href="struct__DUChanges.html#abc422f25fffc039952395d1ee7bab60b">kbytes</a> = 0;
<a name="l01402"></a>01402       mps[mp].<a class="code" href="struct__DUChanges.html#a747259be58ec8b938e15acae871c776b">files</a> = 0;
<a name="l01403"></a>01403       pos = 0;
<a name="l01404"></a>01404       path = mps[mp].<a class="code" href="struct__DUChanges.html#aadd245f6ad6e03d8c272ebb8f2107a09">path</a>;
<a name="l01405"></a>01405       <span class="keywordflow">while</span>(*path == <span class="charliteral">&#39;/&#39;</span>)
<a name="l01406"></a>01406         path++;
<a name="l01407"></a>01407       <span class="keywordflow">while</span> (*path)
<a name="l01408"></a>01408         {
<a name="l01409"></a>01409           <span class="keywordflow">if</span> ((p = strchr(path, <span class="charliteral">&#39;/&#39;</span>)) == 0)
<a name="l01410"></a>01410             {
<a name="l01411"></a>01411               compstr = path;
<a name="l01412"></a>01412               compl = strlen(compstr);
<a name="l01413"></a>01413               path += compl;
<a name="l01414"></a>01414             }
<a name="l01415"></a>01415           <span class="keywordflow">else</span>
<a name="l01416"></a>01416             {
<a name="l01417"></a>01417               compstr = path;
<a name="l01418"></a>01418               compl = p - path;
<a name="l01419"></a>01419               path = p + 1;
<a name="l01420"></a>01420               <span class="keywordflow">while</span>(*path == <span class="charliteral">&#39;/&#39;</span>)
<a name="l01421"></a>01421                 path++;
<a name="l01422"></a>01422             }
<a name="l01423"></a>01423           <span class="keywordflow">for</span> (i = mptree[pos].child; i; i = mptree[i].<a class="code" href="structmptree.html#aa27c97da08757173bad059c305a2573d">sibling</a>)
<a name="l01424"></a>01424             <span class="keywordflow">if</span> (mptree[i].compl == compl &amp;&amp; !strncmp(mptree[i].comp, compstr, compl))
<a name="l01425"></a>01425               <span class="keywordflow">break</span>;
<a name="l01426"></a>01426           <span class="keywordflow">if</span> (!i)
<a name="l01427"></a>01427             {
<a name="l01428"></a>01428               <span class="comment">/* create new node */</span>
<a name="l01429"></a>01429               mptree = <a class="code" href="util_8h.html#a8f0135824fd0936735b002a452c84cbd">sat_extend</a>(mptree, nmptree, 1, <span class="keyword">sizeof</span>(<span class="keyword">struct</span> mptree), <a class="code" href="pool_8c.html#a6e919f476a31375138a3ae679196cd4d">MPTREE_BLOCK</a>);
<a name="l01430"></a>01430               i = nmptree++;
<a name="l01431"></a>01431               mptree[i].<a class="code" href="structmptree.html#aa27c97da08757173bad059c305a2573d">sibling</a> = mptree[pos].<a class="code" href="structmptree.html#af99a91cc3c9db125a8adc2a7014eb8f2">child</a>;
<a name="l01432"></a>01432               mptree[i].<a class="code" href="structmptree.html#af99a91cc3c9db125a8adc2a7014eb8f2">child</a> = 0;
<a name="l01433"></a>01433               mptree[i].<a class="code" href="structmptree.html#a9ee94fc676977f91276ea1479f3e83fd">comp</a> = compstr;
<a name="l01434"></a>01434               mptree[i].<a class="code" href="structmptree.html#a338e18adcf07ecb4500f7734fb689659">compl</a> = compl;
<a name="l01435"></a>01435               mptree[i].<a class="code" href="structmptree.html#a8636f35cc108430b6445101102412703">mountpoint</a> = -1;
<a name="l01436"></a>01436               mptree[pos].<a class="code" href="structmptree.html#af99a91cc3c9db125a8adc2a7014eb8f2">child</a> = i;
<a name="l01437"></a>01437             }
<a name="l01438"></a>01438           pos = i;
<a name="l01439"></a>01439         }
<a name="l01440"></a>01440       mptree[pos].<a class="code" href="structmptree.html#a8636f35cc108430b6445101102412703">mountpoint</a> = mp;
<a name="l01441"></a>01441     }
<a name="l01442"></a>01442 
<a name="l01443"></a>01443   <a class="code" href="pool_8c.html#acfa2b249522fbb77e851f59b40f267b6">propagate_mountpoints</a>(mptree, 0, mptree[0].mountpoint);
<a name="l01444"></a>01444 
<a name="l01445"></a>01445 <span class="preprocessor">#if 0</span>
<a name="l01446"></a>01446 <span class="preprocessor"></span>  <span class="keywordflow">for</span> (i = 0; i &lt; nmptree; i++)
<a name="l01447"></a>01447     {
<a name="l01448"></a>01448       printf(<span class="stringliteral">&quot;#%d sibling: %d\n&quot;</span>, i, mptree[i].sibling);
<a name="l01449"></a>01449       printf(<span class="stringliteral">&quot;#%d child: %d\n&quot;</span>, i, mptree[i].child);
<a name="l01450"></a>01450       printf(<span class="stringliteral">&quot;#%d comp: %s\n&quot;</span>, i, mptree[i].comp);
<a name="l01451"></a>01451       printf(<span class="stringliteral">&quot;#%d compl: %d\n&quot;</span>, i, mptree[i].compl);
<a name="l01452"></a>01452       printf(<span class="stringliteral">&quot;#%d mountpont: %d\n&quot;</span>, i, mptree[i].mountpoint);
<a name="l01453"></a>01453     }
<a name="l01454"></a>01454 <span class="preprocessor">#endif</span>
<a name="l01455"></a>01455 <span class="preprocessor"></span>
<a name="l01456"></a>01456   cbd.<a class="code" href="structducbdata.html#a71098601c6df401e450cfae3cf87716c">mptree</a> = mptree;
<a name="l01457"></a>01457   cbd.<a class="code" href="structducbdata.html#a50176f6cebe1f5d112db80ebe708b9ce">addsub</a> = 1;
<a name="l01458"></a>01458   <span class="keywordflow">for</span> (sp = 1, s = pool-&gt;<a class="code" href="struct__Pool.html#a9842c936aa241bad13ba13f21a337319">solvables</a> + sp; sp &lt; pool-&gt;nsolvables; sp++, s++)
<a name="l01459"></a>01459     {
<a name="l01460"></a>01460       <span class="keywordflow">if</span> (!s-&gt;repo || (oldinstalled &amp;&amp; s-&gt;repo == oldinstalled))
<a name="l01461"></a>01461         <span class="keywordflow">continue</span>;
<a name="l01462"></a>01462       <span class="keywordflow">if</span> (!<a class="code" href="bitmap_8h.html#ad8ccb9ad3a8ad65f5fe08a988acc503d">MAPTST</a>(installedmap, sp))
<a name="l01463"></a>01463         <span class="keywordflow">continue</span>;
<a name="l01464"></a>01464       cbd.<a class="code" href="structducbdata.html#a7e0fcba112f3eec38d6b4e2a84d55aa9">hasdu</a> = 0;
<a name="l01465"></a>01465       <a class="code" href="repo_8c.html#acfa8ad01d505b448a6002c07eb03212a">repo_search</a>(s-&gt;repo, sp, SOLVABLE_DISKUSAGE, 0, 0, <a class="code" href="pool_8c.html#ad7c6eaddf9bd94d4f1a1210be15b11ae">solver_fill_DU_cb</a>, &amp;cbd);
<a name="l01466"></a>01466       <span class="keywordflow">if</span> (!cbd.<a class="code" href="structducbdata.html#a7e0fcba112f3eec38d6b4e2a84d55aa9">hasdu</a> &amp;&amp; oldinstalled)
<a name="l01467"></a>01467         {
<a name="l01468"></a>01468           <a class="code" href="pooltypes_8h.html#a2e0e6278ac51842ca3aeb53e3fc3ead6">Id</a> op, opp;
<a name="l01469"></a>01469           <span class="comment">/* no du data available, ignore data of all installed solvables we obsolete */</span>
<a name="l01470"></a>01470           <span class="keywordflow">if</span> (!ignoredu.<a class="code" href="struct__Map.html#a95e9826de5c06f95d9c43ea0dff150e2">map</a>)
<a name="l01471"></a>01471             <a class="code" href="bitmap_8c.html#a8d8010a0f9f491483c12e83ae3a9082e">map_init</a>(&amp;ignoredu, oldinstalled-&gt;<a class="code" href="struct__Repo.html#aca3e16cc200b9c236963f56bf038a7bc">end</a> - oldinstalled-&gt;<a class="code" href="struct__Repo.html#a4eb2dd93e4a4f88f13d462f2f111e038">start</a>);
<a name="l01472"></a>01472           <span class="keywordflow">if</span> (s-&gt;obsoletes)
<a name="l01473"></a>01473             {
<a name="l01474"></a>01474               <a class="code" href="pooltypes_8h.html#a2e0e6278ac51842ca3aeb53e3fc3ead6">Id</a> obs, *obsp = s-&gt;repo-&gt;idarraydata + s-&gt;obsoletes;
<a name="l01475"></a>01475               <span class="keywordflow">while</span> ((obs = *obsp++) != 0)
<a name="l01476"></a>01476                 <a class="code" href="pool_8h.html#a6529dc5dd039f8d1019aa2e6f9a9011f">FOR_PROVIDES</a>(op, opp, obs)
<a name="l01477"></a>01477                   <span class="keywordflow">if</span> (op &gt;= oldinstalled-&gt;<a class="code" href="struct__Repo.html#a4eb2dd93e4a4f88f13d462f2f111e038">start</a> &amp;&amp; op &lt; oldinstalled-&gt;end)
<a name="l01478"></a>01478                     <a class="code" href="bitmap_8h.html#a33557e357513f5b3faef527bb320183c">MAPSET</a>(&amp;ignoredu, op - oldinstalled-&gt;<a class="code" href="struct__Repo.html#a4eb2dd93e4a4f88f13d462f2f111e038">start</a>);
<a name="l01479"></a>01479             }
<a name="l01480"></a>01480           <a class="code" href="pool_8h.html#a6529dc5dd039f8d1019aa2e6f9a9011f">FOR_PROVIDES</a>(op, opp, s-&gt;name)
<a name="l01481"></a>01481             <span class="keywordflow">if</span> (pool-&gt;<a class="code" href="struct__Pool.html#a9842c936aa241bad13ba13f21a337319">solvables</a>[op].<a class="code" href="struct__Solvable.html#a5912021e2c3fe505c24a92aa7639dff2">name</a> == s-&gt;name)
<a name="l01482"></a>01482               <span class="keywordflow">if</span> (op &gt;= oldinstalled-&gt;<a class="code" href="struct__Repo.html#a4eb2dd93e4a4f88f13d462f2f111e038">start</a> &amp;&amp; op &lt; oldinstalled-&gt;end)
<a name="l01483"></a>01483                 <a class="code" href="bitmap_8h.html#a33557e357513f5b3faef527bb320183c">MAPSET</a>(&amp;ignoredu, op - oldinstalled-&gt;<a class="code" href="struct__Repo.html#a4eb2dd93e4a4f88f13d462f2f111e038">start</a>);
<a name="l01484"></a>01484         }
<a name="l01485"></a>01485     }
<a name="l01486"></a>01486   cbd.<a class="code" href="structducbdata.html#a50176f6cebe1f5d112db80ebe708b9ce">addsub</a> = -1;
<a name="l01487"></a>01487   <span class="keywordflow">if</span> (oldinstalled)
<a name="l01488"></a>01488     {
<a name="l01489"></a>01489       <span class="comment">/* assumes we allways have du data for installed solvables */</span>
<a name="l01490"></a>01490       <a class="code" href="repo_8h.html#ad2d411118e6dc06fdd38f7ec68c3bb32">FOR_REPO_SOLVABLES</a>(oldinstalled, sp, s)
<a name="l01491"></a>01491         {
<a name="l01492"></a>01492           <span class="keywordflow">if</span> (<a class="code" href="bitmap_8h.html#ad8ccb9ad3a8ad65f5fe08a988acc503d">MAPTST</a>(installedmap, sp))
<a name="l01493"></a>01493             <span class="keywordflow">continue</span>;
<a name="l01494"></a>01494           <span class="keywordflow">if</span> (ignoredu.<a class="code" href="struct__Map.html#a95e9826de5c06f95d9c43ea0dff150e2">map</a> &amp;&amp; <a class="code" href="bitmap_8h.html#ad8ccb9ad3a8ad65f5fe08a988acc503d">MAPTST</a>(&amp;ignoredu, sp - oldinstalled-&gt;<a class="code" href="struct__Repo.html#a4eb2dd93e4a4f88f13d462f2f111e038">start</a>))
<a name="l01495"></a>01495             <span class="keywordflow">continue</span>;
<a name="l01496"></a>01496           <a class="code" href="repo_8c.html#acfa8ad01d505b448a6002c07eb03212a">repo_search</a>(oldinstalled, sp, SOLVABLE_DISKUSAGE, 0, 0, <a class="code" href="pool_8c.html#ad7c6eaddf9bd94d4f1a1210be15b11ae">solver_fill_DU_cb</a>, &amp;cbd);
<a name="l01497"></a>01497         }
<a name="l01498"></a>01498     }
<a name="l01499"></a>01499   <span class="keywordflow">if</span> (ignoredu.<a class="code" href="struct__Map.html#a95e9826de5c06f95d9c43ea0dff150e2">map</a>)
<a name="l01500"></a>01500     <a class="code" href="bitmap_8c.html#a85426cea64351e7b4477370824ddd75f">map_free</a>(&amp;ignoredu);
<a name="l01501"></a>01501   <a class="code" href="util_8c.html#a1f246fae10a89534cfe0583cefb44c11">sat_free</a>(cbd.<a class="code" href="structducbdata.html#a2d3dfeb363ab70afcbe5d4b9acaff763">dirmap</a>);
<a name="l01502"></a>01502   <a class="code" href="util_8c.html#a1f246fae10a89534cfe0583cefb44c11">sat_free</a>(mptree);
<a name="l01503"></a>01503 }
<a name="l01504"></a>01504 
<a name="l01505"></a>01505 <span class="keywordtype">int</span>
<a name="l01506"></a><a class="code" href="pool_8h.html#aae337fb0d02ff2fbd798b01bfc45a88a">01506</a> <a class="code" href="pool_8c.html#aae337fb0d02ff2fbd798b01bfc45a88a">pool_calc_installsizechange</a>(<a class="code" href="struct__Pool.html">Pool</a> *pool, <a class="code" href="struct__Map.html">Map</a> *installedmap)
<a name="l01507"></a>01507 {
<a name="l01508"></a>01508   <a class="code" href="pooltypes_8h.html#a2e0e6278ac51842ca3aeb53e3fc3ead6">Id</a> sp;
<a name="l01509"></a>01509   <a class="code" href="struct__Solvable.html">Solvable</a> *s;
<a name="l01510"></a>01510   <span class="keywordtype">int</span> change = 0;
<a name="l01511"></a>01511   <a class="code" href="struct__Repo.html">Repo</a> *oldinstalled = pool-&gt;<a class="code" href="struct__Pool.html#a887053f905054298cd61ce1c99e26690">installed</a>;
<a name="l01512"></a>01512 
<a name="l01513"></a>01513   <span class="keywordflow">for</span> (sp = 1, s = pool-&gt;<a class="code" href="struct__Pool.html#a9842c936aa241bad13ba13f21a337319">solvables</a> + sp; sp &lt; pool-&gt;nsolvables; sp++, s++)
<a name="l01514"></a>01514     {
<a name="l01515"></a>01515       <span class="keywordflow">if</span> (!s-&gt;<a class="code" href="struct__Solvable.html#a15e0b77fe061c6429a24215191b10f05">repo</a> || (oldinstalled &amp;&amp; s-&gt;<a class="code" href="struct__Solvable.html#a15e0b77fe061c6429a24215191b10f05">repo</a> == oldinstalled))
<a name="l01516"></a>01516         <span class="keywordflow">continue</span>;
<a name="l01517"></a>01517       <span class="keywordflow">if</span> (!<a class="code" href="bitmap_8h.html#ad8ccb9ad3a8ad65f5fe08a988acc503d">MAPTST</a>(installedmap, sp))
<a name="l01518"></a>01518         <span class="keywordflow">continue</span>;
<a name="l01519"></a>01519       change += <a class="code" href="pool_8h.html#a441b6e6c581a991a6f2b7abf40a5639a">solvable_lookup_num</a>(s, SOLVABLE_INSTALLSIZE, 0);
<a name="l01520"></a>01520     }
<a name="l01521"></a>01521   <span class="keywordflow">if</span> (oldinstalled)
<a name="l01522"></a>01522     {
<a name="l01523"></a>01523       <a class="code" href="repo_8h.html#ad2d411118e6dc06fdd38f7ec68c3bb32">FOR_REPO_SOLVABLES</a>(oldinstalled, sp, s)
<a name="l01524"></a>01524         {
<a name="l01525"></a>01525           <span class="keywordflow">if</span> (<a class="code" href="bitmap_8h.html#ad8ccb9ad3a8ad65f5fe08a988acc503d">MAPTST</a>(installedmap, sp))
<a name="l01526"></a>01526             <span class="keywordflow">continue</span>;
<a name="l01527"></a>01527           change -= <a class="code" href="pool_8h.html#a441b6e6c581a991a6f2b7abf40a5639a">solvable_lookup_num</a>(s, SOLVABLE_INSTALLSIZE, 0);
<a name="l01528"></a>01528         }
<a name="l01529"></a>01529     }
<a name="l01530"></a>01530   <span class="keywordflow">return</span> change;
<a name="l01531"></a>01531 }
<a name="l01532"></a>01532 
<a name="l01533"></a>01533 <span class="comment">/* map:</span>
<a name="l01534"></a>01534 <span class="comment"> *  1: installed</span>
<a name="l01535"></a>01535 <span class="comment"> *  2: conflicts with installed</span>
<a name="l01536"></a>01536 <span class="comment"> *  8: interesting (only true if installed)</span>
<a name="l01537"></a>01537 <span class="comment"> * 16: undecided</span>
<a name="l01538"></a>01538 <span class="comment"> */</span>
<a name="l01539"></a>01539  
<a name="l01540"></a><a class="code" href="pool_8c.html#a6f37386d3bc2aca1df7460f4017d631b">01540</a> <span class="keyword">static</span> <span class="keyword">inline</span> <a class="code" href="pooltypes_8h.html#a2e0e6278ac51842ca3aeb53e3fc3ead6">Id</a> <a class="code" href="pool_8c.html#a6f37386d3bc2aca1df7460f4017d631b">dep2name</a>(<a class="code" href="struct__Pool.html">Pool</a> *pool, <a class="code" href="pooltypes_8h.html#a2e0e6278ac51842ca3aeb53e3fc3ead6">Id</a> dep)
<a name="l01541"></a>01541 {
<a name="l01542"></a>01542   <span class="keywordflow">while</span> (<a class="code" href="pool_8h.html#a723c8c54fdd5d81be4b612c0d2868c2d">ISRELDEP</a>(dep))
<a name="l01543"></a>01543     {
<a name="l01544"></a>01544       <a class="code" href="struct__Reldep.html">Reldep</a> *rd = rd = <a class="code" href="pool_8h.html#a7f1a1ed4e318be6edd66e5d94d7912bb">GETRELDEP</a>(pool, dep);
<a name="l01545"></a>01545       dep = rd-&gt;<a class="code" href="struct__Reldep.html#a0fa6e0cb741e79dcd2e92d9e65cf8ce5">name</a>;
<a name="l01546"></a>01546     }
<a name="l01547"></a>01547   <span class="keywordflow">return</span> dep;
<a name="l01548"></a>01548 }
<a name="l01549"></a>01549 
<a name="l01550"></a><a class="code" href="pool_8c.html#ac45c0e6b20cf809ac12948eb245467e3">01550</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="pool_8c.html#ac45c0e6b20cf809ac12948eb245467e3">providedbyinstalled_multiversion</a>(<a class="code" href="struct__Pool.html">Pool</a> *pool, <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *map, <a class="code" href="pooltypes_8h.html#a2e0e6278ac51842ca3aeb53e3fc3ead6">Id</a> n, <a class="code" href="pooltypes_8h.html#a2e0e6278ac51842ca3aeb53e3fc3ead6">Id</a> con) 
<a name="l01551"></a>01551 {
<a name="l01552"></a>01552   <a class="code" href="pooltypes_8h.html#a2e0e6278ac51842ca3aeb53e3fc3ead6">Id</a> p, pp;
<a name="l01553"></a>01553   <a class="code" href="struct__Solvable.html">Solvable</a> *sn = pool-&gt;<a class="code" href="struct__Pool.html#a9842c936aa241bad13ba13f21a337319">solvables</a> + n; 
<a name="l01554"></a>01554 
<a name="l01555"></a>01555   <a class="code" href="pool_8h.html#a6529dc5dd039f8d1019aa2e6f9a9011f">FOR_PROVIDES</a>(p, pp, sn-&gt;<a class="code" href="struct__Solvable.html#a5912021e2c3fe505c24a92aa7639dff2">name</a>)
<a name="l01556"></a>01556     {    
<a name="l01557"></a>01557       <a class="code" href="struct__Solvable.html">Solvable</a> *s = pool-&gt;<a class="code" href="struct__Pool.html#a9842c936aa241bad13ba13f21a337319">solvables</a> + p; 
<a name="l01558"></a>01558       <span class="keywordflow">if</span> (s-&gt;<a class="code" href="struct__Solvable.html#a5912021e2c3fe505c24a92aa7639dff2">name</a> != sn-&gt;<a class="code" href="struct__Solvable.html#a5912021e2c3fe505c24a92aa7639dff2">name</a> || s-&gt;<a class="code" href="struct__Solvable.html#a51ba374144373934101befc2bd20150b">arch</a> != sn-&gt;<a class="code" href="struct__Solvable.html#a51ba374144373934101befc2bd20150b">arch</a>)
<a name="l01559"></a>01559         <span class="keywordflow">continue</span>;
<a name="l01560"></a>01560       <span class="keywordflow">if</span> ((map[p] &amp; 9) != 9)
<a name="l01561"></a>01561         <span class="keywordflow">continue</span>;
<a name="l01562"></a>01562       <span class="keywordflow">if</span> (<a class="code" href="pool_8h.html#a1f2bd95045b7a58d9237da8aeaeee6de">pool_match_nevr</a>(pool, pool-&gt;<a class="code" href="struct__Pool.html#a9842c936aa241bad13ba13f21a337319">solvables</a> + p, con))
<a name="l01563"></a>01563         <span class="keywordflow">continue</span>;
<a name="l01564"></a>01564       <span class="keywordflow">return</span> 1;         <span class="comment">/* found installed package that doesn&#39;t conflict */</span>
<a name="l01565"></a>01565     }
<a name="l01566"></a>01566   <span class="keywordflow">return</span> 0;
<a name="l01567"></a>01567 }
<a name="l01568"></a>01568 
<a name="l01569"></a><a class="code" href="pool_8c.html#a000d3a3f837a6c8e9333851ba8262c69">01569</a> <span class="keyword">static</span> <span class="keyword">inline</span> <span class="keywordtype">int</span> <a class="code" href="pool_8c.html#a000d3a3f837a6c8e9333851ba8262c69">providedbyinstalled</a>(<a class="code" href="struct__Pool.html">Pool</a> *pool, <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *map, <a class="code" href="pooltypes_8h.html#a2e0e6278ac51842ca3aeb53e3fc3ead6">Id</a> dep, <span class="keywordtype">int</span> ispatch, <a class="code" href="struct__Map.html">Map</a> *noobsoletesmap)
<a name="l01570"></a>01570 {
<a name="l01571"></a>01571   <a class="code" href="pooltypes_8h.html#a2e0e6278ac51842ca3aeb53e3fc3ead6">Id</a> p, pp;
<a name="l01572"></a>01572   <span class="keywordtype">int</span> r = 0;
<a name="l01573"></a>01573   <a class="code" href="pool_8h.html#a6529dc5dd039f8d1019aa2e6f9a9011f">FOR_PROVIDES</a>(p, pp, dep)
<a name="l01574"></a>01574     {
<a name="l01575"></a>01575       <span class="keywordflow">if</span> (p == <a class="code" href="pool_8h.html#abd207d4eeed4b96e8dd1a25e2dce7f52">SYSTEMSOLVABLE</a>)
<a name="l01576"></a>01576         <span class="keywordflow">return</span> 1;       <span class="comment">/* always boring, as never constraining */</span>
<a name="l01577"></a>01577       <span class="keywordflow">if</span> (ispatch &amp;&amp; !<a class="code" href="pool_8h.html#a1f2bd95045b7a58d9237da8aeaeee6de">pool_match_nevr</a>(pool, pool-&gt;<a class="code" href="struct__Pool.html#a9842c936aa241bad13ba13f21a337319">solvables</a> + p, dep))
<a name="l01578"></a>01578         <span class="keywordflow">continue</span>;
<a name="l01579"></a>01579       <span class="keywordflow">if</span> (ispatch &amp;&amp; noobsoletesmap &amp;&amp; noobsoletesmap-&gt;<a class="code" href="struct__Map.html#a6f33ba32c40c61ac1ab1c96919b77ee0">size</a> &amp;&amp; <a class="code" href="bitmap_8h.html#ad8ccb9ad3a8ad65f5fe08a988acc503d">MAPTST</a>(noobsoletesmap, p) &amp;&amp; <a class="code" href="pool_8h.html#a723c8c54fdd5d81be4b612c0d2868c2d">ISRELDEP</a>(dep))
<a name="l01580"></a>01580         <span class="keywordflow">if</span> (<a class="code" href="pool_8c.html#ac45c0e6b20cf809ac12948eb245467e3">providedbyinstalled_multiversion</a>(pool, map, p, dep))
<a name="l01581"></a>01581           <span class="keywordflow">continue</span>;
<a name="l01582"></a>01582       <span class="keywordflow">if</span> ((map[p] &amp; 9) == 9)
<a name="l01583"></a>01583         <span class="keywordflow">return</span> 9;
<a name="l01584"></a>01584       r |= map[p] &amp; 17;
<a name="l01585"></a>01585     }
<a name="l01586"></a>01586   <span class="keywordflow">return</span> r;
<a name="l01587"></a>01587 }
<a name="l01588"></a>01588 
<a name="l01589"></a>01589 <span class="comment">/*</span>
<a name="l01590"></a>01590 <span class="comment"> * pool_trivial_installable - calculate if a set of solvables is</span>
<a name="l01591"></a>01591 <span class="comment"> * trivial installable without any other installs/deinstalls of</span>
<a name="l01592"></a>01592 <span class="comment"> * packages not belonging to the set.</span>
<a name="l01593"></a>01593 <span class="comment"> *</span>
<a name="l01594"></a>01594 <span class="comment"> * the state is returned in the result queue:</span>
<a name="l01595"></a>01595 <span class="comment"> * 1:  solvable is installable without any other package changes</span>
<a name="l01596"></a>01596 <span class="comment"> * 0:  solvable is not installable</span>
<a name="l01597"></a>01597 <span class="comment"> * -1: solvable is installable, but doesn&#39;t constrain any installed packages</span>
<a name="l01598"></a>01598 <span class="comment"> */</span>
<a name="l01599"></a>01599 
<a name="l01600"></a>01600 <span class="keywordtype">void</span>
<a name="l01601"></a><a class="code" href="pool_8h.html#a9dacd221c320001836028637f4f36660">01601</a> <a class="code" href="pool_8c.html#a9dacd221c320001836028637f4f36660">pool_trivial_installable_noobsoletesmap</a>(<a class="code" href="struct__Pool.html">Pool</a> *pool, <a class="code" href="struct__Map.html">Map</a> *installedmap, <a class="code" href="struct__Queue.html">Queue</a> *pkgs, <a class="code" href="struct__Queue.html">Queue</a> *res, <a class="code" href="struct__Map.html">Map</a> *noobsoletesmap)
<a name="l01602"></a>01602 {
<a name="l01603"></a>01603   <span class="keywordtype">int</span> i, r, m, did;
<a name="l01604"></a>01604   <a class="code" href="pooltypes_8h.html#a2e0e6278ac51842ca3aeb53e3fc3ead6">Id</a> p, *dp, con, *conp, req, *reqp;
<a name="l01605"></a>01605   <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *map;
<a name="l01606"></a>01606   <a class="code" href="struct__Solvable.html">Solvable</a> *s;
<a name="l01607"></a>01607 
<a name="l01608"></a>01608   map = <a class="code" href="util_8c.html#a7964924c069160718b17ac2770d6885d">sat_calloc</a>(pool-&gt;<a class="code" href="struct__Pool.html#a00e935f7b65616513799ac9e26fefa31">nsolvables</a>, 1);
<a name="l01609"></a>01609   <span class="keywordflow">for</span> (p = 1; p &lt; pool-&gt;<a class="code" href="struct__Pool.html#a00e935f7b65616513799ac9e26fefa31">nsolvables</a>; p++)
<a name="l01610"></a>01610     {
<a name="l01611"></a>01611       <span class="keywordflow">if</span> (!<a class="code" href="bitmap_8h.html#ad8ccb9ad3a8ad65f5fe08a988acc503d">MAPTST</a>(installedmap, p))
<a name="l01612"></a>01612         <span class="keywordflow">continue</span>;
<a name="l01613"></a>01613       map[p] |= 9;
<a name="l01614"></a>01614       s = pool-&gt;<a class="code" href="struct__Pool.html#a9842c936aa241bad13ba13f21a337319">solvables</a> + p;
<a name="l01615"></a>01615       <span class="keywordflow">if</span> (!s-&gt;<a class="code" href="struct__Solvable.html#a53b6ec41be31e4aafb5a52e0c7ae2470">conflicts</a>)
<a name="l01616"></a>01616         <span class="keywordflow">continue</span>;
<a name="l01617"></a>01617       conp = s-&gt;<a class="code" href="struct__Solvable.html#a15e0b77fe061c6429a24215191b10f05">repo</a>-&gt;<a class="code" href="struct__Repo.html#afddcfa36231cc08266800bee5b978528">idarraydata</a> + s-&gt;<a class="code" href="struct__Solvable.html#a53b6ec41be31e4aafb5a52e0c7ae2470">conflicts</a>;
<a name="l01618"></a>01618       <span class="keywordflow">while</span> ((con = *conp++) != 0)
<a name="l01619"></a>01619         {
<a name="l01620"></a>01620           dp = <a class="code" href="pool_8h.html#af21fe308922972607173d0fe4d197fae">pool_whatprovides_ptr</a>(pool, con);
<a name="l01621"></a>01621           <span class="keywordflow">for</span> (; *dp; dp++)
<a name="l01622"></a>01622             map[p] |= 2;        <span class="comment">/* XXX: self conflict ? */</span>
<a name="l01623"></a>01623         }
<a name="l01624"></a>01624     }
<a name="l01625"></a>01625   <span class="keywordflow">for</span> (i = 0; i &lt; pkgs-&gt;<a class="code" href="struct__Queue.html#abb0696a77174cd23b5f488ad4c7b45d2">count</a>; i++)
<a name="l01626"></a>01626     map[pkgs-&gt;<a class="code" href="struct__Queue.html#a116eb58bed8ff76bf18f9c16cf1ce5c6">elements</a>[i]] = 16;
<a name="l01627"></a>01627 
<a name="l01628"></a>01628   for (i = 0, did = 0; did &lt; pkgs-&gt;<a class="code" href="struct__Queue.html#abb0696a77174cd23b5f488ad4c7b45d2">count</a>; i++, did++)
<a name="l01629"></a>01629     {
<a name="l01630"></a>01630       <span class="keywordflow">if</span> (i == pkgs-&gt;<a class="code" href="struct__Queue.html#abb0696a77174cd23b5f488ad4c7b45d2">count</a>)
<a name="l01631"></a>01631         i = 0;
<a name="l01632"></a>01632       p = pkgs-&gt;<a class="code" href="struct__Queue.html#a116eb58bed8ff76bf18f9c16cf1ce5c6">elements</a>[i];
<a name="l01633"></a>01633       <span class="keywordflow">if</span> ((map[p] &amp; 16) == 0)
<a name="l01634"></a>01634         <span class="keywordflow">continue</span>;
<a name="l01635"></a>01635       <span class="keywordflow">if</span> ((map[p] &amp; 2) != 0)
<a name="l01636"></a>01636         {
<a name="l01637"></a>01637           map[p] = 2;
<a name="l01638"></a>01638           <span class="keywordflow">continue</span>;
<a name="l01639"></a>01639         }
<a name="l01640"></a>01640       s = pool-&gt;<a class="code" href="struct__Pool.html#a9842c936aa241bad13ba13f21a337319">solvables</a> + p;
<a name="l01641"></a>01641       m = 1;
<a name="l01642"></a>01642       <span class="keywordflow">if</span> (s-&gt;<a class="code" href="struct__Solvable.html#a0920d25d5be01033af30796d19280c65">requires</a>)
<a name="l01643"></a>01643         {
<a name="l01644"></a>01644           reqp = s-&gt;<a class="code" href="struct__Solvable.html#a15e0b77fe061c6429a24215191b10f05">repo</a>-&gt;<a class="code" href="struct__Repo.html#afddcfa36231cc08266800bee5b978528">idarraydata</a> + s-&gt;<a class="code" href="struct__Solvable.html#a0920d25d5be01033af30796d19280c65">requires</a>;
<a name="l01645"></a>01645           <span class="keywordflow">while</span> ((req = *reqp++) != 0)
<a name="l01646"></a>01646             {
<a name="l01647"></a>01647               <span class="keywordflow">if</span> (req == SOLVABLE_PREREQMARKER)
<a name="l01648"></a>01648                 <span class="keywordflow">continue</span>;
<a name="l01649"></a>01649               r = <a class="code" href="pool_8c.html#a000d3a3f837a6c8e9333851ba8262c69">providedbyinstalled</a>(pool, map, req, 0, 0);
<a name="l01650"></a>01650               <span class="keywordflow">if</span> (!r)
<a name="l01651"></a>01651                 {
<a name="l01652"></a>01652                   <span class="comment">/* decided and miss */</span>
<a name="l01653"></a>01653                   map[p] = 2;
<a name="l01654"></a>01654                   <span class="keywordflow">break</span>;
<a name="l01655"></a>01655                 }
<a name="l01656"></a>01656               m |= r;   <span class="comment">/* 1 | 9 | 16 | 17 */</span>
<a name="l01657"></a>01657             }
<a name="l01658"></a>01658           <span class="keywordflow">if</span> (req)
<a name="l01659"></a>01659             <span class="keywordflow">continue</span>;
<a name="l01660"></a>01660           <span class="keywordflow">if</span> ((m &amp; 9) == 9)
<a name="l01661"></a>01661             m = 9;
<a name="l01662"></a>01662         }
<a name="l01663"></a>01663       <span class="keywordflow">if</span> (s-&gt;<a class="code" href="struct__Solvable.html#a53b6ec41be31e4aafb5a52e0c7ae2470">conflicts</a>)
<a name="l01664"></a>01664         {
<a name="l01665"></a>01665           <span class="keywordtype">int</span> ispatch = 0;      <span class="comment">/* see solver.c patch handling */</span>
<a name="l01666"></a>01666 
<a name="l01667"></a>01667           <span class="keywordflow">if</span> (!strncmp(<span class="stringliteral">&quot;patch:&quot;</span>, <a class="code" href="poolid_8c.html#a8a844727bd2258ef240555fc629b2fa7">id2str</a>(pool, s-&gt;<a class="code" href="struct__Solvable.html#a5912021e2c3fe505c24a92aa7639dff2">name</a>), 6))
<a name="l01668"></a>01668             ispatch = 1;
<a name="l01669"></a>01669           conp = s-&gt;<a class="code" href="struct__Solvable.html#a15e0b77fe061c6429a24215191b10f05">repo</a>-&gt;<a class="code" href="struct__Repo.html#afddcfa36231cc08266800bee5b978528">idarraydata</a> + s-&gt;<a class="code" href="struct__Solvable.html#a53b6ec41be31e4aafb5a52e0c7ae2470">conflicts</a>;
<a name="l01670"></a>01670           <span class="keywordflow">while</span> ((con = *conp++) != 0)
<a name="l01671"></a>01671             {
<a name="l01672"></a>01672               <span class="keywordflow">if</span> ((<a class="code" href="pool_8c.html#a000d3a3f837a6c8e9333851ba8262c69">providedbyinstalled</a>(pool, map, con, ispatch, noobsoletesmap) &amp; 1) != 0)
<a name="l01673"></a>01673                 {
<a name="l01674"></a>01674                   map[p] = 2;
<a name="l01675"></a>01675                   <span class="keywordflow">break</span>;
<a name="l01676"></a>01676                 }
<a name="l01677"></a>01677               <span class="keywordflow">if</span> ((m == 1 || m == 17) &amp;&amp; <a class="code" href="pool_8h.html#a723c8c54fdd5d81be4b612c0d2868c2d">ISRELDEP</a>(con))
<a name="l01678"></a>01678                 {
<a name="l01679"></a>01679                   con = <a class="code" href="pool_8c.html#a6f37386d3bc2aca1df7460f4017d631b">dep2name</a>(pool, con);
<a name="l01680"></a>01680                   <span class="keywordflow">if</span> ((<a class="code" href="pool_8c.html#a000d3a3f837a6c8e9333851ba8262c69">providedbyinstalled</a>(pool, map, con, ispatch, noobsoletesmap) &amp; 1) != 0)
<a name="l01681"></a>01681                     m = 9;
<a name="l01682"></a>01682                 }
<a name="l01683"></a>01683             }
<a name="l01684"></a>01684           <span class="keywordflow">if</span> (con)
<a name="l01685"></a>01685             <span class="keywordflow">continue</span>;   <span class="comment">/* found a conflict */</span>
<a name="l01686"></a>01686         }
<a name="l01687"></a>01687 <span class="preprocessor">#if 0</span>
<a name="l01688"></a>01688 <span class="preprocessor"></span>      <span class="keywordflow">if</span> (s-&gt;<a class="code" href="struct__Solvable.html#a15e0b77fe061c6429a24215191b10f05">repo</a> &amp;&amp; s-&gt;<a class="code" href="struct__Solvable.html#a15e0b77fe061c6429a24215191b10f05">repo</a> != oldinstalled)
<a name="l01689"></a>01689         {
<a name="l01690"></a>01690           <a class="code" href="pooltypes_8h.html#a2e0e6278ac51842ca3aeb53e3fc3ead6">Id</a> p2, obs, *obsp, *pp;
<a name="l01691"></a>01691           <a class="code" href="struct__Solvable.html">Solvable</a> *s2;
<a name="l01692"></a>01692           <span class="keywordflow">if</span> (s-&gt;<a class="code" href="struct__Solvable.html#a2eb11a5e84d9a4141fd44e9e9f2d0124">obsoletes</a>)
<a name="l01693"></a>01693             {
<a name="l01694"></a>01694               obsp = s-&gt;<a class="code" href="struct__Solvable.html#a15e0b77fe061c6429a24215191b10f05">repo</a>-&gt;<a class="code" href="struct__Repo.html#afddcfa36231cc08266800bee5b978528">idarraydata</a> + s-&gt;<a class="code" href="struct__Solvable.html#a2eb11a5e84d9a4141fd44e9e9f2d0124">obsoletes</a>;
<a name="l01695"></a>01695               <span class="keywordflow">while</span> ((obs = *obsp++) != 0)
<a name="l01696"></a>01696                 {
<a name="l01697"></a>01697                   <span class="keywordflow">if</span> ((<a class="code" href="pool_8c.html#a000d3a3f837a6c8e9333851ba8262c69">providedbyinstalled</a>(pool, map, obs, 0, 0) &amp; 1) != 0)
<a name="l01698"></a>01698                     {
<a name="l01699"></a>01699                       map[p] = 2;
<a name="l01700"></a>01700                       <span class="keywordflow">break</span>;
<a name="l01701"></a>01701                     }
<a name="l01702"></a>01702                 }
<a name="l01703"></a>01703               <span class="keywordflow">if</span> (obs)
<a name="l01704"></a>01704                 <span class="keywordflow">continue</span>;
<a name="l01705"></a>01705             }
<a name="l01706"></a>01706           <a class="code" href="pool_8h.html#a6529dc5dd039f8d1019aa2e6f9a9011f">FOR_PROVIDES</a>(p2, pp, s-&gt;<a class="code" href="struct__Solvable.html#a5912021e2c3fe505c24a92aa7639dff2">name</a>)
<a name="l01707"></a>01707             {
<a name="l01708"></a>01708               s2 = pool-&gt;<a class="code" href="struct__Pool.html#a9842c936aa241bad13ba13f21a337319">solvables</a> + p2;
<a name="l01709"></a>01709               <span class="keywordflow">if</span> (s2-&gt;<a class="code" href="struct__Solvable.html#a5912021e2c3fe505c24a92aa7639dff2">name</a> == s-&gt;<a class="code" href="struct__Solvable.html#a5912021e2c3fe505c24a92aa7639dff2">name</a> &amp;&amp; (map[p2] &amp; 1) != 0)
<a name="l01710"></a>01710                 {
<a name="l01711"></a>01711                   map[p] = 2;
<a name="l01712"></a>01712                   <span class="keywordflow">break</span>;
<a name="l01713"></a>01713                 }
<a name="l01714"></a>01714             }
<a name="l01715"></a>01715           <span class="keywordflow">if</span> (p2)
<a name="l01716"></a>01716             <span class="keywordflow">continue</span>;
<a name="l01717"></a>01717         }
<a name="l01718"></a>01718 <span class="preprocessor">#endif</span>
<a name="l01719"></a>01719 <span class="preprocessor"></span>      <span class="keywordflow">if</span> (m != map[p])
<a name="l01720"></a>01720         {
<a name="l01721"></a>01721           map[p] = m;
<a name="l01722"></a>01722           did = 0;
<a name="l01723"></a>01723         }
<a name="l01724"></a>01724     }
<a name="l01725"></a>01725   <a class="code" href="queue_8c.html#a701c81a9f7d503837e74d43981e79137">queue_free</a>(res);
<a name="l01726"></a>01726   <a class="code" href="queue_8c.html#ac1d41e0b06e520040213b392002aebed">queue_init_clone</a>(res, pkgs);
<a name="l01727"></a>01727   <span class="keywordflow">for</span> (i = 0; i &lt; pkgs-&gt;<a class="code" href="struct__Queue.html#abb0696a77174cd23b5f488ad4c7b45d2">count</a>; i++)
<a name="l01728"></a>01728     {
<a name="l01729"></a>01729       m = map[pkgs-&gt;<a class="code" href="struct__Queue.html#a116eb58bed8ff76bf18f9c16cf1ce5c6">elements</a>[i]];
<a name="l01730"></a>01730       <span class="keywordflow">if</span> ((m &amp; 9) == 9)
<a name="l01731"></a>01731         r = 1;
<a name="l01732"></a>01732       <span class="keywordflow">else</span> <span class="keywordflow">if</span> (m &amp; 1)
<a name="l01733"></a>01733         r = -1;
<a name="l01734"></a>01734       <span class="keywordflow">else</span>
<a name="l01735"></a>01735         r = 0;
<a name="l01736"></a>01736       res-&gt;<a class="code" href="struct__Queue.html#a116eb58bed8ff76bf18f9c16cf1ce5c6">elements</a>[i] = r;
<a name="l01737"></a>01737     }
<a name="l01738"></a>01738   free(map);
<a name="l01739"></a>01739 }
<a name="l01740"></a>01740 
<a name="l01741"></a>01741 <span class="keywordtype">void</span>
<a name="l01742"></a><a class="code" href="pool_8h.html#acebe676d452b650faad2ebd510568f95">01742</a> <a class="code" href="pool_8c.html#acebe676d452b650faad2ebd510568f95">pool_trivial_installable</a>(<a class="code" href="struct__Pool.html">Pool</a> *pool, <a class="code" href="struct__Map.html">Map</a> *installedmap, <a class="code" href="struct__Queue.html">Queue</a> *pkgs, <a class="code" href="struct__Queue.html">Queue</a> *res)
<a name="l01743"></a>01743 {
<a name="l01744"></a>01744   <a class="code" href="pool_8c.html#a9dacd221c320001836028637f4f36660">pool_trivial_installable_noobsoletesmap</a>(pool, installedmap, pkgs, res, 0);
<a name="l01745"></a>01745 }
<a name="l01746"></a>01746 
<a name="l01747"></a>01747 <span class="keyword">const</span> <span class="keywordtype">char</span> *
<a name="l01748"></a><a class="code" href="pool_8h.html#a27fb82858a6a936d95e8775391ab725b">01748</a> <a class="code" href="pool_8c.html#a27fb82858a6a936d95e8775391ab725b">pool_lookup_str</a>(<a class="code" href="struct__Pool.html">Pool</a> *pool, <a class="code" href="pooltypes_8h.html#a2e0e6278ac51842ca3aeb53e3fc3ead6">Id</a> entry, <a class="code" href="pooltypes_8h.html#a2e0e6278ac51842ca3aeb53e3fc3ead6">Id</a> keyname)
<a name="l01749"></a>01749 {
<a name="l01750"></a>01750   <span class="keywordflow">if</span> (entry == <a class="code" href="repodata_8h.html#a0ef5f441da792e7d3eafa46d97c389db">SOLVID_POS</a> &amp;&amp; pool-&gt;<a class="code" href="struct__Pool.html#abe637b2c911c90240c4941ae0eea3796">pos</a>.<a class="code" href="struct__Repopos.html#ae158182ea6359a09928233e686fc7c81">repo</a>)
<a name="l01751"></a>01751     <span class="keywordflow">return</span> <a class="code" href="repodata_8c.html#a218b2405f5c8938d90bbb20ca012b2e3">repodata_lookup_str</a>(pool-&gt;<a class="code" href="struct__Pool.html#abe637b2c911c90240c4941ae0eea3796">pos</a>.<a class="code" href="struct__Repopos.html#ae158182ea6359a09928233e686fc7c81">repo</a>-&gt;<a class="code" href="struct__Repo.html#a2dfdb93a6ac25e5b52d874f8c2a40ecc">repodata</a> + pool-&gt;<a class="code" href="struct__Pool.html#abe637b2c911c90240c4941ae0eea3796">pos</a>.<a class="code" href="struct__Repopos.html#aafe52247b3327641b7cb0edd1faa31c4">repodataid</a>, <a class="code" href="repodata_8h.html#a0ef5f441da792e7d3eafa46d97c389db">SOLVID_POS</a>, keyname);
<a name="l01752"></a>01752   <span class="keywordflow">if</span> (entry &lt;= 0)
<a name="l01753"></a>01753     <span class="keywordflow">return</span> 0;
<a name="l01754"></a>01754   <span class="keywordflow">return</span> <a class="code" href="pool_8h.html#accb5429320ec3e5fdc24e8766935d8e8">solvable_lookup_str</a>(pool-&gt;<a class="code" href="struct__Pool.html#a9842c936aa241bad13ba13f21a337319">solvables</a> + entry, keyname);
<a name="l01755"></a>01755 }
<a name="l01756"></a>01756 
<a name="l01757"></a>01757 <a class="code" href="pooltypes_8h.html#a2e0e6278ac51842ca3aeb53e3fc3ead6">Id</a>
<a name="l01758"></a><a class="code" href="pool_8h.html#af98073aa0a326ea11690e5369524191e">01758</a> <a class="code" href="pool_8c.html#af98073aa0a326ea11690e5369524191e">pool_lookup_id</a>(<a class="code" href="struct__Pool.html">Pool</a> *pool, <a class="code" href="pooltypes_8h.html#a2e0e6278ac51842ca3aeb53e3fc3ead6">Id</a> entry, <a class="code" href="pooltypes_8h.html#a2e0e6278ac51842ca3aeb53e3fc3ead6">Id</a> keyname)
<a name="l01759"></a>01759 {
<a name="l01760"></a>01760   <span class="keywordflow">if</span> (entry == <a class="code" href="repodata_8h.html#a0ef5f441da792e7d3eafa46d97c389db">SOLVID_POS</a> &amp;&amp; pool-&gt;<a class="code" href="struct__Pool.html#abe637b2c911c90240c4941ae0eea3796">pos</a>.<a class="code" href="struct__Repopos.html#ae158182ea6359a09928233e686fc7c81">repo</a>)
<a name="l01761"></a>01761     {
<a name="l01762"></a>01762       <a class="code" href="struct__Repodata.html">Repodata</a> *data = pool-&gt;<a class="code" href="struct__Pool.html#abe637b2c911c90240c4941ae0eea3796">pos</a>.<a class="code" href="struct__Repopos.html#ae158182ea6359a09928233e686fc7c81">repo</a>-&gt;<a class="code" href="struct__Repo.html#a2dfdb93a6ac25e5b52d874f8c2a40ecc">repodata</a> + pool-&gt;<a class="code" href="struct__Pool.html#abe637b2c911c90240c4941ae0eea3796">pos</a>.<a class="code" href="struct__Repopos.html#aafe52247b3327641b7cb0edd1faa31c4">repodataid</a>;
<a name="l01763"></a>01763       <a class="code" href="pooltypes_8h.html#a2e0e6278ac51842ca3aeb53e3fc3ead6">Id</a> <span class="keywordtype">id</span> = <a class="code" href="repodata_8c.html#aa9b8b91350d8dea70d924cf7f56d50b1">repodata_lookup_id</a>(data, <a class="code" href="repodata_8h.html#a0ef5f441da792e7d3eafa46d97c389db">SOLVID_POS</a>, keyname);
<a name="l01764"></a>01764       <span class="keywordflow">return</span> data-&gt;<a class="code" href="struct__Repodata.html#ab8a9609e3952d09489ca2b61473afdbb">localpool</a> ? <a class="code" href="repodata_8c.html#ad4d0b25d596c26474fe112c73b2c24c8">repodata_globalize_id</a>(data, <span class="keywordtype">id</span>, 1) : id;
<a name="l01765"></a>01765     }
<a name="l01766"></a>01766   <span class="keywordflow">if</span> (entry &lt;= 0)
<a name="l01767"></a>01767     <span class="keywordflow">return</span> 0;
<a name="l01768"></a>01768   <span class="keywordflow">return</span> <a class="code" href="pool_8h.html#a2267fd23b3db64a32b7d1c5937d07bee">solvable_lookup_id</a>(pool-&gt;<a class="code" href="struct__Pool.html#a9842c936aa241bad13ba13f21a337319">solvables</a> + entry, keyname);
<a name="l01769"></a>01769 }
<a name="l01770"></a>01770 
<a name="l01771"></a>01771 <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>
<a name="l01772"></a><a class="code" href="pool_8h.html#af74833ff5f4dd24543a12337e4d70057">01772</a> <a class="code" href="pool_8c.html#af74833ff5f4dd24543a12337e4d70057">pool_lookup_num</a>(<a class="code" href="struct__Pool.html">Pool</a> *pool, <a class="code" href="pooltypes_8h.html#a2e0e6278ac51842ca3aeb53e3fc3ead6">Id</a> entry, <a class="code" href="pooltypes_8h.html#a2e0e6278ac51842ca3aeb53e3fc3ead6">Id</a> keyname, <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> notfound)
<a name="l01773"></a>01773 {
<a name="l01774"></a>01774   <span class="keywordflow">if</span> (entry == <a class="code" href="repodata_8h.html#a0ef5f441da792e7d3eafa46d97c389db">SOLVID_POS</a> &amp;&amp; pool-&gt;<a class="code" href="struct__Pool.html#abe637b2c911c90240c4941ae0eea3796">pos</a>.<a class="code" href="struct__Repopos.html#ae158182ea6359a09928233e686fc7c81">repo</a>)
<a name="l01775"></a>01775     {
<a name="l01776"></a>01776       <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> value;
<a name="l01777"></a>01777       <span class="keywordflow">if</span> (<a class="code" href="repodata_8c.html#a3c10e38b95c289b5aec717eec6b532fa">repodata_lookup_num</a>(pool-&gt;<a class="code" href="struct__Pool.html#abe637b2c911c90240c4941ae0eea3796">pos</a>.<a class="code" href="struct__Repopos.html#ae158182ea6359a09928233e686fc7c81">repo</a>-&gt;<a class="code" href="struct__Repo.html#a2dfdb93a6ac25e5b52d874f8c2a40ecc">repodata</a> + pool-&gt;<a class="code" href="struct__Pool.html#abe637b2c911c90240c4941ae0eea3796">pos</a>.<a class="code" href="struct__Repopos.html#aafe52247b3327641b7cb0edd1faa31c4">repodataid</a>, <a class="code" href="repodata_8h.html#a0ef5f441da792e7d3eafa46d97c389db">SOLVID_POS</a>, keyname, &amp;value))
<a name="l01778"></a>01778         <span class="keywordflow">return</span> value;
<a name="l01779"></a>01779       <span class="keywordflow">return</span> notfound;
<a name="l01780"></a>01780     }
<a name="l01781"></a>01781   <span class="keywordflow">if</span> (entry &lt;= 0)
<a name="l01782"></a>01782     <span class="keywordflow">return</span> notfound;
<a name="l01783"></a>01783   <span class="keywordflow">return</span> <a class="code" href="pool_8h.html#a441b6e6c581a991a6f2b7abf40a5639a">solvable_lookup_num</a>(pool-&gt;<a class="code" href="struct__Pool.html#a9842c936aa241bad13ba13f21a337319">solvables</a> + entry, keyname, notfound);
<a name="l01784"></a>01784 }
<a name="l01785"></a>01785 
<a name="l01786"></a>01786 <span class="keywordtype">int</span>
<a name="l01787"></a><a class="code" href="pool_8h.html#a5dc9db4caacd8621c6ccd91d9f011743">01787</a> <a class="code" href="pool_8c.html#a5dc9db4caacd8621c6ccd91d9f011743">pool_lookup_void</a>(<a class="code" href="struct__Pool.html">Pool</a> *pool, <a class="code" href="pooltypes_8h.html#a2e0e6278ac51842ca3aeb53e3fc3ead6">Id</a> entry, <a class="code" href="pooltypes_8h.html#a2e0e6278ac51842ca3aeb53e3fc3ead6">Id</a> keyname)
<a name="l01788"></a>01788 {
<a name="l01789"></a>01789   <span class="keywordflow">if</span> (entry == <a class="code" href="repodata_8h.html#a0ef5f441da792e7d3eafa46d97c389db">SOLVID_POS</a> &amp;&amp; pool-&gt;<a class="code" href="struct__Pool.html#abe637b2c911c90240c4941ae0eea3796">pos</a>.<a class="code" href="struct__Repopos.html#ae158182ea6359a09928233e686fc7c81">repo</a>)
<a name="l01790"></a>01790     <span class="keywordflow">return</span> <a class="code" href="repodata_8c.html#a6993f0560c51e170d2e6873fc20d4955">repodata_lookup_void</a>(pool-&gt;<a class="code" href="struct__Pool.html#abe637b2c911c90240c4941ae0eea3796">pos</a>.<a class="code" href="struct__Repopos.html#ae158182ea6359a09928233e686fc7c81">repo</a>-&gt;<a class="code" href="struct__Repo.html#a2dfdb93a6ac25e5b52d874f8c2a40ecc">repodata</a> + pool-&gt;<a class="code" href="struct__Pool.html#abe637b2c911c90240c4941ae0eea3796">pos</a>.<a class="code" href="struct__Repopos.html#aafe52247b3327641b7cb0edd1faa31c4">repodataid</a>, <a class="code" href="repodata_8h.html#a0ef5f441da792e7d3eafa46d97c389db">SOLVID_POS</a>, keyname);
<a name="l01791"></a>01791   <span class="keywordflow">if</span> (entry &lt;= 0)
<a name="l01792"></a>01792     <span class="keywordflow">return</span> 0;
<a name="l01793"></a>01793   <span class="keywordflow">return</span> <a class="code" href="pool_8h.html#a358a9d4574fac40ce7936f75204f8920">solvable_lookup_void</a>(pool-&gt;<a class="code" href="struct__Pool.html#a9842c936aa241bad13ba13f21a337319">solvables</a> + entry, keyname);
<a name="l01794"></a>01794 }
<a name="l01795"></a>01795 
<a name="l01796"></a>01796 <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *
<a name="l01797"></a><a class="code" href="pool_8h.html#a9eb46ac8b2ab2f42ac3afe9d7878f2fd">01797</a> <a class="code" href="pool_8c.html#a9eb46ac8b2ab2f42ac3afe9d7878f2fd">pool_lookup_bin_checksum</a>(<a class="code" href="struct__Pool.html">Pool</a> *pool, <a class="code" href="pooltypes_8h.html#a2e0e6278ac51842ca3aeb53e3fc3ead6">Id</a> entry, <a class="code" href="pooltypes_8h.html#a2e0e6278ac51842ca3aeb53e3fc3ead6">Id</a> keyname, <a class="code" href="pooltypes_8h.html#a2e0e6278ac51842ca3aeb53e3fc3ead6">Id</a> *typep)
<a name="l01798"></a>01798 {
<a name="l01799"></a>01799   <span class="keywordflow">if</span> (entry == <a class="code" href="repodata_8h.html#a0ef5f441da792e7d3eafa46d97c389db">SOLVID_POS</a> &amp;&amp; pool-&gt;<a class="code" href="struct__Pool.html#abe637b2c911c90240c4941ae0eea3796">pos</a>.<a class="code" href="struct__Repopos.html#ae158182ea6359a09928233e686fc7c81">repo</a>)
<a name="l01800"></a>01800     <span class="keywordflow">return</span> <a class="code" href="repodata_8c.html#a795d89bae85c507a5e238180f662a5a4">repodata_lookup_bin_checksum</a>(pool-&gt;<a class="code" href="struct__Pool.html#abe637b2c911c90240c4941ae0eea3796">pos</a>.<a class="code" href="struct__Repopos.html#ae158182ea6359a09928233e686fc7c81">repo</a>-&gt;<a class="code" href="struct__Repo.html#a2dfdb93a6ac25e5b52d874f8c2a40ecc">repodata</a> + pool-&gt;<a class="code" href="struct__Pool.html#abe637b2c911c90240c4941ae0eea3796">pos</a>.<a class="code" href="struct__Repopos.html#aafe52247b3327641b7cb0edd1faa31c4">repodataid</a>, <a class="code" href="repodata_8h.html#a0ef5f441da792e7d3eafa46d97c389db">SOLVID_POS</a>, keyname, typep);
<a name="l01801"></a>01801   <span class="keywordflow">if</span> (entry &lt;= 0)
<a name="l01802"></a>01802     <span class="keywordflow">return</span> 0;
<a name="l01803"></a>01803   <span class="keywordflow">return</span> <a class="code" href="pool_8h.html#ab0fb20a2034cf0d0d860b4867d3bf0a5">solvable_lookup_bin_checksum</a>(pool-&gt;<a class="code" href="struct__Pool.html#a9842c936aa241bad13ba13f21a337319">solvables</a> + entry, keyname, typep);
<a name="l01804"></a>01804 }
<a name="l01805"></a>01805 
<a name="l01806"></a>01806 <span class="keyword">const</span> <span class="keywordtype">char</span> *
<a name="l01807"></a><a class="code" href="pool_8h.html#abb4d92d0d9944b3cae4f8978dbc8820b">01807</a> <a class="code" href="pool_8c.html#abb4d92d0d9944b3cae4f8978dbc8820b">pool_lookup_checksum</a>(<a class="code" href="struct__Pool.html">Pool</a> *pool, <a class="code" href="pooltypes_8h.html#a2e0e6278ac51842ca3aeb53e3fc3ead6">Id</a> entry, <a class="code" href="pooltypes_8h.html#a2e0e6278ac51842ca3aeb53e3fc3ead6">Id</a> keyname, <a class="code" href="pooltypes_8h.html#a2e0e6278ac51842ca3aeb53e3fc3ead6">Id</a> *typep)
<a name="l01808"></a>01808 {
<a name="l01809"></a>01809   <span class="keywordflow">if</span> (entry == <a class="code" href="repodata_8h.html#a0ef5f441da792e7d3eafa46d97c389db">SOLVID_POS</a> &amp;&amp; pool-&gt;<a class="code" href="struct__Pool.html#abe637b2c911c90240c4941ae0eea3796">pos</a>.<a class="code" href="struct__Repopos.html#ae158182ea6359a09928233e686fc7c81">repo</a>)
<a name="l01810"></a>01810     {
<a name="l01811"></a>01811       <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *chk = <a class="code" href="repodata_8c.html#a795d89bae85c507a5e238180f662a5a4">repodata_lookup_bin_checksum</a>(pool-&gt;<a class="code" href="struct__Pool.html#abe637b2c911c90240c4941ae0eea3796">pos</a>.<a class="code" href="struct__Repopos.html#ae158182ea6359a09928233e686fc7c81">repo</a>-&gt;<a class="code" href="struct__Repo.html#a2dfdb93a6ac25e5b52d874f8c2a40ecc">repodata</a> + pool-&gt;<a class="code" href="struct__Pool.html#abe637b2c911c90240c4941ae0eea3796">pos</a>.<a class="code" href="struct__Repopos.html#aafe52247b3327641b7cb0edd1faa31c4">repodataid</a>, <a class="code" href="repodata_8h.html#a0ef5f441da792e7d3eafa46d97c389db">SOLVID_POS</a>, keyname, typep);
<a name="l01812"></a>01812       <span class="keywordflow">return</span> chk ? <a class="code" href="repodata_8c.html#a06c55f4640eac033bbd5bf9d244eba1f">repodata_chk2str</a>(pool-&gt;<a class="code" href="struct__Pool.html#abe637b2c911c90240c4941ae0eea3796">pos</a>.<a class="code" href="struct__Repopos.html#ae158182ea6359a09928233e686fc7c81">repo</a>-&gt;<a class="code" href="struct__Repo.html#a2dfdb93a6ac25e5b52d874f8c2a40ecc">repodata</a> + pool-&gt;<a class="code" href="struct__Pool.html#abe637b2c911c90240c4941ae0eea3796">pos</a>.<a class="code" href="struct__Repopos.html#aafe52247b3327641b7cb0edd1faa31c4">repodataid</a>, *typep, chk) : 0;
<a name="l01813"></a>01813     }
<a name="l01814"></a>01814   <span class="keywordflow">if</span> (entry &lt;= 0)
<a name="l01815"></a>01815     <span class="keywordflow">return</span> 0;
<a name="l01816"></a>01816   <span class="keywordflow">return</span> <a class="code" href="pool_8h.html#add352c5960652b093fa71e7c78c454fc">solvable_lookup_checksum</a>(pool-&gt;<a class="code" href="struct__Pool.html#a9842c936aa241bad13ba13f21a337319">solvables</a> + entry, keyname, typep);
<a name="l01817"></a>01817 }
<a name="l01818"></a>01818 
<a name="l01819"></a>01819 <span class="keywordtype">void</span>
<a name="l01820"></a><a class="code" href="pool_8h.html#a044424afd5118109ead346e2ad60a15b">01820</a> <a class="code" href="pool_8c.html#a044424afd5118109ead346e2ad60a15b">pool_add_fileconflicts_deps</a>(<a class="code" href="struct__Pool.html">Pool</a> *pool, <a class="code" href="struct__Queue.html">Queue</a> *conflicts)
<a name="l01821"></a>01821 {
<a name="l01822"></a>01822   <span class="keywordtype">int</span> hadhashes = pool-&gt;<a class="code" href="struct__Pool.html#a704880ffb86517378f160964dda33938">relhashtbl</a> ? 1 : 0;
<a name="l01823"></a>01823   <a class="code" href="struct__Solvable.html">Solvable</a> *s;
<a name="l01824"></a>01824   <a class="code" href="pooltypes_8h.html#a2e0e6278ac51842ca3aeb53e3fc3ead6">Id</a> fn, p, q, md5;
<a name="l01825"></a>01825   <a class="code" href="pooltypes_8h.html#a2e0e6278ac51842ca3aeb53e3fc3ead6">Id</a> id;
<a name="l01826"></a>01826   <span class="keywordtype">int</span> i;
<a name="l01827"></a>01827 
<a name="l01828"></a>01828   <span class="keywordflow">if</span> (!conflicts-&gt;<a class="code" href="struct__Queue.html#abb0696a77174cd23b5f488ad4c7b45d2">count</a>)
<a name="l01829"></a>01829     <span class="keywordflow">return</span>;
<a name="l01830"></a>01830   <a class="code" href="pool_8c.html#a14dd275466a52e37d15ba44422bffe81">pool_freewhatprovides</a>(pool);
<a name="l01831"></a>01831   <span class="keywordflow">for</span> (i = 0; i &lt; conflicts-&gt;<a class="code" href="struct__Queue.html#abb0696a77174cd23b5f488ad4c7b45d2">count</a>; i += 5)
<a name="l01832"></a>01832     {
<a name="l01833"></a>01833       fn = conflicts-&gt;<a class="code" href="struct__Queue.html#a116eb58bed8ff76bf18f9c16cf1ce5c6">elements</a>[i];
<a name="l01834"></a>01834       p = conflicts-&gt;<a class="code" href="struct__Queue.html#a116eb58bed8ff76bf18f9c16cf1ce5c6">elements</a>[i + 1];
<a name="l01835"></a>01835       md5 = conflicts-&gt;<a class="code" href="struct__Queue.html#a116eb58bed8ff76bf18f9c16cf1ce5c6">elements</a>[i + 2];
<a name="l01836"></a>01836       q = conflicts-&gt;<a class="code" href="struct__Queue.html#a116eb58bed8ff76bf18f9c16cf1ce5c6">elements</a>[i + 3];
<a name="l01837"></a>01837       <span class="keywordtype">id</span> = <a class="code" href="poolid_8c.html#a1c3249070e21c2240cffc54ede1d78a5">rel2id</a>(pool, fn, md5, <a class="code" href="pool_8h.html#ae76a4247e589585ea45295087a8bc806">REL_FILECONFLICT</a>, 1);
<a name="l01838"></a>01838       s = pool-&gt;<a class="code" href="struct__Pool.html#a9842c936aa241bad13ba13f21a337319">solvables</a> + p;
<a name="l01839"></a>01839       <span class="keywordflow">if</span> (!s-&gt;<a class="code" href="struct__Solvable.html#a15e0b77fe061c6429a24215191b10f05">repo</a>)
<a name="l01840"></a>01840         <span class="keywordflow">continue</span>;
<a name="l01841"></a>01841       s-&gt;<a class="code" href="struct__Solvable.html#aca85fe4ba80026035c22f0596db71657">provides</a> = <a class="code" href="repo_8c.html#ad035ce4b23179cd53edc538c834b27bd">repo_addid_dep</a>(s-&gt;<a class="code" href="struct__Solvable.html#a15e0b77fe061c6429a24215191b10f05">repo</a>, s-&gt;<a class="code" href="struct__Solvable.html#aca85fe4ba80026035c22f0596db71657">provides</a>, <span class="keywordtype">id</span>, SOLVABLE_FILEMARKER);
<a name="l01842"></a>01842       s = pool-&gt;<a class="code" href="struct__Pool.html#a9842c936aa241bad13ba13f21a337319">solvables</a> + q;
<a name="l01843"></a>01843       <span class="keywordflow">if</span> (!s-&gt;<a class="code" href="struct__Solvable.html#a15e0b77fe061c6429a24215191b10f05">repo</a>)
<a name="l01844"></a>01844         <span class="keywordflow">continue</span>;
<a name="l01845"></a>01845       s-&gt;<a class="code" href="struct__Solvable.html#a53b6ec41be31e4aafb5a52e0c7ae2470">conflicts</a> = <a class="code" href="repo_8c.html#ad035ce4b23179cd53edc538c834b27bd">repo_addid_dep</a>(s-&gt;<a class="code" href="struct__Solvable.html#a15e0b77fe061c6429a24215191b10f05">repo</a>, s-&gt;<a class="code" href="struct__Solvable.html#a53b6ec41be31e4aafb5a52e0c7ae2470">conflicts</a>, <span class="keywordtype">id</span>, 0);
<a name="l01846"></a>01846     }
<a name="l01847"></a>01847   <span class="keywordflow">if</span> (!hadhashes)
<a name="l01848"></a>01848     <a class="code" href="poolid_8c.html#a7fc8f28d414b0a5aa3016a4f60a93eae">pool_freeidhashes</a>(pool);
<a name="l01849"></a>01849 }
<a name="l01850"></a>01850 
<a name="l01851"></a>01851 <span class="comment">/* EOF */</span>
</pre></div></div>
</div>
<hr class="footer"/><address class="footer"><small>Generated on Sun Oct 17 2010 15:21:21 for satsolver by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.7.1 </small></address>
</body>
</html>
