<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>satsolver: The Pool</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<!-- Generated by Doxygen 1.7.1 -->
<div class="navigation" id="top">
  <div class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&nbsp;Page</span></a></li>
      <li class="current"><a href="pages.html"><span>Related&nbsp;Pages</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li><a href="dirs.html"><span>Directories</span></a></li>
    </ul>
  </div>
</div>
<div class="header">
  <div class="headertitle">
<h1>The Pool </h1>  </div>
</div>
<div class="contents">
<h2><a class="anchor" id="pool-intro"></a>
Pool Introduction</h2>
<p>The pool contains all information required for dependency solving.</p>
<ul>
<li>names 'foo', 'bar', 'baz'</li>
<li>reldeps 'foo &gt; 1.0', 'bar == 42.17-33'</li>
<li>solvables name-epoch:version-release.arch + dependencies</li>
</ul>
<p>Main purpose of the pool is efficient storage of data in terms of memory consumption and access time.</p>
<p>The pool is created by reading one or more 'sources', metadata repositories. The rpmdb (installed software) is passed explicit to the solver.</p>
<h3><a class="anchor" id="pool-string"></a>
Strings</h3>
<ul>
<li>names are stored as strings </li>
<li>all string data is kept in hashtable </li>
<li>strings in the hashtable are unique </li>
<li>strings are represented as 'Id' </li>
<li>string comparison is done by Id comparison</li>
</ul>
<p>Pool has 'void *stringspace' pointing to allocated memory Pool has 'off_t strings[Id]', giving an offset into 'stringspace' for each Id</p>
<p>Buffers are allocated in blocks</p>
<p>STRING_BLOCK the hashtable for strings is resized in these steps STRINGSPACE_BLOCK increments size for string buffer</p>
<h4><a class="anchor" id="pool-normal-strings"></a>
Normal strings</h4>
<p>stringspace + strings[id]</p>
<h4><a class="anchor" id="pool-rel-strings"></a>
Rel expressions</h4>
<p>stringspace + strings[Reldep-&gt;name]</p>
<p>Rel Ids have the 31st bit set</p>
<h3><a class="anchor" id="string-to-id"></a>
String -&gt; Id</h3>
<dl class="see"><dt><b>See also:</b></dt><dd><a class="el" href="poolid_8h.html#aad211acfcfd6acb19242b9d607692a4a">str2id</a></dd></dl>
<h3><a class="anchor" id="id-to-string"></a>
Id -&gt; String</h3>
<dl class="see"><dt><b>See also:</b></dt><dd><a class="el" href="poolid_8h.html#afca59869487b48ff1522b0bf89aabf5b">id2str</a></dd></dl>
<h3><a class="anchor" id="pool-string-edition"></a>
Edition</h3>
<p>The edition is the combination of epoch (e), version (v) and release (r) and used for comparing package 'ages' (usually named versions)</p>
<p>The string representation of an edition is </p>
<div class="fragment"><pre class="fragment"><span class="stringliteral">&#39;&lt;e&gt;:&lt;v&gt;-&lt;r&gt;&#39;</span>
</pre></div><p>An empty epoch is considered zero (0) An empty version is considered ? An empty release is considered ?</p>
<h2><a class="anchor" id="pool-comparing-editions"></a>
Comparing editions</h2>
<p>The following comparison rules apply</p>
<div class="fragment"><pre class="fragment">  <span class="keywordflow">if</span> (e1 != e2)
    <span class="keywordflow">return</span> e1 &lt; e2;
  <span class="keywordflow">else</span> <span class="keywordflow">if</span> (v1 != v2)
    <span class="keywordflow">return</span> v1 &lt; v2;
  <span class="keywordflow">else</span>
    <span class="keywordflow">return</span> r1 &lt; r2;
</pre></div><p>Names can have editions and compared against editions.</p>
<p>In comparisons, empty values within the edition are treated as 'any'</p>
<p>Example:</p>
<ul>
<li>A: name == 1.0 </li>
<li>B: name &gt;= 1:2.3-4</li>
</ul>
<p>A name without any edition is said to provide 'all editions'.</p>
<p>'name-1.0-42' matches A, 'name-1:1.0' does not.</p>
<h2><a class="anchor" id="pool-reldeps"></a>
RelDeps</h2>
<p>A relation is the tuple (name, operator, edition) used to express dependencies on ranges.</p>
<h2><a class="anchor" id="pool-solvable"></a>
Solvable</h2>
<p>A solvable contains all package information required for dependency solving.</p>
<p>Solvables as referenced by Id, pointing into 'pool.solvables'. There are 'pool.nsolvables-1' number of solvables.</p>
<p>There is no solvable with Id 0, this Id is reserved and serves as an 'end' indicator in lists of solvables.</p>
<h2><a class="anchor" id="pool-string-vs-rels"></a>
Strings vs. Relations</h2>
<p>Relations (i.e. &lt;name&gt;&lt;flag&gt;&lt;evr&gt;) and Strings (&lt;name&gt;) are encoded as Ids. Relations have the 32th bit set. The pool contains a relation dictionary next to the string dictionary.</p>
<p>Here's an example</p>
<p>String dict: 2 -&gt; bash 3 -&gt; zlib 4 -&gt; 1.2.3</p>
<p>Relation dict: 1 -&gt; 3 &gt;= 4 (i.e. zlib &gt;= 1.2.3)</p>
<p>Some package provides: 2, 0x80000001 (i.e. bash, zlib &gt;= 1.2.3) </p>
</div>
<hr class="footer"/><address class="footer"><small>Generated on Sun Oct 17 2010 15:21:23 for satsolver by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.7.1 </small></address>
</body>
</html>
